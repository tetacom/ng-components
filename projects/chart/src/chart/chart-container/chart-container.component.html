<ng-container *ngIf="{
  size: size | async,
  config: config | async,
  yMap: yMap | async,
  xMap: xMap | async,
  visibleRect: visibleRect | async,
  brushScale: brushScale | async
} as data" xmlns:svg="http://www.w3.org/1999/html">
  <teta-tooltip *ngIf="data.config?.tooltip?.enable"
                [size]="data.size"
                [config]="data.config"></teta-tooltip>
  <ng-container *ngIf="data.visibleRect?.width > 0 && data.visibleRect?.height > 0 && data.xMap.size === data.config?.xAxis?.length && data.yMap.size === data.config?.yAxis?.length">
    <svg height="100%" width="100%" class="position-absolute">
      <g class="y-axis-container">
        <ng-container *ngFor="let item of data.yMap | keyvalue; trackBy: identify">
          <ng-container *ngIf="item.value.options.visible">
            <g
              teta-y-axis
              [axis]="item.value"
              [size]="data.visibleRect"
              [attr.transform]="getTranslate(item.value, data.size) | async"></g>
            <rect
              tetaZoomable
              fill-opacity="0"
              [brushScale]="data.brushScale"
              [scale]="data.yMap.get(item.key).scale"
              [axis]="item.value"
              [config]="data.config"
              [size]="data.visibleRect"
              [attr.x]="item.value.options.opposite ? 0 : -item.value.selfSize"
              [attr.y]="0"
              [attr.height]="data.visibleRect.height"
              [attr.width]="item.value.selfSize"
              [attr.transform]="getTranslate(item.value, data.size) | async"></rect>
          </ng-container>

        </ng-container>
      </g>
      <g class="x-axis-container">
        <ng-container *ngFor="let item of data.xMap | keyvalue; trackBy: identify">
          <ng-container *ngIf="item.value.options.visible && data.xMap.size === data.config?.xAxis?.length && data.yMap.size === data.config?.yAxis?.length">
            <g
              teta-x-axis
              [axis]="item.value"
              [size]="data.visibleRect"
              [attr.transform]="getTranslate(item.value, data.size) | async"></g>
            <rect
              tetaZoomable
              fill-opacity="0"
              [brushScale]="data.brushScale"
              [scale]="data.xMap.get(item.key).scale"
              [axis]="item.value"
              [config]="data.config"
              [size]="data.visibleRect"
              [attr.x]="0"
              [attr.y]="item.value.options.opposite ? -item.value.selfSize : 0"
              [attr.width]="data.visibleRect.width"
              [attr.height]="item.value.selfSize"
              [attr.transform]="getTranslate(item.value, data.size) | async"></rect>
          </ng-container>
        </ng-container>
      </g>
    </svg>
  </ng-container>
  <ng-container *ngIf="data.visibleRect?.width > 0 && data.visibleRect?.height > 0 && data.xMap.size === data.config?.xAxis?.length && data.yMap.size === data.config?.yAxis?.length">
    <svg
      tetaBrushable
      tetaZoomable
      class="position-absolute"
      [size]="data.visibleRect"
      [brushScale]="data.brushScale"
      [scale]="data.brushScale"
      [config]="data.config"
      [axis]="data.config?.zoom?.type === zoomType.x ? data.xMap.get(0) : data.yMap.get(0)"
      [attr.width]="data.visibleRect.width"
      [attr.height]="data.visibleRect.height"
      [attr.viewBox]="'0 0 ' + data.visibleRect.width + ' ' + data.visibleRect.height"
      [style.transform]="'translate('+ data.visibleRect.x +'px, '+ data.visibleRect.y +'px)'"
      (contextmenu)="contextMenu($event, data.xMap, data.yMap)"
      (click)="click($event, data.xMap, data.yMap)"
      (mouseleave)="mouseLeave($event)"
      (mousemove)="mouseMove($event)">

      <g class="gridlines"
         teta-gridlines
         *ngIf="data.config.gridLines?.enable !== false"
         [size]="data.size"></g>

      <g class="x-axis-plotband-container">
        <ng-container *ngFor="let axis of data.config.xAxis; let i = index">
          <g teta-plot-band *ngFor="let plotBand of axis.plotBands"
             [plotBand]="plotBand"
             [scale]="data.xMap.get(i).scale"
             [size]="data.size"
             [axis]="data.xMap.get(i)"></g>
        </ng-container>
      </g>
      <g class="y-axis-plotband-container">
        <ng-container *ngFor="let axis of data.config.yAxis; let i = index">
          <g teta-plot-band *ngFor="let plotBand of axis.plotBands"
             [plotBand]="plotBand"
             [scale]="data.yMap.get(i).scale"
             [size]="data.size"
             [axis]="data.yMap.get(i)"></g>
        </ng-container>
      </g>
      <g class="x-axis-plotline-container">
        <ng-container *ngFor="let axis of data.config.xAxis; let i = index">
          <g teta-plot-line *ngFor="let plotLine of axis.plotLines"
             [plotLine]="plotLine"
             [scale]="data.xMap.get(i).scale"
             [size]="data.size"
             [axis]="data.xMap.get(i)"></g>
        </ng-container>
      </g>
      <g class="y-axis-plotline-container">
        <ng-container *ngFor="let axis of data.config.yAxis; let i = index">
          <g teta-plot-line *ngFor="let plotLine of axis.plotLines"
             [plotLine]="plotLine"
             [scale]="data.yMap.get(i).scale"
             [size]="data.size"
             [axis]="data.yMap.get(i)"></g>
        </ng-container>
      </g>
      <g class="series-container">
        <ng-container *ngFor="let series of data.config.series">
          <g teta-series-host
             *ngIf="series.visible"
             [config]="data.config"
             [series]="series"></g>
        </ng-container>
      </g>
      <g class="annotations">
        <g teta-annotation
           *ngFor="let annotation of data.config.annotations"
           [annotation]="annotation"></g>
      </g>
      <g class="crosshair" *ngIf="data.config.tooltip?.showCrosshair">
        <g teta-crosshair [size]="data.visibleRect"></g>
      </g>
    </svg>

  </ng-container>
</ng-container>

<ng-container *ngIf="{
  size: size | async,
  config: config | async,
  xAxisMap: xAxisMap | async,
  yAxisMap: yAxisMap | async,
  xScaleMap: xScaleMap | async,
  yScaleMap: yScaleMap | async
} as data">

  <teta-tooltip *ngIf="data.config?.tooltip?.enable" [size]="data.size" [config]="data.config"></teta-tooltip>
  <svg height="100%" width="100%" class="position-absolute">
    <g class="y-axis-container">
      <ng-container *ngFor="let item of data.yAxisMap | keyvalue; trackBy: identify">
        <ng-container *ngIf="item.value.options.visible">
          <g
            teta-y-axis
            [axis]="item.value"
            [scale]="data.yScaleMap.get(item.key)"
            [size]="data.size"
            [attr.transform]="getTranslate(item.value, data.size) | async"></g>
          <rect
            tetaZoomable
            fill-opacity="0"
            [axis]="item.value"
            [config]="config | async"
            [size]="data.size"
            [attr.x]="item.value.options.opposite ? 0 : -item.value.selfSize"
            [attr.y]="0"
            [attr.height]="data.size.width"
            [attr.width]="item.value.selfSize"
            [attr.transform]="getTranslate(item.value, data.size) | async"></rect>
        </ng-container>

      </ng-container>
    </g>
    <g class="x-axis-container">
      <ng-container *ngFor="let item of data.xAxisMap | keyvalue; trackBy: identify">
        <ng-container *ngIf="item.value.options.visible">
          <g
            teta-x-axis
            [axis]="item.value"
            [scale]="data.xScaleMap.get(item.key)"
            [size]="data.size"
            [attr.transform]="getTranslate(item.value, data.size) | async"></g>

          <rect
            tetaZoomable
            fill-opacity="0"
            [axis]="item.value"
            [config]="config | async"
            [size]="data.size"
            [attr.x]="0"
            [attr.y]="0"
            [attr.width]="data.size.width"
            [attr.height]="item.value.selfSize"
            [attr.transform]="getTranslate(item.value, data.size) | async"></rect>
        </ng-container>

      </ng-container>
    </g>
  </svg>
  <ng-container *ngIf="visibleRect | async as rect">
    <svg
      tetaBrushable
      tetaZoomable
      [size]="data.size"
      [brushScale]="brushScale | async"
      [config]="config | async"
      [attr.width]="rect.width"
      [attr.height]="rect.height"
      [attr.transform]="'translate('+ rect.x +', '+ rect.y +')'"
      [attr.viewBox]="'0 0 ' + rect.width + ' ' + rect.height"
      (mouseleave)="mouseLeave($event)"
      (mousemove)="mouseMove($event)">
      <g>
        <g>
          <g class="gridlines"
             teta-gridlines
             [size]="data.size"
             [xScaleMap]="data.xScaleMap"
             [yScaleMap]="data.yScaleMap"></g>
          <g class="x-axis-plotline-container">
            <ng-container *ngFor="let axis of data.config.xAxis; let i = index">
              <g teta-plot-line *ngFor="let plotLine of axis.plotLines"
                 [plotLine]="plotLine"
                 [scale]="data.xScaleMap.get(i)"
                 [size]="data.size"
                 [axis]="data.xAxisMap.get(i)"></g>
            </ng-container>
          </g>
          <g class="y-axis-plotline-container">
            <ng-container *ngFor="let axis of data.config.yAxis; let i = index">
              <g teta-plot-line *ngFor="let plotLine of axis.plotLines"
                 [plotLine]="plotLine"
                 [scale]="data.yScaleMap.get(i)"
                 [size]="data.size"
                 [axis]="data.yAxisMap.get(i)"></g>
            </ng-container>
          </g>

          <g class="x-axis-plotband-container">
            <ng-container *ngFor="let axis of data.config.xAxis; let i = index">
              <g teta-plot-band *ngFor="let plotBand of axis.plotBands"
                 [plotBand]="plotBand"
                 [scale]="data.xScaleMap.get(i)"
                 [size]="data.size"
                 [axis]="data.xAxisMap.get(i)"></g>
            </ng-container>
          </g>
          <g class="y-axis-plotband-container">
            <ng-container *ngFor="let axis of data.config.yAxis; let i = index">
              <g teta-plot-band *ngFor="let plotBand of axis.plotBands"
                 [plotBand]="plotBand"
                 [scale]="data.yScaleMap.get(i)"
                 [size]="data.size"
                 [axis]="data.yAxisMap.get(i)"></g>
            </ng-container>
          </g>
          <g class="series-container">
            <g teta-series-host
               *ngFor="let series of data.config.series"
               [config]="data.config"
               [series]="series"
               [size]="data.size"></g>
          </g>
        </g>
      </g>
    </svg>
  </ng-container>
</ng-container>

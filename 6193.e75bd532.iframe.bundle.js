/*! For license information please see 6193.e75bd532.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkteta_components=self.webpackChunkteta_components||[]).push([[6193],{"./node_modules/angular-three-soba/fesm2022/angular-three-soba-abstractions.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ER:()=>NgtsLine,ne:()=>NgtsText});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),angular_three=__webpack_require__("./node_modules/angular-three/fesm2022/angular-three.mjs"),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),observable_combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),operators_map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),operators_switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),observable_of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js");class LineMaterial extends three_module.ShaderMaterial{constructor(parameters){super({type:"LineMaterial",uniforms:three_module.UniformsUtils.clone(three_module.UniformsUtils.merge([three_module.UniformsLib.common,three_module.UniformsLib.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new three_module.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <color_pars_vertex>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\tattribute vec3 instanceColorEnd;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <color_pars_fragment>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t\t#include <color_fragment>\n\n\t\t\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${parseInt(three_module.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(value){this.uniforms.diffuse.value=value}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(value){!0===value?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(value){this.uniforms.linewidth.value=value}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(value){Boolean(value)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===value?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(value){this.uniforms.dashScale.value=value}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(value){this.uniforms.dashSize.value=value}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(value){this.uniforms.dashOffset.value=value}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(value){this.uniforms.gapSize.value=value}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(value){this.uniforms.opacity.value=value}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(value){this.uniforms.resolution.value.copy(value)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(value){Boolean(value)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===value?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(parameters)}}const _box=new three_module.Box3,_vector=new three_module.Vector3;class LineSegmentsGeometry extends three_module.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new three_module.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new three_module.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(matrix){const start=this.attributes.instanceStart,end=this.attributes.instanceEnd;return void 0!==start&&(start.applyMatrix4(matrix),end.applyMatrix4(matrix),start.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(array){let lineSegments;array instanceof Float32Array?lineSegments=array:Array.isArray(array)&&(lineSegments=new Float32Array(array));const instanceBuffer=new three_module.InstancedInterleavedBuffer(lineSegments,6,1);return this.setAttribute("instanceStart",new three_module.InterleavedBufferAttribute(instanceBuffer,3,0)),this.setAttribute("instanceEnd",new three_module.InterleavedBufferAttribute(instanceBuffer,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(array){let colors;array instanceof Float32Array?colors=array:Array.isArray(array)&&(colors=new Float32Array(array));const instanceColorBuffer=new three_module.InstancedInterleavedBuffer(colors,6,1);return this.setAttribute("instanceColorStart",new three_module.InterleavedBufferAttribute(instanceColorBuffer,3,0)),this.setAttribute("instanceColorEnd",new three_module.InterleavedBufferAttribute(instanceColorBuffer,3,3)),this}fromWireframeGeometry(geometry){return this.setPositions(geometry.attributes.position.array),this}fromEdgesGeometry(geometry){return this.setPositions(geometry.attributes.position.array),this}fromMesh(mesh){return this.fromWireframeGeometry(new three_module.WireframeGeometry(mesh.geometry)),this}fromLineSegments(lineSegments){const geometry=lineSegments.geometry;return this.setPositions(geometry.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new three_module.Box3);const start=this.attributes.instanceStart,end=this.attributes.instanceEnd;void 0!==start&&void 0!==end&&(this.boundingBox.setFromBufferAttribute(start),_box.setFromBufferAttribute(end),this.boundingBox.union(_box))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new three_module.Sphere),null===this.boundingBox&&this.computeBoundingBox();const start=this.attributes.instanceStart,end=this.attributes.instanceEnd;if(void 0!==start&&void 0!==end){const center=this.boundingSphere.center;this.boundingBox.getCenter(center);let maxRadiusSq=0;for(let i=0,il=start.count;i<il;i++)_vector.fromBufferAttribute(start,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_vector)),_vector.fromBufferAttribute(end,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_vector));this.boundingSphere.radius=Math.sqrt(maxRadiusSq),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(matrix){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(matrix)}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(array){const length=array.length-3,points=new Float32Array(2*length);for(let i=0;i<length;i+=3)points[2*i]=array[i],points[2*i+1]=array[i+1],points[2*i+2]=array[i+2],points[2*i+3]=array[i+3],points[2*i+4]=array[i+4],points[2*i+5]=array[i+5];return super.setPositions(points),this}setColors(array){const length=array.length-3,colors=new Float32Array(2*length);for(let i=0;i<length;i+=3)colors[2*i]=array[i],colors[2*i+1]=array[i+1],colors[2*i+2]=array[i+2],colors[2*i+3]=array[i+3],colors[2*i+4]=array[i+4],colors[2*i+5]=array[i+5];return super.setColors(colors),this}fromLine(line){const geometry=line.geometry;return this.setPositions(geometry.attributes.position.array),this}}const _start=new three_module.Vector3,_end=new three_module.Vector3,_start4=new three_module.Vector4,_end4=new three_module.Vector4,_ssOrigin=new three_module.Vector4,_ssOrigin3=new three_module.Vector3,_mvMatrix=new three_module.Matrix4,_line=new three_module.Line3,_closestPoint=new three_module.Vector3,LineSegments2_box=new three_module.Box3,_sphere=new three_module.Sphere,_clipToWorldVector=new three_module.Vector4;let _ray,_instanceStart,_instanceEnd,_lineWidth;function getWorldSpaceHalfWidth(camera,distance,resolution){return _clipToWorldVector.set(0,0,-distance,1).applyMatrix4(camera.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/resolution.width,_clipToWorldVector.y=_lineWidth/resolution.height,_clipToWorldVector.applyMatrix4(camera.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}class LineSegments2 extends three_module.Mesh{constructor(geometry=new LineSegmentsGeometry,material=new LineMaterial({color:16777215*Math.random()})){super(geometry,material),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const geometry=this.geometry,instanceStart=geometry.attributes.instanceStart,instanceEnd=geometry.attributes.instanceEnd,lineDistances=new Float32Array(2*instanceStart.count);for(let i=0,j=0,l=instanceStart.count;i<l;i++,j+=2)_start.fromBufferAttribute(instanceStart,i),_end.fromBufferAttribute(instanceEnd,i),lineDistances[j]=0===j?0:lineDistances[j-1],lineDistances[j+1]=lineDistances[j]+_start.distanceTo(_end);const instanceDistanceBuffer=new three_module.InstancedInterleavedBuffer(lineDistances,2,1);return geometry.setAttribute("instanceDistanceStart",new three_module.InterleavedBufferAttribute(instanceDistanceBuffer,1,0)),geometry.setAttribute("instanceDistanceEnd",new three_module.InterleavedBufferAttribute(instanceDistanceBuffer,1,1)),this}raycast(raycaster,intersects){const worldUnits=this.material.worldUnits,camera=raycaster.camera;null!==camera||worldUnits||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const threshold=void 0!==raycaster.params.Line2&&raycaster.params.Line2.threshold||0;_ray=raycaster.ray;const matrixWorld=this.matrixWorld,geometry=this.geometry,material=this.material;let sphereMargin,boxMargin;if(_lineWidth=material.linewidth+threshold,_instanceStart=geometry.attributes.instanceStart,_instanceEnd=geometry.attributes.instanceEnd,null===geometry.boundingSphere&&geometry.computeBoundingSphere(),_sphere.copy(geometry.boundingSphere).applyMatrix4(matrixWorld),worldUnits)sphereMargin=.5*_lineWidth;else{sphereMargin=getWorldSpaceHalfWidth(camera,Math.max(camera.near,_sphere.distanceToPoint(_ray.origin)),material.resolution)}if(_sphere.radius+=sphereMargin,!1!==_ray.intersectsSphere(_sphere)){if(null===geometry.boundingBox&&geometry.computeBoundingBox(),LineSegments2_box.copy(geometry.boundingBox).applyMatrix4(matrixWorld),worldUnits)boxMargin=.5*_lineWidth;else{boxMargin=getWorldSpaceHalfWidth(camera,Math.max(camera.near,LineSegments2_box.distanceToPoint(_ray.origin)),material.resolution)}LineSegments2_box.expandByScalar(boxMargin),!1!==_ray.intersectsBox(LineSegments2_box)&&(worldUnits?function raycastWorldUnits(lineSegments,intersects){for(let i=0,l=_instanceStart.count;i<l;i++){_line.start.fromBufferAttribute(_instanceStart,i),_line.end.fromBufferAttribute(_instanceEnd,i);const pointOnLine=new three_module.Vector3,point=new three_module.Vector3;_ray.distanceSqToSegment(_line.start,_line.end,point,pointOnLine),point.distanceTo(pointOnLine)<.5*_lineWidth&&intersects.push({point,pointOnLine,distance:_ray.origin.distanceTo(point),object:lineSegments,face:null,faceIndex:i,uv:null,uv2:null})}}(this,intersects):function raycastScreenSpace(lineSegments,camera,intersects){const projectionMatrix=camera.projectionMatrix,resolution=lineSegments.material.resolution,matrixWorld=lineSegments.matrixWorld,geometry=lineSegments.geometry,instanceStart=geometry.attributes.instanceStart,instanceEnd=geometry.attributes.instanceEnd,near=-camera.near;_ray.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(camera.matrixWorldInverse),_ssOrigin.applyMatrix4(projectionMatrix),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=resolution.x/2,_ssOrigin.y*=resolution.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(camera.matrixWorldInverse,matrixWorld);for(let i=0,l=instanceStart.count;i<l;i++){if(_start4.fromBufferAttribute(instanceStart,i),_end4.fromBufferAttribute(instanceEnd,i),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>near&&_end4.z>near)continue;if(_start4.z>near){const deltaDist=_start4.z-_end4.z,t=(_start4.z-near)/deltaDist;_start4.lerp(_end4,t)}else if(_end4.z>near){const deltaDist=_end4.z-_start4.z,t=(_end4.z-near)/deltaDist;_end4.lerp(_start4,t)}_start4.applyMatrix4(projectionMatrix),_end4.applyMatrix4(projectionMatrix),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=resolution.x/2,_start4.y*=resolution.y/2,_end4.x*=resolution.x/2,_end4.y*=resolution.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const param=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(param,_closestPoint);const zPos=three_module.MathUtils.lerp(_start4.z,_end4.z,param),isInClipSpace=zPos>=-1&&zPos<=1,isInside=_ssOrigin3.distanceTo(_closestPoint)<.5*_lineWidth;if(isInClipSpace&&isInside){_line.start.fromBufferAttribute(instanceStart,i),_line.end.fromBufferAttribute(instanceEnd,i),_line.start.applyMatrix4(matrixWorld),_line.end.applyMatrix4(matrixWorld);const pointOnLine=new three_module.Vector3,point=new three_module.Vector3;_ray.distanceSqToSegment(_line.start,_line.end,point,pointOnLine),intersects.push({point,pointOnLine,distance:_ray.origin.distanceTo(point),object:lineSegments,face:null,faceIndex:i,uv:null,uv2:null})}}}(this,camera,intersects))}}}class Line2 extends LineSegments2{constructor(geometry=new LineGeometry,material=new LineMaterial({color:16777215*Math.random()})){super(geometry,material),this.isLine2=!0,this.type="Line2"}}class TextGeometry extends three_module.ExtrudeGeometry{constructor(text,parameters={}){const{bevelEnabled=!1,bevelSize=8,bevelThickness=10,font,height=50,size=100,lineHeight=1,letterSpacing=0,...rest}=parameters;if(void 0===font)super();else{super(font.generateShapes(text,size,{lineHeight,letterSpacing}),{...rest,bevelEnabled,bevelSize,bevelThickness,depth:height})}this.type="TextGeometry"}}var __defProp=Object.defineProperty,__publicField=(obj,key,value)=>(((obj,key,value)=>{key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value})(obj,"symbol"!=typeof key?key+"":key,value),value);class FontLoader extends three_module.Loader{constructor(manager){super(manager)}load(url,onLoad,onProgress,onError){const loader=new three_module.FileLoader(this.manager);loader.setPath(this.path),loader.setRequestHeader(this.requestHeader),loader.setWithCredentials(this.withCredentials),loader.load(url,(response=>{if("string"!=typeof response)throw new Error("unsupported data type");const json=JSON.parse(response),font=this.parse(json);onLoad&&onLoad(font)}),onProgress,onError)}loadAsync(url,onProgress){return super.loadAsync(url,onProgress)}parse(json){return new Font(json)}}class Font{constructor(data){__publicField(this,"data"),this.data=data}generateShapes(text,size=100,_options){const shapes=[],options={letterSpacing:0,lineHeight:1,..._options},paths=function createPaths(text,size,data,options){const chars=Array.from(text),scale=size/data.resolution,line_height=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*scale,paths=[];let offsetX=0,offsetY=0;for(let i=0;i<chars.length;i++){const char=chars[i];if("\n"===char)offsetX=0,offsetY-=line_height*options.lineHeight;else{const ret=createPath(char,scale,offsetX,offsetY,data);ret&&(offsetX+=ret.offsetX+options.letterSpacing,paths.push(ret.path))}}return paths}(text,size,this.data,options);for(let p=0,pl=paths.length;p<pl;p++)Array.prototype.push.apply(shapes,paths[p].toShapes(!1));return shapes}}function createPath(char,scale,offsetX,offsetY,data){const glyph=data.glyphs[char]||data.glyphs["?"];if(!glyph)return void console.error('THREE.Font: character "'+char+'" does not exists in font family '+data.familyName+".");const path=new three_module.ShapePath;let x,y,cpx,cpy,cpx1,cpy1,cpx2,cpy2;if(glyph.o){const outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));for(let i=0,l=outline.length;i<l;){switch(outline[i++]){case"m":x=parseInt(outline[i++])*scale+offsetX,y=parseInt(outline[i++])*scale+offsetY,path.moveTo(x,y);break;case"l":x=parseInt(outline[i++])*scale+offsetX,y=parseInt(outline[i++])*scale+offsetY,path.lineTo(x,y);break;case"q":cpx=parseInt(outline[i++])*scale+offsetX,cpy=parseInt(outline[i++])*scale+offsetY,cpx1=parseInt(outline[i++])*scale+offsetX,cpy1=parseInt(outline[i++])*scale+offsetY,path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);break;case"b":cpx=parseInt(outline[i++])*scale+offsetX,cpy=parseInt(outline[i++])*scale+offsetY,cpx1=parseInt(outline[i++])*scale+offsetX,cpy1=parseInt(outline[i++])*scale+offsetY,cpx2=parseInt(outline[i++])*scale+offsetX,cpy2=parseInt(outline[i++])*scale+offsetY,path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy)}}}return{offsetX:glyph.ha*scale,path}}__publicField(Font,"isFont"),__publicField(Font,"type");var _class,angular_three_soba_cameras_class,_class2,_class3,_class4,_class5,common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),util_isObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isObservable.js"),operators_takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js");class NgtsBakeShadows extends angular_three.A7{constructor(){super(...arguments),this.store=(0,core.inject)(angular_three.W7)}ngOnInit(){this.effect(this.store.select("gl"),(gl=>(gl.shadowMap.autoUpdate=!1,gl.shadowMap.needsUpdate=!0,()=>{gl.shadowMap.autoUpdate=gl.shadowMap.needsUpdate=!0})))}}function injectNgtsFBO(paramsFactory){const store=(0,core.inject)(angular_three.W7),targetRef=(0,angular_three.Lv)(),{destroy$,cdr}=(0,angular_three.D4)((()=>{targetRef.nativeElement?.dispose()})),params=paramsFactory({});return((0,util_isObservable.b)(params)?params:(0,observable_of.of)(params)).pipe((0,operators_takeUntil.R)(destroy$)).subscribe((({width,height,settings})=>{const{gl,size,viewport}=store.get(),_width="number"==typeof width?width:size.width*viewport.dpr,_height="number"==typeof height?height:size.height*viewport.dpr,_settings=("number"==typeof width?settings:width)||{},{samples=0,depth,...targetSettings}=_settings;if(!targetRef.nativeElement){const target=new three_module.WebGLRenderTarget(_width,_height,{minFilter:three_module.LinearFilter,magFilter:three_module.LinearFilter,encoding:gl.outputEncoding,type:three_module.HalfFloatType,...targetSettings});depth&&(target.depthTexture=new three_module.DepthTexture(_width,_height,three_module.FloatType)),target.samples=samples,targetRef.nativeElement=target}targetRef.nativeElement.setSize(_width,_height),samples&&(targetRef.nativeElement.samples=samples),(0,angular_three.dI)(cdr)})),targetRef}(_class=NgtsBakeShadows).ɵfac=function(){let ɵ_class_BaseFactory;return function _class_Factory(t){return(ɵ_class_BaseFactory||(ɵ_class_BaseFactory=core["ɵɵgetInheritedFactory"](_class)))(t||_class)}}(),_class.ɵdir=core["ɵɵdefineDirective"]({type:_class,selectors:[["ngts-bake-shadows"]],standalone:!0,features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsBakeShadows,[{type:core.Directive,args:[{selector:"ngts-bake-shadows",standalone:!0}]}],null,null);const _c0=["group"];function _class2_ngt_cube_camera_1_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-cube-camera",4),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("ref",ctx_r0.cameraRef)}}const _c1=function(a0,a1){return{fbo:a0,group:a1}};function _class2_ng_container_4_Template(rf,ctx){if(1&rf&&core["ɵɵelementContainer"](0,5),2&rf){const ctx_r2=core["ɵɵnextContext"](),_r1=core["ɵɵreference"](3);core["ɵɵproperty"]("ngTemplateOutlet",ctx_r2.cameraContent.template)("ngTemplateOutletContext",core["ɵɵpureFunction2"](2,_c1,ctx_r2.get("fbo").texture,_r1))}}function _class4_ng_container_5_Template(rf,ctx){if(1&rf&&core["ɵɵelementContainer"](0,3),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("ngTemplateOutlet",ctx_r0.cameraContent.template)}}function _class4_ngt_group_6_ng_container_2_Template(rf,ctx){1&rf&&core["ɵɵelementContainer"](0)}function _class4_ngt_group_6_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-group",null,4),core["ɵɵtemplate"](2,_class4_ngt_group_6_ng_container_2_Template,1,0,"ng-container",5),core["ɵɵelementEnd"]()),2&rf){const _r2=core["ɵɵreference"](1),ctx_r1=core["ɵɵnextContext"]();core["ɵɵadvance"](2),core["ɵɵproperty"]("ngTemplateOutlet",ctx_r1.cameraContent.template)("ngTemplateOutletContext",core["ɵɵpureFunction2"](2,_c1,ctx_r1.fboRef.nativeElement,_r2))}}function _class5_ng_container_1_Template(rf,ctx){if(1&rf&&core["ɵɵelementContainer"](0,3),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("ngTemplateOutlet",ctx_r0.cameraContent.template)}}function _class5_ngt_group_2_ng_container_2_Template(rf,ctx){1&rf&&core["ɵɵelementContainer"](0)}function _class5_ngt_group_2_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-group",null,4),core["ɵɵtemplate"](2,_class5_ngt_group_2_ng_container_2_Template,1,0,"ng-container",5),core["ɵɵelementEnd"]()),2&rf){const _r2=core["ɵɵreference"](1),ctx_r1=core["ɵɵnextContext"]();core["ɵɵadvance"](2),core["ɵɵproperty"]("ngTemplateOutlet",ctx_r1.cameraContent.template)("ngTemplateOutletContext",core["ɵɵpureFunction2"](2,_c1,ctx_r1.fboRef.nativeElement,_r2))}}class NgtsCameraContent{constructor(){this.template=(0,core.inject)(core.TemplateRef),this.ngtsCameraContent=""}static ngTemplateContextGuard(_,ctx){return!0}}(angular_three_soba_cameras_class=NgtsCameraContent).ɵfac=function _class_Factory(t){return new(t||angular_three_soba_cameras_class)},angular_three_soba_cameras_class.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_soba_cameras_class,selectors:[["ng-template","ngtsCameraContent",""]],inputs:{ngtsCameraContent:"ngtsCameraContent"},standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCameraContent,[{type:core.Directive,args:[{selector:"ng-template[ngtsCameraContent]",standalone:!0}]}],null,{ngtsCameraContent:[{type:core.Input}]}),(0,angular_three.l7)({Group:three_module.Group,CubeCamera:three_module.CubeCamera});class NgtsCubeCamera extends angular_three.A7{set frames(frames){this.set({frames})}set resolution(resolution){this.set({resolution})}set near(near){this.set({near})}set far(far){this.set({far})}set envMap(envMap){this.set({envMap})}set fog(fog){this.set({fog})}initialize(){super.initialize(),this.set({frames:1/0,resolution:256,near:.1,far:1e3})}constructor(){super(),this.cameraRef=(0,angular_three.Lv)(),this.store=(0,core.inject)(angular_three.W7),this.connect("fbo",this.select("resolution").pipe((0,operators_map.U)((resolution=>{const fbo=new three_module.WebGLCubeRenderTarget(resolution);return fbo.texture.encoding=this.store.get("gl").outputEncoding,fbo.texture.type=three_module.HalfFloatType,fbo})))),this.connect("cameraArgs",(0,observable_combineLatest.a)([this.select("near"),this.select("far"),this.select("fbo")]));let originalFog,originalBackground,count=0;(0,angular_three.Os)((({scene,gl})=>{const{frames,envMap,fog}=this.get();envMap&&this.cameraRef.nativeElement&&this.groupRef.nativeElement&&(frames===1/0||count<frames)&&(this.groupRef.nativeElement.visible=!1,originalFog=scene.fog,originalBackground=scene.background,scene.background=envMap||originalBackground,scene.fog=fog||originalFog,this.cameraRef.nativeElement.update(gl,scene),scene.fog=originalFog,scene.background=originalBackground,this.groupRef.nativeElement.visible=!0,count++)}))}}(_class2=NgtsCubeCamera).ɵfac=function _class2_Factory(t){return new(t||_class2)},_class2.ɵcmp=core["ɵɵdefineComponent"]({type:_class2,selectors:[["ngts-cube-camera"]],contentQueries:function _class2_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,NgtsCameraContent,5),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.cameraContent=_t.first)}},viewQuery:function _class2_Query(rf,ctx){if(1&rf&&core["ɵɵviewQuery"](_c0,7),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.groupRef=_t.first)}},inputs:{frames:"frames",resolution:"resolution",near:"near",far:"far",envMap:"envMap",fog:"fog"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:5,vars:2,consts:[["ngtCompound",""],[3,"ref",4,"args"],["group",""],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"ref"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function _class2_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-group",0),core["ɵɵtemplate"](1,_class2_ngt_cube_camera_1_Template,1,1,"ngt-cube-camera",1),core["ɵɵelementStart"](2,"ngt-group",null,2),core["ɵɵtemplate"](4,_class2_ng_container_4_Template,1,5,"ng-container",3),core["ɵɵelementEnd"]()()),2&rf&&(core["ɵɵadvance"](1),core["ɵɵproperty"]("args",ctx.get("cameraArgs")),core["ɵɵadvance"](3),core["ɵɵproperty"]("ngIf",ctx.cameraContent&&ctx.cameraContent.ngtsCameraContent&&ctx.get("fbo")))},dependencies:[common.NgIf,common.NgTemplateOutlet,angular_three.Bj],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCubeCamera,[{type:core.Component,args:[{selector:"ngts-cube-camera",standalone:!0,template:'\n        <ngt-group ngtCompound>\n            <ngt-cube-camera [ref]="cameraRef" *args="get(\'cameraArgs\')" />\n            <ngt-group #group>\n                <ng-container\n                    *ngIf="cameraContent && cameraContent.ngtsCameraContent && get(\'fbo\')"\n                    [ngTemplateOutlet]="cameraContent.template"\n                    [ngTemplateOutletContext]="{ fbo: get(\'fbo\').texture, group }"\n                />\n            </ngt-group>\n        </ngt-group>\n    ',imports:[common.NgIf,common.NgTemplateOutlet,angular_three.Bj],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],(function(){return[]}),{groupRef:[{type:core.ViewChild,args:["group",{static:!0}]}],cameraContent:[{type:core.ContentChild,args:[NgtsCameraContent]}],frames:[{type:core.Input}],resolution:[{type:core.Input}],near:[{type:core.Input}],far:[{type:core.Input}],envMap:[{type:core.Input}],fog:[{type:core.Input}]});class NgtsCamera extends angular_three.A7{constructor(){super(...arguments),this.cameraRef=(0,angular_three.Lv)(),this.store=(0,core.inject)(angular_three.W7),this.fboRef=injectNgtsFBO((()=>this.select("resolution").pipe((0,operators_map.U)((resolution=>({width:resolution}))))))}set makeDefault(makeDefault){this.set({makeDefault})}set manual(manual){this.set({manual})}set frames(frames){this.set({frames})}set resolution(resolution){this.set({resolution})}set envMap(envMap){this.set({envMap})}initialize(){super.initialize(),this.set({resolution:256,frames:1/0,makeDefault:!1,manual:!1})}ngOnInit(){this.hold(this.cameraRef.$,(camera=>{camera.updateProjectionMatrix(),this.setDefaultCamera(),this.updateProjectionMatrix()}))}setDefaultCamera(){this.effect((0,observable_combineLatest.a)([this.cameraRef.$,this.select("makeDefault")]),(([camera,makeDefault])=>{if(makeDefault){const{camera:oldCamera}=this.store.get();return this.store.set({camera}),()=>{this.store.set({camera:oldCamera})}}}))}updateProjectionMatrix(){this.effect((0,observable_combineLatest.a)([this.cameraRef.$,this.select("manual")]),(([camera,manual])=>{!manual&&camera&&camera.updateProjectionMatrix()}))}}(_class3=NgtsCamera).ɵfac=function(){let ɵ_class3_BaseFactory;return function _class3_Factory(t){return(ɵ_class3_BaseFactory||(ɵ_class3_BaseFactory=core["ɵɵgetInheritedFactory"](_class3)))(t||_class3)}}(),_class3.ɵdir=core["ɵɵdefineDirective"]({type:_class3,inputs:{makeDefault:"makeDefault",manual:"manual",frames:"frames",resolution:"resolution",envMap:"envMap",cameraRef:"cameraRef"},features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCamera,[{type:core.Directive}],null,{makeDefault:[{type:core.Input}],manual:[{type:core.Input}],frames:[{type:core.Input}],resolution:[{type:core.Input}],envMap:[{type:core.Input}],cameraRef:[{type:core.Input}]}),(0,angular_three.l7)({OrthographicCamera:three_module.OrthographicCamera,Group:three_module.Group});class NgtsOrthographicCamera extends NgtsCamera{constructor(){super(...arguments),this.left$=(0,observable_combineLatest.a)([this.select("left"),this.store.select("size")]).pipe((0,operators_map.U)((([left,size])=>left||size.width/-2))),this.right$=(0,observable_combineLatest.a)([this.select("right"),this.store.select("size")]).pipe((0,operators_map.U)((([right,size])=>right||size.width/2))),this.top$=(0,observable_combineLatest.a)([this.select("top"),this.store.select("size")]).pipe((0,operators_map.U)((([top,size])=>top||size.height/2))),this.bottom$=(0,observable_combineLatest.a)([this.select("bottom"),this.store.select("size")]).pipe((0,operators_map.U)((([bottom,size])=>bottom||size.height/-2)))}set left(left){this.set({left})}set right(right){this.set({right})}set top(top){this.set({top})}set bottom(bottom){this.set({bottom})}initialize(){super.initialize(),this.set({left:0,right:0,top:0,bottom:0})}}(_class4=NgtsOrthographicCamera).ɵfac=function(){let ɵ_class4_BaseFactory;return function _class4_Factory(t){return(ɵ_class4_BaseFactory||(ɵ_class4_BaseFactory=core["ɵɵgetInheritedFactory"](_class4)))(t||_class4)}}(),_class4.ɵcmp=core["ɵɵdefineComponent"]({type:_class4,selectors:[["ngts-orthographic-camera"]],contentQueries:function _class4_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,NgtsCameraContent,5),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.cameraContent=_t.first)}},inputs:{left:"left",right:"right",top:"top",bottom:"bottom"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:7,vars:15,consts:[["ngtCompound","",3,"ref","left","right","top","bottom"],[3,"ngTemplateOutlet",4,"ngIf"],[4,"ngIf"],[3,"ngTemplateOutlet"],["group",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function _class4_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-orthographic-camera",0),core["ɵɵpipe"](1,"ngtPush"),core["ɵɵpipe"](2,"ngtPush"),core["ɵɵpipe"](3,"ngtPush"),core["ɵɵpipe"](4,"ngtPush"),core["ɵɵtemplate"](5,_class4_ng_container_5_Template,1,1,"ng-container",1),core["ɵɵelementEnd"](),core["ɵɵtemplate"](6,_class4_ngt_group_6_Template,3,5,"ngt-group",2)),2&rf&&(core["ɵɵproperty"]("ref",ctx.cameraRef)("left",core["ɵɵpipeBind1"](1,7,ctx.left$))("right",core["ɵɵpipeBind1"](2,9,ctx.right$))("top",core["ɵɵpipeBind1"](3,11,ctx.top$))("bottom",core["ɵɵpipeBind1"](4,13,ctx.bottom$)),core["ɵɵadvance"](5),core["ɵɵproperty"]("ngIf",ctx.cameraContent&&!ctx.cameraContent.ngtsCameraContent),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngIf",ctx.cameraContent&&ctx.cameraContent.ngtsCameraContent))},dependencies:[common.NgIf,common.NgTemplateOutlet,angular_three.L3],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsOrthographicCamera,[{type:core.Component,args:[{selector:"ngts-orthographic-camera",standalone:!0,template:'\n        <ngt-orthographic-camera\n            ngtCompound\n            [ref]="cameraRef"\n            [left]="left$ | ngtPush"\n            [right]="right$ | ngtPush"\n            [top]="top$ | ngtPush"\n            [bottom]="bottom$ | ngtPush"\n        >\n            <ng-container\n                *ngIf="cameraContent && !cameraContent.ngtsCameraContent"\n                [ngTemplateOutlet]="cameraContent.template"\n            />\n        </ngt-orthographic-camera>\n        <ngt-group #group *ngIf="cameraContent && cameraContent.ngtsCameraContent">\n            <ng-container *ngTemplateOutlet="cameraContent.template; context: { fbo: fboRef.nativeElement, group }" />\n        </ngt-group>\n    ',imports:[common.NgIf,common.NgTemplateOutlet,angular_three.L3],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{cameraContent:[{type:core.ContentChild,args:[NgtsCameraContent]}],left:[{type:core.Input}],right:[{type:core.Input}],top:[{type:core.Input}],bottom:[{type:core.Input}]}),(0,angular_three.l7)({PerspectiveCamera:three_module.PerspectiveCamera,Group:three_module.Group});class NgtsPerspectiveCamera extends NgtsCamera{}(_class5=NgtsPerspectiveCamera).ɵfac=function(){let ɵ_class5_BaseFactory;return function _class5_Factory(t){return(ɵ_class5_BaseFactory||(ɵ_class5_BaseFactory=core["ɵɵgetInheritedFactory"](_class5)))(t||_class5)}}(),_class5.ɵcmp=core["ɵɵdefineComponent"]({type:_class5,selectors:[["ngts-perspective-camera"]],contentQueries:function _class5_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,NgtsCameraContent,5),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.cameraContent=_t.first)}},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:3,vars:3,consts:[["ngtCompound","",3,"ref"],[3,"ngTemplateOutlet",4,"ngIf"],[4,"ngIf"],[3,"ngTemplateOutlet"],["group",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function _class5_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-perspective-camera",0),core["ɵɵtemplate"](1,_class5_ng_container_1_Template,1,1,"ng-container",1),core["ɵɵelementEnd"](),core["ɵɵtemplate"](2,_class5_ngt_group_2_Template,3,5,"ngt-group",2)),2&rf&&(core["ɵɵproperty"]("ref",ctx.cameraRef),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngIf",ctx.cameraContent&&!ctx.cameraContent.ngtsCameraContent),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngIf",ctx.cameraContent&&ctx.cameraContent.ngtsCameraContent))},dependencies:[common.NgIf,common.NgTemplateOutlet],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsPerspectiveCamera,[{type:core.Component,args:[{selector:"ngts-perspective-camera",standalone:!0,template:'\n        <ngt-perspective-camera [ref]="cameraRef" ngtCompound>\n            <ng-container\n                *ngIf="cameraContent && !cameraContent.ngtsCameraContent"\n                [ngTemplateOutlet]="cameraContent.template"\n            />\n        </ngt-perspective-camera>\n        <ngt-group #group *ngIf="cameraContent && cameraContent.ngtsCameraContent">\n            <ng-container *ngTemplateOutlet="cameraContent.template; context: { fbo: fboRef.nativeElement, group }" />\n        </ngt-group>\n    ',imports:[common.NgIf,common.NgTemplateOutlet],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{cameraContent:[{type:core.ContentChild,args:[NgtsCameraContent]}]});var Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),merge=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/merge.js");class RxActionFactory{constructor(errorHandler){this.errorHandler=errorHandler,this.subjects=[]}create(transforms){const subjects={};return this.subjects.push(subjects),new Proxy((function signals(){}),function actionProxyHandler(subjects,transforms,errorHandler){function dispatch(value,prop){subjects[prop]=subjects[prop]||new Subject.x;try{const val=transforms&&transforms[prop]?transforms[prop](value):value;subjects[prop].next(val)}catch(err){errorHandler?.handleError(err)}}return{apply(_,__,props){props.forEach((slice=>Object.entries(slice).forEach((([k,v])=>dispatch(v,k)))))},get(_,property){const prop=property;if("$"===prop.toString().split("").pop()){if(1===prop.toString().length)return props=>(0,merge.T)(...props.map((k=>(subjects[k]=subjects[k]||new Subject.x,subjects[k]))));const propName=prop.toString().slice(0,-1);return subjects[propName]=subjects[propName]||new Subject.x,subjects[propName]}return args=>{dispatch(args,prop)}},set(){throw new Error("No setters available. To emit call the property name.")}}}(subjects,transforms,this.errorHandler))}destroy(){this.subjects.forEach((s=>{Object.values(s).forEach((subject=>subject.complete()))}))}ngOnDestroy(){this.destroy()}}RxActionFactory.ɵfac=function RxActionFactory_Factory(t){return new(t||RxActionFactory)(core["ɵɵinject"](core.ErrorHandler,8))},RxActionFactory.ɵprov=core["ɵɵdefineInjectable"]({token:RxActionFactory,factory:RxActionFactory.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RxActionFactory,[{type:core.Injectable}],(function(){return[{type:core.ErrorHandler,decorators:[{type:core.Optional}]}]}),null);__webpack_require__("./node_modules/process/browser.js");function workerBootstrap(){var modules=Object.create(null);function registerModule(ref,callback){var id=ref.id,name=ref.name,dependencies=ref.dependencies;void 0===dependencies&&(dependencies=[]);var init=ref.init;void 0===init&&(init=function(){});var getTransferables=ref.getTransferables;if(void 0===getTransferables&&(getTransferables=null),!modules[id])try{dependencies=dependencies.map((function(dep){return dep&&dep.isWorkerModule&&(registerModule(dep,(function(depResult){if(depResult instanceof Error)throw depResult})),dep=modules[dep.id].value),dep})),init=rehydrate("<"+name+">.init",init),getTransferables&&(getTransferables=rehydrate("<"+name+">.getTransferables",getTransferables));var value=null;"function"==typeof init?value=init.apply(void 0,dependencies):console.error("worker module init function failed to rehydrate"),modules[id]={id,value,getTransferables},callback(value)}catch(err){err&&err.noLog||console.error(err),callback(err)}}function rehydrate(name,str){var result=void 0;self.troikaDefine=function(r){return result=r};var url=URL.createObjectURL(new Blob(["/** "+name.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+str+"\n)"],{type:"application/javascript"}));try{importScripts(url)}catch(err){console.error(err)}return URL.revokeObjectURL(url),delete self.troikaDefine,result}self.addEventListener("message",(function(e){var ref=e.data,messageId=ref.messageId,action=ref.action,data=ref.data;try{"registerModule"===action&&registerModule(data,(function(result){result instanceof Error?postMessage({messageId,success:!1,error:result.message}):postMessage({messageId,success:!0,result:{isCallable:"function"==typeof result}})})),"callModule"===action&&function callModule(ref,callback){var ref$1,id=ref.id,args=ref.args;modules[id]&&"function"==typeof modules[id].value||callback(new Error("Worker module "+id+": not found or its 'init' did not return a function"));try{var result=(ref$1=modules[id]).value.apply(ref$1,args);result&&"function"==typeof result.then?result.then(handleResult,(function(rej){return callback(rej instanceof Error?rej:new Error(""+rej))})):handleResult(result)}catch(err){callback(err)}function handleResult(result){try{var tx=modules[id].getTransferables&&modules[id].getTransferables(result);tx&&Array.isArray(tx)&&tx.length||(tx=void 0),callback(result,tx)}catch(err){console.error(err),callback(err)}}}(data,(function(result,transferables){result instanceof Error?postMessage({messageId,success:!1,error:result.message}):postMessage({messageId,success:!0,result},transferables||void 0)}))}catch(err){postMessage({messageId,success:!1,error:err.stack})}}))}var supportsWorkers=function(){var supported=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),supported=!0}catch(err){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+err.message+"]")}return supportsWorkers=function(){return supported},supported},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(options){if(!(options&&"function"==typeof options.init||_allowInitAsString))throw new Error("requires `options.init` function");var dependencies=options.dependencies,init=options.init,getTransferables=options.getTransferables,workerId=options.workerId;if(!supportsWorkers())return function defineMainThreadModule(options){var moduleFunc=function(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];return moduleFunc._getInitResult().then((function(initResult){if("function"==typeof initResult)return initResult.apply(void 0,args);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return moduleFunc._getInitResult=function(){var dependencies=options.dependencies,init=options.init;dependencies=Array.isArray(dependencies)?dependencies.map((function(dep){return dep&&dep._getInitResult?dep._getInitResult():dep})):[];var initPromise=Promise.all(dependencies).then((function(deps){return init.apply(null,deps)}));return moduleFunc._getInitResult=function(){return initPromise},initPromise},moduleFunc}(options);null==workerId&&(workerId="#default");var id="workerModule"+ ++_workerModuleId,name=options.name||id,registrationPromise=null;function moduleFunc(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];if(!registrationPromise){registrationPromise=callWorker(workerId,"registerModule",moduleFunc.workerModuleData);var unregister=function(){registrationPromise=null,registeredModules[workerId].delete(unregister)};(registeredModules[workerId]||(registeredModules[workerId]=new Set)).add(unregister)}return registrationPromise.then((function(ref){if(ref.isCallable)return callWorker(workerId,"callModule",{id,args});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return dependencies=dependencies&&dependencies.map((function(dep){return"function"!=typeof dep||dep.workerModuleData||(_allowInitAsString=!0,dep=defineWorkerModule({workerId,name:"<"+name+"> function dependency: "+dep.name,init:"function(){return (\n"+stringifyFunction(dep)+"\n)}"}),_allowInitAsString=!1),dep&&dep.workerModuleData&&(dep=dep.workerModuleData),dep})),moduleFunc.workerModuleData={isWorkerModule:!0,id,name,dependencies,init:stringifyFunction(init),getTransferables:getTransferables&&stringifyFunction(getTransferables)},moduleFunc}function stringifyFunction(fn){var str=fn.toString();return!/^function/.test(str)&&/^\w+\s*\(/.test(str)&&(str="function "+str),str}function callWorker(workerId,action,data){return new Promise((function(resolve,reject){var messageId=++_messageId;openRequests[messageId]=function(response){response.success?resolve(response.result):reject(new Error("Error in worker "+action+" call: "+response.error))},function getWorker(workerId){var worker=workers[workerId];if(!worker){var bootstrap=stringifyFunction(workerBootstrap);(worker=workers[workerId]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+workerId.replace(/\*/g,"")+" **/\n\n;("+bootstrap+")()"],{type:"application/javascript"})))).onmessage=function(e){var response=e.data,msgId=response.messageId,callback=openRequests[msgId];if(!callback)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[msgId],callback(response)}}return worker}(workerId).postMessage({messageId,action,data})}))}function SDFGenerator(){var exports=function(exports){function pointOnCubicBezier(x0,y0,x1,y1,x2,y2,x3,y3,t,pointOut){var t2=1-t;pointOut.x=t2*t2*t2*x0+3*t2*t2*t*x1+3*t2*t*t*x2+t*t*t*x3,pointOut.y=t2*t2*t2*y0+3*t2*t2*t*y1+3*t2*t*t*y2+t*t*t*y3}function forEachPathCommand(pathString,commandCallback){for(var match,firstX,firstY,prevX,prevY,segmentRE=/([MLQCZ])([^MLQCZ]*)/g;match=segmentRE.exec(pathString);){var args=match[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(v){return parseFloat(v)}));switch(match[1]){case"M":prevX=firstX=args[0],prevY=firstY=args[1];break;case"L":args[0]===prevX&&args[1]===prevY||commandCallback("L",prevX,prevY,prevX=args[0],prevY=args[1]);break;case"Q":commandCallback("Q",prevX,prevY,prevX=args[2],prevY=args[3],args[0],args[1]);break;case"C":commandCallback("C",prevX,prevY,prevX=args[4],prevY=args[5],args[0],args[1],args[2],args[3]);break;case"Z":prevX===firstX&&prevY===firstY||commandCallback("L",prevX,prevY,firstX,firstY)}}}function pathToLineSegments(pathString,segmentCallback,curvePoints){void 0===curvePoints&&(curvePoints=16);var tempPoint={x:0,y:0};forEachPathCommand(pathString,(function(command,startX,startY,endX,endY,ctrl1X,ctrl1Y,ctrl2X,ctrl2Y){switch(command){case"L":segmentCallback(startX,startY,endX,endY);break;case"Q":for(var prevCurveX=startX,prevCurveY=startY,i=1;i<curvePoints;i++)y0=startY,y1=ctrl1Y,y2=endY,t2=void 0,t2=1-(t=i/(curvePoints-1)),(pointOut=tempPoint).x=t2*t2*startX+2*t2*t*ctrl1X+t*t*endX,pointOut.y=t2*t2*y0+2*t2*t*y1+t*t*y2,segmentCallback(prevCurveX,prevCurveY,tempPoint.x,tempPoint.y),prevCurveX=tempPoint.x,prevCurveY=tempPoint.y;break;case"C":for(var prevCurveX$1=startX,prevCurveY$1=startY,i$1=1;i$1<curvePoints;i$1++)pointOnCubicBezier(startX,startY,ctrl1X,ctrl1Y,ctrl2X,ctrl2Y,endX,endY,i$1/(curvePoints-1),tempPoint),segmentCallback(prevCurveX$1,prevCurveY$1,tempPoint.x,tempPoint.y),prevCurveX$1=tempPoint.x,prevCurveY$1=tempPoint.y}var y0,y1,y2,t,pointOut,t2}))}var viewportQuadVertex="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",copyTexFragment="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",cache=new WeakMap,glContextParams={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function withWebGLContext(glOrCanvas,callback){var gl=glOrCanvas.getContext?glOrCanvas.getContext("webgl",glContextParams):glOrCanvas,wrapper=cache.get(gl);if(!wrapper){var isWebGL2="undefined"!=typeof WebGL2RenderingContext&&gl instanceof WebGL2RenderingContext,extensions={},programs={},textures={},textureUnit=-1,framebufferStack=[];function getExtension(name){var ext=extensions[name];if(!ext&&!(ext=extensions[name]=gl.getExtension(name)))throw new Error(name+" not supported");return ext}function compileShader(src,type){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function withProgram(name,vert,frag,func){if(!programs[name]){var attributes={},uniforms={},program=gl.createProgram();gl.attachShader(program,compileShader(vert,gl.VERTEX_SHADER)),gl.attachShader(program,compileShader(frag,gl.FRAGMENT_SHADER)),gl.linkProgram(program),programs[name]={program,transaction:function transaction(func){gl.useProgram(program),func({setUniform:function setUniform(type,name){for(var values=[],len=arguments.length-2;len-- >0;)values[len]=arguments[len+2];var uniformLoc=uniforms[name]||(uniforms[name]=gl.getUniformLocation(program,name));gl["uniform"+type].apply(gl,[uniformLoc].concat(values))},setAttribute:function setAttribute(name,size,usage,instancingDivisor,data){var attr=attributes[name];attr||(attr=attributes[name]={buf:gl.createBuffer(),loc:gl.getAttribLocation(program,name),data:null}),gl.bindBuffer(gl.ARRAY_BUFFER,attr.buf),gl.vertexAttribPointer(attr.loc,size,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(attr.loc),isWebGL2?gl.vertexAttribDivisor(attr.loc,instancingDivisor):getExtension("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(attr.loc,instancingDivisor),data!==attr.data&&(gl.bufferData(gl.ARRAY_BUFFER,data,usage),attr.data=data)}})}}}programs[name].transaction(func)}function withTexture(name,func){textureUnit++;try{gl.activeTexture(gl.TEXTURE0+textureUnit);var texture=textures[name];texture||(texture=textures[name]=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)),gl.bindTexture(gl.TEXTURE_2D,texture),func(texture,textureUnit)}finally{textureUnit--}}function withTextureFramebuffer(texture,textureUnit,func){var framebuffer=gl.createFramebuffer();framebufferStack.push(framebuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.activeTexture(gl.TEXTURE0+textureUnit),gl.bindTexture(gl.TEXTURE_2D,texture),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);try{func(framebuffer)}finally{gl.deleteFramebuffer(framebuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,framebufferStack[--framebufferStack.length-1]||null)}}function handleContextLoss(){extensions={},programs={},textures={},textureUnit=-1,framebufferStack.length=0}gl.canvas.addEventListener("webglcontextlost",(function(e){handleContextLoss(),e.preventDefault()}),!1),cache.set(gl,wrapper={gl,isWebGL2,getExtension,withProgram,withTexture,withTextureFramebuffer,handleContextLoss})}callback(wrapper)}function renderImageData(glOrCanvas,imageData,x,y,width,height,channels,framebuffer){void 0===channels&&(channels=15),void 0===framebuffer&&(framebuffer=null),withWebGLContext(glOrCanvas,(function(ref){var gl=ref.gl,withProgram=ref.withProgram;(0,ref.withTexture)("copy",(function(tex,texUnit){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,imageData),withProgram("copy",viewportQuadVertex,copyTexFragment,(function(ref){var setUniform=ref.setUniform;(0,ref.setAttribute)("aUV",2,gl.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),setUniform("1i","image",texUnit),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer||null),gl.disable(gl.BLEND),gl.colorMask(8&channels,4&channels,2&channels,1&channels),gl.viewport(x,y,width,height),gl.scissor(x,y,width,height),gl.drawArrays(gl.TRIANGLES,0,3)}))}))}))}var webglUtils=Object.freeze({__proto__:null,withWebGLContext,renderImageData,resizeWebGLCanvasWithoutClearing:function resizeWebGLCanvasWithoutClearing(canvas,newWidth,newHeight){var width=canvas.width,height=canvas.height;withWebGLContext(canvas,(function(ref){var gl=ref.gl,data=new Uint8Array(width*height*4);gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,data),canvas.width=newWidth,canvas.height=newHeight,renderImageData(gl,data,0,0,width,height)}))}});function generate$2(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent){void 0===sdfExponent&&(sdfExponent=1);var textureData=new Uint8Array(sdfWidth*sdfHeight),viewBoxWidth=viewBox[2]-viewBox[0],viewBoxHeight=viewBox[3]-viewBox[1],segments=[];pathToLineSegments(path,(function(x1,y1,x2,y2){segments.push({x1,y1,x2,y2,minX:Math.min(x1,x2),minY:Math.min(y1,y2),maxX:Math.max(x1,x2),maxY:Math.max(y1,y2)})})),segments.sort((function(a,b){return a.maxX-b.maxX}));for(var sdfX=0;sdfX<sdfWidth;sdfX++)for(var sdfY=0;sdfY<sdfHeight;sdfY++){var signedDist=findNearestSignedDistance(viewBox[0]+viewBoxWidth*(sdfX+.5)/sdfWidth,viewBox[1]+viewBoxHeight*(sdfY+.5)/sdfHeight),alpha=Math.pow(1-Math.abs(signedDist)/maxDistance,sdfExponent)/2;signedDist<0&&(alpha=1-alpha),alpha=Math.max(0,Math.min(255,Math.round(255*alpha))),textureData[sdfY*sdfWidth+sdfX]=alpha}return textureData;function findNearestSignedDistance(x,y){for(var closestDistSq=1/0,closestDist=1/0,i=segments.length;i--;){var seg=segments[i];if(seg.maxX+closestDist<=x)break;if(x+closestDist>seg.minX&&y-closestDist<seg.maxY&&y+closestDist>seg.minY){var distSq=absSquareDistanceToLineSegment(x,y,seg.x1,seg.y1,seg.x2,seg.y2);distSq<closestDistSq&&(closestDistSq=distSq,closestDist=Math.sqrt(closestDistSq))}}return function isPointInPoly(x,y){for(var winding=0,i=segments.length;i--;){var seg=segments[i];if(seg.maxX<=x)break;seg.y1>y!=seg.y2>y&&x<(seg.x2-seg.x1)*(y-seg.y1)/(seg.y2-seg.y1)+seg.x1&&(winding+=seg.y1<seg.y2?1:-1)}return 0!==winding}(x,y)&&(closestDist=-closestDist),closestDist}}function generateIntoCanvas$2(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0),generateIntoFramebuffer$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,null,x,y,channel)}function generateIntoFramebuffer$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,glOrCanvas,framebuffer,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0);for(var data=generate$2(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent),rgbaData=new Uint8Array(4*data.length),i=0;i<data.length;i++)rgbaData[4*i+channel]=data[i];renderImageData(glOrCanvas,rgbaData,x,y,sdfWidth,sdfHeight,1<<3-channel,framebuffer)}function absSquareDistanceToLineSegment(x,y,lineX0,lineY0,lineX1,lineY1){var ldx=lineX1-lineX0,ldy=lineY1-lineY0,lengthSq=ldx*ldx+ldy*ldy,t=lengthSq?Math.max(0,Math.min(1,((x-lineX0)*ldx+(y-lineY0)*ldy)/lengthSq)):0,dx=x-(lineX0+t*ldx),dy=y-(lineY0+t*ldy);return dx*dx+dy*dy}var javascript=Object.freeze({__proto__:null,generate:generate$2,generateIntoCanvas:generateIntoCanvas$2,generateIntoFramebuffer:generateIntoFramebuffer$1}),mainVertex="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",mainFragment="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",postFragment="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",viewportUVs=new Float32Array([0,0,2,0,0,2]),implicitContext=null,isTestingSupport=!1,NULL_OBJECT={},supportByCanvas=new WeakMap;function validateSupport(glOrCanvas){if(!isTestingSupport&&!isSupported(glOrCanvas))throw new Error("WebGL generation not supported")}function generate$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,glOrCanvas){if(void 0===sdfExponent&&(sdfExponent=1),void 0===glOrCanvas&&(glOrCanvas=null),!glOrCanvas&&!(glOrCanvas=implicitContext)){var canvas="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!canvas)throw new Error("OffscreenCanvas or DOM canvas not supported");glOrCanvas=implicitContext=canvas.getContext("webgl",{depth:!1})}validateSupport(glOrCanvas);var rgbaData=new Uint8Array(sdfWidth*sdfHeight*4);withWebGLContext(glOrCanvas,(function(ref){var gl=ref.gl,withTexture=ref.withTexture,withTextureFramebuffer=ref.withTextureFramebuffer;withTexture("readable",(function(texture,textureUnit){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,sdfWidth,sdfHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null),withTextureFramebuffer(texture,textureUnit,(function(framebuffer){generateIntoFramebuffer(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,gl,framebuffer,0,0,0),gl.readPixels(0,0,sdfWidth,sdfHeight,gl.RGBA,gl.UNSIGNED_BYTE,rgbaData)}))}))}));for(var data=new Uint8Array(sdfWidth*sdfHeight),i=0,j=0;i<rgbaData.length;i+=4)data[j++]=rgbaData[i];return data}function generateIntoCanvas$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0),generateIntoFramebuffer(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,null,x,y,channel)}function generateIntoFramebuffer(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,glOrCanvas,framebuffer,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0),validateSupport(glOrCanvas);var lineSegmentCoords=[];pathToLineSegments(path,(function(x1,y1,x2,y2){lineSegmentCoords.push(x1,y1,x2,y2)})),lineSegmentCoords=new Float32Array(lineSegmentCoords),withWebGLContext(glOrCanvas,(function(ref){var gl=ref.gl,isWebGL2=ref.isWebGL2,getExtension=ref.getExtension,withProgram=ref.withProgram,withTexture=ref.withTexture,withTextureFramebuffer=ref.withTextureFramebuffer,handleContextLoss=ref.handleContextLoss;if(withTexture("rawDistances",(function(intermediateTexture,intermediateTextureUnit){sdfWidth===intermediateTexture._lastWidth&&sdfHeight===intermediateTexture._lastHeight||gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,intermediateTexture._lastWidth=sdfWidth,intermediateTexture._lastHeight=sdfHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null),withProgram("main",mainVertex,mainFragment,(function(ref){var setAttribute=ref.setAttribute,setUniform=ref.setUniform,instancingExtension=!isWebGL2&&getExtension("ANGLE_instanced_arrays"),blendMinMaxExtension=!isWebGL2&&getExtension("EXT_blend_minmax");setAttribute("aUV",2,gl.STATIC_DRAW,0,viewportUVs),setAttribute("aLineSegment",4,gl.DYNAMIC_DRAW,1,lineSegmentCoords),setUniform.apply(void 0,["4f","uGlyphBounds"].concat(viewBox)),setUniform("1f","uMaxDistance",maxDistance),setUniform("1f","uExponent",sdfExponent),withTextureFramebuffer(intermediateTexture,intermediateTextureUnit,(function(framebuffer){gl.enable(gl.BLEND),gl.colorMask(!0,!0,!0,!0),gl.viewport(0,0,sdfWidth,sdfHeight),gl.scissor(0,0,sdfWidth,sdfHeight),gl.blendFunc(gl.ONE,gl.ONE),gl.blendEquationSeparate(gl.FUNC_ADD,isWebGL2?gl.MAX:blendMinMaxExtension.MAX_EXT),gl.clear(gl.COLOR_BUFFER_BIT),isWebGL2?gl.drawArraysInstanced(gl.TRIANGLES,0,3,lineSegmentCoords.length/4):instancingExtension.drawArraysInstancedANGLE(gl.TRIANGLES,0,3,lineSegmentCoords.length/4)}))})),withProgram("post",viewportQuadVertex,postFragment,(function(program){program.setAttribute("aUV",2,gl.STATIC_DRAW,0,viewportUVs),program.setUniform("1i","tex",intermediateTextureUnit),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.disable(gl.BLEND),gl.colorMask(0===channel,1===channel,2===channel,3===channel),gl.viewport(x,y,sdfWidth,sdfHeight),gl.scissor(x,y,sdfWidth,sdfHeight),gl.drawArrays(gl.TRIANGLES,0,3)}))})),gl.isContextLost())throw handleContextLoss(),new Error("webgl context lost")}))}function isSupported(glOrCanvas){var key=glOrCanvas&&glOrCanvas!==implicitContext?glOrCanvas.canvas||glOrCanvas:NULL_OBJECT,supported=supportByCanvas.get(key);if(void 0===supported){isTestingSupport=!0;var failReason=null;try{var expectedResult=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],testResult=generate$1(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,glOrCanvas);(supported=testResult&&expectedResult.length===testResult.length&&testResult.every((function(val,i){return val===expectedResult[i]})))||(failReason="bad trial run results",console.info(expectedResult,testResult))}catch(err){supported=!1,failReason=err.message}failReason&&console.warn("WebGL SDF generation not supported:",failReason),isTestingSupport=!1,supportByCanvas.set(key,supported)}return supported}var webgl=Object.freeze({__proto__:null,generate:generate$1,generateIntoCanvas:generateIntoCanvas$1,generateIntoFramebuffer,isSupported});return exports.forEachPathCommand=forEachPathCommand,exports.generate=function generate(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent){void 0===maxDistance&&(maxDistance=Math.max(viewBox[2]-viewBox[0],viewBox[3]-viewBox[1])/2),void 0===sdfExponent&&(sdfExponent=1);try{return generate$1.apply(webgl,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),generate$2.apply(javascript,arguments)}},exports.generateIntoCanvas=function generateIntoCanvas(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,x,y,channel){void 0===maxDistance&&(maxDistance=Math.max(viewBox[2]-viewBox[0],viewBox[3]-viewBox[1])/2),void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0);try{return generateIntoCanvas$1.apply(webgl,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),generateIntoCanvas$2.apply(javascript,arguments)}},exports.javascript=javascript,exports.pathToLineSegments=pathToLineSegments,exports.webgl=webgl,exports.webglUtils=webglUtils,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({});return exports}const bidi=function bidiFactory(){return function(exports){var DATA={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},TYPES={},TYPES_TO_NAMES={};TYPES.L=1,TYPES_TO_NAMES[1]="L",Object.keys(DATA).forEach((function(type,i){TYPES[type]=1<<i+1,TYPES_TO_NAMES[TYPES[type]]=type})),Object.freeze(TYPES);var ISOLATE_INIT_TYPES=TYPES.LRI|TYPES.RLI|TYPES.FSI,STRONG_TYPES=TYPES.L|TYPES.R|TYPES.AL,NEUTRAL_ISOLATE_TYPES=TYPES.B|TYPES.S|TYPES.WS|TYPES.ON|TYPES.FSI|TYPES.LRI|TYPES.RLI|TYPES.PDI,BN_LIKE_TYPES=TYPES.BN|TYPES.RLE|TYPES.LRE|TYPES.RLO|TYPES.LRO|TYPES.PDF,TRAILING_TYPES=TYPES.S|TYPES.WS|TYPES.B|ISOLATE_INIT_TYPES|TYPES.PDI|BN_LIKE_TYPES,map=null;function getBidiCharType(char){return function parseData(){if(!map){map=new Map;var loop=function(type){if(DATA.hasOwnProperty(type)){var lastCode=0;DATA[type].split(",").forEach((function(range){var ref=range.split("+"),skip=ref[0],step=ref[1];skip=parseInt(skip,36),step=step?parseInt(step,36):0,map.set(lastCode+=skip,TYPES[type]);for(var i=0;i<step;i++)map.set(++lastCode,TYPES[type])}))}};for(var type in DATA)loop(type)}}(),map.get(char.codePointAt(0))||TYPES.L}var openToClose,closeToOpen,canonical,data$1={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function parseCharacterMap(encodedString,includeReverse){var prevPair,lastCode=0,map=new Map,reverseMap=includeReverse&&new Map;return encodedString.split(",").forEach((function visit(entry){if(-1!==entry.indexOf("+"))for(var i=+entry;i--;)visit(prevPair);else{prevPair=entry;var ref=entry.split(">"),a=ref[0],b=ref[1];a=String.fromCodePoint(lastCode+=parseInt(a,36)),b=String.fromCodePoint(lastCode+=parseInt(b,36)),map.set(a,b),includeReverse&&reverseMap.set(b,a)}})),{map,reverseMap}}function parse$1(){if(!openToClose){var ref=parseCharacterMap(data$1.pairs,!0),map=ref.map,reverseMap=ref.reverseMap;openToClose=map,closeToOpen=reverseMap,canonical=parseCharacterMap(data$1.canonical,!1).map}}function openingToClosingBracket(char){return parse$1(),openToClose.get(char)||null}function closingToOpeningBracket(char){return parse$1(),closeToOpen.get(char)||null}function getCanonicalBracket(char){return parse$1(),canonical.get(char)||null}var TYPE_L=TYPES.L,TYPE_R=TYPES.R,TYPE_EN=TYPES.EN,TYPE_ES=TYPES.ES,TYPE_ET=TYPES.ET,TYPE_AN=TYPES.AN,TYPE_CS=TYPES.CS,TYPE_B=TYPES.B,TYPE_S=TYPES.S,TYPE_ON=TYPES.ON,TYPE_BN=TYPES.BN,TYPE_NSM=TYPES.NSM,TYPE_AL=TYPES.AL,TYPE_LRO=TYPES.LRO,TYPE_RLO=TYPES.RLO,TYPE_LRE=TYPES.LRE,TYPE_RLE=TYPES.RLE,TYPE_PDF=TYPES.PDF,TYPE_LRI=TYPES.LRI,TYPE_RLI=TYPES.RLI,TYPE_FSI=TYPES.FSI,TYPE_PDI=TYPES.PDI;var mirrorMap,data="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1";function getMirroredCharacter(char){return function parse(){if(!mirrorMap){var ref=parseCharacterMap(data,!0),map=ref.map;ref.reverseMap.forEach((function(value,key){map.set(key,value)})),mirrorMap=map}}(),mirrorMap.get(char)||null}function getReorderSegments(string,embeddingLevelsResult,start,end){var strLen=string.length;start=Math.max(0,null==start?0:+start),end=Math.min(strLen-1,null==end?strLen-1:+end);var segments=[];return embeddingLevelsResult.paragraphs.forEach((function(paragraph){var lineStart=Math.max(start,paragraph.start),lineEnd=Math.min(end,paragraph.end);if(lineStart<lineEnd){for(var lineLevels=embeddingLevelsResult.levels.slice(lineStart,lineEnd+1),i=lineEnd;i>=lineStart&&getBidiCharType(string[i])&TRAILING_TYPES;i--)lineLevels[i]=paragraph.level;for(var maxLevel=paragraph.level,minOddLevel=1/0,i$1=0;i$1<lineLevels.length;i$1++){var level=lineLevels[i$1];level>maxLevel&&(maxLevel=level),level<minOddLevel&&(minOddLevel=1|level)}for(var lvl=maxLevel;lvl>=minOddLevel;lvl--)for(var i$2=0;i$2<lineLevels.length;i$2++)if(lineLevels[i$2]>=lvl){for(var segStart=i$2;i$2+1<lineLevels.length&&lineLevels[i$2+1]>=lvl;)i$2++;i$2>segStart&&segments.push([segStart+lineStart,i$2+lineStart])}}})),segments}function getReorderedIndices(string,embedLevelsResult,start,end){for(var segments=getReorderSegments(string,embedLevelsResult,start,end),indices=[],i=0;i<string.length;i++)indices[i]=i;return segments.forEach((function(ref){for(var start=ref[0],end=ref[1],slice=indices.slice(start,end+1),i=slice.length;i--;)indices[end-i]=slice[i]})),indices}return exports.closingToOpeningBracket=closingToOpeningBracket,exports.getBidiCharType=getBidiCharType,exports.getBidiCharTypeName=function getBidiCharTypeName(char){return TYPES_TO_NAMES[getBidiCharType(char)]},exports.getCanonicalBracket=getCanonicalBracket,exports.getEmbeddingLevels=function getEmbeddingLevels(string,baseDirection){for(var charTypes=new Uint32Array(string.length),i=0;i<string.length;i++)charTypes[i]=getBidiCharType(string[i]);var charTypeCounts=new Map;function changeCharType(i,type){var oldType=charTypes[i];charTypes[i]=type,charTypeCounts.set(oldType,charTypeCounts.get(oldType)-1),oldType&NEUTRAL_ISOLATE_TYPES&&charTypeCounts.set(NEUTRAL_ISOLATE_TYPES,charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)-1),charTypeCounts.set(type,(charTypeCounts.get(type)||0)+1),type&NEUTRAL_ISOLATE_TYPES&&charTypeCounts.set(NEUTRAL_ISOLATE_TYPES,(charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)||0)+1)}for(var embedLevels=new Uint8Array(string.length),isolationPairs=new Map,paragraphs=[],paragraph=null,i$1=0;i$1<string.length;i$1++)paragraph||paragraphs.push(paragraph={start:i$1,end:string.length-1,level:"rtl"===baseDirection?1:"ltr"===baseDirection?0:determineAutoEmbedLevel(i$1,!1)}),charTypes[i$1]&TYPE_B&&(paragraph.end=i$1,paragraph=null);for(var FORMATTING_TYPES=TYPE_RLE|TYPE_LRE|TYPE_RLO|TYPE_LRO|ISOLATE_INIT_TYPES|TYPE_PDI|TYPE_PDF|TYPE_B,nextEven=function(n){return n+(1&n?1:2)},nextOdd=function(n){return n+(1&n?2:1)},paraIdx=0;paraIdx<paragraphs.length;paraIdx++){var statusStack=[{_level:(paragraph=paragraphs[paraIdx]).level,_override:0,_isolate:0}],stackTop=void 0,overflowIsolateCount=0,overflowEmbeddingCount=0,validIsolateCount=0;charTypeCounts.clear();for(var i$2=paragraph.start;i$2<=paragraph.end;i$2++){var charType=charTypes[i$2];if(stackTop=statusStack[statusStack.length-1],charTypeCounts.set(charType,(charTypeCounts.get(charType)||0)+1),charType&NEUTRAL_ISOLATE_TYPES&&charTypeCounts.set(NEUTRAL_ISOLATE_TYPES,(charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)||0)+1),charType&FORMATTING_TYPES)if(charType&(TYPE_RLE|TYPE_LRE)){embedLevels[i$2]=stackTop._level;var level=(charType===TYPE_RLE?nextOdd:nextEven)(stackTop._level);level<=125&&!overflowIsolateCount&&!overflowEmbeddingCount?statusStack.push({_level:level,_override:0,_isolate:0}):overflowIsolateCount||overflowEmbeddingCount++}else if(charType&(TYPE_RLO|TYPE_LRO)){embedLevels[i$2]=stackTop._level;var level$1=(charType===TYPE_RLO?nextOdd:nextEven)(stackTop._level);level$1<=125&&!overflowIsolateCount&&!overflowEmbeddingCount?statusStack.push({_level:level$1,_override:charType&TYPE_RLO?TYPE_R:TYPE_L,_isolate:0}):overflowIsolateCount||overflowEmbeddingCount++}else if(charType&ISOLATE_INIT_TYPES){charType&TYPE_FSI&&(charType=1===determineAutoEmbedLevel(i$2+1,!0)?TYPE_RLI:TYPE_LRI),embedLevels[i$2]=stackTop._level,stackTop._override&&changeCharType(i$2,stackTop._override);var level$2=(charType===TYPE_RLI?nextOdd:nextEven)(stackTop._level);level$2<=125&&0===overflowIsolateCount&&0===overflowEmbeddingCount?(validIsolateCount++,statusStack.push({_level:level$2,_override:0,_isolate:1,_isolInitIndex:i$2})):overflowIsolateCount++}else if(charType&TYPE_PDI){if(overflowIsolateCount>0)overflowIsolateCount--;else if(validIsolateCount>0){for(overflowEmbeddingCount=0;!statusStack[statusStack.length-1]._isolate;)statusStack.pop();var isolInitIndex=statusStack[statusStack.length-1]._isolInitIndex;null!=isolInitIndex&&(isolationPairs.set(isolInitIndex,i$2),isolationPairs.set(i$2,isolInitIndex)),statusStack.pop(),validIsolateCount--}stackTop=statusStack[statusStack.length-1],embedLevels[i$2]=stackTop._level,stackTop._override&&changeCharType(i$2,stackTop._override)}else charType&TYPE_PDF?(0===overflowIsolateCount&&(overflowEmbeddingCount>0?overflowEmbeddingCount--:!stackTop._isolate&&statusStack.length>1&&(statusStack.pop(),stackTop=statusStack[statusStack.length-1])),embedLevels[i$2]=stackTop._level):charType&TYPE_B&&(embedLevels[i$2]=paragraph.level);else embedLevels[i$2]=stackTop._level,stackTop._override&&charType!==TYPE_BN&&changeCharType(i$2,stackTop._override)}for(var levelRuns=[],currentRun=null,i$3=paragraph.start;i$3<=paragraph.end;i$3++){var charType$1=charTypes[i$3];if(!(charType$1&BN_LIKE_TYPES)){var lvl=embedLevels[i$3],isIsolInit=charType$1&ISOLATE_INIT_TYPES,isPDI=charType$1===TYPE_PDI;currentRun&&lvl===currentRun._level?(currentRun._end=i$3,currentRun._endsWithIsolInit=isIsolInit):levelRuns.push(currentRun={_start:i$3,_end:i$3,_level:lvl,_startsWithPDI:isPDI,_endsWithIsolInit:isIsolInit})}}for(var isolatingRunSeqs=[],runIdx=0;runIdx<levelRuns.length;runIdx++){var run=levelRuns[runIdx];if(!run._startsWithPDI||run._startsWithPDI&&!isolationPairs.has(run._start)){for(var seqRuns=[currentRun=run],pdiIndex=void 0;currentRun&&currentRun._endsWithIsolInit&&null!=(pdiIndex=isolationPairs.get(currentRun._end));)for(var i$4=runIdx+1;i$4<levelRuns.length;i$4++)if(levelRuns[i$4]._start===pdiIndex){seqRuns.push(currentRun=levelRuns[i$4]);break}for(var seqIndices=[],i$5=0;i$5<seqRuns.length;i$5++)for(var run$1=seqRuns[i$5],j=run$1._start;j<=run$1._end;j++)seqIndices.push(j);for(var firstLevel=embedLevels[seqIndices[0]],prevLevel=paragraph.level,i$6=seqIndices[0]-1;i$6>=0;i$6--)if(!(charTypes[i$6]&BN_LIKE_TYPES)){prevLevel=embedLevels[i$6];break}var lastIndex=seqIndices[seqIndices.length-1],lastLevel=embedLevels[lastIndex],nextLevel=paragraph.level;if(!(charTypes[lastIndex]&ISOLATE_INIT_TYPES))for(var i$7=lastIndex+1;i$7<=paragraph.end;i$7++)if(!(charTypes[i$7]&BN_LIKE_TYPES)){nextLevel=embedLevels[i$7];break}isolatingRunSeqs.push({_seqIndices:seqIndices,_sosType:Math.max(prevLevel,firstLevel)%2?TYPE_R:TYPE_L,_eosType:Math.max(nextLevel,lastLevel)%2?TYPE_R:TYPE_L})}}for(var seqIdx=0;seqIdx<isolatingRunSeqs.length;seqIdx++){var ref=isolatingRunSeqs[seqIdx],seqIndices$1=ref._seqIndices,sosType=ref._sosType,eosType=ref._eosType,embedDirection=1&embedLevels[seqIndices$1[0]]?TYPE_R:TYPE_L;if(charTypeCounts.get(TYPE_NSM))for(var si=0;si<seqIndices$1.length;si++){var i$8=seqIndices$1[si];if(charTypes[i$8]&TYPE_NSM){for(var prevType=sosType,sj=si-1;sj>=0;sj--)if(!(charTypes[seqIndices$1[sj]]&BN_LIKE_TYPES)){prevType=charTypes[seqIndices$1[sj]];break}changeCharType(i$8,prevType&(ISOLATE_INIT_TYPES|TYPE_PDI)?TYPE_ON:prevType)}}if(charTypeCounts.get(TYPE_EN))for(var si$1=0;si$1<seqIndices$1.length;si$1++){var i$9=seqIndices$1[si$1];if(charTypes[i$9]&TYPE_EN)for(var sj$1=si$1-1;sj$1>=-1;sj$1--){var prevCharType=-1===sj$1?sosType:charTypes[seqIndices$1[sj$1]];if(prevCharType&STRONG_TYPES){prevCharType===TYPE_AL&&changeCharType(i$9,TYPE_AN);break}}}if(charTypeCounts.get(TYPE_AL))for(var si$2=0;si$2<seqIndices$1.length;si$2++){var i$10=seqIndices$1[si$2];charTypes[i$10]&TYPE_AL&&changeCharType(i$10,TYPE_R)}if(charTypeCounts.get(TYPE_ES)||charTypeCounts.get(TYPE_CS))for(var si$3=1;si$3<seqIndices$1.length-1;si$3++){var i$11=seqIndices$1[si$3];if(charTypes[i$11]&(TYPE_ES|TYPE_CS)){for(var prevType$1=0,nextType=0,sj$2=si$3-1;sj$2>=0&&(prevType$1=charTypes[seqIndices$1[sj$2]])&BN_LIKE_TYPES;sj$2--);for(var sj$3=si$3+1;sj$3<seqIndices$1.length&&(nextType=charTypes[seqIndices$1[sj$3]])&BN_LIKE_TYPES;sj$3++);prevType$1===nextType&&(charTypes[i$11]===TYPE_ES?prevType$1===TYPE_EN:prevType$1&(TYPE_EN|TYPE_AN))&&changeCharType(i$11,prevType$1)}}if(charTypeCounts.get(TYPE_EN))for(var si$4=0;si$4<seqIndices$1.length;si$4++){var i$12=seqIndices$1[si$4];if(charTypes[i$12]&TYPE_EN){for(var sj$4=si$4-1;sj$4>=0&&charTypes[seqIndices$1[sj$4]]&(TYPE_ET|BN_LIKE_TYPES);sj$4--)changeCharType(seqIndices$1[sj$4],TYPE_EN);for(si$4++;si$4<seqIndices$1.length&&charTypes[seqIndices$1[si$4]]&(TYPE_ET|BN_LIKE_TYPES|TYPE_EN);si$4++)charTypes[seqIndices$1[si$4]]!==TYPE_EN&&changeCharType(seqIndices$1[si$4],TYPE_EN)}}if(charTypeCounts.get(TYPE_ET)||charTypeCounts.get(TYPE_ES)||charTypeCounts.get(TYPE_CS))for(var si$5=0;si$5<seqIndices$1.length;si$5++){var i$13=seqIndices$1[si$5];if(charTypes[i$13]&(TYPE_ET|TYPE_ES|TYPE_CS)){changeCharType(i$13,TYPE_ON);for(var sj$5=si$5-1;sj$5>=0&&charTypes[seqIndices$1[sj$5]]&BN_LIKE_TYPES;sj$5--)changeCharType(seqIndices$1[sj$5],TYPE_ON);for(var sj$6=si$5+1;sj$6<seqIndices$1.length&&charTypes[seqIndices$1[sj$6]]&BN_LIKE_TYPES;sj$6++)changeCharType(seqIndices$1[sj$6],TYPE_ON)}}if(charTypeCounts.get(TYPE_EN))for(var si$6=0,prevStrongType=sosType;si$6<seqIndices$1.length;si$6++){var i$14=seqIndices$1[si$6],type=charTypes[i$14];type&TYPE_EN?prevStrongType===TYPE_L&&changeCharType(i$14,TYPE_L):type&STRONG_TYPES&&(prevStrongType=type)}if(charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)){for(var R_TYPES_FOR_N_STEPS=TYPE_R|TYPE_EN|TYPE_AN,STRONG_TYPES_FOR_N_STEPS=R_TYPES_FOR_N_STEPS|TYPE_L,bracketPairs=[],openerStack=[],si$7=0;si$7<seqIndices$1.length;si$7++)if(charTypes[seqIndices$1[si$7]]&NEUTRAL_ISOLATE_TYPES){var char=string[seqIndices$1[si$7]],oppositeBracket=void 0;if(null!==openingToClosingBracket(char)){if(!(openerStack.length<63))break;openerStack.push({char,seqIndex:si$7})}else if(null!==(oppositeBracket=closingToOpeningBracket(char)))for(var stackIdx=openerStack.length-1;stackIdx>=0;stackIdx--){var stackChar=openerStack[stackIdx].char;if(stackChar===oppositeBracket||stackChar===closingToOpeningBracket(getCanonicalBracket(char))||openingToClosingBracket(getCanonicalBracket(stackChar))===char){bracketPairs.push([openerStack[stackIdx].seqIndex,si$7]),openerStack.length=stackIdx;break}}}bracketPairs.sort((function(a,b){return a[0]-b[0]}));for(var pairIdx=0;pairIdx<bracketPairs.length;pairIdx++){for(var ref$1=bracketPairs[pairIdx],openSeqIdx=ref$1[0],closeSeqIdx=ref$1[1],foundStrongType=!1,useStrongType=0,si$8=openSeqIdx+1;si$8<closeSeqIdx;si$8++){var i$15=seqIndices$1[si$8];if(charTypes[i$15]&STRONG_TYPES_FOR_N_STEPS){foundStrongType=!0;var lr=charTypes[i$15]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;if(lr===embedDirection){useStrongType=lr;break}}}if(foundStrongType&&!useStrongType){useStrongType=sosType;for(var si$9=openSeqIdx-1;si$9>=0;si$9--){var i$16=seqIndices$1[si$9];if(charTypes[i$16]&STRONG_TYPES_FOR_N_STEPS){var lr$1=charTypes[i$16]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;useStrongType=lr$1!==embedDirection?lr$1:embedDirection;break}}}if(useStrongType){if(charTypes[seqIndices$1[openSeqIdx]]=charTypes[seqIndices$1[closeSeqIdx]]=useStrongType,useStrongType!==embedDirection)for(var si$10=openSeqIdx+1;si$10<seqIndices$1.length;si$10++)if(!(charTypes[seqIndices$1[si$10]]&BN_LIKE_TYPES)){getBidiCharType(string[seqIndices$1[si$10]])&TYPE_NSM&&(charTypes[seqIndices$1[si$10]]=useStrongType);break}if(useStrongType!==embedDirection)for(var si$11=closeSeqIdx+1;si$11<seqIndices$1.length;si$11++)if(!(charTypes[seqIndices$1[si$11]]&BN_LIKE_TYPES)){getBidiCharType(string[seqIndices$1[si$11]])&TYPE_NSM&&(charTypes[seqIndices$1[si$11]]=useStrongType);break}}}for(var si$12=0;si$12<seqIndices$1.length;si$12++)if(charTypes[seqIndices$1[si$12]]&NEUTRAL_ISOLATE_TYPES){for(var niRunStart=si$12,niRunEnd=si$12,prevType$2=sosType,si2=si$12-1;si2>=0;si2--){if(!(charTypes[seqIndices$1[si2]]&BN_LIKE_TYPES)){prevType$2=charTypes[seqIndices$1[si2]]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;break}niRunStart=si2}for(var nextType$1=eosType,si2$1=si$12+1;si2$1<seqIndices$1.length;si2$1++){if(!(charTypes[seqIndices$1[si2$1]]&(NEUTRAL_ISOLATE_TYPES|BN_LIKE_TYPES))){nextType$1=charTypes[seqIndices$1[si2$1]]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;break}niRunEnd=si2$1}for(var sj$7=niRunStart;sj$7<=niRunEnd;sj$7++)charTypes[seqIndices$1[sj$7]]=prevType$2===nextType$1?prevType$2:embedDirection;si$12=niRunEnd}}}for(var i$17=paragraph.start;i$17<=paragraph.end;i$17++){var level$3=embedLevels[i$17],type$1=charTypes[i$17];if(1&level$3?type$1&(TYPE_L|TYPE_EN|TYPE_AN)&&embedLevels[i$17]++:type$1&TYPE_R?embedLevels[i$17]++:type$1&(TYPE_AN|TYPE_EN)&&(embedLevels[i$17]+=2),type$1&BN_LIKE_TYPES&&(embedLevels[i$17]=0===i$17?paragraph.level:embedLevels[i$17-1]),i$17===paragraph.end||getBidiCharType(string[i$17])&(TYPE_S|TYPE_B))for(var j$1=i$17;j$1>=0&&getBidiCharType(string[j$1])&TRAILING_TYPES;j$1--)embedLevels[j$1]=paragraph.level}}return{levels:embedLevels,paragraphs};function determineAutoEmbedLevel(start,isFSI){for(var i=start;i<string.length;i++){var charType=charTypes[i];if(charType&(TYPE_R|TYPE_AL))return 1;if(charType&(TYPE_B|TYPE_L)||isFSI&&charType===TYPE_PDI)return 0;if(charType&ISOLATE_INIT_TYPES){var pdi=indexOfMatchingPDI(i);i=-1===pdi?string.length:pdi}}return 0}function indexOfMatchingPDI(isolateStart){for(var isolationLevel=1,i=isolateStart+1;i<string.length;i++){var charType=charTypes[i];if(charType&TYPE_B)break;if(charType&TYPE_PDI){if(0==--isolationLevel)return i}else charType&ISOLATE_INIT_TYPES&&isolationLevel++}return-1}},exports.getMirroredCharacter=getMirroredCharacter,exports.getMirroredCharactersMap=function getMirroredCharactersMap(string,embeddingLevels,start,end){var strLen=string.length;start=Math.max(0,null==start?0:+start),end=Math.min(strLen-1,null==end?strLen-1:+end);for(var map=new Map,i=start;i<=end;i++)if(1&embeddingLevels[i]){var mirror=getMirroredCharacter(string[i]);null!==mirror&&map.set(i,mirror)}return map},exports.getReorderSegments=getReorderSegments,exports.getReorderedIndices=getReorderedIndices,exports.getReorderedString=function getReorderedString(string,embedLevelsResult,start,end){var indices=getReorderedIndices(string,embedLevelsResult,start,end),chars=[].concat(string);return indices.forEach((function(charIndex,i){chars[i]=(1&embedLevelsResult.levels[charIndex]?getMirroredCharacter(string[charIndex]):null)||string[charIndex]})),chars.join("")},exports.openingToClosingBracket=openingToClosingBracket,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({})},voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(source){return source.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function replace(match,include){let chunk=three_module.ShaderChunk[include];return chunk?expandShaderIncludes(chunk):match}))}const _lut=[];for(let i=0;i<256;i++)_lut[i]=(i<16?"0":"")+i.toString(16);const troika_three_utils_esm_assign=Object.assign||function(){let target=arguments[0];for(let i=1,len=arguments.length;i<len;i++){let source=arguments[i];if(source)for(let prop in source)Object.prototype.hasOwnProperty.call(source,prop)&&(target[prop]=source[prop])}return target},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(baseMaterial,options){const optionsKey=function getKeyForOptions(options){const optionsHash=JSON.stringify(options,optionsJsonReplacer);let id=optionsHashesToIds.get(optionsHash);null==id&&optionsHashesToIds.set(optionsHash,id=++_idCtr);return id}(options);let ctorsByDerivation=CONSTRUCTOR_CACHE.get(baseMaterial);if(ctorsByDerivation||CONSTRUCTOR_CACHE.set(baseMaterial,ctorsByDerivation=Object.create(null)),ctorsByDerivation[optionsKey])return new ctorsByDerivation[optionsKey];const privateBeforeCompileProp=`_onBeforeCompile${optionsKey}`,onBeforeCompile=function(shaderInfo,renderer){baseMaterial.onBeforeCompile.call(this,shaderInfo,renderer);const cacheKey=this.customProgramCacheKey()+"|"+shaderInfo.vertexShader+"|"+shaderInfo.fragmentShader;let upgradedShaders=SHADER_UPGRADE_CACHE[cacheKey];if(!upgradedShaders){const upgraded=function upgradeShaders(material,{vertexShader,fragmentShader},options,key){let{vertexDefs,vertexMainIntro,vertexMainOutro,vertexTransform,fragmentDefs,fragmentMainIntro,fragmentMainOutro,fragmentColorTransform,customRewriter,timeUniform}=options;vertexDefs=vertexDefs||"",vertexMainIntro=vertexMainIntro||"",vertexMainOutro=vertexMainOutro||"",fragmentDefs=fragmentDefs||"",fragmentMainIntro=fragmentMainIntro||"",fragmentMainOutro=fragmentMainOutro||"",(vertexTransform||customRewriter)&&(vertexShader=expandShaderIncludes(vertexShader));(fragmentColorTransform||customRewriter)&&(fragmentShader=expandShaderIncludes(fragmentShader=fragmentShader.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(customRewriter){let res=customRewriter({vertexShader,fragmentShader});vertexShader=res.vertexShader,fragmentShader=res.fragmentShader}if(fragmentColorTransform){let postChunks=[];fragmentShader=fragmentShader.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(match=>(postChunks.push(match),""))),fragmentMainOutro=`${fragmentColorTransform}\n${postChunks.join("\n")}\n${fragmentMainOutro}`}if(timeUniform){const code=`\nuniform float ${timeUniform};\n`;vertexDefs=code+vertexDefs,fragmentDefs=code+fragmentDefs}vertexTransform&&(vertexDefs=`${vertexDefs}\nvoid troikaVertexTransform${key}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${vertexTransform}\n}\n`,vertexMainIntro=`\ntroika_position_${key} = vec3(position);\ntroika_normal_${key} = vec3(normal);\ntroika_uv_${key} = vec2(uv);\ntroikaVertexTransform${key}(troika_position_${key}, troika_normal_${key}, troika_uv_${key});\n${vertexMainIntro}\n`,vertexShader=(vertexShader=`vec3 troika_position_${key};\nvec3 troika_normal_${key};\nvec2 troika_uv_${key};\n${vertexShader}\n`).replace(/\b(position|normal|uv)\b/g,((match,match1,index,fullStr)=>/\battribute\s+vec[23]\s+$/.test(fullStr.substr(0,index))?match1:`troika_${match1}_${key}`)),material.map&&material.map.channel>0||(vertexShader=vertexShader.replace(/\bMAP_UV\b/g,`troika_uv_${key}`)));return vertexShader=injectIntoShaderCode(vertexShader,key,vertexDefs,vertexMainIntro,vertexMainOutro),fragmentShader=injectIntoShaderCode(fragmentShader,key,fragmentDefs,fragmentMainIntro,fragmentMainOutro),{vertexShader,fragmentShader}}(this,shaderInfo,options,optionsKey);upgradedShaders=SHADER_UPGRADE_CACHE[cacheKey]=upgraded}shaderInfo.vertexShader=upgradedShaders.vertexShader,shaderInfo.fragmentShader=upgradedShaders.fragmentShader,troika_three_utils_esm_assign(shaderInfo.uniforms,this.uniforms),options.timeUniform&&(shaderInfo.uniforms[options.timeUniform]={get value(){return Date.now()-epoch}}),this[privateBeforeCompileProp]&&this[privateBeforeCompileProp](shaderInfo)},DerivedMaterial=function DerivedMaterial(){return derive(options.chained?baseMaterial:baseMaterial.clone())},derive=function(base){const derived=Object.create(base,descriptor);return Object.defineProperty(derived,"baseMaterial",{value:baseMaterial}),Object.defineProperty(derived,"id",{value:materialInstanceId++}),derived.uuid=function generateUUID(){const d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return(_lut[255&d0]+_lut[d0>>8&255]+_lut[d0>>16&255]+_lut[d0>>24&255]+"-"+_lut[255&d1]+_lut[d1>>8&255]+"-"+_lut[d1>>16&15|64]+_lut[d1>>24&255]+"-"+_lut[63&d2|128]+_lut[d2>>8&255]+"-"+_lut[d2>>16&255]+_lut[d2>>24&255]+_lut[255&d3]+_lut[d3>>8&255]+_lut[d3>>16&255]+_lut[d3>>24&255]).toUpperCase()}(),derived.uniforms=troika_three_utils_esm_assign({},base.uniforms,options.uniforms),derived.defines=troika_three_utils_esm_assign({},base.defines,options.defines),derived.defines[`TROIKA_DERIVED_MATERIAL_${optionsKey}`]="",derived.extensions=troika_three_utils_esm_assign({},base.extensions,options.extensions),derived._listeners=void 0,derived},descriptor={constructor:{value:DerivedMaterial},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return baseMaterial.customProgramCacheKey()+"|"+optionsKey}},onBeforeCompile:{get:()=>onBeforeCompile,set(fn){this[privateBeforeCompileProp]=fn}},copy:{writable:!0,configurable:!0,value:function(source){return baseMaterial.copy.call(this,source),baseMaterial.isShaderMaterial||baseMaterial.isDerivedMaterial||(troika_three_utils_esm_assign(this.extensions,source.extensions),troika_three_utils_esm_assign(this.defines,source.defines),troika_three_utils_esm_assign(this.uniforms,three_module.UniformsUtils.clone(source.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const newBase=new baseMaterial.constructor;return derive(newBase).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let depthMaterial=this._depthMaterial;return depthMaterial||(depthMaterial=this._depthMaterial=createDerivedMaterial(baseMaterial.isDerivedMaterial?baseMaterial.getDepthMaterial():new three_module.MeshDepthMaterial({depthPacking:three_module.RGBADepthPacking}),options),depthMaterial.defines.IS_DEPTH_MATERIAL="",depthMaterial.uniforms=this.uniforms),depthMaterial}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let distanceMaterial=this._distanceMaterial;return distanceMaterial||(distanceMaterial=this._distanceMaterial=createDerivedMaterial(baseMaterial.isDerivedMaterial?baseMaterial.getDistanceMaterial():new three_module.MeshDistanceMaterial,options),distanceMaterial.defines.IS_DISTANCE_MATERIAL="",distanceMaterial.uniforms=this.uniforms),distanceMaterial}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial,_distanceMaterial}=this;_depthMaterial&&_depthMaterial.dispose(),_distanceMaterial&&_distanceMaterial.dispose(),baseMaterial.dispose.call(this)}}};return ctorsByDerivation[optionsKey]=DerivedMaterial,new DerivedMaterial}function injectIntoShaderCode(shaderCode,id,defs,intro,outro){return(intro||outro||defs)&&(shaderCode=shaderCode.replace(voidMainRegExp,`\n${defs}\nvoid troikaOrigMain${id}() {`),shaderCode+=`\nvoid main() {\n  ${intro}\n  troikaOrigMain${id}();\n  ${outro}\n}`),shaderCode}function optionsJsonReplacer(key,value){return"uniforms"===key?void 0:"function"==typeof value?value.toString():value}let _idCtr=0;const optionsHashesToIds=new Map;three_module.DoubleSide;const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[function typrFactory(){return"undefined"==typeof window&&(self.window=self),function(r){var e={parse:function(r){var t=e._bin,a=new Uint8Array(r);if("ttcf"==t.readASCII(a,0,4)){var n=4;t.readUshort(a,n),n+=2,t.readUshort(a,n),n+=2;var o=t.readUint(a,n);n+=4;for(var s=[],i=0;i<o;i++){var h=t.readUint(a,n);n+=4,s.push(e._readFont(a,h))}return s}return[e._readFont(a,0)]},_readFont:function(r,t){var a=e._bin,n=t;a.readFixed(r,t),t+=4;var o=a.readUshort(r,t);t+=2,a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2;for(var s=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],i={_data:r,_offset:n},h={},f=0;f<o;f++){var d=a.readASCII(r,t,4);t+=4,a.readUint(r,t),t+=4;var u=a.readUint(r,t);t+=4;var l=a.readUint(r,t);t+=4,h[d]={offset:u,length:l}}for(f=0;f<s.length;f++){var v=s[f];h[v]&&(i[v.trim()]=e[v.trim()].parse(r,h[v].offset,h[v].length,i))}return i},_tabOffset:function(r,t,a){for(var n=e._bin,o=n.readUshort(r,a+4),s=a+12,i=0;i<o;i++){var h=n.readASCII(r,s,4);s+=4,n.readUint(r,s),s+=4;var f=n.readUint(r,s);if(s+=4,n.readUint(r,s),s+=4,h==t)return f}return 0}};e._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,t){return e._bin.readShort(r,t)/16384},readInt:function(r,t){return e._bin._view(r).getInt32(t)},readInt8:function(r,t){return e._bin._view(r).getInt8(t)},readShort:function(r,t){return e._bin._view(r).getInt16(t)},readUshort:function(r,t){return e._bin._view(r).getUint16(t)},readUshorts:function(r,t,a){for(var n=[],o=0;o<a;o++)n.push(e._bin.readUshort(r,t+2*o));return n},readUint:function(r,t){return e._bin._view(r).getUint32(t)},readUint64:function(r,t){return 4294967296*e._bin.readUint(r,t)+e._bin.readUint(r,t+4)},readASCII:function(r,e,t){for(var a="",n=0;n<t;n++)a+=String.fromCharCode(r[e+n]);return a},readUnicode:function(r,e,t){for(var a="",n=0;n<t;n++){var o=r[e++]<<8|r[e++];a+=String.fromCharCode(o)}return a},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,t,a){var n=e._bin._tdec;return n&&0==t&&a==r.length?n.decode(r):e._bin.readASCII(r,t,a)},readBytes:function(r,e,t){for(var a=[],n=0;n<t;n++)a.push(r[e+n]);return a},readASCIIArray:function(r,e,t){for(var a=[],n=0;n<t;n++)a.push(String.fromCharCode(r[e+n]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,t,a,n,o){var s=e._bin,i={},h=t;s.readFixed(r,t),t+=4;var f=s.readUshort(r,t);t+=2;var d=s.readUshort(r,t);t+=2;var u=s.readUshort(r,t);return t+=2,i.scriptList=e._lctf.readScriptList(r,h+f),i.featureList=e._lctf.readFeatureList(r,h+d),i.lookupList=e._lctf.readLookupList(r,h+u,o),i},e._lctf.readLookupList=function(r,t,a){var n=e._bin,o=t,s=[],i=n.readUshort(r,t);t+=2;for(var h=0;h<i;h++){var f=n.readUshort(r,t);t+=2;var d=e._lctf.readLookupTable(r,o+f,a);s.push(d)}return s},e._lctf.readLookupTable=function(r,t,a){var n=e._bin,o=t,s={tabs:[]};s.ltype=n.readUshort(r,t),t+=2,s.flag=n.readUshort(r,t),t+=2;var i=n.readUshort(r,t);t+=2;for(var h=s.ltype,f=0;f<i;f++){var d=n.readUshort(r,t);t+=2;var u=a(r,h,o+d,s);s.tabs.push(u)}return s},e._lctf.numOfOnes=function(r){for(var e=0,t=0;t<32;t++)0!=(r>>>t&1)&&e++;return e},e._lctf.readClassDef=function(r,t){var a=e._bin,n=[],o=a.readUshort(r,t);if(t+=2,1==o){var s=a.readUshort(r,t);t+=2;var i=a.readUshort(r,t);t+=2;for(var h=0;h<i;h++)n.push(s+h),n.push(s+h),n.push(a.readUshort(r,t)),t+=2}if(2==o){var f=a.readUshort(r,t);for(t+=2,h=0;h<f;h++)n.push(a.readUshort(r,t)),t+=2,n.push(a.readUshort(r,t)),t+=2,n.push(a.readUshort(r,t)),t+=2}return n},e._lctf.getInterval=function(r,e){for(var t=0;t<r.length;t+=3){var a=r[t],n=r[t+1];if(r[t+2],a<=e&&e<=n)return t}return-1},e._lctf.readCoverage=function(r,t){var a=e._bin,n={};n.fmt=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);return t+=2,1==n.fmt&&(n.tab=a.readUshorts(r,t,o)),2==n.fmt&&(n.tab=a.readUshorts(r,t,3*o)),n},e._lctf.coverageIndex=function(r,t){var a=r.tab;if(1==r.fmt)return a.indexOf(t);if(2==r.fmt){var n=e._lctf.getInterval(a,t);if(-1!=n)return a[n+2]+(t-a[n])}return-1},e._lctf.readFeatureList=function(r,t){var a=e._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readASCII(r,t,4);t+=4;var f=a.readUshort(r,t);t+=2;var d=e._lctf.readFeatureTable(r,n+f);d.tag=h.trim(),o.push(d)}return o},e._lctf.readFeatureTable=function(r,t){var a=e._bin,n=t,o={},s=a.readUshort(r,t);t+=2,s>0&&(o.featureParams=n+s);var i=a.readUshort(r,t);t+=2,o.tab=[];for(var h=0;h<i;h++)o.tab.push(a.readUshort(r,t+2*h));return o},e._lctf.readScriptList=function(r,t){var a=e._bin,n=t,o={},s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readASCII(r,t,4);t+=4;var f=a.readUshort(r,t);t+=2,o[h.trim()]=e._lctf.readScriptTable(r,n+f)}return o},e._lctf.readScriptTable=function(r,t){var a=e._bin,n=t,o={},s=a.readUshort(r,t);t+=2,s>0&&(o.default=e._lctf.readLangSysTable(r,n+s));var i=a.readUshort(r,t);t+=2;for(var h=0;h<i;h++){var f=a.readASCII(r,t,4);t+=4;var d=a.readUshort(r,t);t+=2,o[f.trim()]=e._lctf.readLangSysTable(r,n+d)}return o},e._lctf.readLangSysTable=function(r,t){var a=e._bin,n={};a.readUshort(r,t),t+=2,n.reqFeature=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);return t+=2,n.features=a.readUshorts(r,t,o),n},e.CFF={},e.CFF.parse=function(r,t,a){var n=e._bin;(r=new Uint8Array(r.buffer,t,a))[t=0],r[++t],r[++t],r[++t],t++;var o=[];t=e.CFF.readIndex(r,t,o);for(var s=[],i=0;i<o.length-1;i++)s.push(n.readASCII(r,t+o[i],o[i+1]-o[i]));t+=o[o.length-1];var h=[];t=e.CFF.readIndex(r,t,h);var f=[];for(i=0;i<h.length-1;i++)f.push(e.CFF.readDict(r,t+h[i],t+h[i+1]));t+=h[h.length-1];var d=f[0],u=[];t=e.CFF.readIndex(r,t,u);var l=[];for(i=0;i<u.length-1;i++)l.push(n.readASCII(r,t+u[i],u[i+1]-u[i]));if(t+=u[u.length-1],e.CFF.readSubrs(r,t,d),d.CharStrings){t=d.CharStrings,u=[],t=e.CFF.readIndex(r,t,u);var v=[];for(i=0;i<u.length-1;i++)v.push(n.readBytes(r,t+u[i],u[i+1]-u[i]));d.CharStrings=v}if(d.ROS){t=d.FDArray;var c=[];for(t=e.CFF.readIndex(r,t,c),d.FDArray=[],i=0;i<c.length-1;i++){var p=e.CFF.readDict(r,t+c[i],t+c[i+1]);e.CFF._readFDict(r,p,l),d.FDArray.push(p)}t+=c[c.length-1],t=d.FDSelect,d.FDSelect=[];var U=r[t];if(t++,3!=U)throw U;var g=n.readUshort(r,t);for(t+=2,i=0;i<g+1;i++)d.FDSelect.push(n.readUshort(r,t),r[t+2]),t+=3}return d.Encoding&&(d.Encoding=e.CFF.readEncoding(r,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=e.CFF.readCharset(r,d.charset,d.CharStrings.length)),e.CFF._readFDict(r,d,l),d},e.CFF._readFDict=function(r,t,a){var n;for(var o in t.Private&&(n=t.Private[1],t.Private=e.CFF.readDict(r,n,n+t.Private[0]),t.Private.Subrs&&e.CFF.readSubrs(r,n+t.Private.Subrs,t.Private)),t)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(t[o]=a[t[o]-426+35])},e.CFF.readSubrs=function(r,t,a){var n=e._bin,o=[];t=e.CFF.readIndex(r,t,o);var s,i=o.length;s=i<1240?107:i<33900?1131:32768,a.Bias=s,a.Subrs=[];for(var h=0;h<o.length-1;h++)a.Subrs.push(n.readBytes(r,t+o[h],o[h+1]-o[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,e){for(var t=0;t<r.charset.length;t++)if(r.charset[t]==e)return t;return-1},e.CFF.glyphBySE=function(r,t){return t<0||t>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[t])},e.CFF.readEncoding=function(r,t,a){e._bin;var n=[".notdef"],o=r[t];if(t++,0!=o)throw"error: unknown encoding format: "+o;var s=r[t];t++;for(var i=0;i<s;i++)n.push(r[t+i]);return n},e.CFF.readCharset=function(r,t,a){var n=e._bin,o=[".notdef"],s=r[t];if(t++,0==s)for(var i=0;i<a;i++){var h=n.readUshort(r,t);t+=2,o.push(h)}else{if(1!=s&&2!=s)throw"error: format: "+s;for(;o.length<a;){h=n.readUshort(r,t),t+=2;var f=0;for(1==s?(f=r[t],t++):(f=n.readUshort(r,t),t+=2),i=0;i<=f;i++)o.push(h),h++}}return o},e.CFF.readIndex=function(r,t,a){var n=e._bin,o=n.readUshort(r,t)+1,s=r[t+=2];if(t++,1==s)for(var i=0;i<o;i++)a.push(r[t+i]);else if(2==s)for(i=0;i<o;i++)a.push(n.readUshort(r,t+2*i));else if(3==s)for(i=0;i<o;i++)a.push(16777215&n.readUint(r,t+3*i-1));else if(1!=o)throw"unsupported offset size: "+s+", count: "+o;return(t+=o*s)-1},e.CFF.getCharString=function(r,t,a){var n=e._bin,o=r[t],s=r[t+1];r[t+2],r[t+3],r[t+4];var i=1,h=null,f=null;o<=20&&(h=o,i=1),12==o&&(h=100*o+s,i=2),21<=o&&o<=27&&(h=o,i=1),28==o&&(f=n.readShort(r,t+1),i=3),29<=o&&o<=31&&(h=o,i=1),32<=o&&o<=246&&(f=o-139,i=1),247<=o&&o<=250&&(f=256*(o-247)+s+108,i=2),251<=o&&o<=254&&(f=256*-(o-251)-s-108,i=2),255==o&&(f=n.readInt(r,t+1)/65535,i=5),a.val=null!=f?f:"o"+h,a.size=i},e.CFF.readCharString=function(r,t,a){for(var n=t+a,o=e._bin,s=[];t<n;){var i=r[t],h=r[t+1];r[t+2],r[t+3],r[t+4];var f=1,d=null,u=null;i<=20&&(d=i,f=1),12==i&&(d=100*i+h,f=2),19!=i&&20!=i||(d=i,f=2),21<=i&&i<=27&&(d=i,f=1),28==i&&(u=o.readShort(r,t+1),f=3),29<=i&&i<=31&&(d=i,f=1),32<=i&&i<=246&&(u=i-139,f=1),247<=i&&i<=250&&(u=256*(i-247)+h+108,f=2),251<=i&&i<=254&&(u=256*-(i-251)-h-108,f=2),255==i&&(u=o.readInt(r,t+1)/65535,f=5),s.push(null!=u?u:"o"+d),t+=f}return s},e.CFF.readDict=function(r,t,a){for(var n=e._bin,o={},s=[];t<a;){var i=r[t],h=r[t+1];r[t+2],r[t+3],r[t+4];var f=1,d=null,u=null;if(28==i&&(u=n.readShort(r,t+1),f=3),29==i&&(u=n.readInt(r,t+1),f=5),32<=i&&i<=246&&(u=i-139,f=1),247<=i&&i<=250&&(u=256*(i-247)+h+108,f=2),251<=i&&i<=254&&(u=256*-(i-251)-h-108,f=2),255==i)throw u=n.readInt(r,t+1)/65535,f=5,"unknown number";if(30==i){var l=[];for(f=1;;){var v=r[t+f];f++;var c=v>>4,p=15&v;if(15!=c&&l.push(c),15!=p&&l.push(p),15==p)break}for(var U="",g=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<l.length;S++)U+=g[l[S]];u=parseFloat(U)}i<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][i],f=1,12==i&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],f=2)),null!=d?(o[d]=1==s.length?s[0]:s,s=[]):s.push(u),t+=f}return o},e.cmap={},e.cmap.parse=function(r,t,a){r=new Uint8Array(r.buffer,t,a),t=0;var n=e._bin,o={};n.readUshort(r,t),t+=2;var s=n.readUshort(r,t);t+=2;var i=[];o.tables=[];for(var h=0;h<s;h++){var f=n.readUshort(r,t);t+=2;var d=n.readUshort(r,t);t+=2;var u=n.readUint(r,t);t+=4;var l="p"+f+"e"+d,v=i.indexOf(u);if(-1==v){var c;v=o.tables.length,i.push(u);var p=n.readUshort(r,u);0==p?c=e.cmap.parse0(r,u):4==p?c=e.cmap.parse4(r,u):6==p?c=e.cmap.parse6(r,u):12==p?c=e.cmap.parse12(r,u):console.debug("unknown format: "+p,f,d,u),o.tables.push(c)}if(null!=o[l])throw"multiple tables for one platform+encoding";o[l]=v}return o},e.cmap.parse0=function(r,t){var a=e._bin,n={};n.format=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);t+=2,a.readUshort(r,t),t+=2,n.map=[];for(var s=0;s<o-6;s++)n.map.push(r[t+s]);return n},e.cmap.parse4=function(r,t){var a=e._bin,n=t,o={};o.format=a.readUshort(r,t),t+=2;var s=a.readUshort(r,t);t+=2,a.readUshort(r,t),t+=2;var i=a.readUshort(r,t);t+=2;var h=i/2;o.searchRange=a.readUshort(r,t),t+=2,o.entrySelector=a.readUshort(r,t),t+=2,o.rangeShift=a.readUshort(r,t),t+=2,o.endCount=a.readUshorts(r,t,h),t+=2*h,t+=2,o.startCount=a.readUshorts(r,t,h),t+=2*h,o.idDelta=[];for(var f=0;f<h;f++)o.idDelta.push(a.readShort(r,t)),t+=2;for(o.idRangeOffset=a.readUshorts(r,t,h),t+=2*h,o.glyphIdArray=[];t<n+s;)o.glyphIdArray.push(a.readUshort(r,t)),t+=2;return o},e.cmap.parse6=function(r,t){var a=e._bin,n={};n.format=a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2,n.firstCode=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);t+=2,n.glyphIdArray=[];for(var s=0;s<o;s++)n.glyphIdArray.push(a.readUshort(r,t)),t+=2;return n},e.cmap.parse12=function(r,t){var a=e._bin,n={};n.format=a.readUshort(r,t),t+=2,t+=2,a.readUint(r,t),t+=4,a.readUint(r,t),t+=4;var o=a.readUint(r,t);t+=4,n.groups=[];for(var s=0;s<o;s++){var i=t+12*s,h=a.readUint(r,i+0),f=a.readUint(r,i+4),d=a.readUint(r,i+8);n.groups.push([h,f,d])}return n},e.glyf={},e.glyf.parse=function(r,e,t,a){for(var n=[],o=0;o<a.maxp.numGlyphs;o++)n.push(null);return n},e.glyf._parseGlyf=function(r,t){var a=e._bin,n=r._data,o=e._tabOffset(n,"glyf",r._offset)+r.loca[t];if(r.loca[t]==r.loca[t+1])return null;var s={};if(s.noc=a.readShort(n,o),o+=2,s.xMin=a.readShort(n,o),o+=2,s.yMin=a.readShort(n,o),o+=2,s.xMax=a.readShort(n,o),o+=2,s.yMax=a.readShort(n,o),o+=2,s.xMin>=s.xMax||s.yMin>=s.yMax)return null;if(s.noc>0){s.endPts=[];for(var i=0;i<s.noc;i++)s.endPts.push(a.readUshort(n,o)),o+=2;var h=a.readUshort(n,o);if(o+=2,n.length-o<h)return null;s.instructions=a.readBytes(n,o,h),o+=h;var f=s.endPts[s.noc-1]+1;for(s.flags=[],i=0;i<f;i++){var d=n[o];if(o++,s.flags.push(d),0!=(8&d)){var u=n[o];o++;for(var l=0;l<u;l++)s.flags.push(d),i++}}for(s.xs=[],i=0;i<f;i++){var v=0!=(2&s.flags[i]),c=0!=(16&s.flags[i]);v?(s.xs.push(c?n[o]:-n[o]),o++):c?s.xs.push(0):(s.xs.push(a.readShort(n,o)),o+=2)}for(s.ys=[],i=0;i<f;i++)v=0!=(4&s.flags[i]),c=0!=(32&s.flags[i]),v?(s.ys.push(c?n[o]:-n[o]),o++):c?s.ys.push(0):(s.ys.push(a.readShort(n,o)),o+=2);var p=0,U=0;for(i=0;i<f;i++)p+=s.xs[i],U+=s.ys[i],s.xs[i]=p,s.ys[i]=U}else{var g;s.parts=[];do{g=a.readUshort(n,o),o+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(s.parts.push(S),S.glyphIndex=a.readUshort(n,o),o+=2,1&g){var m=a.readShort(n,o);o+=2;var b=a.readShort(n,o);o+=2}else m=a.readInt8(n,o),o++,b=a.readInt8(n,o),o++;2&g?(S.m.tx=m,S.m.ty=b):(S.p1=m,S.p2=b),8&g?(S.m.a=S.m.d=a.readF2dot14(n,o),o+=2):64&g?(S.m.a=a.readF2dot14(n,o),o+=2,S.m.d=a.readF2dot14(n,o),o+=2):128&g&&(S.m.a=a.readF2dot14(n,o),o+=2,S.m.b=a.readF2dot14(n,o),o+=2,S.m.c=a.readF2dot14(n,o),o+=2,S.m.d=a.readF2dot14(n,o),o+=2)}while(32&g);if(256&g){var y=a.readUshort(n,o);for(o+=2,s.instr=[],i=0;i<y;i++)s.instr.push(n[o]),o++}}return s},e.GPOS={},e.GPOS.parse=function(r,t,a,n){return e._lctf.parse(r,t,a,n,e.GPOS.subt)},e.GPOS.subt=function(r,t,a,n){var o=e._bin,s=a,i={};if(i.fmt=o.readUshort(r,a),a+=2,1==t||2==t||3==t||7==t||8==t&&i.fmt<=2){var h=o.readUshort(r,a);a+=2,i.coverage=e._lctf.readCoverage(r,h+s)}if(1==t&&1==i.fmt){var f=o.readUshort(r,a);a+=2;var d=e._lctf.numOfOnes(f);0!=f&&(i.pos=e.GPOS.readValueRecord(r,a,f))}else if(2==t&&i.fmt>=1&&i.fmt<=2){f=o.readUshort(r,a),a+=2;var u=o.readUshort(r,a);a+=2,d=e._lctf.numOfOnes(f);var l=e._lctf.numOfOnes(u);if(1==i.fmt){i.pairsets=[];var v=o.readUshort(r,a);a+=2;for(var c=0;c<v;c++){var p=s+o.readUshort(r,a);a+=2;var U=o.readUshort(r,p);p+=2;for(var g=[],S=0;S<U;S++){var m=o.readUshort(r,p);p+=2,0!=f&&(x=e.GPOS.readValueRecord(r,p,f),p+=2*d),0!=u&&(P=e.GPOS.readValueRecord(r,p,u),p+=2*l),g.push({gid2:m,val1:x,val2:P})}i.pairsets.push(g)}}if(2==i.fmt){var b=o.readUshort(r,a);a+=2;var y=o.readUshort(r,a);a+=2;var F=o.readUshort(r,a);a+=2;var _=o.readUshort(r,a);for(a+=2,i.classDef1=e._lctf.readClassDef(r,s+b),i.classDef2=e._lctf.readClassDef(r,s+y),i.matrix=[],c=0;c<F;c++){var C=[];for(S=0;S<_;S++){var x=null,P=null;0!=f&&(x=e.GPOS.readValueRecord(r,a,f),a+=2*d),0!=u&&(P=e.GPOS.readValueRecord(r,a,u),a+=2*l),C.push({val1:x,val2:P})}i.matrix.push(C)}}}else{if(9==t&&1==i.fmt){var I=o.readUshort(r,a);a+=2;var w=o.readUint(r,a);if(a+=4,9==n.ltype)n.ltype=I;else if(n.ltype!=I)throw"invalid extension substitution";return e.GPOS.subt(r,n.ltype,s+w)}console.debug("unsupported GPOS table LookupType",t,"format",i.fmt)}return i},e.GPOS.readValueRecord=function(r,t,a){var n=e._bin,o=[];return o.push(1&a?n.readShort(r,t):0),t+=1&a?2:0,o.push(2&a?n.readShort(r,t):0),t+=2&a?2:0,o.push(4&a?n.readShort(r,t):0),t+=4&a?2:0,o.push(8&a?n.readShort(r,t):0),t+=8&a?2:0,o},e.GSUB={},e.GSUB.parse=function(r,t,a,n){return e._lctf.parse(r,t,a,n,e.GSUB.subt)},e.GSUB.subt=function(r,t,a,n){var o=e._bin,s=a,i={};if(i.fmt=o.readUshort(r,a),a+=2,1!=t&&4!=t&&5!=t&&6!=t)return null;if(1==t||4==t||5==t&&i.fmt<=2||6==t&&i.fmt<=2){var h=o.readUshort(r,a);a+=2,i.coverage=e._lctf.readCoverage(r,s+h)}if(1==t&&i.fmt>=1&&i.fmt<=2){if(1==i.fmt)i.delta=o.readShort(r,a),a+=2;else if(2==i.fmt){var f=o.readUshort(r,a);a+=2,i.newg=o.readUshorts(r,a,f),a+=2*i.newg.length}}else if(4==t){i.vals=[],f=o.readUshort(r,a),a+=2;for(var d=0;d<f;d++){var u=o.readUshort(r,a);a+=2,i.vals.push(e.GSUB.readLigatureSet(r,s+u))}}else if(5==t&&2==i.fmt){if(2==i.fmt){var l=o.readUshort(r,a);a+=2,i.cDef=e._lctf.readClassDef(r,s+l),i.scset=[];var v=o.readUshort(r,a);for(a+=2,d=0;d<v;d++){var c=o.readUshort(r,a);a+=2,i.scset.push(0==c?null:e.GSUB.readSubClassSet(r,s+c))}}}else if(6==t&&3==i.fmt){if(3==i.fmt){for(d=0;d<3;d++){f=o.readUshort(r,a),a+=2;for(var p=[],U=0;U<f;U++)p.push(e._lctf.readCoverage(r,s+o.readUshort(r,a+2*U)));a+=2*f,0==d&&(i.backCvg=p),1==d&&(i.inptCvg=p),2==d&&(i.ahedCvg=p)}f=o.readUshort(r,a),a+=2,i.lookupRec=e.GSUB.readSubstLookupRecords(r,a,f)}}else{if(7==t&&1==i.fmt){var g=o.readUshort(r,a);a+=2;var S=o.readUint(r,a);if(a+=4,9==n.ltype)n.ltype=g;else if(n.ltype!=g)throw"invalid extension substitution";return e.GSUB.subt(r,n.ltype,s+S)}console.debug("unsupported GSUB table LookupType",t,"format",i.fmt)}return i},e.GSUB.readSubClassSet=function(r,t){var a=e._bin.readUshort,n=t,o=[],s=a(r,t);t+=2;for(var i=0;i<s;i++){var h=a(r,t);t+=2,o.push(e.GSUB.readSubClassRule(r,n+h))}return o},e.GSUB.readSubClassRule=function(r,t){var a=e._bin.readUshort,n={},o=a(r,t),s=a(r,t+=2);t+=2,n.input=[];for(var i=0;i<o-1;i++)n.input.push(a(r,t)),t+=2;return n.substLookupRecords=e.GSUB.readSubstLookupRecords(r,t,s),n},e.GSUB.readSubstLookupRecords=function(r,t,a){for(var n=e._bin.readUshort,o=[],s=0;s<a;s++)o.push(n(r,t),n(r,t+2)),t+=4;return o},e.GSUB.readChainSubClassSet=function(r,t){var a=e._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readUshort(r,t);t+=2,o.push(e.GSUB.readChainSubClassRule(r,n+h))}return o},e.GSUB.readChainSubClassRule=function(r,t){for(var a=e._bin,n={},o=["backtrack","input","lookahead"],s=0;s<o.length;s++){var i=a.readUshort(r,t);t+=2,1==s&&i--,n[o[s]]=a.readUshorts(r,t,i),t+=2*n[o[s]].length}return i=a.readUshort(r,t),t+=2,n.subst=a.readUshorts(r,t,2*i),t+=2*n.subst.length,n},e.GSUB.readLigatureSet=function(r,t){var a=e._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readUshort(r,t);t+=2,o.push(e.GSUB.readLigature(r,n+h))}return o},e.GSUB.readLigature=function(r,t){var a=e._bin,n={chain:[]};n.nglyph=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);t+=2;for(var s=0;s<o-1;s++)n.chain.push(a.readUshort(r,t)),t+=2;return n},e.head={},e.head.parse=function(r,t,a){var n=e._bin,o={};return n.readFixed(r,t),t+=4,o.fontRevision=n.readFixed(r,t),t+=4,n.readUint(r,t),t+=4,n.readUint(r,t),t+=4,o.flags=n.readUshort(r,t),t+=2,o.unitsPerEm=n.readUshort(r,t),t+=2,o.created=n.readUint64(r,t),t+=8,o.modified=n.readUint64(r,t),t+=8,o.xMin=n.readShort(r,t),t+=2,o.yMin=n.readShort(r,t),t+=2,o.xMax=n.readShort(r,t),t+=2,o.yMax=n.readShort(r,t),t+=2,o.macStyle=n.readUshort(r,t),t+=2,o.lowestRecPPEM=n.readUshort(r,t),t+=2,o.fontDirectionHint=n.readShort(r,t),t+=2,o.indexToLocFormat=n.readShort(r,t),t+=2,o.glyphDataFormat=n.readShort(r,t),t+=2,o},e.hhea={},e.hhea.parse=function(r,t,a){var n=e._bin,o={};return n.readFixed(r,t),t+=4,o.ascender=n.readShort(r,t),t+=2,o.descender=n.readShort(r,t),t+=2,o.lineGap=n.readShort(r,t),t+=2,o.advanceWidthMax=n.readUshort(r,t),t+=2,o.minLeftSideBearing=n.readShort(r,t),t+=2,o.minRightSideBearing=n.readShort(r,t),t+=2,o.xMaxExtent=n.readShort(r,t),t+=2,o.caretSlopeRise=n.readShort(r,t),t+=2,o.caretSlopeRun=n.readShort(r,t),t+=2,o.caretOffset=n.readShort(r,t),t+=2,t+=8,o.metricDataFormat=n.readShort(r,t),t+=2,o.numberOfHMetrics=n.readUshort(r,t),t+=2,o},e.hmtx={},e.hmtx.parse=function(r,t,a,n){for(var o=e._bin,s={aWidth:[],lsBearing:[]},i=0,h=0,f=0;f<n.maxp.numGlyphs;f++)f<n.hhea.numberOfHMetrics&&(i=o.readUshort(r,t),t+=2,h=o.readShort(r,t),t+=2),s.aWidth.push(i),s.lsBearing.push(h);return s},e.kern={},e.kern.parse=function(r,t,a,n){var o=e._bin,s=o.readUshort(r,t);if(t+=2,1==s)return e.kern.parseV1(r,t-2,a,n);var i=o.readUshort(r,t);t+=2;for(var h={glyph1:[],rval:[]},f=0;f<i;f++){t+=2,a=o.readUshort(r,t),t+=2;var d=o.readUshort(r,t);t+=2;var u=d>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;t=e.kern.readFormat0(r,t,h)}return h},e.kern.parseV1=function(r,t,a,n){var o=e._bin;o.readFixed(r,t),t+=4;var s=o.readUint(r,t);t+=4;for(var i={glyph1:[],rval:[]},h=0;h<s;h++){o.readUint(r,t),t+=4;var f=o.readUshort(r,t);t+=2,o.readUshort(r,t),t+=2;var d=f>>>8;if(0!=(d&=15))throw"unknown kern table format: "+d;t=e.kern.readFormat0(r,t,i)}return i},e.kern.readFormat0=function(r,t,a){var n=e._bin,o=-1,s=n.readUshort(r,t);t+=2,n.readUshort(r,t),t+=2,n.readUshort(r,t),t+=2,n.readUshort(r,t),t+=2;for(var i=0;i<s;i++){var h=n.readUshort(r,t);t+=2;var f=n.readUshort(r,t);t+=2;var d=n.readShort(r,t);t+=2,h!=o&&(a.glyph1.push(h),a.rval.push({glyph2:[],vals:[]}));var u=a.rval[a.rval.length-1];u.glyph2.push(f),u.vals.push(d),o=h}return t},e.loca={},e.loca.parse=function(r,t,a,n){var o=e._bin,s=[],i=n.head.indexToLocFormat,h=n.maxp.numGlyphs+1;if(0==i)for(var f=0;f<h;f++)s.push(o.readUshort(r,t+(f<<1))<<1);if(1==i)for(f=0;f<h;f++)s.push(o.readUint(r,t+(f<<2)));return s},e.maxp={},e.maxp.parse=function(r,t,a){var n=e._bin,o={},s=n.readUint(r,t);return t+=4,o.numGlyphs=n.readUshort(r,t),t+=2,65536==s&&(o.maxPoints=n.readUshort(r,t),t+=2,o.maxContours=n.readUshort(r,t),t+=2,o.maxCompositePoints=n.readUshort(r,t),t+=2,o.maxCompositeContours=n.readUshort(r,t),t+=2,o.maxZones=n.readUshort(r,t),t+=2,o.maxTwilightPoints=n.readUshort(r,t),t+=2,o.maxStorage=n.readUshort(r,t),t+=2,o.maxFunctionDefs=n.readUshort(r,t),t+=2,o.maxInstructionDefs=n.readUshort(r,t),t+=2,o.maxStackElements=n.readUshort(r,t),t+=2,o.maxSizeOfInstructions=n.readUshort(r,t),t+=2,o.maxComponentElements=n.readUshort(r,t),t+=2,o.maxComponentDepth=n.readUshort(r,t),t+=2),o},e.name={},e.name.parse=function(r,t,a){var n=e._bin,o={};n.readUshort(r,t),t+=2;var s=n.readUshort(r,t);t+=2,n.readUshort(r,t);for(var i,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=t+=2,d=0;d<s;d++){var u=n.readUshort(r,t);t+=2;var l=n.readUshort(r,t);t+=2;var v=n.readUshort(r,t);t+=2;var c=n.readUshort(r,t);t+=2;var p=n.readUshort(r,t);t+=2;var U=n.readUshort(r,t);t+=2;var g,S=h[c],m=f+12*s+U;if(0==u)g=n.readUnicode(r,m,p/2);else if(3==u&&0==l)g=n.readUnicode(r,m,p/2);else if(0==l)g=n.readASCII(r,m,p);else if(1==l)g=n.readUnicode(r,m,p/2);else if(3==l)g=n.readUnicode(r,m,p/2);else{if(1!=u)throw"unknown encoding "+l+", platformID: "+u;g=n.readASCII(r,m,p),console.debug("reading unknown MAC encoding "+l+" as ASCII")}var b="p"+u+","+v.toString(16);null==o[b]&&(o[b]={}),o[b][void 0!==S?S:c]=g,o[b]._lang=v}for(var y in o)if(null!=o[y].postScriptName&&1033==o[y]._lang)return o[y];for(var y in o)if(null!=o[y].postScriptName&&0==o[y]._lang)return o[y];for(var y in o)if(null!=o[y].postScriptName&&3084==o[y]._lang)return o[y];for(var y in o)if(null!=o[y].postScriptName)return o[y];for(var y in o){i=y;break}return console.debug("returning name table with languageID "+o[i]._lang),o[i]},e["OS/2"]={},e["OS/2"].parse=function(r,t,a){var n=e._bin.readUshort(r,t);t+=2;var o={};if(0==n)e["OS/2"].version0(r,t,o);else if(1==n)e["OS/2"].version1(r,t,o);else if(2==n||3==n||4==n)e["OS/2"].version2(r,t,o);else{if(5!=n)throw"unknown OS/2 table version: "+n;e["OS/2"].version5(r,t,o)}return o},e["OS/2"].version0=function(r,t,a){var n=e._bin;return a.xAvgCharWidth=n.readShort(r,t),t+=2,a.usWeightClass=n.readUshort(r,t),t+=2,a.usWidthClass=n.readUshort(r,t),t+=2,a.fsType=n.readUshort(r,t),t+=2,a.ySubscriptXSize=n.readShort(r,t),t+=2,a.ySubscriptYSize=n.readShort(r,t),t+=2,a.ySubscriptXOffset=n.readShort(r,t),t+=2,a.ySubscriptYOffset=n.readShort(r,t),t+=2,a.ySuperscriptXSize=n.readShort(r,t),t+=2,a.ySuperscriptYSize=n.readShort(r,t),t+=2,a.ySuperscriptXOffset=n.readShort(r,t),t+=2,a.ySuperscriptYOffset=n.readShort(r,t),t+=2,a.yStrikeoutSize=n.readShort(r,t),t+=2,a.yStrikeoutPosition=n.readShort(r,t),t+=2,a.sFamilyClass=n.readShort(r,t),t+=2,a.panose=n.readBytes(r,t,10),t+=10,a.ulUnicodeRange1=n.readUint(r,t),t+=4,a.ulUnicodeRange2=n.readUint(r,t),t+=4,a.ulUnicodeRange3=n.readUint(r,t),t+=4,a.ulUnicodeRange4=n.readUint(r,t),t+=4,a.achVendID=[n.readInt8(r,t),n.readInt8(r,t+1),n.readInt8(r,t+2),n.readInt8(r,t+3)],t+=4,a.fsSelection=n.readUshort(r,t),t+=2,a.usFirstCharIndex=n.readUshort(r,t),t+=2,a.usLastCharIndex=n.readUshort(r,t),t+=2,a.sTypoAscender=n.readShort(r,t),t+=2,a.sTypoDescender=n.readShort(r,t),t+=2,a.sTypoLineGap=n.readShort(r,t),t+=2,a.usWinAscent=n.readUshort(r,t),t+=2,a.usWinDescent=n.readUshort(r,t),t+2},e["OS/2"].version1=function(r,t,a){var n=e._bin;return t=e["OS/2"].version0(r,t,a),a.ulCodePageRange1=n.readUint(r,t),t+=4,a.ulCodePageRange2=n.readUint(r,t),t+4},e["OS/2"].version2=function(r,t,a){var n=e._bin;return t=e["OS/2"].version1(r,t,a),a.sxHeight=n.readShort(r,t),t+=2,a.sCapHeight=n.readShort(r,t),t+=2,a.usDefault=n.readUshort(r,t),t+=2,a.usBreak=n.readUshort(r,t),t+=2,a.usMaxContext=n.readUshort(r,t),t+2},e["OS/2"].version5=function(r,t,a){var n=e._bin;return t=e["OS/2"].version2(r,t,a),a.usLowerOpticalPointSize=n.readUshort(r,t),t+=2,a.usUpperOpticalPointSize=n.readUshort(r,t),t+2},e.post={},e.post.parse=function(r,t,a){var n=e._bin,o={};return o.version=n.readFixed(r,t),t+=4,o.italicAngle=n.readFixed(r,t),t+=4,o.underlinePosition=n.readShort(r,t),t+=2,o.underlineThickness=n.readShort(r,t),t+=2,o},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(r,e){var t=r.cmap,a=-1;if(null!=t.p0e4?a=t.p0e4:null!=t.p3e1?a=t.p3e1:null!=t.p1e0?a=t.p1e0:null!=t.p0e3&&(a=t.p0e3),-1==a)throw"no familiar platform and encoding!";var n=t.tables[a];if(0==n.format)return e>=n.map.length?0:n.map[e];if(4==n.format){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return-1==o||n.startCount[o]>e?0:65535&(0!=n.idRangeOffset[o]?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(12==n.format){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var i=n.groups[s];if(i[0]<=e&&e<=i[1])return i[2]+(e-i[0])}return 0}throw"unknown cmap table format "+n.format},e.U.glyphToPath=function(r,t){var a={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[t]){var n=r.SVG.entries[t];return null==n?a:("string"==typeof n&&(n=e.SVG.toPath(n),r.SVG.entries[t]=n),n)}if(r.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},s=r.CFF,i=r.CFF.Private;if(s.ROS){for(var h=0;s.FDSelect[h+2]<=t;)h+=2;i=s.FDArray[s.FDSelect[h+1]].Private}e.U._drawCFF(r.CFF.CharStrings[t],o,s,i,a)}else r.glyf&&e.U._drawGlyf(t,r,a);return a},e.U._drawGlyf=function(r,t,a){var n=t.glyf[r];null==n&&(n=t.glyf[r]=e.glyf._parseGlyf(t,r)),null!=n&&(n.noc>-1?e.U._simpleGlyph(n,a):e.U._compoGlyph(n,t,a))},e.U._simpleGlyph=function(r,t){for(var a=0;a<r.noc;a++){for(var n=0==a?0:r.endPts[a-1]+1,o=r.endPts[a],s=n;s<=o;s++){var i=s==n?o:s-1,h=s==o?n:s+1,f=1&r.flags[s],d=1&r.flags[i],u=1&r.flags[h],l=r.xs[s],v=r.ys[s];if(s==n)if(f){if(!d){e.U.P.moveTo(t,l,v);continue}e.U.P.moveTo(t,r.xs[i],r.ys[i])}else d?e.U.P.moveTo(t,r.xs[i],r.ys[i]):e.U.P.moveTo(t,(r.xs[i]+l)/2,(r.ys[i]+v)/2);f?d&&e.U.P.lineTo(t,l,v):u?e.U.P.qcurveTo(t,l,v,r.xs[h],r.ys[h]):e.U.P.qcurveTo(t,l,v,(l+r.xs[h])/2,(v+r.ys[h])/2)}e.U.P.closePath(t)}},e.U._compoGlyph=function(r,t,a){for(var n=0;n<r.parts.length;n++){var o={cmds:[],crds:[]},s=r.parts[n];e.U._drawGlyf(s.glyphIndex,t,o);for(var i=s.m,h=0;h<o.crds.length;h+=2){var f=o.crds[h],d=o.crds[h+1];a.crds.push(f*i.a+d*i.b+i.tx),a.crds.push(f*i.c+d*i.d+i.ty)}for(h=0;h<o.cmds.length;h++)a.cmds.push(o.cmds[h])}},e.U._getGlyphClass=function(r,t){var a=e._lctf.getInterval(t,r);return-1==a?0:t[a+2]},e.U.getPairAdjustment=function(r,t,a){var n=!1;if(r.GPOS)for(var o=r.GPOS,s=o.lookupList,i=o.featureList,h=[],f=0;f<i.length;f++){var d=i[f];if("kern"==d.tag){n=!0;for(var u=0;u<d.tab.length;u++)if(!h[d.tab[u]]){h[d.tab[u]]=!0;for(var l=s[d.tab[u]],v=0;v<l.tabs.length;v++)if(null!=l.tabs[v]){var c,p=l.tabs[v];if(!p.coverage||-1!=(c=e._lctf.coverageIndex(p.coverage,t)))if(1==l.ltype);else if(2==l.ltype){var U=null;if(1==p.fmt){var g=p.pairsets[c];for(f=0;f<g.length;f++)g[f].gid2==a&&(U=g[f])}else if(2==p.fmt){var S=e.U._getGlyphClass(t,p.classDef1),m=e.U._getGlyphClass(a,p.classDef2);U=p.matrix[S][m]}if(U){var b=0;return U.val1&&U.val1[2]&&(b+=U.val1[2]),U.val2&&U.val2[0]&&(b+=U.val2[0]),b}}}}}}if(r.kern&&!n){var y=r.kern.glyph1.indexOf(t);if(-1!=y){var F=r.kern.rval[y].glyph2.indexOf(a);if(-1!=F)return r.kern.rval[y].vals[F]}}return 0},e.U._applySubs=function(r,t,a,n){for(var o=r.length-t-1,s=0;s<a.tabs.length;s++)if(null!=a.tabs[s]){var i,h=a.tabs[s];if(!h.coverage||-1!=(i=e._lctf.coverageIndex(h.coverage,r[t])))if(1==a.ltype)r[t],1==h.fmt?r[t]=r[t]+h.delta:r[t]=h.newg[i];else if(4==a.ltype)for(var f=h.vals[i],d=0;d<f.length;d++){var u=f[d],l=u.chain.length;if(!(l>o)){for(var v=!0,c=0,p=0;p<l;p++){for(;-1==r[t+c+(1+p)];)c++;u.chain[p]!=r[t+c+(1+p)]&&(v=!1)}if(v){for(r[t]=u.nglyph,p=0;p<l+c;p++)r[t+p+1]=-1;break}}}else if(5==a.ltype&&2==h.fmt)for(var U=e._lctf.getInterval(h.cDef,r[t]),g=h.cDef[U+2],S=h.scset[g],m=0;m<S.length;m++){var b=S[m],y=b.input;if(!(y.length>o)){for(v=!0,p=0;p<y.length;p++){var F=e._lctf.getInterval(h.cDef,r[t+1+p]);if(-1==U&&h.cDef[F+2]!=y[p]){v=!1;break}}if(v){var _=b.substLookupRecords;for(d=0;d<_.length;d+=2)_[d],_[d+1]}}}else if(6==a.ltype&&3==h.fmt){if(!e.U._glsCovered(r,h.backCvg,t-h.backCvg.length))continue;if(!e.U._glsCovered(r,h.inptCvg,t))continue;if(!e.U._glsCovered(r,h.ahedCvg,t+h.inptCvg.length))continue;var C=h.lookupRec;for(m=0;m<C.length;m+=2){U=C[m];var x=n[C[m+1]];e.U._applySubs(r,t+U,x,n)}}}},e.U._glsCovered=function(r,t,a){for(var n=0;n<t.length;n++)if(-1==e._lctf.coverageIndex(t[n],r[a+n]))return!1;return!0},e.U.glyphsToPath=function(r,t,a){for(var n={cmds:[],crds:[]},o=0,s=0;s<t.length;s++){var i=t[s];if(-1!=i){for(var h=s<t.length-1&&-1!=t[s+1]?t[s+1]:0,f=e.U.glyphToPath(r,i),d=0;d<f.crds.length;d+=2)n.crds.push(f.crds[d]+o),n.crds.push(f.crds[d+1]);for(a&&n.cmds.push(a),d=0;d<f.cmds.length;d++)n.cmds.push(f.cmds[d]);a&&n.cmds.push("X"),o+=r.hmtx.aWidth[i],s<t.length-1&&(o+=e.U.getPairAdjustment(r,i,h))}}return n},e.U.P={},e.U.P.moveTo=function(r,e,t){r.cmds.push("M"),r.crds.push(e,t)},e.U.P.lineTo=function(r,e,t){r.cmds.push("L"),r.crds.push(e,t)},e.U.P.curveTo=function(r,e,t,a,n,o,s){r.cmds.push("C"),r.crds.push(e,t,a,n,o,s)},e.U.P.qcurveTo=function(r,e,t,a,n){r.cmds.push("Q"),r.crds.push(e,t,a,n)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,t,a,n,o){for(var s=t.stack,i=t.nStems,h=t.haveWidth,f=t.width,d=t.open,u=0,l=t.x,v=t.y,c=0,p=0,U=0,g=0,S=0,m=0,b=0,y=0,F=0,_=0,C={val:0,size:0};u<r.length;){e.CFF.getCharString(r,u,C);var x=C.val;if(u+=C.size,"o1"==x||"o18"==x)s.length%2!=0&&!h&&(f=s.shift()+n.nominalWidthX),i+=s.length>>1,s.length=0,h=!0;else if("o3"==x||"o23"==x)s.length%2!=0&&!h&&(f=s.shift()+n.nominalWidthX),i+=s.length>>1,s.length=0,h=!0;else if("o4"==x)s.length>1&&!h&&(f=s.shift()+n.nominalWidthX,h=!0),d&&e.U.P.closePath(o),v+=s.pop(),e.U.P.moveTo(o,l,v),d=!0;else if("o5"==x)for(;s.length>0;)l+=s.shift(),v+=s.shift(),e.U.P.lineTo(o,l,v);else if("o6"==x||"o7"==x)for(var P=s.length,I="o6"==x,w=0;w<P;w++){var O=s.shift();I?l+=O:v+=O,I=!I,e.U.P.lineTo(o,l,v)}else if("o8"==x||"o24"==x){P=s.length;for(var T=0;T+6<=P;)c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),l=U+s.shift(),v=g+s.shift(),e.U.P.curveTo(o,c,p,U,g,l,v),T+=6;"o24"==x&&(l+=s.shift(),v+=s.shift(),e.U.P.lineTo(o,l,v))}else{if("o11"==x)break;if("o1234"==x||"o1235"==x||"o1236"==x||"o1237"==x)"o1234"==x&&(p=v,U=(c=l+s.shift())+s.shift(),_=g=p+s.shift(),m=g,y=v,l=(b=(S=(F=U+s.shift())+s.shift())+s.shift())+s.shift(),e.U.P.curveTo(o,c,p,U,g,F,_),e.U.P.curveTo(o,S,m,b,y,l,v)),"o1235"==x&&(c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),F=U+s.shift(),_=g+s.shift(),S=F+s.shift(),m=_+s.shift(),b=S+s.shift(),y=m+s.shift(),l=b+s.shift(),v=y+s.shift(),s.shift(),e.U.P.curveTo(o,c,p,U,g,F,_),e.U.P.curveTo(o,S,m,b,y,l,v)),"o1236"==x&&(c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),_=g=p+s.shift(),m=g,b=(S=(F=U+s.shift())+s.shift())+s.shift(),y=m+s.shift(),l=b+s.shift(),e.U.P.curveTo(o,c,p,U,g,F,_),e.U.P.curveTo(o,S,m,b,y,l,v)),"o1237"==x&&(c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),F=U+s.shift(),_=g+s.shift(),S=F+s.shift(),m=_+s.shift(),b=S+s.shift(),y=m+s.shift(),Math.abs(b-l)>Math.abs(y-v)?l=b+s.shift():v=y+s.shift(),e.U.P.curveTo(o,c,p,U,g,F,_),e.U.P.curveTo(o,S,m,b,y,l,v));else if("o14"==x){if(s.length>0&&!h&&(f=s.shift()+a.nominalWidthX,h=!0),4==s.length){var k=s.shift(),G=s.shift(),D=s.shift(),B=s.shift(),L=e.CFF.glyphBySE(a,D),R=e.CFF.glyphBySE(a,B);e.U._drawCFF(a.CharStrings[L],t,a,n,o),t.x=k,t.y=G,e.U._drawCFF(a.CharStrings[R],t,a,n,o)}d&&(e.U.P.closePath(o),d=!1)}else if("o19"==x||"o20"==x)s.length%2!=0&&!h&&(f=s.shift()+n.nominalWidthX),i+=s.length>>1,s.length=0,h=!0,u+=i+7>>3;else if("o21"==x)s.length>2&&!h&&(f=s.shift()+n.nominalWidthX,h=!0),v+=s.pop(),l+=s.pop(),d&&e.U.P.closePath(o),e.U.P.moveTo(o,l,v),d=!0;else if("o22"==x)s.length>1&&!h&&(f=s.shift()+n.nominalWidthX,h=!0),l+=s.pop(),d&&e.U.P.closePath(o),e.U.P.moveTo(o,l,v),d=!0;else if("o25"==x){for(;s.length>6;)l+=s.shift(),v+=s.shift(),e.U.P.lineTo(o,l,v);c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),l=U+s.shift(),v=g+s.shift(),e.U.P.curveTo(o,c,p,U,g,l,v)}else if("o26"==x)for(s.length%2&&(l+=s.shift());s.length>0;)c=l,p=v+s.shift(),l=U=c+s.shift(),v=(g=p+s.shift())+s.shift(),e.U.P.curveTo(o,c,p,U,g,l,v);else if("o27"==x)for(s.length%2&&(v+=s.shift());s.length>0;)p=v,U=(c=l+s.shift())+s.shift(),g=p+s.shift(),l=U+s.shift(),v=g,e.U.P.curveTo(o,c,p,U,g,l,v);else if("o10"==x||"o29"==x){var A="o10"==x?n:a;if(0==s.length)console.debug("error: empty stack");else{var W=s.pop(),M=A.Subrs[W+A.Bias];t.x=l,t.y=v,t.nStems=i,t.haveWidth=h,t.width=f,t.open=d,e.U._drawCFF(M,t,a,n,o),l=t.x,v=t.y,i=t.nStems,h=t.haveWidth,f=t.width,d=t.open}}else if("o30"==x||"o31"==x){var V=s.length,N=(T=0,"o31"==x);for(T+=V-(P=-3&V);T<P;)N?(p=v,U=(c=l+s.shift())+s.shift(),v=(g=p+s.shift())+s.shift(),P-T==5?(l=U+s.shift(),T++):l=U,N=!1):(c=l,p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),l=U+s.shift(),P-T==5?(v=g+s.shift(),T++):v=g,N=!0),e.U.P.curveTo(o,c,p,U,g,l,v),T+=4}else{if("o"==(x+"").charAt(0))throw console.debug("Unknown operation: "+x,r),x;s.push(x)}}}t.x=l,t.y=v,t.nStems=i,t.haveWidth=h,t.width=f,t.open=d};var t=e,a={Typr:t};return r.Typr=t,r.default=a,Object.defineProperty(r,"__esModule",{value:!0}),r}({}).Typr},function woff2otfFactory(){return function(r){var e=Uint8Array,n=Uint16Array,t=Uint32Array,a=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(r,e){for(var a=new n(31),i=0;i<31;++i)a[i]=e+=1<<r[i-1];var o=new t(a[30]);for(i=1;i<30;++i)for(var f=a[i];f<a[i+1];++f)o[f]=f-a[i]<<5|i;return[a,o]},u=f(a,2),v=u[0],s=u[1];v[28]=258,s[258]=28;for(var l=f(i,0)[0],c=new n(32768),g=0;g<32768;++g){var h=(43690&g)>>>1|(21845&g)<<1;h=(61680&(h=(52428&h)>>>2|(13107&h)<<2))>>>4|(3855&h)<<4,c[g]=((65280&h)>>>8|(255&h)<<8)>>>1}var w=function(r,e,t){for(var a=r.length,i=0,o=new n(e);i<a;++i)++o[r[i]-1];var f,u=new n(e);for(i=0;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;if(t){f=new n(1<<e);var v=15-e;for(i=0;i<a;++i)if(r[i])for(var s=i<<4|r[i],l=e-r[i],g=u[r[i]-1]++<<l,h=g|(1<<l)-1;g<=h;++g)f[c[g]>>>v]=s}else for(f=new n(a),i=0;i<a;++i)r[i]&&(f[i]=c[u[r[i]-1]++]>>>15-r[i]);return f},d=new e(288);for(g=0;g<144;++g)d[g]=8;for(g=144;g<256;++g)d[g]=9;for(g=256;g<280;++g)d[g]=7;for(g=280;g<288;++g)d[g]=8;var m=new e(32);for(g=0;g<32;++g)m[g]=5;var b=w(d,9,1),p=w(m,5,1),y=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},L=function(r,e,n){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(7&e)&n},U=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(7&e)},k=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(r,e,n){var t=new Error(e||k[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,T),!n)throw t;return t},O=function(r,f,u){var s=r.length;if(!s||u&&!u.l&&s<5)return f||new e(0);var c=!f||u,g=!u||u.i;u||(u={}),f||(f=new e(3*s));var h,d=function(r){var n=f.length;if(r>n){var t=new e(Math.max(2*n,r));t.set(f),f=t}},m=u.f||0,k=u.p||0,O=u.b||0,A=u.l,x=u.d,E=u.m,D=u.n,M=8*s;do{if(!A){u.f=m=L(r,k,1);var S=L(r,k+1,3);if(k+=3,!S){var V=r[(I=((h=k)/8|0)+(7&h&&1)+4)-4]|r[I-3]<<8,_=I+V;if(_>s){g&&T(0);break}c&&d(O+V),f.set(r.subarray(I,_),O),u.b=O+=V,u.p=k=8*_;continue}if(1==S)A=b,x=p,E=9,D=5;else if(2==S){var j=L(r,k,31)+257,z=L(r,k+10,15)+4,C=j+L(r,k+5,31)+1;k+=14;for(var F=new e(C),P=new e(19),q=0;q<z;++q)P[o[q]]=L(r,k+3*q,7);k+=3*z;var B=y(P),G=(1<<B)-1,H=w(P,B,1);for(q=0;q<C;){var I,J=H[L(r,k,G)];if(k+=15&J,(I=J>>>4)<16)F[q++]=I;else{var K=0,N=0;for(16==I?(N=3+L(r,k,3),k+=2,K=F[q-1]):17==I?(N=3+L(r,k,7),k+=3):18==I&&(N=11+L(r,k,127),k+=7);N--;)F[q++]=K}}var Q=F.subarray(0,j),R=F.subarray(j);E=y(Q),D=y(R),A=w(Q,E,1),x=w(R,D,1)}else T(1);if(k>M){g&&T(0);break}}c&&d(O+131072);for(var W=(1<<E)-1,X=(1<<D)-1,Y=k;;Y=k){var Z=(K=A[U(r,k)&W])>>>4;if((k+=15&K)>M){g&&T(0);break}if(K||T(2),Z<256)f[O++]=Z;else{if(256==Z){Y=k,A=null;break}var $=Z-254;if(Z>264){var rr=a[q=Z-257];$=L(r,k,(1<<rr)-1)+v[q],k+=rr}var er=x[U(r,k)&X],nr=er>>>4;if(er||T(3),k+=15&er,R=l[nr],nr>3&&(rr=i[nr],R+=U(r,k)&(1<<rr)-1,k+=rr),k>M){g&&T(0);break}c&&d(O+131072);for(var tr=O+$;O<tr;O+=4)f[O]=f[O-R],f[O+1]=f[O+1-R],f[O+2]=f[O+2-R],f[O+3]=f[O+3-R];O=tr}}u.l=A,u.p=Y,u.b=O,A&&(m=1,u.m=E,u.d=x,u.n=D)}while(!m);return O==f.length?f:function(r,a,i){(null==a||a<0)&&(a=0),(null==i||i>r.length)&&(i=r.length);var o=new(r instanceof n?n:r instanceof t?t:e)(i-a);return o.set(r.subarray(a,i)),o}(f,0,O)},A=new e(0),x="undefined"!=typeof TextDecoder&&new TextDecoder;try{x.decode(A,{stream:!0})}catch(r){}return r.convert_streams=function(r){var e=new DataView(r),n=0;function t(){var r=e.getUint16(n);return n+=2,r}function a(){var r=e.getUint32(n);return n+=4,r}function i(r){m.setUint16(b,r),b+=2}function o(r){m.setUint32(b,r),b+=4}for(var f={signature:a(),flavor:a(),length:a(),numTables:t(),reserved:t(),totalSfntSize:a(),majorVersion:t(),minorVersion:t(),metaOffset:a(),metaLength:a(),metaOrigLength:a(),privOffset:a(),privLength:a()},u=0;Math.pow(2,u)<=f.numTables;)u++;u--;for(var v=16*Math.pow(2,u),s=16*f.numTables-v,l=12,c=[],g=0;g<f.numTables;g++)c.push({tag:a(),offset:a(),compLength:a(),origLength:a(),origChecksum:a()}),l+=16;var h,w=new Uint8Array(12+16*c.length+c.reduce((function(r,e){return r+e.origLength+4}),0)),d=w.buffer,m=new DataView(d),b=0;return o(f.flavor),i(f.numTables),i(v),i(u),i(s),c.forEach((function(r){o(r.tag),o(r.origChecksum),o(l),o(r.origLength),r.outOffset=l,(l+=r.origLength)%4!=0&&(l+=4-l%4)})),c.forEach((function(e){var n,t=r.slice(e.offset,e.offset+e.compLength);if(e.compLength!=e.origLength){var a=new Uint8Array(e.origLength);n=new Uint8Array(t,2),O(n,a)}else a=new Uint8Array(t);w.set(a,e.outOffset);var i=0;(l=e.outOffset+e.origLength)%4!=0&&(i=4-l%4),w.set(new Uint8Array(i).buffer,e.outOffset+e.origLength),h=l+i})),d.slice(0,h)},Object.defineProperty(r,"__esModule",{value:!0}),r}({}).convert_streams},function parserFactory(Typr,woff2otf){const cmdArgLengths={M:2,L:2,Q:4,C:6,Z:0},joiningTypeRawData={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},JT_LEFT=1,JT_RIGHT=2,JT_DUAL=4,JT_TRANSPARENT=8,JT_JOIN_CAUSING=16,JT_NON_JOINING=32;let joiningTypeMap;function getCharJoiningType(ch){if(!joiningTypeMap){const m={R:JT_RIGHT,L:JT_LEFT,D:JT_DUAL,C:JT_JOIN_CAUSING,U:JT_NON_JOINING,T:JT_TRANSPARENT};joiningTypeMap=new Map;for(let type in joiningTypeRawData){let lastCode=0;joiningTypeRawData[type].split(",").forEach((range=>{let[skip,step]=range.split("+");skip=parseInt(skip,36),step=step?parseInt(step,36):0,joiningTypeMap.set(lastCode+=skip,m[type]);for(let i=step;i--;)joiningTypeMap.set(++lastCode,m[type])}))}}return joiningTypeMap.get(ch)||JT_NON_JOINING}const ISOL=1,INIT=2,FINA=3,MEDI=4,formsToFeatures=[null,"isol","init","fina","medi"];function detectJoiningForms(str){const joiningForms=new Uint8Array(str.length);let prevJoiningType=JT_NON_JOINING,prevForm=ISOL,prevIndex=-1;for(let i=0;i<str.length;i++){const code=str.codePointAt(i);let joiningType=0|getCharJoiningType(code),form=ISOL;joiningType&JT_TRANSPARENT||(prevJoiningType&(JT_LEFT|JT_DUAL|JT_JOIN_CAUSING)?joiningType&(JT_RIGHT|JT_DUAL|JT_JOIN_CAUSING)?(form=FINA,prevForm!==ISOL&&prevForm!==FINA||joiningForms[prevIndex]++):joiningType&(JT_LEFT|JT_NON_JOINING)&&(prevForm!==INIT&&prevForm!==MEDI||joiningForms[prevIndex]--):prevJoiningType&(JT_RIGHT|JT_NON_JOINING)&&(prevForm!==INIT&&prevForm!==MEDI||joiningForms[prevIndex]--),prevForm=joiningForms[i]=form,prevJoiningType=joiningType,prevIndex=i,code>65535&&i++)}return joiningForms}function firstNum(...args){for(let i=0;i<args.length;i++)if("number"==typeof args[i])return args[i]}function wrapFontObj(typrFont){const glyphMap=Object.create(null),os2=typrFont["OS/2"],hhea=typrFont.hhea,unitsPerEm=typrFont.head.unitsPerEm,ascender=firstNum(os2&&os2.sTypoAscender,hhea&&hhea.ascender,unitsPerEm),fontObj={unitsPerEm,ascender,descender:firstNum(os2&&os2.sTypoDescender,hhea&&hhea.descender,0),capHeight:firstNum(os2&&os2.sCapHeight,ascender),xHeight:firstNum(os2&&os2.sxHeight,ascender),lineGap:firstNum(os2&&os2.sTypoLineGap,hhea&&hhea.lineGap),supportsCodePoint:code=>Typr.U.codeToGlyph(typrFont,code)>0,forEachGlyph(text,fontSize,letterSpacing,callback){let glyphX=0;const fontScale=1/fontObj.unitsPerEm*fontSize,glyphIndices=function stringToGlyphs(font,str){const glyphIds=[];for(let i=0;i<str.length;i++){const cc=str.codePointAt(i);cc>65535&&i++,glyphIds.push(Typr.U.codeToGlyph(font,cc))}const gsub=font.GSUB;if(gsub){const{lookupList,featureList}=gsub;let joiningForms;const supportedFeatures=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,usedLookups=[];featureList.forEach((feature=>{if(supportedFeatures.test(feature.tag))for(let ti=0;ti<feature.tab.length;ti++){if(usedLookups[feature.tab[ti]])continue;usedLookups[feature.tab[ti]]=!0;const tab=lookupList[feature.tab[ti]],isJoiningFeature=/^(isol|init|fina|medi)$/.test(feature.tag);isJoiningFeature&&!joiningForms&&(joiningForms=detectJoiningForms(str));for(let ci=0;ci<glyphIds.length;ci++)joiningForms&&isJoiningFeature&&formsToFeatures[joiningForms[ci]]!==feature.tag||Typr.U._applySubs(glyphIds,ci,tab,lookupList)}}))}return glyphIds}(typrFont,text);let charIndex=0,prevGlyphIndex=-1;return glyphIndices.forEach(((glyphIndex,i)=>{if(-1!==glyphIndex){let glyphObj=glyphMap[glyphIndex];if(!glyphObj){const{cmds,crds}=Typr.U.glyphToPath(typrFont,glyphIndex);let xMin,yMin,xMax,yMax,path="",crdsIdx=0;for(let i=0,len=cmds.length;i<len;i++){const numArgs=cmdArgLengths[cmds[i]];path+=cmds[i];for(let j=1;j<=numArgs;j++)path+=(j>1?",":"")+crds[crdsIdx++]}if(crds.length){xMin=yMin=1/0,xMax=yMax=-1/0;for(let i=0,len=crds.length;i<len;i+=2){let x=crds[i],y=crds[i+1];x<xMin&&(xMin=x),y<yMin&&(yMin=y),x>xMax&&(xMax=x),y>yMax&&(yMax=y)}}else xMin=xMax=yMin=yMax=0;glyphObj=glyphMap[glyphIndex]={index:glyphIndex,advanceWidth:typrFont.hmtx.aWidth[glyphIndex],xMin,yMin,xMax,yMax,path,pathCommandCount:cmds.length}}-1!==prevGlyphIndex&&(glyphX+=Typr.U.getPairAdjustment(typrFont,prevGlyphIndex,glyphIndex)*fontScale),callback.call(null,glyphObj,glyphX,charIndex),glyphObj.advanceWidth&&(glyphX+=glyphObj.advanceWidth*fontScale),letterSpacing&&(glyphX+=letterSpacing*fontSize),prevGlyphIndex=glyphIndex}charIndex+=text.codePointAt(charIndex)>65535?2:1})),glyphX}};return fontObj}return function parse(buffer){const peek=new Uint8Array(buffer,0,4),tag=Typr._bin.readASCII(peek,0,4);if("wOFF"===tag)buffer=woff2otf(buffer);else if("wOF2"===tag)throw new Error("woff2 fonts not supported");return wrapFontObj(Typr.parse(buffer)[0])}}],init:(typrFactory,woff2otfFactory,parserFactory)=>parserFactory(typrFactory(),woff2otfFactory())});const fontResolverWorkerModule=defineWorkerModule({name:"FontResolver",dependencies:[function createFontResolver(fontParser,unicodeFontResolverClient){const parsedFonts=Object.create(null),loadingFonts=Object.create(null);function loadFont(fontUrl,callback){let font=parsedFonts[fontUrl];font?callback(font):loadingFonts[fontUrl]?loadingFonts[fontUrl].push(callback):(loadingFonts[fontUrl]=[callback],function doLoadFont(url,callback){const onError=err=>{console.error(`Failure loading font ${url}`,err)};try{const request=new XMLHttpRequest;request.open("get",url,!0),request.responseType="arraybuffer",request.onload=function(){if(request.status>=400)onError(new Error(request.statusText));else if(request.status>0)try{const fontObj=fontParser(request.response);fontObj.src=url,callback(fontObj)}catch(e){onError(e)}},request.onerror=onError,request.send()}catch(err){onError(err)}}(fontUrl,(fontObj=>{fontObj.src=fontUrl,parsedFonts[fontUrl]=fontObj,loadingFonts[fontUrl].forEach((cb=>cb(fontObj))),delete loadingFonts[fontUrl]})))}return function(text,callback,{lang,fonts:userFonts=[],style="normal",weight="normal"}={}){const charResolutions=new Uint8Array(text.length),fontResolutions=[];text.length||allDone();const fontIndices=new Map,fallbackRanges=[];if("italic"!==style&&(style="normal"),"number"!=typeof weight&&(weight="bold"===weight?700:400),userFonts&&!Array.isArray(userFonts)&&(userFonts=[userFonts]),(userFonts=userFonts.slice().filter((def=>!def.lang||def.lang.test(lang))).reverse()).length){const RESOLVED=1,NEEDS_FALLBACK=2;let prevCharResult=0;!function resolveUserFonts(startIndex=0){for(let i=startIndex,iLen=text.length;i<iLen;i++){const codePoint=text.codePointAt(i);if(prevCharResult===RESOLVED&&fontResolutions[charResolutions[i-1]].supportsCodePoint(codePoint)||/\s/.test(text[i]))charResolutions[i]=charResolutions[i-1],prevCharResult===NEEDS_FALLBACK&&(fallbackRanges[fallbackRanges.length-1][1]=i);else for(let j=charResolutions[i],jLen=userFonts.length;j<=jLen;j++)if(j===jLen){(prevCharResult===NEEDS_FALLBACK?fallbackRanges[fallbackRanges.length-1]:fallbackRanges[fallbackRanges.length]=[i,i])[1]=i,prevCharResult=NEEDS_FALLBACK}else{charResolutions[i]=j;const{src,unicodeRange}=userFonts[j];if(!unicodeRange||isCodeInRanges(codePoint,unicodeRange)){const fontObj=parsedFonts[src];if(!fontObj)return void loadFont(src,(()=>{resolveUserFonts(i)}));if(fontObj.supportsCodePoint(codePoint)){let fontIndex=fontIndices.get(fontObj);"number"!=typeof fontIndex&&(fontIndex=fontResolutions.length,fontResolutions.push(fontObj),fontIndices.set(fontObj,fontIndex)),charResolutions[i]=fontIndex,prevCharResult=RESOLVED;break}}}codePoint>65535&&i+1<iLen&&(charResolutions[i+1]=charResolutions[i],i++,prevCharResult===NEEDS_FALLBACK&&(fallbackRanges[fallbackRanges.length-1][1]=i))}resolveFallbacks()}()}else fallbackRanges.push([0,text.length-1]),resolveFallbacks();function resolveFallbacks(){if(fallbackRanges.length){const fallbackString=fallbackRanges.map((range=>text.substring(range[0],range[1]+1))).join("\n");unicodeFontResolverClient.getFontsForString(fallbackString,{lang,style,weight}).then((({fontUrls,chars})=>{const fontIndexOffset=fontResolutions.length;let charIdx=0;fallbackRanges.forEach((range=>{for(let i=0,endIdx=range[1]-range[0];i<=endIdx;i++)charResolutions[range[0]+i]=chars[charIdx++]+fontIndexOffset;charIdx++}));let loadedCount=0;fontUrls.forEach(((url,i)=>{loadFont(url,(fontObj=>{fontResolutions[i+fontIndexOffset]=fontObj,++loadedCount===fontUrls.length&&allDone()}))}))}))}else allDone()}function allDone(){callback({chars:charResolutions,fonts:fontResolutions})}function isCodeInRanges(code,ranges){for(let k=0;k<ranges.length;k++){const[start,end=start]=ranges[k];if(start<=code&&code<=end)return!0}return!1}}},workerModule,function unicodeFontResolverClientFactory(){return function(t){class e{constructor(){this.buckets=new Map}add(t){const e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))}has(t){const e=this.buckets.get(t>>5);return void 0!==e&&0!=(e&1<<(31&t))}serialize(){const t=[];return this.buckets.forEach(((e,n)=>{t.push(`${(+n).toString(36)}:${e.toString(36)}`)})),t.join(",")}deserialize(t){this.buckets.clear(),t.split(",").forEach((t=>{const e=t.split(":");this.buckets.set(parseInt(e[0],36),parseInt(e[1],36))}))}}const n=Math.pow(2,8),o=n-1,r=~o;function s(t){const e=function(t){return t&r}(t).toString(16),o=function(t){return(t&r)+n-1}(t).toString(16);return`codepoint-index/plane${t>>16}/${e}-${o}.json`}function i(t,e){const n=t&o;let r=e.codePointAt(n/6|0);return r=(r||48)-48,0!=(r&1<<n%6)}function l(t,e){!function c(t,e){var n;(n=t,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((t=>t.split("-").map((t=>parseInt(t.trim(),16)))))).forEach((([t,n=t])=>{e(t,n)}))}(t,((t,n)=>{for(let o=t;o<=n;o++)e(o)}))}let a={},u={};const f=new WeakMap;function h(t){let n=f.get(t);return n||(n=new e,l(t.ranges,(t=>n.add(t))),f.set(t,n)),n}const d=new Map;function g(t){let e=d.get(t);return e||(e=fetch(t).then((t=>t.json())),d.set(t,e)),e}function p(t,e,n){return t[e]?e:t[n]?n:function(t){for(const e in t)return e}(t)}function $(t,e){let n=e;if(!t.includes(n)){n=1/0;for(let o=0;o<t.length;o++)Math.abs(t[o]-e)<Math.abs(n-e)&&(n=t[o])}return n}let v;function w(t){return v||(v=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(t=>{v.add(t)}))),v.has(t)}return t.CodePointSet=e,t.clearCache=function(){a={},u={}},t.getFontsForString=function(t,e={}){const{lang:n="en",category:o="sans-serif",style:r="normal",weight:c=400}=e,l=(e.dataUrl||"https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v0.3.2/packages/data").replace(/\/$/g,""),f=new Map,d=new Uint8Array(t.length),v={},b={},k=new Array(t.length),m=new Map;for(let e=0;e<t.length;e++){const n=t.codePointAt(e),o=s(n);k[e]=o,a[o]||m.has(o)||m.set(o,g(`${l}/${o}`).then((t=>{a[o]=t}))),n>65535&&e++}return Promise.all(m.values()).then((()=>{m.clear();for(let e=0;e<t.length;e++){const o=t.codePointAt(e);let r=null;const s=a[k[e]];t:for(let t in s){let e=b[t];if(void 0===e&&(e=b[t]=new RegExp(t).test(n)),e)for(let e in s[t])if(i(o,s[t][e])){r=e;break t}}r||(console.debug(`No font coverage for U+${o.toString(16)}`),r="latin"),k[e]=r,u[r]||m.has(r)||m.set(r,g(`${l}/font-meta/${r}.json`).then((t=>{u[r]=t}))),o>65535&&e++}return Promise.all(m.values())})).then((()=>{var e;let n=null;for(let s=0;s<t.length;s++){const i=t.codePointAt(s);if(n&&(w(i)||h(n).has(i)))d[s]=d[s-1];else{n=u[k[s]];let t=v[n.id];if(!t){const{typeforms:s}=n,i=p(s,o,"sans-serif"),a=p(s[i],r,"normal"),u=$(null===(e=s[i])||void 0===e?void 0:e[a],c);t=v[n.id]=`${l}/font-files/${n.id}/${i}.${a}.${u}.woff`}let i=f.get(t);null==i&&(i=f.size,f.set(t,i)),d[s]=i}i>65535&&(s++,d[s]=d[s-1])}return{fontUrls:Array.from(f.keys()),chars:d}}))},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(createFontResolver,fontParser,unicodeFontResolverClientFactory)=>createFontResolver(fontParser,unicodeFontResolverClientFactory())});const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;const queue=[];let timer=0;function nextChunk(){const start=now();for(;queue.length&&now()-start<5;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...args)=>new Promise(((resolve,reject)=>{queue.push((()=>{const start=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...args),resolve({timing:now()-start})}catch(err){reject(err)}})),timer||(timer=setTimeout(nextChunk,0))})),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(width,height,path,viewBox,distance,exponent,canvas,x,y,channel){const workerId="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let thread=threads[workerId];return thread||(thread=threads[workerId]={workerModule:defineWorkerModule({name:workerId,workerId,dependencies:[SDFGenerator,now],init(_createSDFGenerator,now){const generate=_createSDFGenerator().javascript.generate;return function(...args){const start=now();return{textureData:generate(...args),timing:now()-start}}},getTransferables:result=>[result.textureData.buffer]}),requests:0,idleTimer:null}),thread.requests++,clearTimeout(thread.idleTimer),thread.workerModule(width,height,path,viewBox,distance,exponent).then((({textureData,timing})=>{const start=now(),imageData=new Uint8Array(4*textureData.length);for(let i=0;i<textureData.length;i++)imageData[4*i+channel]=textureData[i];return mainThreadGenerator.webglUtils.renderImageData(canvas,imageData,x,y,width,height,1<<3-channel),timing+=now()-start,0==--thread.requests&&(thread.idleTimer=setTimeout((()=>{!function terminateWorker(workerId){registeredModules[workerId]&&registeredModules[workerId].forEach((function(unregister){unregister()})),workers[workerId]&&(workers[workerId].terminate(),delete workers[workerId])}(workerId)}),idleTimeout)),{timing}}))}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing,CONFIG={defaultFontURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},tempColor=new three_module.Color;let hasRequested=!1;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(args,callback){hasRequested=!0,args=troika_three_text_esm_assign({},args);const totalStart=now$1(),{defaultFontURL}=CONFIG,fonts=[];if(defaultFontURL&&fonts.push({label:"default",src:toAbsoluteURL(defaultFontURL)}),args.font&&fonts.push({label:"user",src:toAbsoluteURL(args.font)}),args.font=fonts,args.text=""+args.text,args.sdfGlyphSize=args.sdfGlyphSize||CONFIG.sdfGlyphSize,null!=args.colorRanges){let colors={};for(let key in args.colorRanges)if(args.colorRanges.hasOwnProperty(key)){let val=args.colorRanges[key];"number"!=typeof val&&(val=tempColor.set(val).getHex()),colors[key]=val}args.colorRanges=colors}Object.freeze(args);const{textureWidth,sdfExponent}=CONFIG,{sdfGlyphSize}=args,glyphsPerRow=textureWidth/sdfGlyphSize*4;let atlas=atlases[sdfGlyphSize];if(!atlas){const canvas=document.createElement("canvas");canvas.width=textureWidth,canvas.height=256*sdfGlyphSize/glyphsPerRow,atlas=atlases[sdfGlyphSize]={glyphCount:0,sdfGlyphSize,sdfCanvas:canvas,sdfTexture:new three_module.Texture(canvas,void 0,void 0,void 0,three_module.LinearFilter,three_module.LinearFilter),contextLost:!1,glyphsByFont:new Map},atlas.sdfTexture.generateMipmaps=!1,function initContextLossHandling(atlas){const canvas=atlas.sdfCanvas;canvas.addEventListener("webglcontextlost",(event=>{console.log("Context Lost",event),event.preventDefault(),atlas.contextLost=!0})),canvas.addEventListener("webglcontextrestored",(event=>{console.log("Context Restored",event),atlas.contextLost=!1;const promises=[];atlas.glyphsByFont.forEach((glyphMap=>{glyphMap.forEach((glyph=>{promises.push(generateGlyphSDF(glyph,atlas,!0))}))})),Promise.all(promises).then((()=>{safariPre15Workaround(atlas),atlas.sdfTexture.needsUpdate=!0}))}))}(atlas)}const{sdfTexture,sdfCanvas}=atlas;typesetInWorker(args).then((result=>{const{glyphIds,glyphFontIndices,fontData,glyphPositions,fontSize,timings}=result,neededSDFs=[],glyphBounds=new Float32Array(4*glyphIds.length);let boundsIdx=0,positionsIdx=0;const quadsStart=now$1(),fontGlyphMaps=fontData.map((font=>{let map=atlas.glyphsByFont.get(font.src);return map||atlas.glyphsByFont.set(font.src,map=new Map),map}));glyphIds.forEach(((glyphId,i)=>{const fontIndex=glyphFontIndices[i],{src:fontSrc,unitsPerEm}=fontData[fontIndex];let glyphInfo=fontGlyphMaps[fontIndex].get(glyphId);if(!glyphInfo){const{path,pathBounds}=result.glyphData[fontSrc][glyphId],fontUnitsMargin=Math.max(pathBounds[2]-pathBounds[0],pathBounds[3]-pathBounds[1])/sdfGlyphSize*(CONFIG.sdfMargin*sdfGlyphSize+.5),atlasIndex=atlas.glyphCount++,sdfViewBox=[pathBounds[0]-fontUnitsMargin,pathBounds[1]-fontUnitsMargin,pathBounds[2]+fontUnitsMargin,pathBounds[3]+fontUnitsMargin];fontGlyphMaps[fontIndex].set(glyphId,glyphInfo={path,atlasIndex,sdfViewBox}),neededSDFs.push(glyphInfo)}const{sdfViewBox}=glyphInfo,posX=glyphPositions[positionsIdx++],posY=glyphPositions[positionsIdx++],fontSizeMult=fontSize/unitsPerEm;glyphBounds[boundsIdx++]=posX+sdfViewBox[0]*fontSizeMult,glyphBounds[boundsIdx++]=posY+sdfViewBox[1]*fontSizeMult,glyphBounds[boundsIdx++]=posX+sdfViewBox[2]*fontSizeMult,glyphBounds[boundsIdx++]=posY+sdfViewBox[3]*fontSizeMult,glyphIds[i]=glyphInfo.atlasIndex})),timings.quads=(timings.quads||0)+(now$1()-quadsStart);const sdfStart=now$1();timings.sdf={};const currentHeight=sdfCanvas.height,neededRows=Math.ceil(atlas.glyphCount/glyphsPerRow),neededHeight=Math.pow(2,Math.ceil(Math.log2(neededRows*sdfGlyphSize)));neededHeight>currentHeight&&(console.info(`Increasing SDF texture size ${currentHeight}->${neededHeight}`),resizeWebGLCanvasWithoutClearing(sdfCanvas,textureWidth,neededHeight),sdfTexture.dispose()),Promise.all(neededSDFs.map((glyphInfo=>generateGlyphSDF(glyphInfo,atlas,args.gpuAccelerateSDF).then((({timing})=>{timings.sdf[glyphInfo.atlasIndex]=timing}))))).then((()=>{neededSDFs.length&&!atlas.contextLost&&(safariPre15Workaround(atlas),sdfTexture.needsUpdate=!0),timings.sdfTotal=now$1()-sdfStart,timings.total=now$1()-totalStart,callback(Object.freeze({parameters:args,sdfTexture,sdfGlyphSize,sdfExponent,glyphBounds,glyphAtlasIndices:glyphIds,glyphColors:result.glyphColors,caretPositions:result.caretPositions,chunkedBounds:result.chunkedBounds,ascender:result.ascender,descender:result.descender,lineHeight:result.lineHeight,capHeight:result.capHeight,xHeight:result.xHeight,topBaseline:result.topBaseline,blockBounds:result.blockBounds,visibleBounds:result.visibleBounds,timings:result.timings}))}))})),Promise.resolve().then((()=>{atlas.contextLost||function warmUpSDFCanvas(canvas){canvas._warm||(mainThreadGenerator.webgl.isSupported(canvas),canvas._warm=!0)}(sdfCanvas)}))}function generateGlyphSDF({path,atlasIndex,sdfViewBox},{sdfGlyphSize,sdfCanvas,contextLost},useGPU){if(contextLost)return Promise.resolve({timing:-1});const{textureWidth,sdfExponent}=CONFIG,maxDist=Math.max(sdfViewBox[2]-sdfViewBox[0],sdfViewBox[3]-sdfViewBox[1]),squareIndex=Math.floor(atlasIndex/4);return function generateSDF(width,height,path,viewBox,distance,exponent,canvas,x,y,channel,useWebGL=!0){return useWebGL?generateSDF_GL(width,height,path,viewBox,distance,exponent,canvas,x,y,channel).then(null,(err=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",err),warned=!0),generateSDF_JS_Worker(width,height,path,viewBox,distance,exponent,canvas,x,y,channel)))):generateSDF_JS_Worker(width,height,path,viewBox,distance,exponent,canvas,x,y,channel)}(sdfGlyphSize,sdfGlyphSize,path,sdfViewBox,maxDist,sdfExponent,sdfCanvas,squareIndex%(textureWidth/sdfGlyphSize)*sdfGlyphSize,Math.floor(squareIndex/(textureWidth/sdfGlyphSize))*sdfGlyphSize,atlasIndex%4,useGPU)}function troika_three_text_esm_assign(toObj,fromObj){for(let key in fromObj)fromObj.hasOwnProperty(key)&&(toObj[key]=fromObj[key]);return toObj}let linkEl;function toAbsoluteURL(path){return linkEl||(linkEl="undefined"==typeof document?{}:document.createElement("a")),linkEl.href=path,linkEl.href}function safariPre15Workaround(atlas){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas,sdfTexture}=atlas,{width,height}=sdfCanvas,gl=atlas.sdfCanvas.getContext("webgl");let pixels=sdfTexture.image.data;pixels&&pixels.length===width*height*4||(pixels=new Uint8Array(width*height*4),sdfTexture.image={width,height,data:pixels},sdfTexture.flipY=!1,sdfTexture.isDataTexture=!0),gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,pixels)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[function createTypesetter(resolveFonts,bidi){const INF=1/0,DEFAULT_IGNORABLE_CHARS=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,lineBreakingWhiteSpace="[^\\S\\u00A0]",BREAK_AFTER_CHARS=new RegExp(`${lineBreakingWhiteSpace}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function typeset({text="",font,lang="en",sdfGlyphSize=64,fontSize=400,fontWeight=1,fontStyle="normal",letterSpacing=0,lineHeight="normal",maxWidth=INF,direction,textAlign="left",textIndent=0,whiteSpace="normal",overflowWrap="normal",anchorX=0,anchorY=0,metricsOnly=!1,preResolvedFonts=null,includeCaretPositions=!1,chunkedBoundsSize=8192,colorRanges=null},callback){const mainStart=now(),timings={fontLoad:0,typesetting:0};text.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),text=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),fontSize=+fontSize,letterSpacing=+letterSpacing,maxWidth=+maxWidth,lineHeight=lineHeight||"normal",textIndent=+textIndent,function calculateFontRuns({text,lang,fonts,style,weight,preResolvedFonts},onDone){const onResolved=({chars,fonts:parsedFonts})=>{let curRun,prevVal;const runs=[];for(let i=0;i<chars.length;i++)chars[i]!==prevVal?(prevVal=chars[i],runs.push(curRun={start:i,end:i,fontObj:parsedFonts[chars[i]]})):curRun.end=i;onDone(runs)};preResolvedFonts?onResolved(preResolvedFonts):resolveFonts(text,onResolved,{lang,fonts,style,weight})}({text,lang,style:fontStyle,weight:fontWeight,fonts:"string"==typeof font?[{src:font}]:font,preResolvedFonts},(runs=>{timings.fontLoad=now()-mainStart;const hasMaxWidth=isFinite(maxWidth);let glyphIds=null,glyphFontIndices=null,glyphPositions=null,glyphData=null,glyphColors=null,caretPositions=null,visibleBounds=null,chunkedBounds=null,maxLineWidth=0,renderableGlyphCount=0,canWrap="nowrap"!==whiteSpace;const metricsByFont=new Map,typesetStart=now();let lineXOffset=textIndent,prevRunEndX=0,currentLine=new TextLine;const lines=[currentLine];runs.forEach((run=>{const{fontObj}=run,{ascender,descender,unitsPerEm,lineGap,capHeight,xHeight}=fontObj;let fontData=metricsByFont.get(fontObj);if(!fontData){const fontSizeMult=fontSize/unitsPerEm,calcLineHeight="normal"===lineHeight?(ascender-descender+lineGap)*fontSizeMult:lineHeight*fontSize,halfLeading=(calcLineHeight-(ascender-descender)*fontSizeMult)/2,caretHeight=Math.min(calcLineHeight,(ascender-descender)*fontSizeMult),caretTop=(ascender+descender)/2*fontSizeMult+caretHeight/2;fontData={index:metricsByFont.size,src:fontObj.src,fontObj,fontSizeMult,unitsPerEm,ascender:ascender*fontSizeMult,descender:descender*fontSizeMult,capHeight:capHeight*fontSizeMult,xHeight:xHeight*fontSizeMult,lineHeight:calcLineHeight,baseline:-halfLeading-ascender*fontSizeMult,caretTop:(ascender+descender)/2*fontSizeMult+caretHeight/2,caretBottom:caretTop-caretHeight},metricsByFont.set(fontObj,fontData)}const{fontSizeMult}=fontData,runText=text.slice(run.start,run.end+1);let prevGlyphX,prevGlyphObj;fontObj.forEachGlyph(runText,fontSize,letterSpacing,((glyphObj,glyphX,charIndex)=>{glyphX+=prevRunEndX,charIndex+=run.start,prevGlyphX=glyphX,prevGlyphObj=glyphObj;const char=text.charAt(charIndex),glyphWidth=glyphObj.advanceWidth*fontSizeMult,curLineCount=currentLine.count;let nextLine;if("isEmpty"in glyphObj||(glyphObj.isWhitespace=!!char&&new RegExp(lineBreakingWhiteSpace).test(char),glyphObj.canBreakAfter=!!char&&BREAK_AFTER_CHARS.test(char),glyphObj.isEmpty=glyphObj.xMin===glyphObj.xMax||glyphObj.yMin===glyphObj.yMax||DEFAULT_IGNORABLE_CHARS.test(char)),glyphObj.isWhitespace||glyphObj.isEmpty||renderableGlyphCount++,canWrap&&hasMaxWidth&&!glyphObj.isWhitespace&&glyphX+glyphWidth+lineXOffset>maxWidth&&curLineCount){if(currentLine.glyphAt(curLineCount-1).glyphObj.canBreakAfter)nextLine=new TextLine,lineXOffset=-glyphX;else for(let i=curLineCount;i--;){if(0===i&&"break-word"===overflowWrap){nextLine=new TextLine,lineXOffset=-glyphX;break}if(currentLine.glyphAt(i).glyphObj.canBreakAfter){nextLine=currentLine.splitAt(i+1);const adjustX=nextLine.glyphAt(0).x;lineXOffset-=adjustX;for(let j=nextLine.count;j--;)nextLine.glyphAt(j).x-=adjustX;break}}nextLine&&(currentLine.isSoftWrapped=!0,currentLine=nextLine,lines.push(currentLine),maxLineWidth=maxWidth)}let fly=currentLine.glyphAt(currentLine.count);fly.glyphObj=glyphObj,fly.x=glyphX+lineXOffset,fly.width=glyphWidth,fly.charIndex=charIndex,fly.fontData=fontData,"\n"===char&&(currentLine=new TextLine,lines.push(currentLine),lineXOffset=-(glyphX+glyphWidth+letterSpacing*fontSize)+textIndent)})),prevRunEndX=prevGlyphX+prevGlyphObj.advanceWidth*fontSizeMult+letterSpacing*fontSize}));let totalHeight=0;lines.forEach((line=>{let isTrailingWhitespace=!0;for(let i=line.count;i--;){const glyphInfo=line.glyphAt(i);isTrailingWhitespace&&!glyphInfo.glyphObj.isWhitespace&&(line.width=glyphInfo.x+glyphInfo.width,line.width>maxLineWidth&&(maxLineWidth=line.width),isTrailingWhitespace=!1);let{lineHeight,capHeight,xHeight,baseline}=glyphInfo.fontData;lineHeight>line.lineHeight&&(line.lineHeight=lineHeight);const baselineDiff=baseline-line.baseline;baselineDiff<0&&(line.baseline+=baselineDiff,line.cap+=baselineDiff,line.ex+=baselineDiff),line.cap=Math.max(line.cap,line.baseline+capHeight),line.ex=Math.max(line.ex,line.baseline+xHeight)}line.baseline-=totalHeight,line.cap-=totalHeight,line.ex-=totalHeight,totalHeight+=line.lineHeight}));let anchorXOffset=0,anchorYOffset=0;if(anchorX&&("number"==typeof anchorX?anchorXOffset=-anchorX:"string"==typeof anchorX&&(anchorXOffset=-maxLineWidth*("left"===anchorX?0:"center"===anchorX?.5:"right"===anchorX?1:parsePercent(anchorX)))),anchorY&&("number"==typeof anchorY?anchorYOffset=-anchorY:"string"==typeof anchorY&&(anchorYOffset="top"===anchorY?0:"top-baseline"===anchorY?-lines[0].baseline:"top-cap"===anchorY?-lines[0].cap:"top-ex"===anchorY?-lines[0].ex:"middle"===anchorY?totalHeight/2:"bottom"===anchorY?totalHeight:"bottom-baseline"===anchorY?lines[lines.length-1].baseline:parsePercent(anchorY)*totalHeight)),!metricsOnly){const bidiLevelsResult=bidi.getEmbeddingLevels(text,direction);glyphIds=new Uint16Array(renderableGlyphCount),glyphFontIndices=new Uint8Array(renderableGlyphCount),glyphPositions=new Float32Array(2*renderableGlyphCount),glyphData={},visibleBounds=[INF,INF,-INF,-INF],chunkedBounds=[],includeCaretPositions&&(caretPositions=new Float32Array(4*text.length)),colorRanges&&(glyphColors=new Uint8Array(3*renderableGlyphCount));let chunk,currentColor,renderableGlyphIndex=0,prevCharIndex=-1,colorCharIndex=-1;if(lines.forEach(((line,lineIndex)=>{let{count:lineGlyphCount,width:lineWidth}=line;if(lineGlyphCount>0){let trailingWhitespaceCount=0;for(let i=lineGlyphCount;i--&&line.glyphAt(i).glyphObj.isWhitespace;)trailingWhitespaceCount++;let lineXOffset=0,justifyAdjust=0;if("center"===textAlign)lineXOffset=(maxLineWidth-lineWidth)/2;else if("right"===textAlign)lineXOffset=maxLineWidth-lineWidth;else if("justify"===textAlign&&line.isSoftWrapped){let whitespaceCount=0;for(let i=lineGlyphCount-trailingWhitespaceCount;i--;)line.glyphAt(i).glyphObj.isWhitespace&&whitespaceCount++;justifyAdjust=(maxLineWidth-lineWidth)/whitespaceCount}if(justifyAdjust||lineXOffset){let justifyOffset=0;for(let i=0;i<lineGlyphCount;i++){let glyphInfo=line.glyphAt(i);const glyphObj=glyphInfo.glyphObj;glyphInfo.x+=lineXOffset+justifyOffset,0!==justifyAdjust&&glyphObj.isWhitespace&&i<lineGlyphCount-trailingWhitespaceCount&&(justifyOffset+=justifyAdjust,glyphInfo.width+=justifyAdjust)}}const flips=bidi.getReorderSegments(text,bidiLevelsResult,line.glyphAt(0).charIndex,line.glyphAt(line.count-1).charIndex);for(let fi=0;fi<flips.length;fi++){const[start,end]=flips[fi];let left=1/0,right=-1/0;for(let i=0;i<lineGlyphCount;i++)if(line.glyphAt(i).charIndex>=start){let startInLine=i,endInLine=i;for(;endInLine<lineGlyphCount;endInLine++){let info=line.glyphAt(endInLine);if(info.charIndex>end)break;endInLine<lineGlyphCount-trailingWhitespaceCount&&(left=Math.min(left,info.x),right=Math.max(right,info.x+info.width))}for(let j=startInLine;j<endInLine;j++){const glyphInfo=line.glyphAt(j);glyphInfo.x=right-(glyphInfo.x+glyphInfo.width-left)}break}}let glyphObj;const setGlyphObj=g=>glyphObj=g;for(let i=0;i<lineGlyphCount;i++){const glyphInfo=line.glyphAt(i);glyphObj=glyphInfo.glyphObj;const glyphId=glyphObj.index,rtl=1&bidiLevelsResult.levels[glyphInfo.charIndex];if(rtl){const mirrored=bidi.getMirroredCharacter(text[glyphInfo.charIndex]);mirrored&&glyphInfo.fontData.fontObj.forEachGlyph(mirrored,0,0,setGlyphObj)}if(includeCaretPositions){const{charIndex,fontData}=glyphInfo,caretLeft=glyphInfo.x+anchorXOffset,caretRight=glyphInfo.x+glyphInfo.width+anchorXOffset;caretPositions[4*charIndex]=rtl?caretRight:caretLeft,caretPositions[4*charIndex+1]=rtl?caretLeft:caretRight,caretPositions[4*charIndex+2]=line.baseline+fontData.caretBottom+anchorYOffset,caretPositions[4*charIndex+3]=line.baseline+fontData.caretTop+anchorYOffset;const ligCount=charIndex-prevCharIndex;ligCount>1&&fillLigatureCaretPositions(caretPositions,prevCharIndex,ligCount),prevCharIndex=charIndex}if(colorRanges){const{charIndex}=glyphInfo;for(;charIndex>colorCharIndex;)colorCharIndex++,colorRanges.hasOwnProperty(colorCharIndex)&&(currentColor=colorRanges[colorCharIndex])}if(!glyphObj.isWhitespace&&!glyphObj.isEmpty){const idx=renderableGlyphIndex++,{fontSizeMult,src:fontSrc,index:fontIndex}=glyphInfo.fontData,fontGlyphData=glyphData[fontSrc]||(glyphData[fontSrc]={});fontGlyphData[glyphId]||(fontGlyphData[glyphId]={path:glyphObj.path,pathBounds:[glyphObj.xMin,glyphObj.yMin,glyphObj.xMax,glyphObj.yMax]});const glyphX=glyphInfo.x+anchorXOffset,glyphY=line.baseline+anchorYOffset;glyphPositions[2*idx]=glyphX,glyphPositions[2*idx+1]=glyphY;const visX0=glyphX+glyphObj.xMin*fontSizeMult,visY0=glyphY+glyphObj.yMin*fontSizeMult,visX1=glyphX+glyphObj.xMax*fontSizeMult,visY1=glyphY+glyphObj.yMax*fontSizeMult;visX0<visibleBounds[0]&&(visibleBounds[0]=visX0),visY0<visibleBounds[1]&&(visibleBounds[1]=visY0),visX1>visibleBounds[2]&&(visibleBounds[2]=visX1),visY1>visibleBounds[3]&&(visibleBounds[3]=visY1),idx%chunkedBoundsSize==0&&(chunk={start:idx,end:idx,rect:[INF,INF,-INF,-INF]},chunkedBounds.push(chunk)),chunk.end++;const chunkRect=chunk.rect;if(visX0<chunkRect[0]&&(chunkRect[0]=visX0),visY0<chunkRect[1]&&(chunkRect[1]=visY0),visX1>chunkRect[2]&&(chunkRect[2]=visX1),visY1>chunkRect[3]&&(chunkRect[3]=visY1),glyphIds[idx]=glyphId,glyphFontIndices[idx]=fontIndex,colorRanges){const start=3*idx;glyphColors[start]=currentColor>>16&255,glyphColors[start+1]=currentColor>>8&255,glyphColors[start+2]=255&currentColor}}}}})),caretPositions){const ligCount=text.length-prevCharIndex;ligCount>1&&fillLigatureCaretPositions(caretPositions,prevCharIndex,ligCount)}}const fontData=[];metricsByFont.forEach((({index,src,unitsPerEm,ascender,descender,lineHeight,capHeight,xHeight})=>{fontData[index]={src,unitsPerEm,ascender,descender,lineHeight,capHeight,xHeight}})),timings.typesetting=now()-typesetStart,callback({glyphIds,glyphFontIndices,glyphPositions,glyphData,fontData,caretPositions,glyphColors,chunkedBounds,fontSize,topBaseline:anchorYOffset+lines[0].baseline,blockBounds:[anchorXOffset,anchorYOffset-totalHeight,anchorXOffset+maxLineWidth,anchorYOffset],visibleBounds,timings})}))}function parsePercent(str){let match=str.match(/^([\d.]+)%$/),pct=match?parseFloat(match[1]):NaN;return isNaN(pct)?0:pct/100}function fillLigatureCaretPositions(caretPositions,ligStartIndex,ligCount){const ligStartX=caretPositions[4*ligStartIndex],ligEndX=caretPositions[4*ligStartIndex+1],ligBottom=caretPositions[4*ligStartIndex+2],ligTop=caretPositions[4*ligStartIndex+3],guessedAdvanceX=(ligEndX-ligStartX)/ligCount;for(let i=0;i<ligCount;i++){const startIndex=4*(ligStartIndex+i);caretPositions[startIndex]=ligStartX+guessedAdvanceX*i,caretPositions[startIndex+1]=ligStartX+guessedAdvanceX*(i+1),caretPositions[startIndex+2]=ligBottom,caretPositions[startIndex+3]=ligTop}}function now(){return(self.performance||Date).now()}function TextLine(){this.data=[]}const textLineProps=["glyphObj","x","width","charIndex","fontData"];return TextLine.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/textLineProps.length)},glyphAt(i){let fly=TextLine.flyweight;return fly.data=this.data,fly.index=i,fly},splitAt(i){let newLine=new TextLine;return newLine.data=this.data.splice(i*textLineProps.length),newLine}},TextLine.flyweight=textLineProps.reduce(((obj,prop,i,all)=>(Object.defineProperty(obj,prop,{get(){return this.data[this.index*textLineProps.length+i]},set(val){this.data[this.index*textLineProps.length+i]=val}}),obj)),{data:null,index:0}),{typeset,measure:function measure(args,callback){typeset({...args,metricsOnly:!0},(result=>{const[x0,y0,x1,y1]=result.blockBounds;callback({width:x1-x0,height:y1-y0})}))}}},fontResolverWorkerModule,bidi],init:(createTypesetter,fontResolver,bidiFactory)=>createTypesetter(fontResolver,bidiFactory())}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init:typesetter=>function(args){return new Promise((resolve=>{typesetter.typeset(args,resolve)}))},getTransferables(result){const transferables=[];for(let p in result)result[p]&&result[p].buffer&&transferables.push(result[p].buffer);return transferables}});const templateGeometries={};class GlyphsGeometry extends three_module.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new three_module.Sphere,this.boundingBox=new three_module.Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(side){const verts=this.getIndex().count;this.setDrawRange(side===three_module.BackSide?verts/2:0,side===three_module.DoubleSide?verts:verts/2)}set detail(detail){if(detail!==this._detail){this._detail=detail,("number"!=typeof detail||detail<1)&&(detail=1);let tpl=function getTemplateGeometry(detail){let geom=templateGeometries[detail];if(!geom){const front=new three_module.PlaneGeometry(1,1,detail,detail),back=front.clone(),frontAttrs=front.attributes,backAttrs=back.attributes,combined=new three_module.BufferGeometry,vertCount=frontAttrs.uv.count;for(let i=0;i<vertCount;i++)backAttrs.position.array[3*i]*=-1,backAttrs.normal.array[3*i+2]*=-1;["position","normal","uv"].forEach((name=>{combined.setAttribute(name,new three_module.Float32BufferAttribute([...frontAttrs[name].array,...backAttrs[name].array],frontAttrs[name].itemSize))})),combined.setIndex([...front.index.array,...back.index.array.map((n=>n+vertCount))]),combined.translate(.5,.5,0),geom=templateGeometries[detail]=combined}return geom}(detail);["position","normal","uv"].forEach((attr=>{this.attributes[attr]=tpl.attributes[attr].clone()})),this.setIndex(tpl.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(glyphBounds,glyphAtlasIndices,blockBounds,chunkedBounds,glyphColors){updateBufferAttr(this,"aTroikaGlyphBounds",glyphBounds,4),updateBufferAttr(this,"aTroikaGlyphIndex",glyphAtlasIndices,1),updateBufferAttr(this,"aTroikaGlyphColor",glyphColors,3),this._blockBounds=blockBounds,this._chunkedBounds=chunkedBounds,this.instanceCount=glyphAtlasIndices.length,this._updateBounds()}_updateBounds(){const bounds=this._blockBounds;if(bounds){const{curveRadius,boundingBox:bbox}=this;if(curveRadius){const{PI,floor,min,max,sin,cos}=Math,halfPi=PI/2,twoPi=2*PI,absR=Math.abs(curveRadius),leftAngle=bounds[0]/absR,rightAngle=bounds[2]/absR,minX=floor((leftAngle+halfPi)/twoPi)!==floor((rightAngle+halfPi)/twoPi)?-absR:min(sin(leftAngle)*absR,sin(rightAngle)*absR),maxX=floor((leftAngle-halfPi)/twoPi)!==floor((rightAngle-halfPi)/twoPi)?absR:max(sin(leftAngle)*absR,sin(rightAngle)*absR),maxZ=floor((leftAngle+PI)/twoPi)!==floor((rightAngle+PI)/twoPi)?2*absR:max(absR-cos(leftAngle)*absR,absR-cos(rightAngle)*absR);bbox.min.set(minX,bounds[1],curveRadius<0?-maxZ:0),bbox.max.set(maxX,bounds[3],curveRadius<0?0:maxZ)}else bbox.min.set(bounds[0],bounds[1],0),bbox.max.set(bounds[2],bounds[3],0);bbox.getBoundingSphere(this.boundingSphere)}}applyClipRect(clipRect){let count=this.getAttribute("aTroikaGlyphIndex").count,chunks=this._chunkedBounds;if(chunks)for(let i=chunks.length;i--;){count=chunks[i].end;let rect=chunks[i].rect;if(rect[1]<clipRect.w&&rect[3]>clipRect.y&&rect[0]<clipRect.z&&rect[2]>clipRect.x)break}this.instanceCount=count}}function updateBufferAttr(geom,attrName,newArray,itemSize){const attr=geom.getAttribute(attrName);newArray?attr&&attr.array.length===newArray.length?(attr.array.set(newArray),attr.needsUpdate=!0):(geom.setAttribute(attrName,new three_module.InstancedBufferAttribute(newArray,itemSize)),delete geom._maxInstanceCount,geom.dispose()):attr&&geom.deleteAttribute(attrName)}const defaultMaterial=new three_module.MeshBasicMaterial({color:16777215,side:three_module.DoubleSide,transparent:!0}),tempMat4=new three_module.Matrix4,tempVec3a=new three_module.Vector3,tempVec3b=new three_module.Vector3,tempArray=[],origin=new three_module.Vector3;function first(o){return Array.isArray(o)?o[0]:o}let getFlatRaycastMesh=()=>{const mesh=new three_module.Mesh(new three_module.PlaneGeometry(1,1),defaultMaterial);return getFlatRaycastMesh=()=>mesh,mesh},getCurvedRaycastMesh=()=>{const mesh=new three_module.Mesh(new three_module.PlaneGeometry(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>mesh,mesh};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Text extends three_module.Mesh{constructor(){super(new GlyphsGeometry,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang="en",this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation="+x+y",this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(callback){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(callback):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},(textRenderInfo=>{this._isSyncing=!1,this._textRenderInfo=textRenderInfo,this.geometry.updateGlyphs(textRenderInfo.glyphBounds,textRenderInfo.glyphAtlasIndices,textRenderInfo.blockBounds,textRenderInfo.chunkedBounds,textRenderInfo.glyphColors);const queued=this._queuedSyncs;queued&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{queued.forEach((fn=>fn&&fn()))}))),this.dispatchEvent(syncCompleteEvent),callback&&callback()}))))}onBeforeRender(renderer,scene,camera,geometry,material,group){this.sync(),material.isTroikaTextMaterial&&this._prepareForRender(material),material._hadOwnSide=material.hasOwnProperty("side"),this.geometry.setSide(material._actualSide=material.side),material.side=three_module.FrontSide}onAfterRender(renderer,scene,camera,geometry,material,group){material._hadOwnSide?material.side=material._actualSide:delete material.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let derivedMaterial=this._derivedMaterial;const baseMaterial=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if(derivedMaterial&&derivedMaterial.baseMaterial===baseMaterial||(derivedMaterial=this._derivedMaterial=function createTextDerivedMaterial(baseMaterial){const textMaterial=createDerivedMaterial(baseMaterial,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new three_module.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new three_module.Vector4(0,0,0,0)},uTroikaClipRect:{value:new three_module.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new three_module.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new three_module.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new three_module.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader,fragmentShader}){let uDiffuseRE=/\buniform\s+vec3\s+diffuse\b/;return uDiffuseRE.test(fragmentShader)&&(fragmentShader=fragmentShader.replace(uDiffuseRE,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),uDiffuseRE.test(vertexShader)||(vertexShader=vertexShader.replace(voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader,fragmentShader}}});return textMaterial.transparent=!0,Object.defineProperties(textMaterial,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),textMaterial}(baseMaterial),baseMaterial.addEventListener("dispose",(function onDispose(){baseMaterial.removeEventListener("dispose",onDispose),derivedMaterial.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let outlineMaterial=derivedMaterial._outlineMtl;return outlineMaterial||(outlineMaterial=derivedMaterial._outlineMtl=Object.create(derivedMaterial,{id:{value:derivedMaterial.id+.1}}),outlineMaterial.isTextOutlineMaterial=!0,outlineMaterial.depthWrite=!1,outlineMaterial.map=null,derivedMaterial.addEventListener("dispose",(function onDispose(){derivedMaterial.removeEventListener("dispose",onDispose),outlineMaterial.dispose()}))),[outlineMaterial,derivedMaterial]}return derivedMaterial}set material(baseMaterial){baseMaterial&&baseMaterial.isTroikaTextMaterial?(this._derivedMaterial=baseMaterial,this._baseMaterial=baseMaterial.baseMaterial):this._baseMaterial=baseMaterial}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(detail){this.geometry.detail=detail}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(material){const isOutline=material.isTextOutlineMaterial,uniforms=material.uniforms,textInfo=this.textRenderInfo;if(textInfo){const{sdfTexture,blockBounds}=textInfo;uniforms.uTroikaSDFTexture.value=sdfTexture,uniforms.uTroikaSDFTextureSize.value.set(sdfTexture.image.width,sdfTexture.image.height),uniforms.uTroikaSDFGlyphSize.value=textInfo.sdfGlyphSize,uniforms.uTroikaSDFExponent.value=textInfo.sdfExponent,uniforms.uTroikaTotalBounds.value.fromArray(blockBounds),uniforms.uTroikaUseGlyphColors.value=!isOutline&&!!textInfo.glyphColors;let fillOpacity,strokeOpacity,strokeColor,distanceOffset=0,blurRadius=0,strokeWidth=0,offsetX=0,offsetY=0;if(isOutline){let{outlineWidth,outlineOffsetX,outlineOffsetY,outlineBlur,outlineOpacity}=this;distanceOffset=this._parsePercent(outlineWidth)||0,blurRadius=Math.max(0,this._parsePercent(outlineBlur)||0),fillOpacity=outlineOpacity,offsetX=this._parsePercent(outlineOffsetX)||0,offsetY=this._parsePercent(outlineOffsetY)||0}else strokeWidth=Math.max(0,this._parsePercent(this.strokeWidth)||0),strokeWidth&&(strokeColor=this.strokeColor,uniforms.uTroikaStrokeColor.value.set(null==strokeColor?8421504:strokeColor),strokeOpacity=this.strokeOpacity,null==strokeOpacity&&(strokeOpacity=1)),fillOpacity=this.fillOpacity;uniforms.uTroikaDistanceOffset.value=distanceOffset,uniforms.uTroikaPositionOffset.value.set(offsetX,offsetY),uniforms.uTroikaBlurRadius.value=blurRadius,uniforms.uTroikaStrokeWidth.value=strokeWidth,uniforms.uTroikaStrokeOpacity.value=strokeOpacity,uniforms.uTroikaFillOpacity.value=null==fillOpacity?1:fillOpacity,uniforms.uTroikaCurveRadius.value=this.curveRadius||0;let clipRect=this.clipRect;if(clipRect&&Array.isArray(clipRect)&&4===clipRect.length)uniforms.uTroikaClipRect.value.fromArray(clipRect);else{const pad=100*(this.fontSize||.1);uniforms.uTroikaClipRect.value.set(blockBounds[0]-pad,blockBounds[1]-pad,blockBounds[2]+pad,blockBounds[3]+pad)}this.geometry.applyClipRect(uniforms.uTroikaClipRect.value)}uniforms.uTroikaSDFDebug.value=!!this.debugSDF,material.polygonOffset=!!this.depthOffset,material.polygonOffsetFactor=material.polygonOffsetUnits=this.depthOffset||0;const color=isOutline?this.outlineColor||0:this.color;if(null==color)delete material.color;else{const colorObj=material.hasOwnProperty("color")?material.color:material.color=new three_module.Color;color===colorObj._input&&"object"!=typeof color||colorObj.set(colorObj._input=color)}let orient=this.orientation||"+x+y";if(orient!==material._orientation){let rotMat=uniforms.uTroikaOrient.value;orient=orient.replace(/[^-+xyz]/g,"");let match="+x+y"!==orient&&orient.match(/^([-+])([xyz])([-+])([xyz])$/);if(match){let[,hSign,hAxis,vSign,vAxis]=match;tempVec3a.set(0,0,0)[hAxis]="-"===hSign?1:-1,tempVec3b.set(0,0,0)[vAxis]="-"===vSign?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),rotMat.setFromMatrix4(tempMat4)}else rotMat.identity();material._orientation=orient}}_parsePercent(value){if("string"==typeof value){let match=value.match(/^(-?[\d.]+)%$/),pct=match?parseFloat(match[1]):NaN;value=(isNaN(pct)?0:pct/100)*this.fontSize}return value}localPositionToTextCoords(position,target=new three_module.Vector2){target.copy(position);const r=this.curveRadius;return r&&(target.x=Math.atan2(position.x,Math.abs(r)-Math.abs(position.z))*Math.abs(r)),target}worldPositionToTextCoords(position,target=new three_module.Vector2){return tempVec3a.copy(position),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),target)}raycast(raycaster,intersects){const{textRenderInfo,curveRadius}=this;if(textRenderInfo){const bounds=textRenderInfo.blockBounds,raycastMesh=curveRadius?getCurvedRaycastMesh():getFlatRaycastMesh(),geom=raycastMesh.geometry,{position,uv}=geom.attributes;for(let i=0;i<uv.count;i++){let x=bounds[0]+uv.getX(i)*(bounds[2]-bounds[0]);const y=bounds[1]+uv.getY(i)*(bounds[3]-bounds[1]);let z=0;curveRadius&&(z=curveRadius-Math.cos(x/curveRadius)*curveRadius,x=Math.sin(x/curveRadius)*curveRadius),position.setXYZ(i,x,y,z)}geom.boundingSphere=this.geometry.boundingSphere,geom.boundingBox=this.geometry.boundingBox,raycastMesh.matrixWorld=this.matrixWorld,raycastMesh.material.side=this.material.side,tempArray.length=0,raycastMesh.raycast(raycaster,tempArray);for(let i=0;i<tempArray.length;i++)tempArray[i].object=this,intersects.push(tempArray[i])}}copy(source){const geom=this.geometry;return super.copy(source),this.geometry=geom,COPYABLE_PROPS.forEach((prop=>{this[prop]=source[prop]})),this}clone(){return(new this.constructor).copy(this)}}SYNCABLE_PROPS.forEach((prop=>{const privateKey="_private_"+prop;Object.defineProperty(Text.prototype,prop,{get(){return this[privateKey]},set(value){value!==this[privateKey]&&(this[privateKey]=value,this._needsSync=!0)}})}));new WeakMap;new WeakMap;var angular_three_soba_abstractions_class,angular_three_soba_abstractions_class2,angular_three_soba_abstractions_class3,angular_three_soba_abstractions_class4,angular_three_soba_abstractions_class5,_class6,_class7,_class8,_class9,_class10,_class11,_class12,_class13,_class14,_class15,_class16,_class17,_class18,_class19;const angular_three_soba_abstractions_c0=["*"],angular_three_soba_abstractions_c1=["points",""];function _class3_ngt_primitive_0_ngt_primitive_1_Template(rf,ctx){if(1&rf){const _r4=core["ɵɵgetCurrentView"]();core["ɵɵelementStart"](0,"ngt-primitive",4),core["ɵɵlistener"]("afterAttach",(function _class3_ngt_primitive_0_ngt_primitive_1_Template_ngt_primitive_afterAttach_0_listener($event){core["ɵɵrestoreView"](_r4);const ctx_r3=core["ɵɵnextContext"](2);return core["ɵɵresetView"](ctx_r3.onAfterAttach($event))})),core["ɵɵelementEnd"]()}}function _class3_ngt_primitive_0_ngt_primitive_2_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-primitive",5),2&rf){const ctx_r2=core["ɵɵnextContext"](2);let tmp_6_0,tmp_7_0,tmp_8_0,tmp_9_0,tmp_10_0;core["ɵɵproperty"]("color",ctx_r2.get("color"))("vertexColors",ctx_r2.Boolean(ctx_r2.get("vertexColors")))("resolution",ctx_r2.get("materialResolution"))("linewidth",ctx_r2.get("lineWidth"))("alphaToCoverage",ctx_r2.get("alphaToCoverage"))("dashed",ctx_r2.get("dashed"))("dashScale",null!==(tmp_6_0=ctx_r2.get("dashScale"))&&void 0!==tmp_6_0?tmp_6_0:ctx_r2.lineMaterial.dashScale)("dashSize",null!==(tmp_7_0=ctx_r2.get("dashSize"))&&void 0!==tmp_7_0?tmp_7_0:ctx_r2.lineMaterial.dashSize)("dashOffset",null!==(tmp_8_0=ctx_r2.get("dashOffset"))&&void 0!==tmp_8_0?tmp_8_0:ctx_r2.lineMaterial.dashOffset)("gapSize",null!==(tmp_9_0=ctx_r2.get("gapSize"))&&void 0!==tmp_9_0?tmp_9_0:ctx_r2.lineMaterial.gapSize)("wireframe",null!==(tmp_10_0=ctx_r2.get("wireframe"))&&void 0!==tmp_10_0?tmp_10_0:ctx_r2.lineMaterial.wireframe)("worldUnits",ctx_r2.get("worldUnits"))}}const _c2=function(a0){return[a0]};function _class3_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",1),core["ɵɵtemplate"](1,_class3_ngt_primitive_0_ngt_primitive_1_Template,1,0,"ngt-primitive",2),core["ɵɵtemplate"](2,_class3_ngt_primitive_0_ngt_primitive_2_Template,1,12,"ngt-primitive",3),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("ref",ctx_r0.lineRef),core["ɵɵadvance"](1),core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](3,_c2,ctx_r0.get("lineGeometry"))),core["ɵɵadvance"](1),core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](5,_c2,ctx_r0.lineMaterial))}}function _class6_ng_container_1_Template(rf,ctx){1&rf&&(core["ɵɵelementContainerStart"](0),core["ɵɵprojection"](1),core["ɵɵelementContainerEnd"]())}function _class6_ng_template_2_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-line-basic-material",3),2&rf){const ctx_r2=core["ɵɵnextContext"]();core["ɵɵproperty"]("color",ctx_r2.color)}}function _class8_ng_template_1_ng_container_2_Template(rf,ctx){1&rf&&core["ɵɵelementContainer"](0)}const _c4=function(){return[0,0,200]};function _class8_ng_template_1_Template(rf,ctx){if(1&rf){const _r3=core["ɵɵgetCurrentView"]();core["ɵɵelement"](0,"ngts-orthographic-camera",2),core["ɵɵelementStart"](1,"ngt-group",3),core["ɵɵlistener"]("beforeRender",(function _class8_ng_template_1_Template_ngt_group_beforeRender_1_listener($event){core["ɵɵrestoreView"](_r3);const ctx_r2=core["ɵɵnextContext"]();return core["ɵɵresetView"](ctx_r2.onBeforeRender($event.state.delta))})),core["ɵɵtemplate"](2,_class8_ng_template_1_ng_container_2_Template,1,0,"ng-container",4),core["ɵɵelementEnd"]()}if(2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("cameraRef",ctx_r0.virtualCameraRef)("makeDefault",!0)("position",core["ɵɵpureFunction0"](6,_c4)),core["ɵɵadvance"](1),core["ɵɵproperty"]("ref",ctx_r0.gizmoRef)("position",ctx_r0.get("gizmoPosition")),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngTemplateOutlet",ctx_r0.gizmoHelperContent)}}function _class10_ngt_box_geometry_1_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-box-geometry")}const _c7=function(a1){return["material",a1]};function _class12_ngts_gizmo_viewcube_face_material_2_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngts-gizmo-viewcube-face-material",2),2&rf){const i_r1=ctx.$implicit,ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("hover",ctx_r0.hover===i_r1)("index",i_r1)("font",ctx_r0.get("font"))("color",ctx_r0.get("color"))("opacity",ctx_r0.get("opacity"))("hoverColor",ctx_r0.get("hoverColor"))("textColor",ctx_r0.get("textColor"))("strokeColor",ctx_r0.get("strokeColor"))("faces",ctx_r0.get("faces"))}}function _class13_ngts_gizmo_viewcube_edge_cube_2_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngts-gizmo-viewcube-edge-cube",5),2&rf){const edge_r2=ctx.$implicit,i_r3=ctx.index,ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("position",edge_r2)("dimensions",ctx_r0.edgeDimensions[i_r3])("font",ctx_r0.get("font"))("color",ctx_r0.get("color"))("opacity",ctx_r0.get("opacity"))("hoverColor",ctx_r0.get("hoverColor"))("textColor",ctx_r0.get("textColor"))("strokeColor",ctx_r0.get("strokeColor"))("faces",ctx_r0.get("faces"))("clickEmitter",ctx_r0.clicked)}}function _class13_ngts_gizmo_viewcube_edge_cube_3_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngts-gizmo-viewcube-edge-cube",5),2&rf){const corner_r4=ctx.$implicit,ctx_r1=core["ɵɵnextContext"]();core["ɵɵproperty"]("position",corner_r4)("dimensions",ctx_r1.cornerDimensions)("font",ctx_r1.get("font"))("color",ctx_r1.get("color"))("opacity",ctx_r1.get("opacity"))("hoverColor",ctx_r1.get("hoverColor"))("textColor",ctx_r1.get("textColor"))("strokeColor",ctx_r1.get("strokeColor"))("faces",ctx_r1.get("faces"))("clickEmitter",ctx_r1.clicked)}}function _class14_ngt_box_geometry_2_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-box-geometry")}const _c9=function(){return[.4,0,0]},_c10=function(a0){return[a0,0,0]},_c11=function(a1){return[0,a1,0]},_c12=function(a2){return[0,0,a2]};function _class16_ng_container_4_ng_container_4_Template(rf,ctx){if(1&rf){const _r3=core["ɵɵgetCurrentView"]();core["ɵɵelementContainerStart"](0),core["ɵɵelementStart"](1,"ngts-gizmo-viewport-axis-head",6),core["ɵɵlistener"]("pointerdown",(function _class16_ng_container_4_ng_container_4_Template_ngts_gizmo_viewport_axis_head_pointerdown_1_listener($event){core["ɵɵrestoreView"](_r3);const ctx_r2=core["ɵɵnextContext"](2);return core["ɵɵresetView"](ctx_r2.onPointerDown($event))})),core["ɵɵelementEnd"](),core["ɵɵelementStart"](2,"ngts-gizmo-viewport-axis-head",6),core["ɵɵlistener"]("pointerdown",(function _class16_ng_container_4_ng_container_4_Template_ngts_gizmo_viewport_axis_head_pointerdown_2_listener($event){core["ɵɵrestoreView"](_r3);const ctx_r4=core["ɵɵnextContext"](2);return core["ɵɵresetView"](ctx_r4.onPointerDown($event))})),core["ɵɵelementEnd"](),core["ɵɵelementStart"](3,"ngts-gizmo-viewport-axis-head",6),core["ɵɵlistener"]("pointerdown",(function _class16_ng_container_4_ng_container_4_Template_ngts_gizmo_viewport_axis_head_pointerdown_3_listener($event){core["ɵɵrestoreView"](_r3);const ctx_r5=core["ɵɵnextContext"](2);return core["ɵɵresetView"](ctx_r5.onPointerDown($event))})),core["ɵɵelementEnd"](),core["ɵɵelementContainerEnd"]()}if(2&rf){const ctx_r1=core["ɵɵnextContext"](2);core["ɵɵadvance"](1),core["ɵɵproperty"]("arcStyle",ctx_r1.get("axisColors")[0])("position",core["ɵɵpureFunction1"](21,_c10,-1))("font",ctx_r1.get("font"))("disabled",ctx_r1.get("disabled"))("labelColor",ctx_r1.get("labelColor"))("clickEmitter",ctx_r1.clicked)("axisHeadScale",ctx_r1.get("axisHeadScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("arcStyle",ctx_r1.get("axisColors")[1])("position",core["ɵɵpureFunction1"](23,_c11,-1))("font",ctx_r1.get("font"))("disabled",ctx_r1.get("disabled"))("labelColor",ctx_r1.get("labelColor"))("clickEmitter",ctx_r1.clicked)("axisHeadScale",ctx_r1.get("axisHeadScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("arcStyle",ctx_r1.get("axisColors")[2])("position",core["ɵɵpureFunction1"](25,_c12,-1))("font",ctx_r1.get("font"))("disabled",ctx_r1.get("disabled"))("labelColor",ctx_r1.get("labelColor"))("clickEmitter",ctx_r1.clicked)("axisHeadScale",ctx_r1.get("axisHeadScale"))}}const _c13=function(){return[1,0,0]},_c14=function(){return[0,1,0]},_c15=function(){return[0,0,1]};function _class16_ng_container_4_Template(rf,ctx){if(1&rf){const _r7=core["ɵɵgetCurrentView"]();core["ɵɵelementContainerStart"](0),core["ɵɵelementStart"](1,"ngts-gizmo-viewport-axis-head",5),core["ɵɵlistener"]("pointerdown",(function _class16_ng_container_4_Template_ngts_gizmo_viewport_axis_head_pointerdown_1_listener($event){core["ɵɵrestoreView"](_r7);const ctx_r6=core["ɵɵnextContext"]();return core["ɵɵresetView"](ctx_r6.onPointerDown($event))})),core["ɵɵelementEnd"](),core["ɵɵelementStart"](2,"ngts-gizmo-viewport-axis-head",5),core["ɵɵlistener"]("pointerdown",(function _class16_ng_container_4_Template_ngts_gizmo_viewport_axis_head_pointerdown_2_listener($event){core["ɵɵrestoreView"](_r7);const ctx_r8=core["ɵɵnextContext"]();return core["ɵɵresetView"](ctx_r8.onPointerDown($event))})),core["ɵɵelementEnd"](),core["ɵɵelementStart"](3,"ngts-gizmo-viewport-axis-head",5),core["ɵɵlistener"]("pointerdown",(function _class16_ng_container_4_Template_ngts_gizmo_viewport_axis_head_pointerdown_3_listener($event){core["ɵɵrestoreView"](_r7);const ctx_r9=core["ɵɵnextContext"]();return core["ɵɵresetView"](ctx_r9.onPointerDown($event))})),core["ɵɵelementEnd"](),core["ɵɵtemplate"](4,_class16_ng_container_4_ng_container_4_Template,4,27,"ng-container",2),core["ɵɵelementContainerEnd"]()}if(2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵadvance"](1),core["ɵɵproperty"]("arcStyle",ctx_r0.get("axisColors")[0])("position",core["ɵɵpureFunction0"](25,_c13))("label",ctx_r0.get("labels")[0])("font",ctx_r0.get("font"))("disabled",ctx_r0.get("disabled"))("labelColor",ctx_r0.get("labelColor"))("clickEmitter",ctx_r0.clicked)("axisHeadScale",ctx_r0.get("axisHeadScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("arcStyle",ctx_r0.get("axisColors")[1])("position",core["ɵɵpureFunction0"](26,_c14))("label",ctx_r0.get("labels")[1])("font",ctx_r0.get("font"))("disabled",ctx_r0.get("disabled"))("labelColor",ctx_r0.get("labelColor"))("clickEmitter",ctx_r0.clicked)("axisHeadScale",ctx_r0.get("axisHeadScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("arcStyle",ctx_r0.get("axisColors")[2])("position",core["ɵɵpureFunction0"](27,_c15))("label",ctx_r0.get("labels")[2])("font",ctx_r0.get("font"))("disabled",ctx_r0.get("disabled"))("labelColor",ctx_r0.get("labelColor"))("clickEmitter",ctx_r0.clicked)("axisHeadScale",ctx_r0.get("axisHeadScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngIf",!ctx_r0.get("hideNegativeAxes"))}}const _c16=function(){return[0,0,0]};function _class18_ngt_text_geometry_1_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-text-geometry")}function _class19_ngt_primitive_1_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",1),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("ref",ctx_r0.textRef)("text",ctx_r0.get("text"))("anchorX",ctx_r0.get("anchorX"))("anchorY",ctx_r0.get("anchorY"))("font",ctx_r0.get("font"))}}(0,angular_three.l7)({Group:three_module.Group});class NgtsBillboard extends angular_three.A7{constructor(){super(...arguments),this.billboardRef=(0,angular_three.Lv)()}set follow(follow){this.set({follow})}set lockX(lockX){this.set({lockX})}set lockY(lockY){this.set({lockY})}set lockZ(lockZ){this.set({lockZ})}initialize(){super.initialize(),this.set({follow:!0,lockX:!1,lockY:!1,lockZ:!1})}onBeforeRender({state,object}){const{follow,lockX,lockY,lockZ}=this.get();if(!follow)return;const prevRotation=object.rotation.clone();state.camera.getWorldQuaternion(object.quaternion),lockX&&(object.rotation.x=prevRotation.x),lockY&&(object.rotation.y=prevRotation.y),lockZ&&(object.rotation.z=prevRotation.z)}}(angular_three_soba_abstractions_class=NgtsBillboard).ɵfac=function(){let ɵ_class_BaseFactory;return function _class_Factory(t){return(ɵ_class_BaseFactory||(ɵ_class_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_soba_abstractions_class)))(t||angular_three_soba_abstractions_class)}}(),angular_three_soba_abstractions_class.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_soba_abstractions_class,selectors:[["ngts-billboard"]],inputs:{billboardRef:"billboardRef",follow:"follow",lockX:"lockX",lockY:"lockY",lockZ:"lockZ"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],ngContentSelectors:angular_three_soba_abstractions_c0,decls:2,vars:1,consts:[["ngtCompound","",3,"ref","beforeRender"]],template:function _class_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-group",0),core["ɵɵlistener"]("beforeRender",(function _class_Template_ngt_group_beforeRender_0_listener($event){return ctx.onBeforeRender($event)})),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("ref",ctx.billboardRef)},encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsBillboard,[{type:core.Component,args:[{selector:"ngts-billboard",standalone:!0,template:'\n        <ngt-group ngtCompound [ref]="billboardRef" (beforeRender)="onBeforeRender($any($event))">\n            <ng-content />\n        </ngt-group>\n    ',schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{billboardRef:[{type:core.Input}],follow:[{type:core.Input}],lockX:[{type:core.Input}],lockY:[{type:core.Input}],lockZ:[{type:core.Input}]});class NgtsLineInput extends angular_three.A7{set vertexColors(vertexColors){this.set({vertexColors})}set lineWidth(lineWidth){this.set({lineWidth})}set alphaToCoverage(alphaToCoverage){this.set({alphaToCoverage})}set color(color){this.set({color})}set dashed(dashed){this.set({dashed})}set dashScale(dashScale){this.set({dashScale})}set dashSize(dashSize){this.set({dashSize})}set dashOffset(dashOffset){this.set({dashOffset})}set gapSize(gapSize){this.set({gapSize})}set resolution(resolution){this.set({resolution})}set wireframe(wireframe){this.set({wireframe})}set worldUnits(worldUnits){this.set({worldUnits})}initialize(){super.initialize(),this.set({color:"black"})}}(angular_three_soba_abstractions_class2=NgtsLineInput).ɵfac=function(){let ɵ_class2_BaseFactory;return function _class2_Factory(t){return(ɵ_class2_BaseFactory||(ɵ_class2_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_soba_abstractions_class2)))(t||angular_three_soba_abstractions_class2)}}(),angular_three_soba_abstractions_class2.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_soba_abstractions_class2,inputs:{vertexColors:"vertexColors",lineWidth:"lineWidth",alphaToCoverage:"alphaToCoverage",color:"color",dashed:"dashed",dashScale:"dashScale",dashSize:"dashSize",dashOffset:"dashOffset",gapSize:"gapSize",resolution:"resolution",wireframe:"wireframe",worldUnits:"worldUnits"},features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsLineInput,[{type:core.Directive}],null,{vertexColors:[{type:core.Input}],lineWidth:[{type:core.Input}],alphaToCoverage:[{type:core.Input}],color:[{type:core.Input}],dashed:[{type:core.Input}],dashScale:[{type:core.Input}],dashSize:[{type:core.Input}],dashOffset:[{type:core.Input}],gapSize:[{type:core.Input}],resolution:[{type:core.Input}],wireframe:[{type:core.Input}],worldUnits:[{type:core.Input}]});class NgtsLine extends NgtsLineInput{constructor(){super(...arguments),this.Boolean=Boolean,this.lineMaterial=new LineMaterial,this.store=(0,core.inject)(angular_three.W7),this.line=null,this.lineRef=(0,angular_three.Lv)()}set points(points){this.set({points})}set segments(segments){this.set({segments})}onAfterAttach({parent}){parent.computeLineDistances()}initialize(){super.initialize(),this.set({segments:!1}),this.connect("lineGeometry",(0,observable_combineLatest.a)([this.select("points"),this.select("segments"),this.select("vertexColors").pipe((0,angular_three.Xb)())]).pipe((0,operators_map.U)((([points,segments,vertexColors])=>{const geometry=segments?new LineSegmentsGeometry:new LineGeometry,pValues=points.map((p=>{const isArray=Array.isArray(p);return p instanceof three_module.Vector3?[p.x,p.y,p.z]:p instanceof three_module.Vector2?[p.x,p.y,0]:isArray&&3===p.length?[p[0],p[1],p[2]]:isArray&&2===p.length?[p[0],p[1],0]:p}));if(geometry.setPositions(pValues.flat()),vertexColors){const cValues=vertexColors.map((c=>c instanceof three_module.Color?c.toArray():c));geometry.setColors(cValues.flat())}return geometry}))))}ngOnInit(){this.connect("materialResolution",(0,observable_combineLatest.a)([this.store.select("size"),this.select("resolution").pipe((0,angular_three.Xb)())]).pipe((0,operators_map.U)((([size,resolution])=>resolution??[size.width,size.height])))),this.line=this.get("segments")?new LineSegments2:new Line2,this.disposeGeometry()}disposeGeometry(){this.effect(this.select("lineGeometry"),(lineGeometry=>()=>lineGeometry.dispose()))}}(angular_three_soba_abstractions_class3=NgtsLine).ɵfac=function(){let ɵ_class3_BaseFactory;return function _class3_Factory(t){return(ɵ_class3_BaseFactory||(ɵ_class3_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_soba_abstractions_class3)))(t||angular_three_soba_abstractions_class3)}}(),angular_three_soba_abstractions_class3.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_soba_abstractions_class3,selectors:[["ngts-line","points",""]],inputs:{lineRef:"lineRef",points:"points",segments:"segments"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:angular_three_soba_abstractions_c1,decls:1,vars:3,consts:[["ngtCompound","",3,"ref",4,"args"],["ngtCompound","",3,"ref"],["attach","geometry",3,"afterAttach",4,"args"],["attach","material",3,"color","vertexColors","resolution","linewidth","alphaToCoverage","dashed","dashScale","dashSize","dashOffset","gapSize","wireframe","worldUnits",4,"args"],["attach","geometry",3,"afterAttach"],["attach","material",3,"color","vertexColors","resolution","linewidth","alphaToCoverage","dashed","dashScale","dashSize","dashOffset","gapSize","wireframe","worldUnits"]],template:function _class3_Template(rf,ctx){1&rf&&core["ɵɵtemplate"](0,_class3_ngt_primitive_0_Template,3,7,"ngt-primitive",0),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,_c2,ctx.line))},dependencies:[angular_three.Bj],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsLine,[{type:core.Component,args:[{selector:"ngts-line[points]",standalone:!0,template:'\n        <ngt-primitive *args="[line]" [ref]="lineRef" ngtCompound>\n            <ngt-primitive\n                *args="[get(\'lineGeometry\')]"\n                attach="geometry"\n                (afterAttach)="onAfterAttach($any($event))"\n            />\n            <ngt-primitive\n                *args="[lineMaterial]"\n                attach="material"\n                [color]="get(\'color\')"\n                [vertexColors]="Boolean(get(\'vertexColors\'))"\n                [resolution]="get(\'materialResolution\')"\n                [linewidth]="get(\'lineWidth\')"\n                [alphaToCoverage]="get(\'alphaToCoverage\')"\n                [dashed]="get(\'dashed\')"\n                [dashScale]="get(\'dashScale\') ?? lineMaterial.dashScale"\n                [dashSize]="get(\'dashSize\') ?? lineMaterial.dashSize"\n                [dashOffset]="get(\'dashOffset\') ?? lineMaterial.dashOffset"\n                [gapSize]="get(\'gapSize\') ?? lineMaterial.gapSize"\n                [wireframe]="get(\'wireframe\') ?? lineMaterial.wireframe"\n                [worldUnits]="get(\'worldUnits\')"\n            />\n        </ngt-primitive>\n    ',imports:[angular_three.Bj],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{lineRef:[{type:core.Input}],points:[{type:core.Input}],segments:[{type:core.Input}]});class NgtsCatmullRomLine extends NgtsLineInput{constructor(){super(...arguments),this.lineRef=(0,angular_three.Lv)()}set points(points){this.set({points})}set closed(closed){this.set({closed})}set curveType(curveType){this.set({curveType})}set tension(tension){this.set({tension})}set segments(segments){this.set({segments})}initialize(){super.initialize(),this.set({closed:!1,curveType:"centripetal",tension:.5,segments:64}),this.connect("curve",(0,observable_combineLatest.a)([this.select("points"),this.select("closed"),this.select("curveType"),this.select("tension")]).pipe((0,operators_map.U)((([points,closed,curveType,tension])=>{const mappedPoints=points.map((p=>p instanceof three_module.Vector3?p:new three_module.Vector3(...p)));return new three_module.CatmullRomCurve3(mappedPoints,closed,curveType,tension)})))),this.connect("segmentedPoints",(0,observable_combineLatest.a)([this.select("curve"),this.select("segments")]).pipe((0,operators_map.U)((([curve,segments])=>curve.getPoints(segments))))),this.connect("interpolatedVertexColors",(0,observable_combineLatest.a)([this.select("vertexColors").pipe((0,angular_three.Xb)()),this.select("segments")]).pipe((0,operators_map.U)((([vertexColors,segments])=>{if(!vertexColors||vertexColors.length<2)return;if(vertexColors.length===segments+1)return vertexColors;const mappedColors=vertexColors.map((color=>color instanceof three_module.Color?color:new three_module.Color(...color)));this.get("closed")&&mappedColors.push(mappedColors[0].clone());const iColors=[mappedColors[0]],divisions=segments/(mappedColors.length-1);for(let i=0;i<segments;i++){const alpha=i%divisions/divisions,colorIndex=Math.floor(i/divisions);iColors.push(mappedColors[colorIndex].clone().lerp(mappedColors[colorIndex+1],alpha))}iColors.push(mappedColors[mappedColors.length-1])}))))}}(angular_three_soba_abstractions_class4=NgtsCatmullRomLine).ɵfac=function(){let ɵ_class4_BaseFactory;return function _class4_Factory(t){return(ɵ_class4_BaseFactory||(ɵ_class4_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_soba_abstractions_class4)))(t||angular_three_soba_abstractions_class4)}}(),angular_three_soba_abstractions_class4.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_soba_abstractions_class4,selectors:[["ngts-catmull-rom-line","points",""]],inputs:{lineRef:"lineRef",points:"points",closed:"closed",curveType:"curveType",tension:"tension",segments:"segments"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:angular_three_soba_abstractions_c1,decls:1,vars:14,consts:[[3,"lineRef","points","color","vertexColors","resolution","lineWidth","alphaToCoverage","dashed","dashScale","dashOffset","dashSize","gapSize","wireframe","worldUnits"]],template:function _class4_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngts-line",0),2&rf&&core["ɵɵproperty"]("lineRef",ctx.lineRef)("points",ctx.get("segmentedPoints"))("color",ctx.get("color"))("vertexColors",ctx.get("interpolatedVertexColors"))("resolution",ctx.get("resolution"))("lineWidth",ctx.get("lineWidth"))("alphaToCoverage",ctx.get("alphaToCoverage"))("dashed",ctx.get("dashed"))("dashScale",ctx.get("dashScale"))("dashOffset",ctx.get("dashOffset"))("dashSize",ctx.get("dashSize"))("gapSize",ctx.get("gapSize"))("wireframe",ctx.get("wireframe"))("worldUnits",ctx.get("worldUnits"))},dependencies:[NgtsLine],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCatmullRomLine,[{type:core.Component,args:[{selector:"ngts-catmull-rom-line[points]",standalone:!0,template:'\n        <ngts-line\n            [lineRef]="lineRef"\n            [points]="get(\'segmentedPoints\')"\n            [color]="get(\'color\')"\n            [vertexColors]="get(\'interpolatedVertexColors\')"\n            [resolution]="get(\'resolution\')"\n            [lineWidth]="get(\'lineWidth\')"\n            [alphaToCoverage]="get(\'alphaToCoverage\')"\n            [dashed]="get(\'dashed\')"\n            [dashScale]="get(\'dashScale\')"\n            [dashOffset]="get(\'dashOffset\')"\n            [dashSize]="get(\'dashSize\')"\n            [gapSize]="get(\'gapSize\')"\n            [wireframe]="get(\'wireframe\')"\n            [worldUnits]="get(\'worldUnits\')"\n        />\n    ',imports:[NgtsLine],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{lineRef:[{type:core.Input}],points:[{type:core.Input}],closed:[{type:core.Input}],curveType:[{type:core.Input}],tension:[{type:core.Input}],segments:[{type:core.Input}]});class NgtsCubicBezierLine extends NgtsLineInput{constructor(){super(...arguments),this.lineRef=(0,angular_three.Lv)()}set start(start){this.set({start})}set end(end){this.set({end})}set midA(midA){this.set({midA})}set midB(midB){this.set({midB})}set segments(segments){this.set({segments})}initialize(){super.initialize(),this.set({segments:10}),this.connect("points",this.select(["start","end","midA","midB","segments"],(({start,end,midA,midB,segments})=>{const startV=start instanceof three_module.Vector3?start:new three_module.Vector3(...start),endV=end instanceof three_module.Vector3?end:new three_module.Vector3(...end),midAV=midA instanceof three_module.Vector3?midA:new three_module.Vector3(...midA),midBV=midB instanceof three_module.Vector3?midB:new three_module.Vector3(...midB);return new three_module.CubicBezierCurve3(startV,midAV,midBV,endV).getPoints(segments)})))}}(angular_three_soba_abstractions_class5=NgtsCubicBezierLine).ɵfac=function(){let ɵ_class5_BaseFactory;return function _class5_Factory(t){return(ɵ_class5_BaseFactory||(ɵ_class5_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_soba_abstractions_class5)))(t||angular_three_soba_abstractions_class5)}}(),angular_three_soba_abstractions_class5.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_soba_abstractions_class5,selectors:[["ngts-cubic-bezier-line","start","","end","","midA","","midB",""]],inputs:{lineRef:"lineRef",start:"start",end:"end",midA:"midA",midB:"midB",segments:"segments"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:["start","","end","","midA","","midB",""],decls:1,vars:14,consts:[[3,"lineRef","points","color","vertexColors","resolution","lineWidth","alphaToCoverage","dashed","dashScale","dashSize","dashOffset","gapSize","wireframe","worldUnits"]],template:function _class5_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngts-line",0),2&rf&&core["ɵɵproperty"]("lineRef",ctx.lineRef)("points",ctx.get("points"))("color",ctx.get("color"))("vertexColors",ctx.get("vertexColors"))("resolution",ctx.get("resolution"))("lineWidth",ctx.get("lineWidth"))("alphaToCoverage",ctx.get("alphaToCoverage"))("dashed",ctx.get("dashed"))("dashScale",ctx.get("dashScale"))("dashSize",ctx.get("dashSize"))("dashOffset",ctx.get("dashOffset"))("gapSize",ctx.get("gapSize"))("wireframe",ctx.get("wireframe"))("worldUnits",ctx.get("worldUnits"))},dependencies:[NgtsLine],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCubicBezierLine,[{type:core.Component,args:[{selector:"ngts-cubic-bezier-line[start][end][midA][midB]",standalone:!0,template:'\n        <ngts-line\n            [lineRef]="lineRef"\n            [points]="get(\'points\')"\n            [color]="get(\'color\')"\n            [vertexColors]="get(\'vertexColors\')"\n            [resolution]="get(\'resolution\')"\n            [lineWidth]="get(\'lineWidth\')"\n            [alphaToCoverage]="get(\'alphaToCoverage\')"\n            [dashed]="get(\'dashed\')"\n            [dashScale]="get(\'dashScale\')"\n            [dashSize]="get(\'dashSize\')"\n            [dashOffset]="get(\'dashOffset\')"\n            [gapSize]="get(\'gapSize\')"\n            [wireframe]="get(\'wireframe\')"\n            [worldUnits]="get(\'worldUnits\')"\n        />\n    ',imports:[NgtsLine,common.NgIf],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{lineRef:[{type:core.Input}],start:[{type:core.Input}],end:[{type:core.Input}],midA:[{type:core.Input}],midB:[{type:core.Input}],segments:[{type:core.Input}]}),(0,angular_three.l7)({LineSegments:three_module.LineSegments,LineBasicMaterial:three_module.LineBasicMaterial});class NgtsEdges extends angular_three.A7{constructor(){super(...arguments),this.edgesRef=(0,angular_three.Lv)(),this.withChildren=!1,this.noop=()=>null}set threshold(threshold){this.set({threshold})}set color(color){this.set({color})}set geometry(geometry){this.set({geometry})}set userData(userData){this.set({userData})}initialize(){super.initialize(),this.set({threshold:15,color:"black",userData:{}})}ngOnInit(){this.setupGeometry()}setupGeometry(){this.hold(this.edgesRef.$,(segments=>{const parent=segments.parent;if(parent){const geom=this.get("geometry")||parent.geometry,threshold=this.get("threshold");geom===segments.userData.currentGeom&&threshold===segments.userData.currentThreshold||(segments.userData.currentGeom=geom,segments.userData.currentThreshold=threshold,segments.geometry=new three_module.EdgesGeometry(geom,threshold))}}))}}(_class6=NgtsEdges).ɵfac=function(){let ɵ_class6_BaseFactory;return function _class6_Factory(t){return(ɵ_class6_BaseFactory||(ɵ_class6_BaseFactory=core["ɵɵgetInheritedFactory"](_class6)))(t||_class6)}}(),_class6.ɵcmp=core["ɵɵdefineComponent"]({type:_class6,selectors:[["ngts-edges"]],inputs:{edgesRef:"edgesRef",threshold:"threshold",color:"color",geometry:"geometry",userData:"userData",withChildren:"withChildren"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],ngContentSelectors:angular_three_soba_abstractions_c0,decls:4,vars:4,consts:[["ngtCompound","",3,"ref","raycast"],[4,"ngIf","ngIfElse"],["noChildren",""],[3,"color"]],template:function _class6_Template(rf,ctx){if(1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-line-segments",0),core["ɵɵtemplate"](1,_class6_ng_container_1_Template,2,0,"ng-container",1),core["ɵɵtemplate"](2,_class6_ng_template_2_Template,1,1,"ng-template",null,2,core["ɵɵtemplateRefExtractor"]),core["ɵɵelementEnd"]()),2&rf){const _r1=core["ɵɵreference"](3);core["ɵɵproperty"]("ref",ctx.edgesRef)("raycast",ctx.noop),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngIf",ctx.withChildren)("ngIfElse",_r1)}},dependencies:[common.NgIf],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsEdges,[{type:core.Component,args:[{selector:"ngts-edges",standalone:!0,template:'\n        <ngt-line-segments [ref]="edgesRef" [raycast]="noop" ngtCompound>\n            <ng-container *ngIf="withChildren; else noChildren">\n                <ng-content />\n            </ng-container>\n            <ng-template #noChildren>\n                <ngt-line-basic-material [color]="color" />\n            </ng-template>\n        </ngt-line-segments>\n    ',imports:[common.NgIf],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{edgesRef:[{type:core.Input}],threshold:[{type:core.Input}],color:[{type:core.Input}],geometry:[{type:core.Input}],userData:[{type:core.Input}],withChildren:[{type:core.Input}]});const NGTS_GIZMO_HELPER_API=new core.InjectionToken("NgtsGizmoHelper API");function gizmoHelperApiFactory(gizmo){const store=(0,core.inject)(angular_three.W7);return{tweenCamera:direction=>{const{controls,camera,invalidate}=store.get(),defaultControls=controls;gizmo.animating=!0,defaultControls&&(gizmo.focusPoint=defaultControls.target),gizmo.radius=camera.position.distanceTo(gizmo.target),gizmo.q1.copy(camera.quaternion),gizmo.targetPosition.copy(direction).multiplyScalar(gizmo.radius).add(gizmo.target),gizmo.dummy.lookAt(gizmo.targetPosition),gizmo.q2.copy(gizmo.dummy.quaternion),invalidate()}}}(0,angular_three.l7)({Group:three_module.Group});class NgtsGizmoHelperContent{}(_class7=NgtsGizmoHelperContent).ɵfac=function _class7_Factory(t){return new(t||_class7)},_class7.ɵdir=core["ɵɵdefineDirective"]({type:_class7,selectors:[["ng-template","ngtsGizmoHelperContent",""]],standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoHelperContent,[{type:core.Directive,args:[{selector:"ng-template[ngtsGizmoHelperContent]",standalone:!0}]}],null,null);class NgtsGizmoHelper extends angular_three.A7{constructor(){super(...arguments),this.store=(0,core.inject)(angular_three.W7),this.gizmoRef=(0,angular_three.Lv)(),this.virtualCameraRef=(0,angular_three.Lv)(),this.animating=!1,this.radius=0,this.focusPoint=new three_module.Vector3(0,0,0),this.q1=new three_module.Quaternion,this.q2=new three_module.Quaternion,this.target=new three_module.Vector3,this.targetPosition=new three_module.Vector3,this.dummy=new three_module.Object3D,this.defaultUp=new three_module.Vector3(0,0,0),this.turnRate=2*Math.PI,this.matrix=new three_module.Matrix4,this.updated=new core.EventEmitter}set alignment(alignment){this.set({alignment})}set margin(margin){this.set({margin})}set renderPriority(renderPriority){this.set({renderPriority})}set autoClear(autoClear){this.set({autoClear})}initialize(){super.initialize(),this.set({alignment:"bottom-right",margin:[80,80],renderPriority:1})}ngOnInit(){this.updateDefaultUp(),this.setGizmoPosition()}onBeforeRender(delta){if(this.virtualCameraRef.nativeElement&&this.gizmoRef.nativeElement){const{controls,camera:mainCamera,invalidate}=this.store.get(),defaultControls=controls;if(this.animating)if(this.q1.angleTo(this.q2)<.01)this.animating=!1,(controls=>"minPolarAngle"in controls)(defaultControls)&&mainCamera.up.copy(this.defaultUp);else{const step=delta*this.turnRate;this.q1.rotateTowards(this.q2,step),mainCamera.position.set(0,0,1).applyQuaternion(this.q1).multiplyScalar(this.radius).add(this.focusPoint),mainCamera.up.set(0,1,0).applyQuaternion(this.q1).normalize(),mainCamera.quaternion.copy(this.q1),this.updated.observed?this.updated.emit():defaultControls&&defaultControls.update(),invalidate()}this.matrix.copy(mainCamera.matrix).invert(),this.gizmoRef.nativeElement.quaternion.setFromRotationMatrix(this.matrix)}}setGizmoPosition(){this.connect("gizmoPosition",(0,observable_combineLatest.a)([this.store.select("size"),(0,observable_combineLatest.a)({alignment:this.select("alignment"),margin:this.select("margin")})]).pipe((0,operators_map.U)((([size,{alignment,margin}])=>{const[marginX,marginY]=margin;return[alignment.endsWith("-center")?0:alignment.endsWith("-left")?-size.width/2+marginX:size.width/2-marginX,alignment.startsWith("center-")?0:alignment.startsWith("top-")?size.height/2-marginY:-size.height/2+marginY,0]}))))}updateDefaultUp(){this.hold(this.store.select("camera"),(camera=>{this.defaultUp.copy(camera.up)}))}}(_class8=NgtsGizmoHelper).ɵfac=function(){let ɵ_class8_BaseFactory;return function _class8_Factory(t){return(ɵ_class8_BaseFactory||(ɵ_class8_BaseFactory=core["ɵɵgetInheritedFactory"](_class8)))(t||_class8)}}(),_class8.ɵcmp=core["ɵɵdefineComponent"]({type:_class8,selectors:[["ngts-gizmo-helper"]],contentQueries:function _class8_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,NgtsGizmoHelperContent,7,core.TemplateRef),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.gizmoHelperContent=_t.first)}},inputs:{alignment:"alignment",margin:"margin",renderPriority:"renderPriority",autoClear:"autoClear"},outputs:{updated:"updated"},standalone:!0,features:[core["ɵɵProvidersFeature"]([{provide:NGTS_GIZMO_HELPER_API,useFactory:gizmoHelperApiFactory,deps:[_class8]}]),core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:2,vars:1,consts:[[3,"renderPriority"],["ngtPortalContent",""],[3,"cameraRef","makeDefault","position"],[3,"ref","position","beforeRender"],[4,"ngTemplateOutlet"]],template:function _class8_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-portal",0),core["ɵɵtemplate"](1,_class8_ng_template_1_Template,3,7,"ng-template",1),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("renderPriority",ctx.get("renderPriority"))},dependencies:[angular_three.WS,angular_three.ZQ,NgtsOrthographicCamera,common.NgTemplateOutlet],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoHelper,[{type:core.Component,args:[{selector:"ngts-gizmo-helper",standalone:!0,template:'\n        <ngt-portal [renderPriority]="get(\'renderPriority\')">\n            <ng-template ngtPortalContent>\n                <ngts-orthographic-camera\n                    [cameraRef]="virtualCameraRef"\n                    [makeDefault]="true"\n                    [position]="[0, 0, 200]"\n                />\n                <ngt-group\n                    [ref]="gizmoRef"\n                    [position]="get(\'gizmoPosition\')"\n                    (beforeRender)="onBeforeRender($any($event).state.delta)"\n                >\n                    <ng-container *ngTemplateOutlet="gizmoHelperContent" />\n                </ngt-group>\n            </ng-template>\n        </ngt-portal>\n    ',imports:[angular_three.WS,angular_three.ZQ,NgtsOrthographicCamera,common.NgTemplateOutlet],providers:[{provide:NGTS_GIZMO_HELPER_API,useFactory:gizmoHelperApiFactory,deps:[NgtsGizmoHelper]}],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{alignment:[{type:core.Input}],margin:[{type:core.Input}],renderPriority:[{type:core.Input}],autoClear:[{type:core.Input}],updated:[{type:core.Output}],gizmoHelperContent:[{type:core.ContentChild,args:[NgtsGizmoHelperContent,{static:!0,read:core.TemplateRef}]}]});const colors_bg="#f0f0f0",colors_hover="#999",colors_text="black",colors_stroke="black",defaultFaces=["Right","Left","Top","Bottom","Front","Back"],makePositionVector=xyz=>new three_module.Vector3(...xyz).multiplyScalar(.38),corners=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(makePositionVector),cornerDimensions=[.25,.25,.25],edges=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(makePositionVector),edgeDimensions=edges.map((edge=>edge.toArray().map((axis=>0==axis?.5:.25))));class NgtsGizmoViewcubeInputs extends angular_three.A7{constructor(){super(...arguments),this.store=(0,core.inject)(angular_three.W7)}set opacity(opacity){this.set({opacity})}set hoverColor(hoverColor){this.set({hoverColor})}set textColor(textColor){this.set({textColor})}set strokeColor(strokeColor){this.set({strokeColor})}set faces(faces){this.set({faces})}set clickEmitter(clickEmitter){this.set({clickEmitter})}}(_class9=NgtsGizmoViewcubeInputs).ɵfac=function(){let ɵ_class9_BaseFactory;return function _class9_Factory(t){return(ɵ_class9_BaseFactory||(ɵ_class9_BaseFactory=core["ɵɵgetInheritedFactory"](_class9)))(t||_class9)}}(),_class9.ɵdir=core["ɵɵdefineDirective"]({type:_class9,inputs:{opacity:"opacity",hoverColor:"hoverColor",textColor:"textColor",strokeColor:"strokeColor",faces:"faces",clickEmitter:"clickEmitter"},features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewcubeInputs,[{type:core.Directive}],null,{opacity:[{type:core.Input}],hoverColor:[{type:core.Input}],textColor:[{type:core.Input}],strokeColor:[{type:core.Input}],faces:[{type:core.Input}],clickEmitter:[{type:core.Input}]}),(0,angular_three.l7)({Mesh:three_module.Mesh,BoxGeometry:three_module.BoxGeometry,MeshBasicMaterial:three_module.MeshBasicMaterial});class NgtsGizmoViewcubeEdgeCube extends NgtsGizmoViewcubeInputs{constructor(){super(...arguments),this.gizmoHelperApi=(0,core.inject)(NGTS_GIZMO_HELPER_API),this.hover=!1}set dimensions(dimensions){this.set({dimensions})}set position(position){this.set({position})}initialize(){super.initialize(),this.set({hoverColor:colors_hover})}onPointerMove(event){event.stopPropagation(),this.hover=!0}onPointerOut(event){event.stopPropagation(),this.hover=!1}onClick(event){this.get("clickEmitter")?.observed?this.get("clickEmitter").emit(event):(event.stopPropagation(),this.gizmoHelperApi.tweenCamera(this.get("position")))}}(_class10=NgtsGizmoViewcubeEdgeCube).ɵfac=function(){let ɵ_class10_BaseFactory;return function _class10_Factory(t){return(ɵ_class10_BaseFactory||(ɵ_class10_BaseFactory=core["ɵɵgetInheritedFactory"](_class10)))(t||_class10)}}(),_class10.ɵcmp=core["ɵɵdefineComponent"]({type:_class10,selectors:[["ngts-gizmo-viewcube-edge-cube","dimensions","","position",""]],inputs:{dimensions:"dimensions",position:"position"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:["dimensions","","position",""],decls:3,vars:7,consts:[[3,"scale","position","pointermove","pointerout","click"],[4,"args"],[3,"color","transparent","opacity","visible"]],template:function _class10_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-mesh",0),core["ɵɵlistener"]("pointermove",(function _class10_Template_ngt_mesh_pointermove_0_listener($event){return ctx.onPointerMove($event)}))("pointerout",(function _class10_Template_ngt_mesh_pointerout_0_listener($event){return ctx.onPointerOut($event)}))("click",(function _class10_Template_ngt_mesh_click_0_listener($event){return ctx.onClick($event)})),core["ɵɵtemplate"](1,_class10_ngt_box_geometry_1_Template,1,0,"ngt-box-geometry",1),core["ɵɵelement"](2,"ngt-mesh-basic-material",2),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("scale",1.01)("position",ctx.get("position")),core["ɵɵadvance"](1),core["ɵɵproperty"]("args",ctx.get("dimensions")),core["ɵɵadvance"](1),core["ɵɵproperty"]("color",ctx.hover?ctx.get("hoverColor"):"white")("transparent",!0)("opacity",.6)("visible",ctx.hover))},dependencies:[angular_three.Bj],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewcubeEdgeCube,[{type:core.Component,args:[{selector:"ngts-gizmo-viewcube-edge-cube[dimensions][position]",standalone:!0,template:'\n        <ngt-mesh\n            [scale]="1.01"\n            [position]="get(\'position\')"\n            (pointermove)="onPointerMove($any($event))"\n            (pointerout)="onPointerOut($any($event))"\n            (click)="onClick($any($event))"\n        >\n            <ngt-box-geometry *args="get(\'dimensions\')" />\n            <ngt-mesh-basic-material\n                [color]="hover ? get(\'hoverColor\') : \'white\'"\n                [transparent]="true"\n                [opacity]="0.6"\n                [visible]="hover"\n            />\n        </ngt-mesh>\n    ',imports:[angular_three.Bj],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{dimensions:[{type:core.Input}],position:[{type:core.Input}]}),(0,angular_three.l7)({MeshLambertMaterial:three_module.MeshLambertMaterial,Mesh:three_module.Mesh,BoxGeometry:three_module.BoxGeometry});class NgtsGizmoViewcubeFaceMaterial extends NgtsGizmoViewcubeInputs{constructor(){super(...arguments),this.document=(0,core.inject)(common.DOCUMENT)}set index(index){this.set({index})}set hover(hover){this.set({hover})}set font(font){this.set({font})}set color(color){this.set({color})}initialize(){super.initialize(),this.set({font:"20px Inter var, Arial, sans-serif",faces:defaultFaces,color:colors_bg,hoverColor:colors_hover,textColor:colors_text,strokeColor:colors_stroke,opacity:1}),this.connect("texture",this.select(["index","faces","color","font","textColor","strokeColor"],(({index,faces,color,font,textColor,strokeColor})=>{const canvas=this.document.createElement("canvas");canvas.width=128,canvas.height=128;const context=canvas.getContext("2d");return context.fillStyle=color,context.fillRect(0,0,canvas.width,canvas.height),context.strokeStyle=strokeColor,context.strokeRect(0,0,canvas.width,canvas.height),context.font=font,context.textAlign="center",context.fillStyle=textColor,context.fillText(faces[index].toUpperCase(),64,76),new three_module.CanvasTexture(canvas)})))}}(_class11=NgtsGizmoViewcubeFaceMaterial).ɵfac=function(){let ɵ_class11_BaseFactory;return function _class11_Factory(t){return(ɵ_class11_BaseFactory||(ɵ_class11_BaseFactory=core["ɵɵgetInheritedFactory"](_class11)))(t||_class11)}}(),_class11.ɵcmp=core["ɵɵdefineComponent"]({type:_class11,selectors:[["ngts-gizmo-viewcube-face-material","hover","","index",""]],inputs:{index:"index",hover:"hover",font:"font",color:"color"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:["hover","","index",""],decls:3,vars:9,consts:[[3,"attach","map","color","opacity","transparent"],["attach","map.encoding",3,"rawValue"],["attach","map.anisotrophy",3,"rawValue"]],template:function _class11_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-mesh-lambert-material",0),core["ɵɵelement"](1,"ngt-value",1)(2,"ngt-value",2),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("attach",core["ɵɵpureFunction1"](7,_c7,ctx.get("index")))("map",ctx.get("texture"))("color",ctx.get("hover")?ctx.get("hoverColor"):ctx.get("color"))("opacity",ctx.get("opacity"))("transparent",!0),core["ɵɵadvance"](1),core["ɵɵproperty"]("rawValue",ctx.store.get("gl").outputEncoding),core["ɵɵadvance"](1),core["ɵɵproperty"]("rawValue",ctx.store.get("gl").capabilities.getMaxAnisotropy()||1))},encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewcubeFaceMaterial,[{type:core.Component,args:[{selector:"ngts-gizmo-viewcube-face-material[hover][index]",standalone:!0,template:"\n        <ngt-mesh-lambert-material\n            [attach]=\"['material', get('index')]\"\n            [map]=\"get('texture')\"\n            [color]=\"get('hover') ? get('hoverColor') : get('color')\"\n            [opacity]=\"get('opacity')\"\n            [transparent]=\"true\"\n        >\n            <ngt-value [rawValue]=\"store.get('gl').outputEncoding\" attach=\"map.encoding\" />\n            <ngt-value [rawValue]=\"store.get('gl').capabilities.getMaxAnisotropy() || 1\" attach=\"map.anisotrophy\" />\n        </ngt-mesh-lambert-material>\n    ",schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{index:[{type:core.Input}],hover:[{type:core.Input}],font:[{type:core.Input}],color:[{type:core.Input}]});class NgtsGizmoViewcubeFaceCube extends NgtsGizmoViewcubeInputs{constructor(){super(...arguments),this.gizmoHelperApi=(0,core.inject)(NGTS_GIZMO_HELPER_API),this.hover=-1}set font(font){this.set({font})}set color(color){this.set({color})}onPointerMove(event){event.stopPropagation(),this.hover=Math.floor(event.faceIndex/2)}onPointerOut(event){event.stopPropagation(),this.hover=-1}onClick(event){this.get("clickEmitter")?.observed?this.get("clickEmitter").emit(event):(event.stopPropagation(),this.gizmoHelperApi.tweenCamera(event.face.normal))}}(_class12=NgtsGizmoViewcubeFaceCube).ɵfac=function(){let ɵ_class12_BaseFactory;return function _class12_Factory(t){return(ɵ_class12_BaseFactory||(ɵ_class12_BaseFactory=core["ɵɵgetInheritedFactory"](_class12)))(t||_class12)}}(),_class12.ɵcmp=core["ɵɵdefineComponent"]({type:_class12,selectors:[["ngts-gizmo-viewcube-face-cube"]],inputs:{font:"font",color:"color"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:3,vars:1,consts:[[3,"pointermove","pointerout","click"],[3,"hover","index","font","color","opacity","hoverColor","textColor","strokeColor","faces",4,"ngFor","ngForRepeat"],[3,"hover","index","font","color","opacity","hoverColor","textColor","strokeColor","faces"]],template:function _class12_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-mesh",0),core["ɵɵlistener"]("pointermove",(function _class12_Template_ngt_mesh_pointermove_0_listener($event){return ctx.onPointerMove($event)}))("pointerout",(function _class12_Template_ngt_mesh_pointerout_0_listener($event){return ctx.onPointerOut($event)}))("click",(function _class12_Template_ngt_mesh_click_0_listener($event){return ctx.onClick($event)})),core["ɵɵelement"](1,"ngt-box-geometry"),core["ɵɵtemplate"](2,_class12_ngts_gizmo_viewcube_face_material_2_Template,1,9,"ngts-gizmo-viewcube-face-material",1),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵadvance"](2),core["ɵɵproperty"]("ngForRepeat",6))},dependencies:[NgtsGizmoViewcubeFaceMaterial,angular_three.l3],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewcubeFaceCube,[{type:core.Component,args:[{selector:"ngts-gizmo-viewcube-face-cube",standalone:!0,template:'\n        <ngt-mesh\n            (pointermove)="onPointerMove($any($event))"\n            (pointerout)="onPointerOut($any($event))"\n            (click)="onClick($any($event))"\n        >\n            <ngt-box-geometry />\n            <ngts-gizmo-viewcube-face-material\n                *ngFor="let i; repeat: 6"\n                [hover]="hover === i"\n                [index]="i"\n                [font]="get(\'font\')"\n                [color]="get(\'color\')"\n                [opacity]="get(\'opacity\')"\n                [hoverColor]="get(\'hoverColor\')"\n                [textColor]="get(\'textColor\')"\n                [strokeColor]="get(\'strokeColor\')"\n                [faces]="get(\'faces\')"\n            />\n        </ngt-mesh>\n    ',imports:[NgtsGizmoViewcubeFaceMaterial,angular_three.l3],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{font:[{type:core.Input}],color:[{type:core.Input}]}),(0,angular_three.l7)({Group:three_module.Group,AmbientLight:three_module.AmbientLight,PointLight:three_module.PointLight});class NgtsGizmoViewcube extends NgtsGizmoViewcubeInputs{constructor(){super(...arguments),this.edges=edges,this.edgeDimensions=edgeDimensions,this.corners=corners,this.cornerDimensions=cornerDimensions,this.clicked=new core.EventEmitter}set font(font){this.set({font})}set color(color){this.set({color})}}(_class13=NgtsGizmoViewcube).ɵfac=function(){let ɵ_class13_BaseFactory;return function _class13_Factory(t){return(ɵ_class13_BaseFactory||(ɵ_class13_BaseFactory=core["ɵɵgetInheritedFactory"](_class13)))(t||_class13)}}(),_class13.ɵcmp=core["ɵɵdefineComponent"]({type:_class13,selectors:[["ngts-gizmo-viewcube"]],inputs:{font:"font",color:"color"},outputs:{clicked:"clicked"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:6,vars:14,consts:[[3,"scale"],[3,"font","color","opacity","hoverColor","textColor","strokeColor","faces","clickEmitter"],[3,"position","dimensions","font","color","opacity","hoverColor","textColor","strokeColor","faces","clickEmitter",4,"ngFor","ngForOf"],[3,"intensity"],[3,"position","intensity"],[3,"position","dimensions","font","color","opacity","hoverColor","textColor","strokeColor","faces","clickEmitter"]],template:function _class13_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-group",0),core["ɵɵelement"](1,"ngts-gizmo-viewcube-face-cube",1),core["ɵɵtemplate"](2,_class13_ngts_gizmo_viewcube_edge_cube_2_Template,1,10,"ngts-gizmo-viewcube-edge-cube",2),core["ɵɵtemplate"](3,_class13_ngts_gizmo_viewcube_edge_cube_3_Template,1,10,"ngts-gizmo-viewcube-edge-cube",2),core["ɵɵelement"](4,"ngt-ambient-light",3)(5,"ngt-point-light",4),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("scale",60),core["ɵɵadvance"](1),core["ɵɵproperty"]("font",ctx.get("font"))("color",ctx.get("color"))("opacity",ctx.get("opacity"))("hoverColor",ctx.get("hoverColor"))("textColor",ctx.get("textColor"))("strokeColor",ctx.get("strokeColor"))("faces",ctx.get("faces"))("clickEmitter",ctx.clicked),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngForOf",ctx.edges),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngForOf",ctx.corners),core["ɵɵadvance"](1),core["ɵɵproperty"]("intensity",.5),core["ɵɵadvance"](1),core["ɵɵproperty"]("position",10)("intensity",.5))},dependencies:[NgtsGizmoViewcubeEdgeCube,NgtsGizmoViewcubeFaceCube,common.NgFor],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewcube,[{type:core.Component,args:[{selector:"ngts-gizmo-viewcube",standalone:!0,template:'\n        <ngt-group [scale]="60">\n            <ngts-gizmo-viewcube-face-cube\n                [font]="get(\'font\')"\n                [color]="get(\'color\')"\n                [opacity]="get(\'opacity\')"\n                [hoverColor]="get(\'hoverColor\')"\n                [textColor]="get(\'textColor\')"\n                [strokeColor]="get(\'strokeColor\')"\n                [faces]="get(\'faces\')"\n                [clickEmitter]="clicked"\n            />\n\n            <ngts-gizmo-viewcube-edge-cube\n                *ngFor="let edge of edges; let i = index"\n                [position]="edge"\n                [dimensions]="edgeDimensions[i]"\n                [font]="get(\'font\')"\n                [color]="get(\'color\')"\n                [opacity]="get(\'opacity\')"\n                [hoverColor]="get(\'hoverColor\')"\n                [textColor]="get(\'textColor\')"\n                [strokeColor]="get(\'strokeColor\')"\n                [faces]="get(\'faces\')"\n                [clickEmitter]="clicked"\n            />\n\n            <ngts-gizmo-viewcube-edge-cube\n                *ngFor="let corner of corners"\n                [position]="corner"\n                [dimensions]="cornerDimensions"\n                [font]="get(\'font\')"\n                [color]="get(\'color\')"\n                [opacity]="get(\'opacity\')"\n                [hoverColor]="get(\'hoverColor\')"\n                [textColor]="get(\'textColor\')"\n                [strokeColor]="get(\'strokeColor\')"\n                [faces]="get(\'faces\')"\n                [clickEmitter]="clicked"\n            />\n\n            <ngt-ambient-light [intensity]="0.5" />\n            <ngt-point-light [position]="10" [intensity]="0.5" />\n        </ngt-group>\n    ',imports:[NgtsGizmoViewcubeEdgeCube,NgtsGizmoViewcubeFaceCube,common.NgFor],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{font:[{type:core.Input}],color:[{type:core.Input}],clicked:[{type:core.Output}]}),(0,angular_three.l7)({Group:three_module.Group,Mesh:three_module.Mesh,BoxGeometry:three_module.BoxGeometry,MeshBasicMaterial:three_module.MeshBasicMaterial,Sprite:three_module.Sprite,SpriteMaterial:three_module.SpriteMaterial});class NgtsGizmoViewportAxis extends angular_three.A7{set color(color){this.set({color})}set rotation(rotation){this.set({rotation})}set scale(scale){this.set({scale:void 0===scale?this.get("scale"):scale})}initialize(){super.initialize(),this.set({scale:[.8,.05,.05]})}}(_class14=NgtsGizmoViewportAxis).ɵfac=function(){let ɵ_class14_BaseFactory;return function _class14_Factory(t){return(ɵ_class14_BaseFactory||(ɵ_class14_BaseFactory=core["ɵɵgetInheritedFactory"](_class14)))(t||_class14)}}(),_class14.ɵcmp=core["ɵɵdefineComponent"]({type:_class14,selectors:[["ngts-gizmo-viewport-axis","color","","rotation",""]],inputs:{color:"color",rotation:"rotation",scale:"scale"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:["color","","rotation",""],decls:4,vars:6,consts:[[3,"rotation"],[3,"position"],[4,"args"],[3,"color","toneMapped"]],template:function _class14_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-group",0)(1,"ngt-mesh",1),core["ɵɵtemplate"](2,_class14_ngt_box_geometry_2_Template,1,0,"ngt-box-geometry",2),core["ɵɵelement"](3,"ngt-mesh-basic-material",3),core["ɵɵelementEnd"]()()),2&rf&&(core["ɵɵproperty"]("rotation",ctx.get("rotation")),core["ɵɵadvance"](1),core["ɵɵproperty"]("position",core["ɵɵpureFunction0"](5,_c9)),core["ɵɵadvance"](1),core["ɵɵproperty"]("args",ctx.get("scale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("color",ctx.get("color"))("toneMapped",!1))},dependencies:[angular_three.Bj],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewportAxis,[{type:core.Component,args:[{selector:"ngts-gizmo-viewport-axis[color][rotation]",standalone:!0,template:'\n        <ngt-group [rotation]="get(\'rotation\')">\n            <ngt-mesh [position]="[0.4, 0, 0]">\n                <ngt-box-geometry *args="get(\'scale\')" />\n                <ngt-mesh-basic-material [color]="get(\'color\')" [toneMapped]="false" />\n            </ngt-mesh>\n        </ngt-group>\n    ',imports:[angular_three.Bj],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{color:[{type:core.Input}],rotation:[{type:core.Input}],scale:[{type:core.Input}]});class NgtsGizmoViewportAxisHead extends angular_three.A7{constructor(){super(...arguments),this.document=(0,core.inject)(common.DOCUMENT),this.store=(0,core.inject)(angular_three.W7),this.gl=this.store.get("gl")}set arcStyle(arcStyle){this.set({arcStyle})}set label(label){this.set({label})}set labelColor(labelColor){this.set({labelColor})}set axisHeadScale(axisHeadScale){this.set({axisHeadScale})}set disabled(disabled){this.set({disabled})}set font(font){this.set({font})}set clickEmitter(clickEmitter){this.set({clickEmitter})}initialize(){super.initialize(),this.set({axisHeadScale:1,active:!1}),this.connect("texture",(0,observable_combineLatest.a)([this.select("arcStyle"),this.select("labelColor"),this.select("font"),this.select("label").pipe((0,angular_three.Xb)())]).pipe((0,operators_map.U)((([arcStyle,labelColor,font,label])=>{const canvas=this.document.createElement("canvas");canvas.width=64,canvas.height=64;const context=canvas.getContext("2d");return context.beginPath(),context.arc(32,32,16,0,2*Math.PI),context.closePath(),context.fillStyle=arcStyle,context.fill(),label&&(context.font=font,context.textAlign="center",context.fillStyle=labelColor,context.fillText(label,32,41)),new three_module.CanvasTexture(canvas)})))),this.connect("scale",(0,observable_combineLatest.a)([this.select("active"),this.select("axisHeadScale"),this.select("label").pipe((0,angular_three.Xb)())]).pipe((0,operators_map.U)((([active,axisHeadScale,label])=>(label?1:.75)*(active?1.2:1)*axisHeadScale))))}onPointerOver(event){this.get("disabled")||(event.stopPropagation(),this.set({active:!0}))}onPointerOut(event){this.get("disabled")||(this.get("clickEmitter")?.observed?this.get("clickEmitter").emit(event):(event.stopPropagation(),this.set({active:!1})))}}(_class15=NgtsGizmoViewportAxisHead).ɵfac=function(){let ɵ_class15_BaseFactory;return function _class15_Factory(t){return(ɵ_class15_BaseFactory||(ɵ_class15_BaseFactory=core["ɵɵgetInheritedFactory"](_class15)))(t||_class15)}}(),_class15.ɵcmp=core["ɵɵdefineComponent"]({type:_class15,selectors:[["ngts-gizmo-viewport-axis-head"]],inputs:{arcStyle:"arcStyle",label:"label",labelColor:"labelColor",axisHeadScale:"axisHeadScale",disabled:"disabled",font:"font",clickEmitter:"clickEmitter"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:4,vars:7,consts:[["ngtCompound","",3,"scale","pointerover","pointerout"],[3,"map","opacity","alphaTest","toneMapped"],["attach","map.encoding",3,"rawValue"],["attach","map.anisotropy",3,"rawValue"]],template:function _class15_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-sprite",0),core["ɵɵlistener"]("pointerover",(function _class15_Template_ngt_sprite_pointerover_0_listener($event){return ctx.onPointerOver($event)}))("pointerout",(function _class15_Template_ngt_sprite_pointerout_0_listener($event){return ctx.onPointerOut($event)})),core["ɵɵelementStart"](1,"ngt-sprite-material",1),core["ɵɵelement"](2,"ngt-value",2)(3,"ngt-value",3),core["ɵɵelementEnd"]()()),2&rf&&(core["ɵɵproperty"]("scale",ctx.get("scale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("map",ctx.get("texture"))("opacity",ctx.get("label")?1:.75)("alphaTest",.3)("toneMapped",!1),core["ɵɵadvance"](1),core["ɵɵproperty"]("rawValue",ctx.gl.outputEncoding),core["ɵɵadvance"](1),core["ɵɵproperty"]("rawValue",ctx.gl.capabilities.getMaxAnisotropy()||1))},encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewportAxisHead,[{type:core.Component,args:[{selector:"ngts-gizmo-viewport-axis-head",standalone:!0,template:'\n        <ngt-sprite\n            ngtCompound\n            [scale]="get(\'scale\')"\n            (pointerover)="onPointerOver($any($event))"\n            (pointerout)="onPointerOut($any($event))"\n        >\n            <ngt-sprite-material\n                [map]="get(\'texture\')"\n                [opacity]="get(\'label\') ? 1 : 0.75"\n                [alphaTest]="0.3"\n                [toneMapped]="false"\n            >\n                <ngt-value [rawValue]="gl.outputEncoding" attach="map.encoding" />\n                <ngt-value [rawValue]="gl.capabilities.getMaxAnisotropy() || 1" attach="map.anisotropy" />\n            </ngt-sprite-material>\n        </ngt-sprite>\n    ',imports:[angular_three.Bj],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{arcStyle:[{type:core.Input}],label:[{type:core.Input}],labelColor:[{type:core.Input}],axisHeadScale:[{type:core.Input}],disabled:[{type:core.Input}],font:[{type:core.Input}],clickEmitter:[{type:core.Input}]}),(0,angular_three.l7)({Group:three_module.Group,AmbientLight:three_module.AmbientLight,PointLight:three_module.PointLight});class NgtsGizmoViewport extends angular_three.A7{constructor(){super(...arguments),this.gizmoHelperApi=(0,core.inject)(NGTS_GIZMO_HELPER_API),this.Math=Math,this.clicked=new core.EventEmitter}set axisColors(axisColors){this.set({axisColors})}set axisScale(axisScale){this.set({axisScale})}set labels(labels){this.set({labels})}set axisHeadScale(axisHeadScale){this.set({axisHeadScale})}set labelColor(labelColor){this.set({labelColor})}set hideNegativeAxes(hideNegativeAxes){this.set({hideNegativeAxes})}set hideAxisHeads(hideAxisHeads){this.set({hideAxisHeads})}set disabled(disabled){this.set({disabled})}set font(font){this.set({font})}initialize(){super.initialize(),this.set({font:"18px Inter var, Arial, sans-serif",axisColors:["#ff2060","#20df80","#2080ff"],axisHeadScale:1,labels:["X","Y","Z"],labelColor:"#000"})}onPointerDown(event){this.get("disabled")||(event.stopPropagation(),this.gizmoHelperApi.tweenCamera(event.object.position))}}(_class16=NgtsGizmoViewport).ɵfac=function(){let ɵ_class16_BaseFactory;return function _class16_Factory(t){return(ɵ_class16_BaseFactory||(ɵ_class16_BaseFactory=core["ɵɵgetInheritedFactory"](_class16)))(t||_class16)}}(),_class16.ɵcmp=core["ɵɵdefineComponent"]({type:_class16,selectors:[["ngts-gizmo-viewport"]],inputs:{axisColors:"axisColors",axisScale:"axisScale",labels:"labels",axisHeadScale:"axisHeadScale",labelColor:"labelColor",hideNegativeAxes:"hideNegativeAxes",hideAxisHeads:"hideAxisHeads",disabled:"disabled",font:"font"},outputs:{clicked:"clicked"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:7,vars:16,consts:[["ngtCompound","",3,"scale"],[3,"color","rotation","scale"],[4,"ngIf"],["intensity","0.5"],["position","10","intensity","0.5"],[3,"arcStyle","position","label","font","disabled","labelColor","clickEmitter","axisHeadScale","pointerdown"],[3,"arcStyle","position","font","disabled","labelColor","clickEmitter","axisHeadScale","pointerdown"]],template:function _class16_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-group",0),core["ɵɵelement"](1,"ngts-gizmo-viewport-axis",1)(2,"ngts-gizmo-viewport-axis",1)(3,"ngts-gizmo-viewport-axis",1),core["ɵɵtemplate"](4,_class16_ng_container_4_Template,5,28,"ng-container",2),core["ɵɵelement"](5,"ngt-ambient-light",3)(6,"ngt-point-light",4),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("scale",40),core["ɵɵadvance"](1),core["ɵɵproperty"]("color",ctx.get("axisColors")[0])("rotation",core["ɵɵpureFunction0"](11,_c16))("scale",ctx.get("axisScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("color",ctx.get("axisColors")[1])("rotation",core["ɵɵpureFunction1"](12,_c12,ctx.Math.PI/2))("scale",ctx.get("axisScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("color",ctx.get("axisColors")[2])("rotation",core["ɵɵpureFunction1"](14,_c11,-ctx.Math.PI/2))("scale",ctx.get("axisScale")),core["ɵɵadvance"](1),core["ɵɵproperty"]("ngIf",!ctx.get("hideAxisHeads")))},dependencies:[NgtsGizmoViewportAxis,NgtsGizmoViewportAxisHead,common.NgIf],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGizmoViewport,[{type:core.Component,args:[{selector:"ngts-gizmo-viewport",standalone:!0,template:'\n        <ngt-group ngtCompound [scale]="40">\n            <ngts-gizmo-viewport-axis\n                [color]="get(\'axisColors\')[0]"\n                [rotation]="[0, 0, 0]"\n                [scale]="get(\'axisScale\')"\n            ></ngts-gizmo-viewport-axis>\n            <ngts-gizmo-viewport-axis\n                [color]="get(\'axisColors\')[1]"\n                [rotation]="[0, 0, Math.PI / 2]"\n                [scale]="get(\'axisScale\')"\n            ></ngts-gizmo-viewport-axis>\n            <ngts-gizmo-viewport-axis\n                [color]="get(\'axisColors\')[2]"\n                [rotation]="[0, -Math.PI / 2, 0]"\n                [scale]="get(\'axisScale\')"\n            ></ngts-gizmo-viewport-axis>\n            <ng-container *ngIf="!get(\'hideAxisHeads\')">\n                <ngts-gizmo-viewport-axis-head\n                    [arcStyle]="get(\'axisColors\')[0]"\n                    [position]="[1, 0, 0]"\n                    [label]="get(\'labels\')[0]"\n                    [font]="get(\'font\')"\n                    [disabled]="get(\'disabled\')"\n                    [labelColor]="get(\'labelColor\')"\n                    [clickEmitter]="clicked"\n                    [axisHeadScale]="get(\'axisHeadScale\')"\n                    (pointerdown)="onPointerDown($any($event))"\n                ></ngts-gizmo-viewport-axis-head>\n                <ngts-gizmo-viewport-axis-head\n                    [arcStyle]="get(\'axisColors\')[1]"\n                    [position]="[0, 1, 0]"\n                    [label]="get(\'labels\')[1]"\n                    [font]="get(\'font\')"\n                    [disabled]="get(\'disabled\')"\n                    [labelColor]="get(\'labelColor\')"\n                    [clickEmitter]="clicked"\n                    [axisHeadScale]="get(\'axisHeadScale\')"\n                    (pointerdown)="onPointerDown($any($event))"\n                ></ngts-gizmo-viewport-axis-head>\n                <ngts-gizmo-viewport-axis-head\n                    [arcStyle]="get(\'axisColors\')[2]"\n                    [position]="[0, 0, 1]"\n                    [label]="get(\'labels\')[2]"\n                    [font]="get(\'font\')"\n                    [disabled]="get(\'disabled\')"\n                    [labelColor]="get(\'labelColor\')"\n                    [clickEmitter]="clicked"\n                    [axisHeadScale]="get(\'axisHeadScale\')"\n                    (pointerdown)="onPointerDown($any($event))"\n                ></ngts-gizmo-viewport-axis-head>\n                <ng-container *ngIf="!get(\'hideNegativeAxes\')">\n                    <ngts-gizmo-viewport-axis-head\n                        [arcStyle]="get(\'axisColors\')[0]"\n                        [position]="[-1, 0, 0]"\n                        [font]="get(\'font\')"\n                        [disabled]="get(\'disabled\')"\n                        [labelColor]="get(\'labelColor\')"\n                        [clickEmitter]="clicked"\n                        [axisHeadScale]="get(\'axisHeadScale\')"\n                        (pointerdown)="onPointerDown($any($event))"\n                    ></ngts-gizmo-viewport-axis-head>\n                    <ngts-gizmo-viewport-axis-head\n                        [arcStyle]="get(\'axisColors\')[1]"\n                        [position]="[0, -1, 0]"\n                        [font]="get(\'font\')"\n                        [disabled]="get(\'disabled\')"\n                        [labelColor]="get(\'labelColor\')"\n                        [clickEmitter]="clicked"\n                        [axisHeadScale]="get(\'axisHeadScale\')"\n                        (pointerdown)="onPointerDown($any($event))"\n                    ></ngts-gizmo-viewport-axis-head>\n                    <ngts-gizmo-viewport-axis-head\n                        [arcStyle]="get(\'axisColors\')[2]"\n                        [position]="[0, 0, -1]"\n                        [font]="get(\'font\')"\n                        [disabled]="get(\'disabled\')"\n                        [labelColor]="get(\'labelColor\')"\n                        [clickEmitter]="clicked"\n                        [axisHeadScale]="get(\'axisHeadScale\')"\n                        (pointerdown)="onPointerDown($any($event))"\n                    ></ngts-gizmo-viewport-axis-head>\n                </ng-container>\n            </ng-container>\n            <ngt-ambient-light intensity="0.5"></ngt-ambient-light>\n            <ngt-point-light position="10" intensity="0.5"></ngt-point-light>\n        </ngt-group>\n    ',imports:[NgtsGizmoViewportAxis,NgtsGizmoViewportAxisHead,common.NgIf],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{axisColors:[{type:core.Input}],axisScale:[{type:core.Input}],labels:[{type:core.Input}],axisHeadScale:[{type:core.Input}],labelColor:[{type:core.Input}],hideNegativeAxes:[{type:core.Input}],hideAxisHeads:[{type:core.Input}],disabled:[{type:core.Input}],font:[{type:core.Input}],clicked:[{type:core.Output}]});const v=new three_module.Vector3;class NgtsQuadraticBezierLine extends NgtsLineInput{constructor(){super(...arguments),this.curve=new three_module.QuadraticBezierCurve3(void 0,void 0,void 0),this.lineRef=(0,angular_three.Lv)()}set start(start){this.set({start})}set end(end){this.set({end})}set mid(mid){this.set({mid})}set segments(segments){this.set({segments})}initialize(){super.initialize(),this.set({start:[0,0,0],end:[0,0,0],segments:20})}ngOnInit(){this.connect("points",(0,observable_combineLatest.a)([this.select("start"),this.select("end"),this.select("mid").pipe((0,angular_three.Xb)()),this.select("segments")]).pipe((0,operators_map.U)((([start,end,mid,segments])=>this.getPoints(start,end,mid,segments))))),this.replaceSetPoints()}replaceSetPoints(){this.hold(this.lineRef.$,(line=>{line.setPoints=(start,end,mid)=>{const points=this.getPoints(start,end,mid);this.lineRef.nativeElement.geometry&&this.lineRef.nativeElement.geometry.setPositions(points.map((p=>p.toArray())).flat())}}))}getPoints(start,end,mid,segments=20){return start instanceof three_module.Vector3?this.curve.v0.copy(start):this.curve.v0.set(...start),end instanceof three_module.Vector3?this.curve.v2.copy(end):this.curve.v2.set(...end),mid instanceof three_module.Vector3?this.curve.v1.copy(mid):this.curve.v1.copy(this.curve.v0.clone().add(this.curve.v2.clone().sub(this.curve.v0)).add(v.set(0,this.curve.v0.y-this.curve.v2.y,0))),this.curve.getPoints(segments)}}(_class17=NgtsQuadraticBezierLine).ɵfac=function(){let ɵ_class17_BaseFactory;return function _class17_Factory(t){return(ɵ_class17_BaseFactory||(ɵ_class17_BaseFactory=core["ɵɵgetInheritedFactory"](_class17)))(t||_class17)}}(),_class17.ɵcmp=core["ɵɵdefineComponent"]({type:_class17,selectors:[["ngts-quadratic-bezier-line"]],inputs:{lineRef:"lineRef",start:"start",end:"end",mid:"mid",segments:"segments"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:1,vars:14,consts:[[3,"lineRef","points","color","vertexColors","resolution","lineWidth","alphaToCoverage","dashed","dashScale","dashSize","dashOffset","gapSize","wireframe","worldUnits"]],template:function _class17_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngts-line",0),2&rf&&core["ɵɵproperty"]("lineRef",ctx.lineRef)("points",ctx.get("points"))("color",ctx.get("color"))("vertexColors",ctx.get("vertexColors"))("resolution",ctx.get("resolution"))("lineWidth",ctx.get("lineWidth"))("alphaToCoverage",ctx.get("alphaToCoverage"))("dashed",ctx.get("dashed"))("dashScale",ctx.get("dashScale"))("dashSize",ctx.get("dashSize"))("dashOffset",ctx.get("dashOffset"))("gapSize",ctx.get("gapSize"))("wireframe",ctx.get("wireframe"))("worldUnits",ctx.get("worldUnits"))},dependencies:[NgtsLine],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsQuadraticBezierLine,[{type:core.Component,args:[{selector:"ngts-quadratic-bezier-line",standalone:!0,template:'\n        <ngts-line\n            [lineRef]="lineRef"\n            [points]="get(\'points\')"\n            [color]="get(\'color\')"\n            [vertexColors]="get(\'vertexColors\')"\n            [resolution]="get(\'resolution\')"\n            [lineWidth]="get(\'lineWidth\')"\n            [alphaToCoverage]="get(\'alphaToCoverage\')"\n            [dashed]="get(\'dashed\')"\n            [dashScale]="get(\'dashScale\')"\n            [dashSize]="get(\'dashSize\')"\n            [dashOffset]="get(\'dashOffset\')"\n            [gapSize]="get(\'gapSize\')"\n            [wireframe]="get(\'wireframe\')"\n            [worldUnits]="get(\'worldUnits\')"\n        />\n    ',imports:[NgtsLine],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{lineRef:[{type:core.Input}],start:[{type:core.Input}],end:[{type:core.Input}],mid:[{type:core.Input}],segments:[{type:core.Input}]}),(0,angular_three.l7)({Mesh:three_module.Mesh,TextGeometry});class NgtsText3D extends angular_three.A7{constructor(){super(...arguments),this.font$=this.select("font").pipe((0,operators_switchMap.w)((font=>"string"==typeof font?fetch(font).then((res=>res.json())):(0,observable_of.of)(font))),(0,operators_map.U)((fontData=>(new FontLoader).parse(fontData)))),this.geometryArgs$=(0,observable_combineLatest.a)([this.font$,this.select("text"),this.select("size"),this.select("height"),this.select("bevelThickness"),this.select("bevelSize"),this.select("bevelEnabled"),this.select("bevelSegments"),this.select("bevelOffset"),this.select("curveSegments"),this.select("letterSpacing"),this.select("lineHeight")]).pipe((0,operators_map.U)((([font,text,size,height,bevelThickness,bevelSize,bevelEnabled,bevelSegments,bevelOffset,curveSegments,letterSpacing,lineHeight])=>[text,{font,size,height,bevelThickness,bevelSize,bevelSegments,bevelEnabled,bevelOffset,curveSegments,letterSpacing,lineHeight}])))}set font(font){this.set({font})}set text(text){this.set({text})}set bevelEnabled(bevelEnabled){this.set({bevelEnabled})}set bevelOffset(bevelOffset){this.set({bevelOffset})}set bevelSize(bevelSize){this.set({bevelSize})}set bevelThickness(bevelThickness){this.set({bevelThickness})}set curveSegments(curveSegments){this.set({curveSegments})}set bevelSegments(bevelSegments){this.set({bevelSegments})}set height(height){this.set({height})}set size(size){this.set({size})}set lineHeight(lineHeight){this.set({lineHeight})}set letterSpacing(letterSpacing){this.set({letterSpacing})}initialize(){super.initialize(),this.set({letterSpacing:0,lineHeight:1,size:1,height:.2,bevelThickness:.1,bevelSize:.01,bevelEnabled:!1,bevelOffset:0,bevelSegments:4,curveSegments:8})}}(_class18=NgtsText3D).ɵfac=function(){let ɵ_class18_BaseFactory;return function _class18_Factory(t){return(ɵ_class18_BaseFactory||(ɵ_class18_BaseFactory=core["ɵɵgetInheritedFactory"](_class18)))(t||_class18)}}(),_class18.ɵcmp=core["ɵɵdefineComponent"]({type:_class18,selectors:[["ngts-text-3d","font",""]],inputs:{font:"font",text:"text",bevelEnabled:"bevelEnabled",bevelOffset:"bevelOffset",bevelSize:"bevelSize",bevelThickness:"bevelThickness",curveSegments:"curveSegments",bevelSegments:"bevelSegments",height:"height",size:"size",lineHeight:"lineHeight",letterSpacing:"letterSpacing"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:["font",""],ngContentSelectors:angular_three_soba_abstractions_c0,decls:4,vars:4,consts:[["ngtCompound",""],[4,"args"]],template:function _class18_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-mesh",0),core["ɵɵtemplate"](1,_class18_ngt_text_geometry_1_Template,1,0,"ngt-text-geometry",1),core["ɵɵpipe"](2,"ngtPush"),core["ɵɵprojection"](3),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵadvance"](1),core["ɵɵproperty"]("args",core["ɵɵpipeBind2"](2,1,ctx.geometryArgs$,null)))},dependencies:[angular_three.Bj,angular_three.L3],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsText3D,[{type:core.Component,args:[{selector:"ngts-text-3d[font]",standalone:!0,template:'\n        <ngt-mesh ngtCompound>\n            <ngt-text-geometry *args="geometryArgs$ | ngtPush : null" />\n            <ng-content />\n        </ngt-mesh>\n    ',imports:[angular_three.Bj,angular_three.L3],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{font:[{type:core.Input}],text:[{type:core.Input}],bevelEnabled:[{type:core.Input}],bevelOffset:[{type:core.Input}],bevelSize:[{type:core.Input}],bevelThickness:[{type:core.Input}],curveSegments:[{type:core.Input}],bevelSegments:[{type:core.Input}],height:[{type:core.Input}],size:[{type:core.Input}],lineHeight:[{type:core.Input}],letterSpacing:[{type:core.Input}]});class NgtsText extends angular_three.A7{constructor(){super(...arguments),this.textRef=(0,angular_three.Lv)(),this.sync=new core.EventEmitter,this.store=(0,core.inject)(angular_three.W7),this.troikaText=new Text}set text(text){this.set({text})}set characters(characters){this.set({characters})}set font(font){this.set({font})}set anchorX(anchorX){this.set({anchorX})}set anchorY(anchorY){this.set({anchorY})}initialize(){super.initialize(),this.set({anchorX:"center",anchorY:"middle",text:""})}ngOnInit(){this.preloadFont(),this.syncText()}ngOnDestroy(){this.troikaText.dispose(),super.ngOnDestroy()}preloadFont(){const{font,characters}=this.get();font&&characters&&function preloadFont({font,characters,sdfGlyphSize},callback){getTextRenderInfo({font,sdfGlyphSize,text:Array.isArray(characters)?characters.join("\n"):""+characters},callback)}({font,characters})}syncText(){this.hold(this.select(),(()=>{const invalidate=this.store.get("invalidate");this.troikaText.sync((()=>{invalidate(),this.sync.observed&&this.sync.next(this.troikaText)}))}))}}(_class19=NgtsText).ɵfac=function(){let ɵ_class19_BaseFactory;return function _class19_Factory(t){return(ɵ_class19_BaseFactory||(ɵ_class19_BaseFactory=core["ɵɵgetInheritedFactory"](_class19)))(t||_class19)}}(),_class19.ɵcmp=core["ɵɵdefineComponent"]({type:_class19,selectors:[["ngts-text","text",""]],inputs:{textRef:"textRef",text:"text",characters:"characters",font:"font",anchorX:"anchorX",anchorY:"anchorY"},outputs:{sync:"sync"},standalone:!0,features:[core["ɵɵProvidersFeature"]([RxActionFactory]),core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],attrs:["text",""],ngContentSelectors:angular_three_soba_abstractions_c0,decls:2,vars:3,consts:[["ngtCompound","",3,"ref","text","anchorX","anchorY","font",4,"args"],["ngtCompound","",3,"ref","text","anchorX","anchorY","font"]],template:function _class19_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementContainerStart"](0),core["ɵɵtemplate"](1,_class19_ngt_primitive_1_Template,2,5,"ngt-primitive",0),core["ɵɵelementContainerEnd"]()),2&rf&&(core["ɵɵadvance"](1),core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,_c2,ctx.troikaText)))},dependencies:[angular_three.Bj],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsText,[{type:core.Component,args:[{selector:"ngts-text[text]",standalone:!0,template:'\n        <ng-container>\n            <ngt-primitive\n                ngtCompound\n                *args="[troikaText]"\n                [ref]="textRef"\n                [text]="get(\'text\')"\n                [anchorX]="get(\'anchorX\')"\n                [anchorY]="get(\'anchorY\')"\n                [font]="get(\'font\')"\n            >\n                <ng-content />\n            </ngt-primitive>\n        </ng-container>\n    ',imports:[angular_three.Bj],providers:[RxActionFactory],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],null,{textRef:[{type:core.Input}],text:[{type:core.Input}],characters:[{type:core.Input}],font:[{type:core.Input}],anchorX:[{type:core.Input}],anchorY:[{type:core.Input}],sync:[{type:core.Output}]})},"./node_modules/angular-three-soba/fesm2022/angular-three-soba-controls.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>NgtsOrbitControls});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),angular_three=__webpack_require__("./node_modules/angular-three/fesm2022/angular-three.mjs"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),__defProp=Object.defineProperty,__publicField=(obj,key,value)=>(((obj,key,value)=>{key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value})(obj,"symbol"!=typeof key?key+"":key,value),value);const moduloWrapAround=(offset,capacity)=>(offset%capacity+capacity)%capacity;class OrbitControls extends three_module.EventDispatcher{constructor(object,domElement){super(),__publicField(this,"object"),__publicField(this,"domElement"),__publicField(this,"enabled",!0),__publicField(this,"target",new three_module.Vector3),__publicField(this,"minDistance",0),__publicField(this,"maxDistance",1/0),__publicField(this,"minZoom",0),__publicField(this,"maxZoom",1/0),__publicField(this,"minPolarAngle",0),__publicField(this,"maxPolarAngle",Math.PI),__publicField(this,"minAzimuthAngle",-1/0),__publicField(this,"maxAzimuthAngle",1/0),__publicField(this,"enableDamping",!1),__publicField(this,"dampingFactor",.05),__publicField(this,"enableZoom",!0),__publicField(this,"zoomSpeed",1),__publicField(this,"enableRotate",!0),__publicField(this,"rotateSpeed",1),__publicField(this,"enablePan",!0),__publicField(this,"panSpeed",1),__publicField(this,"screenSpacePanning",!0),__publicField(this,"keyPanSpeed",7),__publicField(this,"autoRotate",!1),__publicField(this,"autoRotateSpeed",2),__publicField(this,"reverseOrbit",!1),__publicField(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),__publicField(this,"mouseButtons",{LEFT:three_module.MOUSE.ROTATE,MIDDLE:three_module.MOUSE.DOLLY,RIGHT:three_module.MOUSE.PAN}),__publicField(this,"touches",{ONE:three_module.TOUCH.ROTATE,TWO:three_module.TOUCH.DOLLY_PAN}),__publicField(this,"target0"),__publicField(this,"position0"),__publicField(this,"zoom0"),__publicField(this,"_domElementKeyEvents",null),__publicField(this,"getPolarAngle"),__publicField(this,"getAzimuthalAngle"),__publicField(this,"setPolarAngle"),__publicField(this,"setAzimuthalAngle"),__publicField(this,"getDistance"),__publicField(this,"listenToKeyEvents"),__publicField(this,"stopListenToKeyEvents"),__publicField(this,"saveState"),__publicField(this,"reset"),__publicField(this,"update"),__publicField(this,"connect"),__publicField(this,"dispose"),this.object=object,this.domElement=domElement,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>spherical.phi,this.getAzimuthalAngle=()=>spherical.theta,this.setPolarAngle=value=>{let phi=moduloWrapAround(value,2*Math.PI),currentPhi=spherical.phi;currentPhi<0&&(currentPhi+=2*Math.PI),phi<0&&(phi+=2*Math.PI);let phiDist=Math.abs(phi-currentPhi);2*Math.PI-phiDist<phiDist&&(phi<currentPhi?phi+=2*Math.PI:currentPhi+=2*Math.PI),sphericalDelta.phi=phi-currentPhi,scope.update()},this.setAzimuthalAngle=value=>{let theta=moduloWrapAround(value,2*Math.PI),currentTheta=spherical.theta;currentTheta<0&&(currentTheta+=2*Math.PI),theta<0&&(theta+=2*Math.PI);let thetaDist=Math.abs(theta-currentTheta);2*Math.PI-thetaDist<thetaDist&&(theta<currentTheta?theta+=2*Math.PI:currentTheta+=2*Math.PI),sphericalDelta.theta=theta-currentTheta,scope.update()},this.getDistance=()=>scope.object.position.distanceTo(scope.target),this.listenToKeyEvents=domElement2=>{domElement2.addEventListener("keydown",onKeyDown),this._domElementKeyEvents=domElement2},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",onKeyDown),this._domElementKeyEvents=null},this.saveState=()=>{scope.target0.copy(scope.target),scope.position0.copy(scope.object.position),scope.zoom0=scope.object.zoom},this.reset=()=>{scope.target.copy(scope.target0),scope.object.position.copy(scope.position0),scope.object.zoom=scope.zoom0,scope.object.updateProjectionMatrix(),scope.dispatchEvent(changeEvent),scope.update(),state=STATE.NONE},this.update=(()=>{const offset=new three_module.Vector3,up=new three_module.Vector3(0,1,0),quat=(new three_module.Quaternion).setFromUnitVectors(object.up,up),quatInverse=quat.clone().invert(),lastPosition=new three_module.Vector3,lastQuaternion=new three_module.Quaternion,twoPI=2*Math.PI;return function update(){const position=scope.object.position;quat.setFromUnitVectors(object.up,up),quatInverse.copy(quat).invert(),offset.copy(position).sub(scope.target),offset.applyQuaternion(quat),spherical.setFromVector3(offset),scope.autoRotate&&state===STATE.NONE&&rotateLeft(function getAutoRotationAngle(){return 2*Math.PI/60/60*scope.autoRotateSpeed}()),scope.enableDamping?(spherical.theta+=sphericalDelta.theta*scope.dampingFactor,spherical.phi+=sphericalDelta.phi*scope.dampingFactor):(spherical.theta+=sphericalDelta.theta,spherical.phi+=sphericalDelta.phi);let min=scope.minAzimuthAngle,max=scope.maxAzimuthAngle;return isFinite(min)&&isFinite(max)&&(min<-Math.PI?min+=twoPI:min>Math.PI&&(min-=twoPI),max<-Math.PI?max+=twoPI:max>Math.PI&&(max-=twoPI),spherical.theta=min<=max?Math.max(min,Math.min(max,spherical.theta)):spherical.theta>(min+max)/2?Math.max(min,spherical.theta):Math.min(max,spherical.theta)),spherical.phi=Math.max(scope.minPolarAngle,Math.min(scope.maxPolarAngle,spherical.phi)),spherical.makeSafe(),spherical.radius*=scale,spherical.radius=Math.max(scope.minDistance,Math.min(scope.maxDistance,spherical.radius)),!0===scope.enableDamping?scope.target.addScaledVector(panOffset,scope.dampingFactor):scope.target.add(panOffset),offset.setFromSpherical(spherical),offset.applyQuaternion(quatInverse),position.copy(scope.target).add(offset),scope.object.lookAt(scope.target),!0===scope.enableDamping?(sphericalDelta.theta*=1-scope.dampingFactor,sphericalDelta.phi*=1-scope.dampingFactor,panOffset.multiplyScalar(1-scope.dampingFactor)):(sphericalDelta.set(0,0,0),panOffset.set(0,0,0)),scale=1,!!(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS)&&(scope.dispatchEvent(changeEvent),lastPosition.copy(scope.object.position),lastQuaternion.copy(scope.object.quaternion),zoomChanged=!1,!0)}})(),this.connect=domElement2=>{domElement2===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),scope.domElement=domElement2,scope.domElement.style.touchAction="none",scope.domElement.addEventListener("contextmenu",onContextMenu),scope.domElement.addEventListener("pointerdown",onPointerDown),scope.domElement.addEventListener("pointercancel",onPointerCancel),scope.domElement.addEventListener("wheel",onMouseWheel)},this.dispose=()=>{var _a,_b,_c,_d,_e,_f;null==(_a=scope.domElement)||_a.removeEventListener("contextmenu",onContextMenu),null==(_b=scope.domElement)||_b.removeEventListener("pointerdown",onPointerDown),null==(_c=scope.domElement)||_c.removeEventListener("pointercancel",onPointerCancel),null==(_d=scope.domElement)||_d.removeEventListener("wheel",onMouseWheel),null==(_e=scope.domElement)||_e.ownerDocument.removeEventListener("pointermove",onPointerMove),null==(_f=scope.domElement)||_f.ownerDocument.removeEventListener("pointerup",onPointerUp),null!==scope._domElementKeyEvents&&scope._domElementKeyEvents.removeEventListener("keydown",onKeyDown)};const scope=this,changeEvent={type:"change"},startEvent={type:"start"},endEvent={type:"end"},STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let state=STATE.NONE;const EPS=1e-6,spherical=new three_module.Spherical,sphericalDelta=new three_module.Spherical;let scale=1;const panOffset=new three_module.Vector3;let zoomChanged=!1;const rotateStart=new three_module.Vector2,rotateEnd=new three_module.Vector2,rotateDelta=new three_module.Vector2,panStart=new three_module.Vector2,panEnd=new three_module.Vector2,panDelta=new three_module.Vector2,dollyStart=new three_module.Vector2,dollyEnd=new three_module.Vector2,dollyDelta=new three_module.Vector2,pointers=[],pointerPositions={};function getZoomScale(){return Math.pow(.95,scope.zoomSpeed)}function rotateLeft(angle){scope.reverseOrbit?sphericalDelta.theta+=angle:sphericalDelta.theta-=angle}function rotateUp(angle){scope.reverseOrbit?sphericalDelta.phi+=angle:sphericalDelta.phi-=angle}const panLeft=(()=>{const v=new three_module.Vector3;return function panLeft2(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0),v.multiplyScalar(-distance),panOffset.add(v)}})(),panUp=(()=>{const v=new three_module.Vector3;return function panUp2(distance,objectMatrix){!0===scope.screenSpacePanning?v.setFromMatrixColumn(objectMatrix,1):(v.setFromMatrixColumn(objectMatrix,0),v.crossVectors(scope.object.up,v)),v.multiplyScalar(distance),panOffset.add(v)}})(),pan=(()=>{const offset=new three_module.Vector3;return function pan2(deltaX,deltaY){const element=scope.domElement;if(element&&scope.object instanceof three_module.PerspectiveCamera&&scope.object.isPerspectiveCamera){const position=scope.object.position;offset.copy(position).sub(scope.target);let targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*Math.PI/180),panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix),panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix)}else element&&scope.object instanceof three_module.OrthographicCamera&&scope.object.isOrthographicCamera?(panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix),panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),scope.enablePan=!1)}})();function dollyOut(dollyScale){scope.object instanceof three_module.PerspectiveCamera&&scope.object.isPerspectiveCamera?scale/=dollyScale:scope.object instanceof three_module.OrthographicCamera&&scope.object.isOrthographicCamera?(scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom*dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),scope.enableZoom=!1)}function dollyIn(dollyScale){scope.object instanceof three_module.PerspectiveCamera&&scope.object.isPerspectiveCamera?scale*=dollyScale:scope.object instanceof three_module.OrthographicCamera&&scope.object.isOrthographicCamera?(scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom/dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),scope.enableZoom=!1)}function handleMouseDownRotate(event){rotateStart.set(event.clientX,event.clientY)}function handleMouseDownPan(event){panStart.set(event.clientX,event.clientY)}function handleTouchStartRotate(){if(1==pointers.length)rotateStart.set(pointers[0].pageX,pointers[0].pageY);else{const x=.5*(pointers[0].pageX+pointers[1].pageX),y=.5*(pointers[0].pageY+pointers[1].pageY);rotateStart.set(x,y)}}function handleTouchStartPan(){if(1==pointers.length)panStart.set(pointers[0].pageX,pointers[0].pageY);else{const x=.5*(pointers[0].pageX+pointers[1].pageX),y=.5*(pointers[0].pageY+pointers[1].pageY);panStart.set(x,y)}}function handleTouchStartDolly(){const dx=pointers[0].pageX-pointers[1].pageX,dy=pointers[0].pageY-pointers[1].pageY,distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance)}function handleTouchMoveRotate(event){if(1==pointers.length)rotateEnd.set(event.pageX,event.pageY);else{const position=getSecondPointerPosition(event),x=.5*(event.pageX+position.x),y=.5*(event.pageY+position.y);rotateEnd.set(x,y)}rotateDelta.subVectors(rotateEnd,rotateStart).multiplyScalar(scope.rotateSpeed);const element=scope.domElement;element&&(rotateLeft(2*Math.PI*rotateDelta.x/element.clientHeight),rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight)),rotateStart.copy(rotateEnd)}function handleTouchMovePan(event){if(1==pointers.length)panEnd.set(event.pageX,event.pageY);else{const position=getSecondPointerPosition(event),x=.5*(event.pageX+position.x),y=.5*(event.pageY+position.y);panEnd.set(x,y)}panDelta.subVectors(panEnd,panStart).multiplyScalar(scope.panSpeed),pan(panDelta.x,panDelta.y),panStart.copy(panEnd)}function handleTouchMoveDolly(event){const position=getSecondPointerPosition(event),dx=event.pageX-position.x,dy=event.pageY-position.y,distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance),dollyDelta.set(0,Math.pow(dollyEnd.y/dollyStart.y,scope.zoomSpeed)),dollyOut(dollyDelta.y),dollyStart.copy(dollyEnd)}function onPointerDown(event){var _a,_b;!1!==scope.enabled&&(0===pointers.length&&(null==(_a=scope.domElement)||_a.ownerDocument.addEventListener("pointermove",onPointerMove),null==(_b=scope.domElement)||_b.ownerDocument.addEventListener("pointerup",onPointerUp)),function addPointer(event){pointers.push(event)}(event),"touch"===event.pointerType?function onTouchStart(event){switch(trackPointer(event),pointers.length){case 1:switch(scope.touches.ONE){case three_module.TOUCH.ROTATE:if(!1===scope.enableRotate)return;handleTouchStartRotate(),state=STATE.TOUCH_ROTATE;break;case three_module.TOUCH.PAN:if(!1===scope.enablePan)return;handleTouchStartPan(),state=STATE.TOUCH_PAN;break;default:state=STATE.NONE}break;case 2:switch(scope.touches.TWO){case three_module.TOUCH.DOLLY_PAN:if(!1===scope.enableZoom&&!1===scope.enablePan)return;!function handleTouchStartDollyPan(){scope.enableZoom&&handleTouchStartDolly(),scope.enablePan&&handleTouchStartPan()}(),state=STATE.TOUCH_DOLLY_PAN;break;case three_module.TOUCH.DOLLY_ROTATE:if(!1===scope.enableZoom&&!1===scope.enableRotate)return;!function handleTouchStartDollyRotate(){scope.enableZoom&&handleTouchStartDolly(),scope.enableRotate&&handleTouchStartRotate()}(),state=STATE.TOUCH_DOLLY_ROTATE;break;default:state=STATE.NONE}break;default:state=STATE.NONE}state!==STATE.NONE&&scope.dispatchEvent(startEvent)}(event):function onMouseDown(event){let mouseAction;switch(event.button){case 0:mouseAction=scope.mouseButtons.LEFT;break;case 1:mouseAction=scope.mouseButtons.MIDDLE;break;case 2:mouseAction=scope.mouseButtons.RIGHT;break;default:mouseAction=-1}switch(mouseAction){case three_module.MOUSE.DOLLY:if(!1===scope.enableZoom)return;!function handleMouseDownDolly(event){dollyStart.set(event.clientX,event.clientY)}(event),state=STATE.DOLLY;break;case three_module.MOUSE.ROTATE:if(event.ctrlKey||event.metaKey||event.shiftKey){if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN}else{if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE}break;case three_module.MOUSE.PAN:if(event.ctrlKey||event.metaKey||event.shiftKey){if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE}else{if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN}break;default:state=STATE.NONE}state!==STATE.NONE&&scope.dispatchEvent(startEvent)}(event))}function onPointerMove(event){!1!==scope.enabled&&("touch"===event.pointerType?function onTouchMove(event){switch(trackPointer(event),state){case STATE.TOUCH_ROTATE:if(!1===scope.enableRotate)return;handleTouchMoveRotate(event),scope.update();break;case STATE.TOUCH_PAN:if(!1===scope.enablePan)return;handleTouchMovePan(event),scope.update();break;case STATE.TOUCH_DOLLY_PAN:if(!1===scope.enableZoom&&!1===scope.enablePan)return;!function handleTouchMoveDollyPan(event){scope.enableZoom&&handleTouchMoveDolly(event),scope.enablePan&&handleTouchMovePan(event)}(event),scope.update();break;case STATE.TOUCH_DOLLY_ROTATE:if(!1===scope.enableZoom&&!1===scope.enableRotate)return;!function handleTouchMoveDollyRotate(event){scope.enableZoom&&handleTouchMoveDolly(event),scope.enableRotate&&handleTouchMoveRotate(event)}(event),scope.update();break;default:state=STATE.NONE}}(event):function onMouseMove(event){if(!1===scope.enabled)return;switch(state){case STATE.ROTATE:if(!1===scope.enableRotate)return;!function handleMouseMoveRotate(event){rotateEnd.set(event.clientX,event.clientY),rotateDelta.subVectors(rotateEnd,rotateStart).multiplyScalar(scope.rotateSpeed);const element=scope.domElement;element&&(rotateLeft(2*Math.PI*rotateDelta.x/element.clientHeight),rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight)),rotateStart.copy(rotateEnd),scope.update()}(event);break;case STATE.DOLLY:if(!1===scope.enableZoom)return;!function handleMouseMoveDolly(event){dollyEnd.set(event.clientX,event.clientY),dollyDelta.subVectors(dollyEnd,dollyStart),dollyDelta.y>0?dollyOut(getZoomScale()):dollyDelta.y<0&&dollyIn(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}(event);break;case STATE.PAN:if(!1===scope.enablePan)return;!function handleMouseMovePan(event){panEnd.set(event.clientX,event.clientY),panDelta.subVectors(panEnd,panStart).multiplyScalar(scope.panSpeed),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}(event)}}(event))}function onPointerUp(event){var _a,_b,_c;removePointer(event),0===pointers.length&&(null==(_a=scope.domElement)||_a.releasePointerCapture(event.pointerId),null==(_b=scope.domElement)||_b.ownerDocument.removeEventListener("pointermove",onPointerMove),null==(_c=scope.domElement)||_c.ownerDocument.removeEventListener("pointerup",onPointerUp)),scope.dispatchEvent(endEvent),state=STATE.NONE}function onPointerCancel(event){removePointer(event)}function onMouseWheel(event){!1===scope.enabled||!1===scope.enableZoom||state!==STATE.NONE&&state!==STATE.ROTATE||(event.preventDefault(),scope.dispatchEvent(startEvent),function handleMouseWheel(event){event.deltaY<0?dollyIn(getZoomScale()):event.deltaY>0&&dollyOut(getZoomScale()),scope.update()}(event),scope.dispatchEvent(endEvent))}function onKeyDown(event){!1!==scope.enabled&&!1!==scope.enablePan&&function handleKeyDown(event){let needsUpdate=!1;switch(event.code){case scope.keys.UP:pan(0,scope.keyPanSpeed),needsUpdate=!0;break;case scope.keys.BOTTOM:pan(0,-scope.keyPanSpeed),needsUpdate=!0;break;case scope.keys.LEFT:pan(scope.keyPanSpeed,0),needsUpdate=!0;break;case scope.keys.RIGHT:pan(-scope.keyPanSpeed,0),needsUpdate=!0}needsUpdate&&(event.preventDefault(),scope.update())}(event)}function onContextMenu(event){!1!==scope.enabled&&event.preventDefault()}function removePointer(event){delete pointerPositions[event.pointerId];for(let i=0;i<pointers.length;i++)if(pointers[i].pointerId==event.pointerId)return void pointers.splice(i,1)}function trackPointer(event){let position=pointerPositions[event.pointerId];void 0===position&&(position=new three_module.Vector2,pointerPositions[event.pointerId]=position),position.set(event.pageX,event.pageY)}function getSecondPointerPosition(event){const pointer=event.pointerId===pointers[0].pointerId?pointers[1]:pointers[0];return pointerPositions[pointer.pointerId]}void 0!==domElement&&this.connect(domElement),this.update()}}var _class;function _class_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelement"](0,"ngt-primitive",1),core["ɵɵpipe"](1,"ngtPush")),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("enableDamping",core["ɵɵpipeBind1"](1,1,ctx_r0.enableDamping$))}}class NgtsOrbitControls extends angular_three.A7{set camera(camera){this.set({camera})}set domElement(domElement){this.set({domElement})}set makeDefault(makeDefault){this.set({makeDefault})}set regress(regress){this.set({regress})}set target(target){this.set({target})}set enableDamping(enableDamping){this.set({enableDamping})}constructor(){super(),this.controlsRef=(0,angular_three.Lv)(),this.change=new core.EventEmitter,this.start=new core.EventEmitter,this.end=new core.EventEmitter,this.store=(0,core.inject)(angular_three.W7),this.enableDamping$=this.select("enableDamping"),(0,angular_three.Os)((()=>{const controls=this.controlsRef.nativeElement;controls&&controls.enabled&&controls.update()}))}initialize(){super.initialize(),this.set({enableDamping:!0,regress:!1})}ngOnInit(){this.setControls(),this.connectElement(),this.makeControlsDefault(),this.setEvents(),this.connect("args",this.controlsRef.$.pipe((0,map.U)((controls=>[controls]))))}setControls(){this.hold((0,combineLatest.a)([this.store.select("camera"),this.select("camera").pipe((0,angular_three.Xb)())]),(([defaultCamera,camera])=>{const controlsCamera=camera||defaultCamera;this.controlsRef.nativeElement&&this.controlsRef.nativeElement.object===controlsCamera||(this.controlsRef.nativeElement=new OrbitControls(controlsCamera))}))}connectElement(){this.hold((0,combineLatest.a)([this.store.select("gl","domElement"),this.store.select("invalidate"),this.select("regress"),this.controlsRef.$]),(([glDom,,,controls])=>{const{events}=this.store.get(),domElement=this.get("domElement")||events.connected||glDom;controls.connect(domElement)}))}makeControlsDefault(){this.effect((0,combineLatest.a)([this.controlsRef.$,this.select("makeDefault")]),(([controls,makeDefault])=>{if(makeDefault){const oldControls=this.store.get("controls");return this.store.set({controls}),()=>{this.store.set({controls:oldControls})}}}))}setEvents(){this.effect(this.controlsRef.$,(controls=>{const{invalidate,performance}=this.store.get(),regress=this.get("regress"),changeCallback=e=>{invalidate(),regress&&performance.regress(),this.change.observed&&this.change.emit(e)},startCallback=this.start.observed?this.start.emit.bind(this.start):null,endCallback=this.end.observed?this.end.emit.bind(this.end):null;return controls.addEventListener("change",changeCallback),startCallback&&controls.addEventListener("start",startCallback),endCallback&&controls.addEventListener("end",endCallback),()=>{controls.removeEventListener("change",changeCallback),startCallback&&controls.removeEventListener("start",startCallback),endCallback&&controls.removeEventListener("end",endCallback)}}))}}(_class=NgtsOrbitControls).ɵfac=function _class_Factory(t){return new(t||_class)},_class.ɵcmp=core["ɵɵdefineComponent"]({type:_class,selectors:[["ngts-orbit-controls"]],inputs:{controlsRef:"controlsRef",camera:"camera",domElement:"domElement",makeDefault:"makeDefault",regress:"regress",target:"target",enableDamping:"enableDamping"},outputs:{change:"change",start:"start",end:"end"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:1,vars:1,consts:[["ngtCompound","",3,"enableDamping",4,"args"],["ngtCompound","",3,"enableDamping"]],template:function _class_Template(rf,ctx){1&rf&&core["ɵɵtemplate"](0,_class_ngt_primitive_0_Template,2,3,"ngt-primitive",0),2&rf&&core["ɵɵproperty"]("args",ctx.get("args"))},dependencies:[angular_three.Bj,angular_three.L3],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsOrbitControls,[{type:core.Component,args:[{selector:"ngts-orbit-controls",standalone:!0,template:'\n        <ngt-primitive *args="get(\'args\')" ngtCompound [enableDamping]="enableDamping$ | ngtPush" />\n    ',imports:[angular_three.Bj,angular_three.L3],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],(function(){return[]}),{controlsRef:[{type:core.Input}],camera:[{type:core.Input}],domElement:[{type:core.Input}],makeDefault:[{type:core.Input}],regress:[{type:core.Input}],target:[{type:core.Input}],enableDamping:[{type:core.Input}],change:[{type:core.Output}],start:[{type:core.Output}],end:[{type:core.Output}]})},"./node_modules/angular-three/fesm2022/angular-three.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bj:()=>NgtArgs,B3:()=>NgtCanvas,WS:()=>NgtPortal,ZQ:()=>NgtPortalContent,L3:()=>NgtPush,l3:()=>NgtRepeat,A7:()=>NgtRxStore,W7:()=>NgtStore,l7:()=>extend,Os:()=>injectBeforeRender,D4:()=>injectNgtDestroy,Lv:()=>injectNgtRef,dI:()=>safeDetectChanges,Xb:()=>startWithUndefined});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),pipe=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/pipe.js"),scheduler_async=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/async.js"),lift=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),OperatorSubscriber=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js");function debounceTime(dueTime,scheduler){return void 0===scheduler&&(scheduler=scheduler_async.z),(0,lift.e)((function(source,subscriber){var activeTask=null,lastValue=null,lastTime=null,emit=function(){if(activeTask){activeTask.unsubscribe(),activeTask=null;var value=lastValue;lastValue=null,subscriber.next(value)}};function emitWhenIdle(){var targetTime=lastTime+dueTime,now=scheduler.now();if(now<targetTime)return activeTask=this.schedule(void 0,targetTime-now),void subscriber.add(activeTask);emit()}source.subscribe((0,OperatorSubscriber.x)(subscriber,(function(value){lastValue=value,lastTime=scheduler.now(),activeTask||(activeTask=scheduler.schedule(emitWhenIdle,dueTime),subscriber.add(activeTask))}),(function(){emit(),subscriber.complete()}),void 0,(function(){lastValue=activeTask=null})))}))}var takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),fromEvent=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),share=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/share.js");const defaultResizeOptions={box:"content-box",scroll:!1,offsetSize:!1,debounce:{scroll:50,resize:0},emitInZone:!0,emitInitialResult:!1},NGX_RESIZE_OPTIONS=new core.InjectionToken("NgxResizeOptions",{factory:()=>defaultResizeOptions});function provideNgxResizeOptions(options={}){return{provide:NGX_RESIZE_OPTIONS,useValue:{...defaultResizeOptions,...options}}}class NgxResize{constructor(host,zone,document,resizeOptions){this.host=host,this.zone=zone,this.document=document,this.resizeOptions=resizeOptions,this.ngxResizeOptions={},this.ngxResize=new core.EventEmitter}ngOnInit(){const mergedOptions={...this.resizeOptions,...this.ngxResizeOptions};this.sub=createResizeStream(mergedOptions,this.host.nativeElement,this.document,this.zone).subscribe(this.ngxResize)}ngOnDestroy(){this.sub?.unsubscribe()}}function createResizeStream({debounce,scroll,offsetSize,box,emitInZone,emitInitialResult},nativeElement,document,zone){const window=document.defaultView,isSupport=!!window?.ResizeObserver;let observer,lastBounds,lastEntries=[];const torndown$=new ReplaySubject.t,scrollContainers=findScrollContainers(nativeElement,window,document.body),scrollDebounce=debounce?"number"==typeof debounce?debounce:debounce.scroll:null,resizeDebounce=debounce?"number"==typeof debounce?debounce:debounce.resize:null,debounceAndTorndown=debounce=>(0,pipe.z)(debounceTime(debounce??0),(0,takeUntil.R)(torndown$));return new Observable.y((subscriber=>{if(isSupport){if(emitInitialResult){const[result]=calculateResult(nativeElement,window,offsetSize,[]);subscriber.next(result)}return zone.runOutsideAngular((()=>{const callback=entries=>{lastEntries=entries;const[result,size]=calculateResult(nativeElement,window,offsetSize,entries);emitInZone?zone.run((()=>{subscriber.next(result)})):subscriber.next(result),areBoundsEqual(lastBounds||{},size)||(lastBounds=size)},boundCallback=()=>{callback(lastEntries)};observer=new ResizeObserver(callback),observer.observe(nativeElement,{box}),scroll&&(scrollContainers&&scrollContainers.forEach((scrollContainer=>{(0,fromEvent.R)(scrollContainer,"scroll",{capture:!0,passive:!0}).pipe(debounceAndTorndown(scrollDebounce)).subscribe(boundCallback)})),(0,fromEvent.R)(window,"scroll",{capture:!0,passive:!0}).pipe(debounceAndTorndown(scrollDebounce)).subscribe(boundCallback)),(0,fromEvent.R)(window,"resize").pipe(debounceAndTorndown(resizeDebounce)).subscribe(boundCallback)})),()=>{observer&&(observer.unobserve(nativeElement),observer.disconnect()),torndown$.next(),torndown$.complete()}}subscriber.error("[ngx-resize] your browser does not support ResizeObserver. Please consider using a polyfill")})).pipe(debounceTime(scrollDebounce??0),(0,share.B)({connector:()=>new ReplaySubject.t(1)}))}function calculateResult(nativeElement,window,offsetSize,entries){const{left,top,width,height,bottom,right,x,y}=nativeElement.getBoundingClientRect(),size={left,top,width,height,bottom,right,x,y};return nativeElement instanceof HTMLElement&&offsetSize&&(size.height=nativeElement.offsetHeight,size.width=nativeElement.offsetWidth),Object.freeze(size),[{entries,dpr:window.devicePixelRatio,...size},size]}function findScrollContainers(element,window,documentBody){const result=[];if(!element||!window||element===documentBody)return result;const{overflow,overflowX,overflowY}=window.getComputedStyle(element);return[overflow,overflowX,overflowY].some((prop=>"auto"===prop||"scroll"===prop))&&result.push(element),[...result,...findScrollContainers(element.parentElement,window,documentBody)]}NgxResize.ɵfac=function NgxResize_Factory(t){return new(t||NgxResize)(core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.NgZone),core["ɵɵdirectiveInject"](common.DOCUMENT),core["ɵɵdirectiveInject"](NGX_RESIZE_OPTIONS))},NgxResize.ɵdir=core["ɵɵdefineDirective"]({type:NgxResize,selectors:[["","ngxResize",""]],inputs:{ngxResizeOptions:"ngxResizeOptions"},outputs:{ngxResize:"ngxResize"},standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgxResize,[{type:core.Directive,args:[{selector:"[ngxResize]",standalone:!0}]}],(function(){return[{type:core.ElementRef},{type:core.NgZone},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:void 0,decorators:[{type:core.Inject,args:[NGX_RESIZE_OPTIONS]}]}]}),{ngxResizeOptions:[{type:core.Input}],ngxResize:[{type:core.Output}]});const keys=["x","y","top","bottom","left","right","width","height"],areBoundsEqual=(a,b)=>keys.every((key=>a[key]===b[key]));var isObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isObservable.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),from=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/from.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),retry=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/retry.js"),catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),forkJoin=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),BehaviorSubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),startWith=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/startWith.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),merge=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/merge.js"),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),QueueAction=function(_super){function QueueAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this}return(0,tslib_es6.ZT)(QueueAction,_super),QueueAction.prototype.schedule=function(state,delay){return void 0===delay&&(delay=0),delay>0?_super.prototype.schedule.call(this,state,delay):(this.delay=delay,this.state=state,this.scheduler.flush(this),this)},QueueAction.prototype.execute=function(state,delay){return delay>0||this.closed?_super.prototype.execute.call(this,state,delay):this._execute(state,delay)},QueueAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),null!=delay&&delay>0||null==delay&&this.delay>0?_super.prototype.requestAsyncId.call(this,scheduler,id,delay):(scheduler.flush(this),0)},QueueAction}(__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/AsyncAction.js").o),queueScheduler=new(function(_super){function QueueScheduler(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.ZT)(QueueScheduler,_super),QueueScheduler}(__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/AsyncScheduler.js").v))(QueueAction),empty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js"),noop=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/noop.js"),mergeAll=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js"),observeOn=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/observeOn.js"),withLatestFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");function scan(accumulator,seed){return(0,lift.e)(function scanInternals(accumulator,seed,hasSeed,emitOnNext,emitBeforeComplete){return function(source,subscriber){var hasState=hasSeed,state=seed,index=0;source.subscribe((0,OperatorSubscriber.x)(subscriber,(function(value){var i=index++;state=hasState?accumulator(state,value,i):(hasState=!0,value),emitOnNext&&subscriber.next(state)}),emitBeforeComplete&&function(){hasState&&subscriber.next(state),subscriber.complete()}))}}(accumulator,seed,arguments.length>=2,!0))}var ConnectableObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/ConnectableObservable.js"),isFunction=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isFunction.js"),innerFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js");var DEFAULT_CONFIG={connector:function(){return new Subject.x}};function connect(selector,config){void 0===config&&(config=DEFAULT_CONFIG);var connector=config.connector;return(0,lift.e)((function(source,subscriber){var subject=connector();(0,innerFrom.Xf)(selector(function fromSubscribable(subscribable){return new Observable.y((function(subscriber){return subscribable.subscribe(subscriber)}))}(subject))).subscribe(subscriber),subscriber.add(source.subscribe(subject))}))}function multicast(subjectOrSubjectFactory,selector){var subjectFactory=(0,isFunction.m)(subjectOrSubjectFactory)?subjectOrSubjectFactory:function(){return subjectOrSubjectFactory};return(0,isFunction.m)(selector)?connect(selector,{connector:subjectFactory}):function(source){return new ConnectableObservable.c(source,subjectFactory)}}var shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js");const defaultAccumulator=(st,sl)=>({...st,...sl});function createAccumulationObservable(stateObservables=new Subject.x,stateSlices=new Subject.x,accumulatorObservable=new BehaviorSubject.X(defaultAccumulator)){const signal$=(0,merge.T)(stateObservables.pipe((0,distinctUntilChanged.x)(),(0,mergeAll.J)(),(0,observeOn.Q)(queueScheduler)),stateSlices.pipe((0,observeOn.Q)(queueScheduler))).pipe((0,withLatestFrom.M)(accumulatorObservable.pipe((0,observeOn.Q)(queueScheduler))),scan(((state,[slice,stateAccumulator])=>stateAccumulator(state,slice)),{}),(0,tap.b)((newState=>compositionObservable.state=newState),(error=>console.error(error))),(0,catchError.K)((e=>empty.E)),function publish(selector){return selector?function(source){return connect(selector)(source)}:function(source){return multicast(new Subject.x)(source)}}()),state$=signal$.pipe(function publishReplay(bufferSize,windowTime,selectorOrScheduler,timestampProvider){selectorOrScheduler&&!(0,isFunction.m)(selectorOrScheduler)&&(timestampProvider=selectorOrScheduler);var selector=(0,isFunction.m)(selectorOrScheduler)?selectorOrScheduler:void 0;return function(source){return multicast(new ReplaySubject.t(bufferSize,windowTime,timestampProvider),selector)(source)}}(1)),compositionObservable={state:{},signal$,state$,nextSlice:function nextSlice(stateSlice){stateSlices.next(stateSlice)},nextSliceObservable:function nextSliceObservable(stateObservable){stateObservables.next(stateObservable)},nextAccumulator:function nextAccumulator(accumulatorFn){accumulatorObservable.next(accumulatorFn)},subscribe:function subscribe(){const sub=compositionObservable.signal$.connect();return sub.add(compositionObservable.state$.connect()),sub.add((()=>{accumulatorObservable.complete(),stateObservables.complete(),stateSlices.complete()})),sub}};return compositionObservable}function isOperateFnArrayGuard(op){return!!Array.isArray(op)&&(op.length>0&&op.every((i=>"function"==typeof i)))}function isStringArrayGuard(op){return!!Array.isArray(op)&&(op.length>0&&op.every((i=>"string"==typeof i)))}function isKeyOf(k){return null!=k&&["string","symbol","number"].includes(typeof k)}function isObjectGuard(obj){return null!=obj&&"object"==typeof obj&&!Array.isArray(obj)}function isDefined(val){return null!=val}function pipeFromArray(fns){return fns?1===fns.length?fns[0]:function piped(input){return fns.reduce(((prev,fn)=>fn(prev)),input)}:noop.Z}function stateful(...optionalDerive){return s=>s.pipe((0,distinctUntilChanged.x)(),(o=>isOperateFnArrayGuard(optionalDerive)?o.pipe(pipeFromArray(optionalDerive)):o),(0,filter.h)((v=>void 0!==v)),(0,distinctUntilChanged.x)(),(0,shareReplay.d)({bufferSize:1,refCount:!0}))}function safePluck(stateObject,keys){if(!isDefined(stateObject))return stateObject;if(!isDefined(keys))return;const keysArr=(Array.isArray(keys)?keys:[keys]).filter((k=>isKeyOf(k)));if(0===keysArr.length||!isObjectGuard(stateObject)||0===Object.keys(stateObject).length)return;let prop=stateObject[keysArr.shift()];return keysArr.forEach((key=>{isObjectGuard(prop)&&isKeyOf(key)&&(prop=prop[key])})),prop}function defaultCompare(oldVal,newVal){return oldVal===newVal}function selectSlice(keys,keyCompareMap){return o$=>o$.pipe((0,filter.h)((state=>void 0!==state)),(0,map.U)((state=>{if(null===state)return null;const definedKeys=keys.filter((k=>state.hasOwnProperty(k)&&void 0!==state[k]));return definedKeys.length<keys.length?void 0:definedKeys.reduce(((vm,key)=>(vm[key]=state[key],vm)),{})})),(0,filter.h)((v=>void 0!==v)),function distinctUntilSomeChanged(keys,keyCompareMap){let distinctCompare=(oldState,newState)=>keys.some((key=>!defaultCompare(safePluck(oldState,[key]),safePluck(newState,[key]))));if(void 0!==keyCompareMap){const compare=key=>keyCompareMap.hasOwnProperty(key)&&void 0!==keyCompareMap[key]?keyCompareMap[key]:defaultCompare;distinctCompare=(oldState,newState)=>keys.some((key=>!compare(key)(safePluck(oldState,[key]),safePluck(newState,[key]))))}return(0,distinctUntilChanged.x)(((oldV,newV)=>!distinctCompare(oldV,newV)))}(keys,keyCompareMap))}function state_selections_select(...opOrMapFn){return state$=>{if(opOrMapFn&&0!==opOrMapFn.length){if(function isStringAndFunctionTupleGuard(op){return"string"==typeof op[0]&&"function"==typeof op[1]}(opOrMapFn))return state$.pipe(stateful((0,map.U)((s=>opOrMapFn[1](s[opOrMapFn[0]])))));if(function isStringArrayFunctionAndOptionalObjectTupleGuard(op){return isStringArrayGuard(op[0])&&"function"==typeof op[1]&&(void 0===op[2]||"object"==typeof op[2])}(opOrMapFn))return state$.pipe(selectSlice(opOrMapFn[0],opOrMapFn[2]),stateful((0,map.U)(opOrMapFn[1])));if(isStringArrayGuard(opOrMapFn))return state$.pipe(stateful(function pluck(){for(var properties=[],_i=0;_i<arguments.length;_i++)properties[_i]=arguments[_i];var length=properties.length;if(0===length)throw new Error("list of properties cannot be empty.");return(0,map.U)((function(x){for(var currentProp=x,i=0;i<length;i++){var p=null==currentProp?void 0:currentProp[properties[i]];if(void 0===p)return;currentProp=p}return currentProp}))}(...opOrMapFn)));if(isOperateFnArrayGuard(opOrMapFn))return state$.pipe(stateful(pipeFromArray(opOrMapFn)));throw new Error("wrong params passed to select")}return state$.pipe(stateful())}}var Subscription=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js");class RxState{constructor(){this.subscription=new Subscription.w0,this.accumulator=createAccumulationObservable(),this.effectObservable=function createSideEffectObservable(stateObservables=new Subject.x){const effects$=(0,merge.T)(stateObservables.pipe((0,mergeAll.J)(),(0,observeOn.Q)(queueScheduler)));return{effects$,nextEffectObservable:function nextEffectObservable(effect$){stateObservables.next(effect$)},subscribe:function subscribe(){return effects$.subscribe()}}}(),this.$=this.accumulator.signal$,this.subscription.add(this.subscribe())}ngOnDestroy(){this.subscription.unsubscribe()}setAccumulator(accumulatorFn){this.accumulator.nextAccumulator(accumulatorFn)}get(...keys){const hasStateAnyKeys=Object.keys(this.accumulator.state).length>0;return keys&&keys.length?safePluck(this.accumulator.state,keys):hasStateAnyKeys?this.accumulator.state:void 0}set(keyOrStateOrProjectState,stateOrSliceProjectFn){if("object"!=typeof keyOrStateOrProjectState||void 0!==stateOrSliceProjectFn){if("function"!=typeof keyOrStateOrProjectState||void 0!==stateOrSliceProjectFn){if(isKeyOf(keyOrStateOrProjectState)&&"function"==typeof stateOrSliceProjectFn){const state={};return state[keyOrStateOrProjectState]=stateOrSliceProjectFn(this.accumulator.state),void this.accumulator.nextSlice(state)}throw new Error("wrong params passed to set")}this.accumulator.nextSlice(keyOrStateOrProjectState(this.accumulator.state))}else this.accumulator.nextSlice(keyOrStateOrProjectState)}connect(keyOrInputOrSlice$,projectOrSlices$,projectValueFn){if(void 0===projectValueFn&&void 0===projectOrSlices$&&(0,isObservable.b)(keyOrInputOrSlice$))this.accumulator.nextSliceObservable(keyOrInputOrSlice$);else if(void 0!==projectValueFn||"function"!=typeof projectOrSlices$||!(0,isObservable.b)(keyOrInputOrSlice$)||(0,isObservable.b)(projectOrSlices$))if(void 0===projectValueFn&&isKeyOf(keyOrInputOrSlice$)&&(0,isObservable.b)(projectOrSlices$)){const key=keyOrInputOrSlice$,slice$=projectOrSlices$.pipe((0,map.U)((value=>({[key]:value}))));this.accumulator.nextSliceObservable(slice$)}else{if("function"!=typeof projectValueFn||!isKeyOf(keyOrInputOrSlice$)||!(0,isObservable.b)(projectOrSlices$))throw new Error("wrong params passed to connect");{const key=keyOrInputOrSlice$,slice$=projectOrSlices$.pipe((0,map.U)((value=>({[key]:projectValueFn(this.get(),value)}))));this.accumulator.nextSliceObservable(slice$)}}else{const project=projectOrSlices$,slice$=keyOrInputOrSlice$.pipe((0,map.U)((v=>project(this.get(),v))));this.accumulator.nextSliceObservable(slice$)}}select(...args){return this.accumulator.state$.pipe(state_selections_select(...args))}hold(obsOrObsWithSideEffect,sideEffectFn){const sideEffect=obsOrObsWithSideEffect.pipe((0,catchError.K)((e=>empty.E)));"function"!=typeof sideEffectFn?this.effectObservable.nextEffectObservable(sideEffect):this.effectObservable.nextEffectObservable(sideEffect.pipe((0,tap.b)(sideEffectFn)))}subscribe(){const subscription=new Subscription.w0;return subscription.add(this.accumulator.subscribe()),subscription.add(this.effectObservable.subscribe()),subscription}}RxState.ɵfac=function RxState_Factory(t){return new(t||RxState)},RxState.ɵprov=core["ɵɵdefineInjectable"]({token:RxState,factory:RxState.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RxState,[{type:core.Injectable}],(function(){return[]}),null);var EmptyError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/EmptyError.js"),concat=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/concat.js");function defer(observableFactory){return new Observable.y((function(subscriber){(0,innerFrom.Xf)(observableFactory()).subscribe(subscriber)}))}function throwError(errorOrErrorFactory,scheduler){var errorFactory=(0,isFunction.m)(errorOrErrorFactory)?errorOrErrorFactory:function(){return errorOrErrorFactory},init=function(subscriber){return subscriber.error(errorFactory())};return new Observable.y(scheduler?function(subscriber){return scheduler.schedule(init,0,subscriber)}:init)}var mergeMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),first=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/first.js"),concatMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/concatMap.js"),defaultIfEmpty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");function takeLast(count){return count<=0?function(){return empty.E}:(0,lift.e)((function(source,subscriber){var buffer=[];source.subscribe((0,OperatorSubscriber.x)(subscriber,(function(value){buffer.push(value),count<buffer.length&&buffer.shift()}),(function(){var e_1,_a;try{for(var buffer_1=(0,tslib_es6.XA)(buffer),buffer_1_1=buffer_1.next();!buffer_1_1.done;buffer_1_1=buffer_1.next()){var value=buffer_1_1.value;subscriber.next(value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{buffer_1_1&&!buffer_1_1.done&&(_a=buffer_1.return)&&_a.call(buffer_1)}finally{if(e_1)throw e_1.error}}subscriber.complete()}),void 0,(function(){buffer=null})))}))}var throwIfEmpty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/throwIfEmpty.js"),identity=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js");var _class,_class2,_class3,_class4,_class5,_class6,_class7,_class8,_class9,_class10,_class11,_class12,_class13,_class14,_class15,_class16,_class17,_class18,_class19,_class20,_class21,finalize=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/finalize.js"),refCount=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/refCount.js"),platform_browser=__webpack_require__("./node_modules/@angular/platform-browser/fesm2022/platform-browser.mjs");const PRIMARY_OUTLET="primary",RouteTitleKey=Symbol("RouteTitle");class ParamsAsMap{constructor(params){this.params=params||{}}has(name){return Object.prototype.hasOwnProperty.call(this.params,name)}get(name){if(this.has(name)){const v=this.params[name];return Array.isArray(v)?v[0]:v}return null}getAll(name){if(this.has(name)){const v=this.params[name];return Array.isArray(v)?v:[v]}return[]}get keys(){return Object.keys(this.params)}}function convertToParamMap(params){return new ParamsAsMap(params)}function defaultUrlMatcher(segments,segmentGroup,route){const parts=route.path.split("/");if(parts.length>segments.length)return null;if("full"===route.pathMatch&&(segmentGroup.hasChildren()||parts.length<segments.length))return null;const posParams={};for(let index=0;index<parts.length;index++){const part=parts[index],segment=segments[index];if(part.startsWith(":"))posParams[part.substring(1)]=segment;else if(part!==segment.path)return null}return{consumed:segments.slice(0,parts.length),posParams}}function shallowEqual(a,b){const k1=a?Object.keys(a):void 0,k2=b?Object.keys(b):void 0;if(!k1||!k2||k1.length!=k2.length)return!1;let key;for(let i=0;i<k1.length;i++)if(key=k1[i],!equalArraysOrString(a[key],b[key]))return!1;return!0}function equalArraysOrString(a,b){if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;const aSorted=[...a].sort(),bSorted=[...b].sort();return aSorted.every(((val,index)=>bSorted[index]===val))}return a===b}function router_last(a){return a.length>0?a[a.length-1]:null}function wrapIntoObservable(value){return(0,isObservable.b)(value)?value:(0,core["ɵisPromise"])(value)?(0,from.D)(Promise.resolve(value)):(0,of.of)(value)}const pathCompareMap={exact:function equalSegmentGroups(container,containee,matrixParams){if(!equalPath(container.segments,containee.segments))return!1;if(!matrixParamsMatch(container.segments,containee.segments,matrixParams))return!1;if(container.numberOfChildren!==containee.numberOfChildren)return!1;for(const c in containee.children){if(!container.children[c])return!1;if(!equalSegmentGroups(container.children[c],containee.children[c],matrixParams))return!1}return!0},subset:containsSegmentGroup},paramCompareMap={exact:function equalParams(container,containee){return shallowEqual(container,containee)},subset:function containsParams(container,containee){return Object.keys(containee).length<=Object.keys(container).length&&Object.keys(containee).every((key=>equalArraysOrString(container[key],containee[key])))},ignored:()=>!0};function containsTree(container,containee,options){return pathCompareMap[options.paths](container.root,containee.root,options.matrixParams)&&paramCompareMap[options.queryParams](container.queryParams,containee.queryParams)&&!("exact"===options.fragment&&container.fragment!==containee.fragment)}function containsSegmentGroup(container,containee,matrixParams){return containsSegmentGroupHelper(container,containee,containee.segments,matrixParams)}function containsSegmentGroupHelper(container,containee,containeePaths,matrixParams){if(container.segments.length>containeePaths.length){const current=container.segments.slice(0,containeePaths.length);return!!equalPath(current,containeePaths)&&(!containee.hasChildren()&&!!matrixParamsMatch(current,containeePaths,matrixParams))}if(container.segments.length===containeePaths.length){if(!equalPath(container.segments,containeePaths))return!1;if(!matrixParamsMatch(container.segments,containeePaths,matrixParams))return!1;for(const c in containee.children){if(!container.children[c])return!1;if(!containsSegmentGroup(container.children[c],containee.children[c],matrixParams))return!1}return!0}{const current=containeePaths.slice(0,container.segments.length),next=containeePaths.slice(container.segments.length);return!!equalPath(container.segments,current)&&(!!matrixParamsMatch(container.segments,current,matrixParams)&&(!!container.children[PRIMARY_OUTLET]&&containsSegmentGroupHelper(container.children[PRIMARY_OUTLET],containee,next,matrixParams)))}}function matrixParamsMatch(containerPaths,containeePaths,options){return containeePaths.every(((containeeSegment,i)=>paramCompareMap[options](containerPaths[i].parameters,containeeSegment.parameters)))}class UrlTree{constructor(root=new UrlSegmentGroup([],{}),queryParams={},fragment=null){if(this.root=root,this.queryParams=queryParams,this.fragment=fragment,("undefined"==typeof ngDevMode||ngDevMode)&&root.segments.length>0)throw new core["ɵRuntimeError"](4015,"The root `UrlSegmentGroup` should not contain `segments`. Instead, these segments belong in the `children` so they can be associated with a named outlet.")}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=convertToParamMap(this.queryParams)),this._queryParamMap}toString(){return DEFAULT_SERIALIZER.serialize(this)}}class UrlSegmentGroup{constructor(segments,children){this.segments=segments,this.children=children,this.parent=null,Object.values(children).forEach((v=>v.parent=this))}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return serializePaths(this)}}class UrlSegment{constructor(path,parameters){this.path=path,this.parameters=parameters}get parameterMap(){return this._parameterMap||(this._parameterMap=convertToParamMap(this.parameters)),this._parameterMap}toString(){return serializePath(this)}}function equalPath(as,bs){return as.length===bs.length&&as.every(((a,i)=>a.path===bs[i].path))}class UrlSerializer{}(_class=UrlSerializer).ɵfac=function _class_Factory(t){return new(t||_class)},_class.ɵprov=core["ɵɵdefineInjectable"]({token:_class,factory:function(){return new DefaultUrlSerializer},providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](UrlSerializer,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>new DefaultUrlSerializer}]}],null,null);class DefaultUrlSerializer{parse(url){const p=new UrlParser(url);return new UrlTree(p.parseRootSegment(),p.parseQueryParams(),p.parseFragment())}serialize(tree){return`${`/${serializeSegment(tree.root,!0)}`}${function serializeQueryParams(params){const strParams=Object.keys(params).map((name=>{const value=params[name];return Array.isArray(value)?value.map((v=>`${encodeUriQuery(name)}=${encodeUriQuery(v)}`)).join("&"):`${encodeUriQuery(name)}=${encodeUriQuery(value)}`})).filter((s=>!!s));return strParams.length?`?${strParams.join("&")}`:""}(tree.queryParams)}${"string"==typeof tree.fragment?`#${function encodeUriFragment(s){return encodeURI(s)}(tree.fragment)}`:""}`}}const DEFAULT_SERIALIZER=new DefaultUrlSerializer;function serializePaths(segment){return segment.segments.map((p=>serializePath(p))).join("/")}function serializeSegment(segment,root){if(!segment.hasChildren())return serializePaths(segment);if(root){const primary=segment.children[PRIMARY_OUTLET]?serializeSegment(segment.children[PRIMARY_OUTLET],!1):"",children=[];return Object.entries(segment.children).forEach((([k,v])=>{k!==PRIMARY_OUTLET&&children.push(`${k}:${serializeSegment(v,!1)}`)})),children.length>0?`${primary}(${children.join("//")})`:primary}{const children=function mapChildrenIntoArray(segment,fn){let res=[];return Object.entries(segment.children).forEach((([childOutlet,child])=>{childOutlet===PRIMARY_OUTLET&&(res=res.concat(fn(child,childOutlet)))})),Object.entries(segment.children).forEach((([childOutlet,child])=>{childOutlet!==PRIMARY_OUTLET&&(res=res.concat(fn(child,childOutlet)))})),res}(segment,((v,k)=>k===PRIMARY_OUTLET?[serializeSegment(segment.children[PRIMARY_OUTLET],!1)]:[`${k}:${serializeSegment(v,!1)}`]));return 1===Object.keys(segment.children).length&&null!=segment.children[PRIMARY_OUTLET]?`${serializePaths(segment)}/${children[0]}`:`${serializePaths(segment)}/(${children.join("//")})`}}function encodeUriString(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function encodeUriQuery(s){return encodeUriString(s).replace(/%3B/gi,";")}function encodeUriSegment(s){return encodeUriString(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function decode(s){return decodeURIComponent(s)}function decodeQuery(s){return decode(s.replace(/\+/g,"%20"))}function serializePath(path){return`${encodeUriSegment(path.path)}${function serializeMatrixParams(params){return Object.keys(params).map((key=>`;${encodeUriSegment(key)}=${encodeUriSegment(params[key])}`)).join("")}(path.parameters)}`}const SEGMENT_RE=/^[^\/()?;#]+/;function matchSegments(str){const match=str.match(SEGMENT_RE);return match?match[0]:""}const MATRIX_PARAM_SEGMENT_RE=/^[^\/()?;=#]+/;const QUERY_PARAM_RE=/^[^=?&#]+/;const QUERY_PARAM_VALUE_RE=/^[^&#]+/;class UrlParser{constructor(url){this.url=url,this.remaining=url}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new UrlSegmentGroup([],{}):new UrlSegmentGroup([],this.parseChildren())}parseQueryParams(){const params={};if(this.consumeOptional("?"))do{this.parseQueryParam(params)}while(this.consumeOptional("&"));return params}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const segments=[];for(this.peekStartsWith("(")||segments.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),segments.push(this.parseSegment());let children={};this.peekStartsWith("/(")&&(this.capture("/"),children=this.parseParens(!0));let res={};return this.peekStartsWith("(")&&(res=this.parseParens(!1)),(segments.length>0||Object.keys(children).length>0)&&(res[PRIMARY_OUTLET]=new UrlSegmentGroup(segments,children)),res}parseSegment(){const path=matchSegments(this.remaining);if(""===path&&this.peekStartsWith(";"))throw new core["ɵRuntimeError"](4009,("undefined"==typeof ngDevMode||ngDevMode)&&`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(path),new UrlSegment(decode(path),this.parseMatrixParams())}parseMatrixParams(){const params={};for(;this.consumeOptional(";");)this.parseParam(params);return params}parseParam(params){const key=function matchMatrixKeySegments(str){const match=str.match(MATRIX_PARAM_SEGMENT_RE);return match?match[0]:""}(this.remaining);if(!key)return;this.capture(key);let value="";if(this.consumeOptional("=")){const valueMatch=matchSegments(this.remaining);valueMatch&&(value=valueMatch,this.capture(value))}params[decode(key)]=decode(value)}parseQueryParam(params){const key=function matchQueryParams(str){const match=str.match(QUERY_PARAM_RE);return match?match[0]:""}(this.remaining);if(!key)return;this.capture(key);let value="";if(this.consumeOptional("=")){const valueMatch=function matchUrlQueryParamValue(str){const match=str.match(QUERY_PARAM_VALUE_RE);return match?match[0]:""}(this.remaining);valueMatch&&(value=valueMatch,this.capture(value))}const decodedKey=decodeQuery(key),decodedVal=decodeQuery(value);if(params.hasOwnProperty(decodedKey)){let currentVal=params[decodedKey];Array.isArray(currentVal)||(currentVal=[currentVal],params[decodedKey]=currentVal),currentVal.push(decodedVal)}else params[decodedKey]=decodedVal}parseParens(allowPrimary){const segments={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const path=matchSegments(this.remaining),next=this.remaining[path.length];if("/"!==next&&")"!==next&&";"!==next)throw new core["ɵRuntimeError"](4010,("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot parse url '${this.url}'`);let outletName;path.indexOf(":")>-1?(outletName=path.slice(0,path.indexOf(":")),this.capture(outletName),this.capture(":")):allowPrimary&&(outletName=PRIMARY_OUTLET);const children=this.parseChildren();segments[outletName]=1===Object.keys(children).length?children[PRIMARY_OUTLET]:new UrlSegmentGroup([],children),this.consumeOptional("//")}return segments}peekStartsWith(str){return this.remaining.startsWith(str)}consumeOptional(str){return!!this.peekStartsWith(str)&&(this.remaining=this.remaining.substring(str.length),!0)}capture(str){if(!this.consumeOptional(str))throw new core["ɵRuntimeError"](4011,("undefined"==typeof ngDevMode||ngDevMode)&&`Expected "${str}".`)}}function createRoot(rootCandidate){return rootCandidate.segments.length>0?new UrlSegmentGroup([],{[PRIMARY_OUTLET]:rootCandidate}):rootCandidate}function squashSegmentGroup(segmentGroup){const newChildren={};for(const childOutlet of Object.keys(segmentGroup.children)){const childCandidate=squashSegmentGroup(segmentGroup.children[childOutlet]);if(childOutlet===PRIMARY_OUTLET&&0===childCandidate.segments.length&&childCandidate.hasChildren())for(const[grandChildOutlet,grandChild]of Object.entries(childCandidate.children))newChildren[grandChildOutlet]=grandChild;else(childCandidate.segments.length>0||childCandidate.hasChildren())&&(newChildren[childOutlet]=childCandidate)}return function mergeTrivialChildren(s){if(1===s.numberOfChildren&&s.children[PRIMARY_OUTLET]){const c=s.children[PRIMARY_OUTLET];return new UrlSegmentGroup(s.segments.concat(c.segments),c.children)}return s}(new UrlSegmentGroup(segmentGroup.segments,newChildren))}function isUrlTree(v){return v instanceof UrlTree}function createSegmentGroupFromRoute(route){let targetGroup;const rootCandidate=function createSegmentGroupFromRouteRecursive(currentRoute){const childOutlets={};for(const childSnapshot of currentRoute.children){const root=createSegmentGroupFromRouteRecursive(childSnapshot);childOutlets[childSnapshot.outlet]=root}const segmentGroup=new UrlSegmentGroup(currentRoute.url,childOutlets);return currentRoute===route&&(targetGroup=segmentGroup),segmentGroup}(route.root),rootSegmentGroup=createRoot(rootCandidate);return targetGroup??rootSegmentGroup}function createUrlTreeFromSegmentGroup(relativeTo,commands,queryParams,fragment){let root=relativeTo;for(;root.parent;)root=root.parent;if(0===commands.length)return tree(root,root,root,queryParams,fragment);const nav=function computeNavigation(commands){if("string"==typeof commands[0]&&1===commands.length&&"/"===commands[0])return new Navigation(!0,0,commands);let numberOfDoubleDots=0,isAbsolute=!1;const res=commands.reduce(((res,cmd,cmdIdx)=>{if("object"==typeof cmd&&null!=cmd){if(cmd.outlets){const outlets={};return Object.entries(cmd.outlets).forEach((([name,commands])=>{outlets[name]="string"==typeof commands?commands.split("/"):commands})),[...res,{outlets}]}if(cmd.segmentPath)return[...res,cmd.segmentPath]}return"string"!=typeof cmd?[...res,cmd]:0===cmdIdx?(cmd.split("/").forEach(((urlPart,partIndex)=>{0==partIndex&&"."===urlPart||(0==partIndex&&""===urlPart?isAbsolute=!0:".."===urlPart?numberOfDoubleDots++:""!=urlPart&&res.push(urlPart))})),res):[...res,cmd]}),[]);return new Navigation(isAbsolute,numberOfDoubleDots,res)}(commands);if(nav.toRoot())return tree(root,root,new UrlSegmentGroup([],{}),queryParams,fragment);const position=function findStartingPositionForTargetGroup(nav,root,target){if(nav.isAbsolute)return new Position(root,!0,0);if(!target)return new Position(root,!1,NaN);if(null===target.parent)return new Position(target,!0,0);const modifier=isMatrixParams(nav.commands[0])?0:1,index=target.segments.length-1+modifier;return function createPositionApplyingDoubleDots(group,index,numberOfDoubleDots){let g=group,ci=index,dd=numberOfDoubleDots;for(;dd>ci;){if(dd-=ci,g=g.parent,!g)throw new core["ɵRuntimeError"](4005,("undefined"==typeof ngDevMode||ngDevMode)&&"Invalid number of '../'");ci=g.segments.length}return new Position(g,!1,ci-dd)}(target,index,nav.numberOfDoubleDots)}(nav,root,relativeTo),newSegmentGroup=position.processChildren?updateSegmentGroupChildren(position.segmentGroup,position.index,nav.commands):updateSegmentGroup(position.segmentGroup,position.index,nav.commands);return tree(root,position.segmentGroup,newSegmentGroup,queryParams,fragment)}function isMatrixParams(command){return"object"==typeof command&&null!=command&&!command.outlets&&!command.segmentPath}function isCommandWithOutlets(command){return"object"==typeof command&&null!=command&&command.outlets}function tree(oldRoot,oldSegmentGroup,newSegmentGroup,queryParams,fragment){let rootCandidate,qp={};queryParams&&Object.entries(queryParams).forEach((([name,value])=>{qp[name]=Array.isArray(value)?value.map((v=>`${v}`)):`${value}`})),rootCandidate=oldRoot===oldSegmentGroup?newSegmentGroup:replaceSegment(oldRoot,oldSegmentGroup,newSegmentGroup);const newRoot=createRoot(squashSegmentGroup(rootCandidate));return new UrlTree(newRoot,qp,fragment)}function replaceSegment(current,oldSegment,newSegment){const children={};return Object.entries(current.children).forEach((([outletName,c])=>{children[outletName]=c===oldSegment?newSegment:replaceSegment(c,oldSegment,newSegment)})),new UrlSegmentGroup(current.segments,children)}class Navigation{constructor(isAbsolute,numberOfDoubleDots,commands){if(this.isAbsolute=isAbsolute,this.numberOfDoubleDots=numberOfDoubleDots,this.commands=commands,isAbsolute&&commands.length>0&&isMatrixParams(commands[0]))throw new core["ɵRuntimeError"](4003,("undefined"==typeof ngDevMode||ngDevMode)&&"Root segment cannot have matrix parameters");const cmdWithOutlet=commands.find(isCommandWithOutlets);if(cmdWithOutlet&&cmdWithOutlet!==router_last(commands))throw new core["ɵRuntimeError"](4004,("undefined"==typeof ngDevMode||ngDevMode)&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Position{constructor(segmentGroup,processChildren,index){this.segmentGroup=segmentGroup,this.processChildren=processChildren,this.index=index}}function updateSegmentGroup(segmentGroup,startIndex,commands){if(segmentGroup||(segmentGroup=new UrlSegmentGroup([],{})),0===segmentGroup.segments.length&&segmentGroup.hasChildren())return updateSegmentGroupChildren(segmentGroup,startIndex,commands);const m=function prefixedWith(segmentGroup,startIndex,commands){let currentCommandIndex=0,currentPathIndex=startIndex;const noMatch={match:!1,pathIndex:0,commandIndex:0};for(;currentPathIndex<segmentGroup.segments.length;){if(currentCommandIndex>=commands.length)return noMatch;const path=segmentGroup.segments[currentPathIndex],command=commands[currentCommandIndex];if(isCommandWithOutlets(command))break;const curr=`${command}`,next=currentCommandIndex<commands.length-1?commands[currentCommandIndex+1]:null;if(currentPathIndex>0&&void 0===curr)break;if(curr&&next&&"object"==typeof next&&void 0===next.outlets){if(!compare(curr,next,path))return noMatch;currentCommandIndex+=2}else{if(!compare(curr,{},path))return noMatch;currentCommandIndex++}currentPathIndex++}return{match:!0,pathIndex:currentPathIndex,commandIndex:currentCommandIndex}}(segmentGroup,startIndex,commands),slicedCommands=commands.slice(m.commandIndex);if(m.match&&m.pathIndex<segmentGroup.segments.length){const g=new UrlSegmentGroup(segmentGroup.segments.slice(0,m.pathIndex),{});return g.children[PRIMARY_OUTLET]=new UrlSegmentGroup(segmentGroup.segments.slice(m.pathIndex),segmentGroup.children),updateSegmentGroupChildren(g,0,slicedCommands)}return m.match&&0===slicedCommands.length?new UrlSegmentGroup(segmentGroup.segments,{}):m.match&&!segmentGroup.hasChildren()?createNewSegmentGroup(segmentGroup,startIndex,commands):m.match?updateSegmentGroupChildren(segmentGroup,0,slicedCommands):createNewSegmentGroup(segmentGroup,startIndex,commands)}function updateSegmentGroupChildren(segmentGroup,startIndex,commands){if(0===commands.length)return new UrlSegmentGroup(segmentGroup.segments,{});{const outlets=function getOutlets(commands){return isCommandWithOutlets(commands[0])?commands[0].outlets:{[PRIMARY_OUTLET]:commands}}(commands),children={};if(Object.keys(outlets).some((o=>o!==PRIMARY_OUTLET))&&segmentGroup.children[PRIMARY_OUTLET]&&1===segmentGroup.numberOfChildren&&0===segmentGroup.children[PRIMARY_OUTLET].segments.length){const childrenOfEmptyChild=updateSegmentGroupChildren(segmentGroup.children[PRIMARY_OUTLET],startIndex,commands);return new UrlSegmentGroup(segmentGroup.segments,childrenOfEmptyChild.children)}return Object.entries(outlets).forEach((([outlet,commands])=>{"string"==typeof commands&&(commands=[commands]),null!==commands&&(children[outlet]=updateSegmentGroup(segmentGroup.children[outlet],startIndex,commands))})),Object.entries(segmentGroup.children).forEach((([childOutlet,child])=>{void 0===outlets[childOutlet]&&(children[childOutlet]=child)})),new UrlSegmentGroup(segmentGroup.segments,children)}}function createNewSegmentGroup(segmentGroup,startIndex,commands){const paths=segmentGroup.segments.slice(0,startIndex);let i=0;for(;i<commands.length;){const command=commands[i];if(isCommandWithOutlets(command)){const children=createNewSegmentChildren(command.outlets);return new UrlSegmentGroup(paths,children)}if(0===i&&isMatrixParams(commands[0])){const p=segmentGroup.segments[startIndex];paths.push(new UrlSegment(p.path,stringify(commands[0]))),i++;continue}const curr=isCommandWithOutlets(command)?command.outlets[PRIMARY_OUTLET]:`${command}`,next=i<commands.length-1?commands[i+1]:null;curr&&next&&isMatrixParams(next)?(paths.push(new UrlSegment(curr,stringify(next))),i+=2):(paths.push(new UrlSegment(curr,{})),i++)}return new UrlSegmentGroup(paths,{})}function createNewSegmentChildren(outlets){const children={};return Object.entries(outlets).forEach((([outlet,commands])=>{"string"==typeof commands&&(commands=[commands]),null!==commands&&(children[outlet]=createNewSegmentGroup(new UrlSegmentGroup([],{}),0,commands))})),children}function stringify(params){const res={};return Object.entries(params).forEach((([k,v])=>res[k]=`${v}`)),res}function compare(path,params,segment){return path==segment.path&&shallowEqual(params,segment.parameters)}class RouterEvent{constructor(id,url){this.id=id,this.url=url}}class NavigationStart extends RouterEvent{constructor(id,url,navigationTrigger="imperative",restoredState=null){super(id,url),this.type=0,this.navigationTrigger=navigationTrigger,this.restoredState=restoredState}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class NavigationEnd extends RouterEvent{constructor(id,url,urlAfterRedirects){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class NavigationCancel extends RouterEvent{constructor(id,url,reason,code){super(id,url),this.reason=reason,this.code=code,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class NavigationSkipped extends RouterEvent{constructor(id,url,reason,code){super(id,url),this.reason=reason,this.code=code,this.type=16}}class NavigationError extends RouterEvent{constructor(id,url,error,target){super(id,url),this.error=error,this.target=target,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class RoutesRecognized extends RouterEvent{constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GuardsCheckStart extends RouterEvent{constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GuardsCheckEnd extends RouterEvent{constructor(id,url,urlAfterRedirects,state,shouldActivate){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state,this.shouldActivate=shouldActivate,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ResolveStart extends RouterEvent{constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ResolveEnd extends RouterEvent{constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class RouteConfigLoadStart{constructor(route){this.route=route,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class RouteConfigLoadEnd{constructor(route){this.route=route,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class ChildActivationStart{constructor(snapshot){this.snapshot=snapshot,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ChildActivationEnd{constructor(snapshot){this.snapshot=snapshot,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ActivationStart{constructor(snapshot){this.snapshot=snapshot,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ActivationEnd{constructor(snapshot){this.snapshot=snapshot,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Scroll{constructor(routerEvent,position,anchor){this.routerEvent=routerEvent,this.position=position,this.anchor=anchor,this.type=15}toString(){const pos=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${pos}')`}}class OutletContext{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ChildrenOutletContexts,this.attachRef=null}}class ChildrenOutletContexts{constructor(){this.contexts=new Map}onChildOutletCreated(childName,outlet){const context=this.getOrCreateContext(childName);context.outlet=outlet,this.contexts.set(childName,context)}onChildOutletDestroyed(childName){const context=this.getContext(childName);context&&(context.outlet=null,context.attachRef=null)}onOutletDeactivated(){const contexts=this.contexts;return this.contexts=new Map,contexts}onOutletReAttached(contexts){this.contexts=contexts}getOrCreateContext(childName){let context=this.getContext(childName);return context||(context=new OutletContext,this.contexts.set(childName,context)),context}getContext(childName){return this.contexts.get(childName)||null}}(_class2=ChildrenOutletContexts).ɵfac=function _class2_Factory(t){return new(t||_class2)},_class2.ɵprov=core["ɵɵdefineInjectable"]({token:_class2,factory:_class2.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](ChildrenOutletContexts,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class Tree{constructor(root){this._root=root}get root(){return this._root.value}parent(t){const p=this.pathFromRoot(t);return p.length>1?p[p.length-2]:null}children(t){const n=findNode(t,this._root);return n?n.children.map((t=>t.value)):[]}firstChild(t){const n=findNode(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const p=findPath(t,this._root);if(p.length<2)return[];return p[p.length-2].children.map((c=>c.value)).filter((cc=>cc!==t))}pathFromRoot(t){return findPath(t,this._root).map((s=>s.value))}}function findNode(value,node){if(value===node.value)return node;for(const child of node.children){const node=findNode(value,child);if(node)return node}return null}function findPath(value,node){if(value===node.value)return[node];for(const child of node.children){const path=findPath(value,child);if(path.length)return path.unshift(node),path}return[]}class TreeNode{constructor(value,children){this.value=value,this.children=children}toString(){return`TreeNode(${this.value})`}}function nodeChildrenAsMap(node){const map={};return node&&node.children.forEach((child=>map[child.value.outlet]=child)),map}class RouterState extends Tree{constructor(root,snapshot){super(root),this.snapshot=snapshot,setRouterState(this,root)}toString(){return this.snapshot.toString()}}function createEmptyState(urlTree,rootComponent){const snapshot=function createEmptyStateSnapshot(urlTree,rootComponent){const emptyParams={},emptyData={},emptyQueryParams={},fragment="",activated=new ActivatedRouteSnapshot([],emptyParams,emptyQueryParams,fragment,emptyData,PRIMARY_OUTLET,rootComponent,null,{});return new RouterStateSnapshot("",new TreeNode(activated,[]))}(0,rootComponent),emptyUrl=new BehaviorSubject.X([new UrlSegment("",{})]),emptyParams=new BehaviorSubject.X({}),emptyData=new BehaviorSubject.X({}),emptyQueryParams=new BehaviorSubject.X({}),fragment=new BehaviorSubject.X(""),activated=new ActivatedRoute(emptyUrl,emptyParams,emptyQueryParams,fragment,emptyData,PRIMARY_OUTLET,rootComponent,snapshot.root);return activated.snapshot=snapshot.root,new RouterState(new TreeNode(activated,[]),snapshot)}class ActivatedRoute{constructor(urlSubject,paramsSubject,queryParamsSubject,fragmentSubject,dataSubject,outlet,component,futureSnapshot){this.urlSubject=urlSubject,this.paramsSubject=paramsSubject,this.queryParamsSubject=queryParamsSubject,this.fragmentSubject=fragmentSubject,this.dataSubject=dataSubject,this.outlet=outlet,this.component=component,this._futureSnapshot=futureSnapshot,this.title=this.dataSubject?.pipe((0,map.U)((d=>d[RouteTitleKey])))??(0,of.of)(void 0),this.url=urlSubject,this.params=paramsSubject,this.queryParams=queryParamsSubject,this.fragment=fragmentSubject,this.data=dataSubject}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,map.U)((p=>convertToParamMap(p))))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,map.U)((p=>convertToParamMap(p))))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function inheritedParamsDataResolve(route,paramsInheritanceStrategy="emptyOnly"){const pathFromRoot=route.pathFromRoot;let inheritingStartingFrom=0;if("always"!==paramsInheritanceStrategy)for(inheritingStartingFrom=pathFromRoot.length-1;inheritingStartingFrom>=1;){const current=pathFromRoot[inheritingStartingFrom],parent=pathFromRoot[inheritingStartingFrom-1];if(current.routeConfig&&""===current.routeConfig.path)inheritingStartingFrom--;else{if(parent.component)break;inheritingStartingFrom--}}return function flattenInherited(pathFromRoot){return pathFromRoot.reduce(((res,curr)=>({params:{...res.params,...curr.params},data:{...res.data,...curr.data},resolve:{...curr.data,...res.resolve,...curr.routeConfig?.data,...curr._resolvedData}})),{params:{},data:{},resolve:{}})}(pathFromRoot.slice(inheritingStartingFrom))}class ActivatedRouteSnapshot{get title(){return this.data?.[RouteTitleKey]}constructor(url,params,queryParams,fragment,data,outlet,component,routeConfig,resolve){this.url=url,this.params=params,this.queryParams=queryParams,this.fragment=fragment,this.data=data,this.outlet=outlet,this.component=component,this.routeConfig=routeConfig,this._resolve=resolve}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=convertToParamMap(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=convertToParamMap(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map((segment=>segment.toString())).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class RouterStateSnapshot extends Tree{constructor(url,root){super(root),this.url=url,setRouterState(this,root)}toString(){return serializeNode(this._root)}}function setRouterState(state,node){node.value._routerState=state,node.children.forEach((c=>setRouterState(state,c)))}function serializeNode(node){const c=node.children.length>0?` { ${node.children.map(serializeNode).join(", ")} } `:"";return`${node.value}${c}`}function advanceActivatedRoute(route){if(route.snapshot){const currentSnapshot=route.snapshot,nextSnapshot=route._futureSnapshot;route.snapshot=nextSnapshot,shallowEqual(currentSnapshot.queryParams,nextSnapshot.queryParams)||route.queryParamsSubject.next(nextSnapshot.queryParams),currentSnapshot.fragment!==nextSnapshot.fragment&&route.fragmentSubject.next(nextSnapshot.fragment),shallowEqual(currentSnapshot.params,nextSnapshot.params)||route.paramsSubject.next(nextSnapshot.params),function shallowEqualArrays(a,b){if(a.length!==b.length)return!1;for(let i=0;i<a.length;++i)if(!shallowEqual(a[i],b[i]))return!1;return!0}(currentSnapshot.url,nextSnapshot.url)||route.urlSubject.next(nextSnapshot.url),shallowEqual(currentSnapshot.data,nextSnapshot.data)||route.dataSubject.next(nextSnapshot.data)}else route.snapshot=route._futureSnapshot,route.dataSubject.next(route._futureSnapshot.data)}function equalParamsAndUrlSegments(a,b){const equalUrlParams=shallowEqual(a.params,b.params)&&function equalSegments(as,bs){return equalPath(as,bs)&&as.every(((a,i)=>shallowEqual(a.parameters,bs[i].parameters)))}(a.url,b.url),parentsMismatch=!a.parent!=!b.parent;return equalUrlParams&&!parentsMismatch&&(!a.parent||equalParamsAndUrlSegments(a.parent,b.parent))}class RouterOutlet{constructor(){this.activated=null,this._activatedRoute=null,this.name=PRIMARY_OUTLET,this.activateEvents=new core.EventEmitter,this.deactivateEvents=new core.EventEmitter,this.attachEvents=new core.EventEmitter,this.detachEvents=new core.EventEmitter,this.parentContexts=(0,core.inject)(ChildrenOutletContexts),this.location=(0,core.inject)(core.ViewContainerRef),this.changeDetector=(0,core.inject)(core.ChangeDetectorRef),this.environmentInjector=(0,core.inject)(core.EnvironmentInjector),this.inputBinder=(0,core.inject)(INPUT_BINDER,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(changes){if(changes.name){const{firstChange,previousValue}=changes.name;if(firstChange)return;this.isTrackedInParentContexts(previousValue)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(previousValue)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(outletName){return this.parentContexts.getContext(outletName)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const context=this.parentContexts.getContext(this.name);context?.route&&(context.attachRef?this.attach(context.attachRef,context.route):this.activateWith(context.route,context.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new core["ɵRuntimeError"](4012,("undefined"==typeof ngDevMode||ngDevMode)&&"Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new core["ɵRuntimeError"](4012,("undefined"==typeof ngDevMode||ngDevMode)&&"Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new core["ɵRuntimeError"](4012,("undefined"==typeof ngDevMode||ngDevMode)&&"Outlet is not activated");this.location.detach();const cmp=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(cmp.instance),cmp}attach(ref,activatedRoute){this.activated=ref,this._activatedRoute=activatedRoute,this.location.insert(ref.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(ref.instance)}deactivate(){if(this.activated){const c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(activatedRoute,environmentInjector){if(this.isActivated)throw new core["ɵRuntimeError"](4013,("undefined"==typeof ngDevMode||ngDevMode)&&"Cannot activate an already activated outlet");this._activatedRoute=activatedRoute;const location=this.location,component=activatedRoute.snapshot.component,childContexts=this.parentContexts.getOrCreateContext(this.name).children,injector=new OutletInjector(activatedRoute,childContexts,location.injector);this.activated=location.createComponent(component,{index:location.length,injector,environmentInjector:environmentInjector??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}(_class3=RouterOutlet).ɵfac=function _class3_Factory(t){return new(t||_class3)},_class3.ɵdir=core["ɵɵdefineDirective"]({type:_class3,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[core["ɵɵNgOnChangesFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterOutlet,[{type:core.Directive,args:[{selector:"router-outlet",exportAs:"outlet",standalone:!0}]}],null,{name:[{type:core.Input}],activateEvents:[{type:core.Output,args:["activate"]}],deactivateEvents:[{type:core.Output,args:["deactivate"]}],attachEvents:[{type:core.Output,args:["attach"]}],detachEvents:[{type:core.Output,args:["detach"]}]});class OutletInjector{constructor(route,childContexts,parent){this.route=route,this.childContexts=childContexts,this.parent=parent}get(token,notFoundValue){return token===ActivatedRoute?this.route:token===ChildrenOutletContexts?this.childContexts:this.parent.get(token,notFoundValue)}}const INPUT_BINDER=new core.InjectionToken("");class RoutedComponentInputBinder{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(outlet){this.unsubscribeFromRouteData(outlet),this.subscribeToRouteData(outlet)}unsubscribeFromRouteData(outlet){this.outletDataSubscriptions.get(outlet)?.unsubscribe(),this.outletDataSubscriptions.delete(outlet)}subscribeToRouteData(outlet){const{activatedRoute}=outlet,dataSubscription=(0,combineLatest.a)([activatedRoute.queryParams,activatedRoute.params,activatedRoute.data]).pipe((0,switchMap.w)((([queryParams,params,data],index)=>(data={...queryParams,...params,...data},0===index?(0,of.of)(data):Promise.resolve(data))))).subscribe((data=>{if(!outlet.isActivated||!outlet.activatedComponentRef||outlet.activatedRoute!==activatedRoute||null===activatedRoute.component)return void this.unsubscribeFromRouteData(outlet);const mirror=(0,core.reflectComponentType)(activatedRoute.component);if(mirror)for(const{templateName}of mirror.inputs)outlet.activatedComponentRef.setInput(templateName,data[templateName]);else this.unsubscribeFromRouteData(outlet)}));this.outletDataSubscriptions.set(outlet,dataSubscription)}}function createNode(routeReuseStrategy,curr,prevState){if(prevState&&routeReuseStrategy.shouldReuseRoute(curr.value,prevState.value.snapshot)){const value=prevState.value;value._futureSnapshot=curr.value;const children=function createOrReuseChildren(routeReuseStrategy,curr,prevState){return curr.children.map((child=>{for(const p of prevState.children)if(routeReuseStrategy.shouldReuseRoute(child.value,p.value.snapshot))return createNode(routeReuseStrategy,child,p);return createNode(routeReuseStrategy,child)}))}(routeReuseStrategy,curr,prevState);return new TreeNode(value,children)}{if(routeReuseStrategy.shouldAttach(curr.value)){const detachedRouteHandle=routeReuseStrategy.retrieve(curr.value);if(null!==detachedRouteHandle){const tree=detachedRouteHandle.route;return tree.value._futureSnapshot=curr.value,tree.children=curr.children.map((c=>createNode(routeReuseStrategy,c))),tree}}const value=function createActivatedRoute(c){return new ActivatedRoute(new BehaviorSubject.X(c.url),new BehaviorSubject.X(c.params),new BehaviorSubject.X(c.queryParams),new BehaviorSubject.X(c.fragment),new BehaviorSubject.X(c.data),c.outlet,c.component,c)}(curr.value),children=curr.children.map((c=>createNode(routeReuseStrategy,c)));return new TreeNode(value,children)}}(_class4=RoutedComponentInputBinder).ɵfac=function _class4_Factory(t){return new(t||_class4)},_class4.ɵprov=core["ɵɵdefineInjectable"]({token:_class4,factory:_class4.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RoutedComponentInputBinder,[{type:core.Injectable}],null,null);const NAVIGATION_CANCELING_ERROR="ngNavigationCancelingError";function redirectingNavigationError(urlSerializer,redirect){const{redirectTo,navigationBehaviorOptions}=isUrlTree(redirect)?{redirectTo:redirect,navigationBehaviorOptions:void 0}:redirect,error=navigationCancelingError(ngDevMode&&`Redirecting to "${urlSerializer.serialize(redirectTo)}"`,0,redirect);return error.url=redirectTo,error.navigationBehaviorOptions=navigationBehaviorOptions,error}function navigationCancelingError(message,code,redirectUrl){const error=new Error("NavigationCancelingError: "+(message||""));return error[NAVIGATION_CANCELING_ERROR]=!0,error.cancellationCode=code,redirectUrl&&(error.url=redirectUrl),error}function isRedirectingNavigationCancelingError$1(error){return isNavigationCancelingError$1(error)&&isUrlTree(error.url)}function isNavigationCancelingError$1(error){return error&&error[NAVIGATION_CANCELING_ERROR]}class ɵEmptyOutletComponent{}function validateConfig(config,parentPath="",requireStandaloneComponents=!1){for(let i=0;i<config.length;i++){const route=config[i];validateNode(route,getFullPath(parentPath,route),requireStandaloneComponents)}}function assertStandalone(fullPath,component){if(component&&(0,core["ɵisNgModule"])(component))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}'. You are using 'loadComponent' with a module, but it must be used with standalone components. Use 'loadChildren' instead.`);if(component&&!(0,core.isStandalone)(component))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}'. The component must be standalone.`)}function validateNode(route,fullPath,requireStandaloneComponents){if("undefined"==typeof ngDevMode||ngDevMode){if(!route)throw new core["ɵRuntimeError"](4014,`\n      Invalid configuration of route '${fullPath}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(route))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': Array cannot be specified`);if(!route.redirectTo&&!route.component&&!route.loadComponent&&!route.children&&!route.loadChildren&&route.outlet&&route.outlet!==PRIMARY_OUTLET)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': a componentless route without children or loadChildren cannot have a named outlet set`);if(route.redirectTo&&route.children)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and children cannot be used together`);if(route.redirectTo&&route.loadChildren)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and loadChildren cannot be used together`);if(route.children&&route.loadChildren)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': children and loadChildren cannot be used together`);if(route.redirectTo&&(route.component||route.loadComponent))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and component/loadComponent cannot be used together`);if(route.component&&route.loadComponent)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': component and loadComponent cannot be used together`);if(route.redirectTo&&route.canActivate)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and canActivate cannot be used together. Redirects happen before activation so canActivate will never be executed.`);if(route.path&&route.matcher)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': path and matcher cannot be used together`);if(!(void 0!==route.redirectTo||route.component||route.loadComponent||route.children||route.loadChildren))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}'. One of the following must be provided: component, loadComponent, redirectTo, children or loadChildren`);if(void 0===route.path&&void 0===route.matcher)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': routes must have either a path or a matcher specified`);if("string"==typeof route.path&&"/"===route.path.charAt(0))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': path cannot start with a slash`);if(""===route.path&&void 0!==route.redirectTo&&void 0===route.pathMatch){const exp="The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.";throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '{path: "${fullPath}", redirectTo: "${route.redirectTo}"}': please provide 'pathMatch'. ${exp}`)}requireStandaloneComponents&&assertStandalone(fullPath,route.component)}route.children&&validateConfig(route.children,fullPath,requireStandaloneComponents)}function getFullPath(parentPath,currentRoute){return currentRoute?parentPath||currentRoute.path?parentPath&&!currentRoute.path?`${parentPath}/`:!parentPath&&currentRoute.path?currentRoute.path:`${parentPath}/${currentRoute.path}`:"":parentPath}function standardizeConfig(r){const children=r.children&&r.children.map(standardizeConfig),c=children?{...r,children}:{...r};return c.component||c.loadComponent||!children&&!c.loadChildren||!c.outlet||c.outlet===PRIMARY_OUTLET||(c.component=ɵEmptyOutletComponent),c}function getOutlet(route){return route.outlet||PRIMARY_OUTLET}function getClosestRouteInjector(snapshot){if(!snapshot)return null;if(snapshot.routeConfig?._injector)return snapshot.routeConfig._injector;for(let s=snapshot.parent;s;s=s.parent){const route=s.routeConfig;if(route?._loadedInjector)return route._loadedInjector;if(route?._injector)return route._injector}return null}(_class5=ɵEmptyOutletComponent).ɵfac=function _class5_Factory(t){return new(t||_class5)},_class5.ɵcmp=core["ɵɵdefineComponent"]({type:_class5,selectors:[["ng-component"]],standalone:!0,features:[core["ɵɵStandaloneFeature"]],decls:1,vars:0,template:function _class5_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"router-outlet")},dependencies:[RouterOutlet],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](ɵEmptyOutletComponent,[{type:core.Component,args:[{template:"<router-outlet></router-outlet>",imports:[RouterOutlet],standalone:!0}]}],null,null);let warnedAboutUnsupportedInputBinding=!1;class ActivateRoutes{constructor(routeReuseStrategy,futureState,currState,forwardEvent,inputBindingEnabled){this.routeReuseStrategy=routeReuseStrategy,this.futureState=futureState,this.currState=currState,this.forwardEvent=forwardEvent,this.inputBindingEnabled=inputBindingEnabled}activate(parentContexts){const futureRoot=this.futureState._root,currRoot=this.currState?this.currState._root:null;this.deactivateChildRoutes(futureRoot,currRoot,parentContexts),advanceActivatedRoute(this.futureState.root),this.activateChildRoutes(futureRoot,currRoot,parentContexts)}deactivateChildRoutes(futureNode,currNode,contexts){const children=nodeChildrenAsMap(currNode);futureNode.children.forEach((futureChild=>{const childOutletName=futureChild.value.outlet;this.deactivateRoutes(futureChild,children[childOutletName],contexts),delete children[childOutletName]})),Object.values(children).forEach((v=>{this.deactivateRouteAndItsChildren(v,contexts)}))}deactivateRoutes(futureNode,currNode,parentContext){const future=futureNode.value,curr=currNode?currNode.value:null;if(future===curr)if(future.component){const context=parentContext.getContext(future.outlet);context&&this.deactivateChildRoutes(futureNode,currNode,context.children)}else this.deactivateChildRoutes(futureNode,currNode,parentContext);else curr&&this.deactivateRouteAndItsChildren(currNode,parentContext)}deactivateRouteAndItsChildren(route,parentContexts){route.value.component&&this.routeReuseStrategy.shouldDetach(route.value.snapshot)?this.detachAndStoreRouteSubtree(route,parentContexts):this.deactivateRouteAndOutlet(route,parentContexts)}detachAndStoreRouteSubtree(route,parentContexts){const context=parentContexts.getContext(route.value.outlet),contexts=context&&route.value.component?context.children:parentContexts,children=nodeChildrenAsMap(route);for(const childOutlet of Object.keys(children))this.deactivateRouteAndItsChildren(children[childOutlet],contexts);if(context&&context.outlet){const componentRef=context.outlet.detach(),contexts=context.children.onOutletDeactivated();this.routeReuseStrategy.store(route.value.snapshot,{componentRef,route,contexts})}}deactivateRouteAndOutlet(route,parentContexts){const context=parentContexts.getContext(route.value.outlet),contexts=context&&route.value.component?context.children:parentContexts,children=nodeChildrenAsMap(route);for(const childOutlet of Object.keys(children))this.deactivateRouteAndItsChildren(children[childOutlet],contexts);context&&(context.outlet&&(context.outlet.deactivate(),context.children.onOutletDeactivated()),context.attachRef=null,context.route=null)}activateChildRoutes(futureNode,currNode,contexts){const children=nodeChildrenAsMap(currNode);futureNode.children.forEach((c=>{this.activateRoutes(c,children[c.value.outlet],contexts),this.forwardEvent(new ActivationEnd(c.value.snapshot))})),futureNode.children.length&&this.forwardEvent(new ChildActivationEnd(futureNode.value.snapshot))}activateRoutes(futureNode,currNode,parentContexts){const future=futureNode.value,curr=currNode?currNode.value:null;if(advanceActivatedRoute(future),future===curr)if(future.component){const context=parentContexts.getOrCreateContext(future.outlet);this.activateChildRoutes(futureNode,currNode,context.children)}else this.activateChildRoutes(futureNode,currNode,parentContexts);else if(future.component){const context=parentContexts.getOrCreateContext(future.outlet);if(this.routeReuseStrategy.shouldAttach(future.snapshot)){const stored=this.routeReuseStrategy.retrieve(future.snapshot);this.routeReuseStrategy.store(future.snapshot,null),context.children.onOutletReAttached(stored.contexts),context.attachRef=stored.componentRef,context.route=stored.route.value,context.outlet&&context.outlet.attach(stored.componentRef,stored.route.value),advanceActivatedRoute(stored.route.value),this.activateChildRoutes(futureNode,null,context.children)}else{const injector=getClosestRouteInjector(future.snapshot);context.attachRef=null,context.route=future,context.injector=injector,context.outlet&&context.outlet.activateWith(future,context.injector),this.activateChildRoutes(futureNode,null,context.children)}}else this.activateChildRoutes(futureNode,null,parentContexts);if("undefined"==typeof ngDevMode||ngDevMode){const outlet=parentContexts.getOrCreateContext(future.outlet).outlet;outlet&&this.inputBindingEnabled&&!outlet.supportsBindingToComponentInputs&&!warnedAboutUnsupportedInputBinding&&(console.warn("'withComponentInputBinding' feature is enabled but this application is using an outlet that may not support binding to component inputs."),warnedAboutUnsupportedInputBinding=!0)}}}class CanActivate{constructor(path){this.path=path,this.route=this.path[this.path.length-1]}}class CanDeactivate{constructor(component,route){this.component=component,this.route=route}}function getAllRouteGuards(future,curr,parentContexts){const futureRoot=future._root;return getChildRouteGuards(futureRoot,curr?curr._root:null,parentContexts,[futureRoot.value])}function getTokenOrFunctionIdentity(tokenOrFunction,injector){const NOT_FOUND=Symbol(),result=injector.get(tokenOrFunction,NOT_FOUND);return result===NOT_FOUND?"function"!=typeof tokenOrFunction||(0,core["ɵisInjectable"])(tokenOrFunction)?injector.get(tokenOrFunction):tokenOrFunction:result}function getChildRouteGuards(futureNode,currNode,contexts,futurePath,checks={canDeactivateChecks:[],canActivateChecks:[]}){const prevChildren=nodeChildrenAsMap(currNode);return futureNode.children.forEach((c=>{!function getRouteGuards(futureNode,currNode,parentContexts,futurePath,checks={canDeactivateChecks:[],canActivateChecks:[]}){const future=futureNode.value,curr=currNode?currNode.value:null,context=parentContexts?parentContexts.getContext(futureNode.value.outlet):null;if(curr&&future.routeConfig===curr.routeConfig){const shouldRun=function shouldRunGuardsAndResolvers(curr,future,mode){if("function"==typeof mode)return mode(curr,future);switch(mode){case"pathParamsChange":return!equalPath(curr.url,future.url);case"pathParamsOrQueryParamsChange":return!equalPath(curr.url,future.url)||!shallowEqual(curr.queryParams,future.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!equalParamsAndUrlSegments(curr,future)||!shallowEqual(curr.queryParams,future.queryParams);default:return!equalParamsAndUrlSegments(curr,future)}}(curr,future,future.routeConfig.runGuardsAndResolvers);shouldRun?checks.canActivateChecks.push(new CanActivate(futurePath)):(future.data=curr.data,future._resolvedData=curr._resolvedData),future.component?getChildRouteGuards(futureNode,currNode,context?context.children:null,futurePath,checks):getChildRouteGuards(futureNode,currNode,parentContexts,futurePath,checks),shouldRun&&context&&context.outlet&&context.outlet.isActivated&&checks.canDeactivateChecks.push(new CanDeactivate(context.outlet.component,curr))}else curr&&deactivateRouteAndItsChildren(currNode,context,checks),checks.canActivateChecks.push(new CanActivate(futurePath)),future.component?getChildRouteGuards(futureNode,null,context?context.children:null,futurePath,checks):getChildRouteGuards(futureNode,null,parentContexts,futurePath,checks);return checks}(c,prevChildren[c.value.outlet],contexts,futurePath.concat([c.value]),checks),delete prevChildren[c.value.outlet]})),Object.entries(prevChildren).forEach((([k,v])=>deactivateRouteAndItsChildren(v,contexts.getContext(k),checks))),checks}function deactivateRouteAndItsChildren(route,context,checks){const children=nodeChildrenAsMap(route),r=route.value;Object.entries(children).forEach((([childName,node])=>{r.component?deactivateRouteAndItsChildren(node,context?context.children.getContext(childName):null,checks):deactivateRouteAndItsChildren(node,context,checks)})),r.component&&context&&context.outlet&&context.outlet.isActivated?checks.canDeactivateChecks.push(new CanDeactivate(context.outlet.component,r)):checks.canDeactivateChecks.push(new CanDeactivate(null,r))}function router_isFunction(v){return"function"==typeof v}function isEmptyError(e){return e instanceof EmptyError.K||"EmptyError"===e?.name}const INITIAL_VALUE=Symbol("INITIAL_VALUE");function prioritizedGuardValue(){return(0,switchMap.w)((obs=>(0,combineLatest.a)(obs.map((o=>o.pipe((0,take.q)(1),(0,startWith.O)(INITIAL_VALUE))))).pipe((0,map.U)((results=>{for(const result of results)if(!0!==result){if(result===INITIAL_VALUE)return INITIAL_VALUE;if(!1===result||result instanceof UrlTree)return result}return!0})),(0,filter.h)((item=>item!==INITIAL_VALUE)),(0,take.q)(1))))}function checkGuards(injector,forwardEvent){return(0,mergeMap.z)((t=>{const{targetSnapshot,currentSnapshot,guards:{canActivateChecks,canDeactivateChecks}}=t;return 0===canDeactivateChecks.length&&0===canActivateChecks.length?(0,of.of)({...t,guardsResult:!0}):function runCanDeactivateChecks(checks,futureRSS,currRSS,injector){return(0,from.D)(checks).pipe((0,mergeMap.z)((check=>function runCanDeactivate(component,currARS,currRSS,futureRSS,injector){const canDeactivate=currARS&&currARS.routeConfig?currARS.routeConfig.canDeactivate:null;if(!canDeactivate||0===canDeactivate.length)return(0,of.of)(!0);const canDeactivateObservables=canDeactivate.map((c=>{const closestInjector=getClosestRouteInjector(currARS)??injector,guard=getTokenOrFunctionIdentity(c,closestInjector);return wrapIntoObservable(function isCanDeactivate(guard){return guard&&router_isFunction(guard.canDeactivate)}(guard)?guard.canDeactivate(component,currARS,currRSS,futureRSS):closestInjector.runInContext((()=>guard(component,currARS,currRSS,futureRSS)))).pipe((0,first.P)())}));return(0,of.of)(canDeactivateObservables).pipe(prioritizedGuardValue())}(check.component,check.route,currRSS,futureRSS,injector))),(0,first.P)((result=>!0!==result),!0))}(canDeactivateChecks,targetSnapshot,currentSnapshot,injector).pipe((0,mergeMap.z)((canDeactivate=>canDeactivate&&function isBoolean(v){return"boolean"==typeof v}(canDeactivate)?function runCanActivateChecks(futureSnapshot,checks,injector,forwardEvent){return(0,from.D)(checks).pipe((0,concatMap.b)((check=>(0,concat.z)(function fireChildActivationStart(snapshot,forwardEvent){null!==snapshot&&forwardEvent&&forwardEvent(new ChildActivationStart(snapshot));return(0,of.of)(!0)}(check.route.parent,forwardEvent),function fireActivationStart(snapshot,forwardEvent){null!==snapshot&&forwardEvent&&forwardEvent(new ActivationStart(snapshot));return(0,of.of)(!0)}(check.route,forwardEvent),function runCanActivateChild(futureRSS,path,injector){const futureARS=path[path.length-1],canActivateChildGuardsMapped=path.slice(0,path.length-1).reverse().map((p=>function getCanActivateChild(p){const canActivateChild=p.routeConfig?p.routeConfig.canActivateChild:null;return canActivateChild&&0!==canActivateChild.length?{node:p,guards:canActivateChild}:null}(p))).filter((_=>null!==_)).map((d=>defer((()=>{const guardsMapped=d.guards.map((canActivateChild=>{const closestInjector=getClosestRouteInjector(d.node)??injector,guard=getTokenOrFunctionIdentity(canActivateChild,closestInjector);return wrapIntoObservable(function isCanActivateChild(guard){return guard&&router_isFunction(guard.canActivateChild)}(guard)?guard.canActivateChild(futureARS,futureRSS):closestInjector.runInContext((()=>guard(futureARS,futureRSS)))).pipe((0,first.P)())}));return(0,of.of)(guardsMapped).pipe(prioritizedGuardValue())}))));return(0,of.of)(canActivateChildGuardsMapped).pipe(prioritizedGuardValue())}(futureSnapshot,check.path,injector),function runCanActivate(futureRSS,futureARS,injector){const canActivate=futureARS.routeConfig?futureARS.routeConfig.canActivate:null;if(!canActivate||0===canActivate.length)return(0,of.of)(!0);const canActivateObservables=canActivate.map((canActivate=>defer((()=>{const closestInjector=getClosestRouteInjector(futureARS)??injector,guard=getTokenOrFunctionIdentity(canActivate,closestInjector);return wrapIntoObservable(function isCanActivate(guard){return guard&&router_isFunction(guard.canActivate)}(guard)?guard.canActivate(futureARS,futureRSS):closestInjector.runInContext((()=>guard(futureARS,futureRSS)))).pipe((0,first.P)())}))));return(0,of.of)(canActivateObservables).pipe(prioritizedGuardValue())}(futureSnapshot,check.route,injector)))),(0,first.P)((result=>!0!==result),!0))}(targetSnapshot,canActivateChecks,injector,forwardEvent):(0,of.of)(canDeactivate))),(0,map.U)((guardsResult=>({...t,guardsResult}))))}))}function runCanLoadGuards(injector,route,segments,urlSerializer){const canLoad=route.canLoad;if(void 0===canLoad||0===canLoad.length)return(0,of.of)(!0);const canLoadObservables=canLoad.map((injectionToken=>{const guard=getTokenOrFunctionIdentity(injectionToken,injector);return wrapIntoObservable(function isCanLoad(guard){return guard&&router_isFunction(guard.canLoad)}(guard)?guard.canLoad(route,segments):injector.runInContext((()=>guard(route,segments))))}));return(0,of.of)(canLoadObservables).pipe(prioritizedGuardValue(),redirectIfUrlTree(urlSerializer))}function redirectIfUrlTree(urlSerializer){return(0,pipe.z)((0,tap.b)((result=>{if(isUrlTree(result))throw redirectingNavigationError(urlSerializer,result)})),(0,map.U)((result=>!0===result)))}function runCanMatchGuards(injector,route,segments,urlSerializer){const canMatch=route.canMatch;if(!canMatch||0===canMatch.length)return(0,of.of)(!0);const canMatchObservables=canMatch.map((injectionToken=>{const guard=getTokenOrFunctionIdentity(injectionToken,injector);return wrapIntoObservable(function isCanMatch(guard){return guard&&router_isFunction(guard.canMatch)}(guard)?guard.canMatch(route,segments):injector.runInContext((()=>guard(route,segments))))}));return(0,of.of)(canMatchObservables).pipe(prioritizedGuardValue(),redirectIfUrlTree(urlSerializer))}class NoMatch{constructor(segmentGroup){this.segmentGroup=segmentGroup||null}}class AbsoluteRedirect{constructor(urlTree){this.urlTree=urlTree}}function noMatch$1(segmentGroup){return throwError(new NoMatch(segmentGroup))}function absoluteRedirect(newTree){return throwError(new AbsoluteRedirect(newTree))}class ApplyRedirects{constructor(urlSerializer,urlTree){this.urlSerializer=urlSerializer,this.urlTree=urlTree}noMatchError(e){return new core["ɵRuntimeError"](4002,("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}lineralizeSegments(route,urlTree){let res=[],c=urlTree.root;for(;;){if(res=res.concat(c.segments),0===c.numberOfChildren)return(0,of.of)(res);if(c.numberOfChildren>1||!c.children[PRIMARY_OUTLET])return redirectTo=route.redirectTo,throwError(new core["ɵRuntimeError"](4e3,("undefined"==typeof ngDevMode||ngDevMode)&&`Only absolute redirects can have named outlets. redirectTo: '${redirectTo}'`));c=c.children[PRIMARY_OUTLET]}var redirectTo}applyRedirectCommands(segments,redirectTo,posParams){return this.applyRedirectCreateUrlTree(redirectTo,this.urlSerializer.parse(redirectTo),segments,posParams)}applyRedirectCreateUrlTree(redirectTo,urlTree,segments,posParams){const newRoot=this.createSegmentGroup(redirectTo,urlTree.root,segments,posParams);return new UrlTree(newRoot,this.createQueryParams(urlTree.queryParams,this.urlTree.queryParams),urlTree.fragment)}createQueryParams(redirectToParams,actualParams){const res={};return Object.entries(redirectToParams).forEach((([k,v])=>{if("string"==typeof v&&v.startsWith(":")){const sourceName=v.substring(1);res[k]=actualParams[sourceName]}else res[k]=v})),res}createSegmentGroup(redirectTo,group,segments,posParams){const updatedSegments=this.createSegments(redirectTo,group.segments,segments,posParams);let children={};return Object.entries(group.children).forEach((([name,child])=>{children[name]=this.createSegmentGroup(redirectTo,child,segments,posParams)})),new UrlSegmentGroup(updatedSegments,children)}createSegments(redirectTo,redirectToSegments,actualSegments,posParams){return redirectToSegments.map((s=>s.path.startsWith(":")?this.findPosParam(redirectTo,s,posParams):this.findOrReturn(s,actualSegments)))}findPosParam(redirectTo,redirectToUrlSegment,posParams){const pos=posParams[redirectToUrlSegment.path.substring(1)];if(!pos)throw new core["ɵRuntimeError"](4001,("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot redirect to '${redirectTo}'. Cannot find '${redirectToUrlSegment.path}'.`);return pos}findOrReturn(redirectToUrlSegment,actualSegments){let idx=0;for(const s of actualSegments){if(s.path===redirectToUrlSegment.path)return actualSegments.splice(idx),s;idx++}return redirectToUrlSegment}}const noMatch={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function matchWithChecks(segmentGroup,route,segments,injector,urlSerializer){const result=match(segmentGroup,route,segments);return result.matched?(injector=function getOrCreateRouteInjectorIfNeeded(route,currentInjector){return route.providers&&!route._injector&&(route._injector=(0,core.createEnvironmentInjector)(route.providers,currentInjector,`Route: ${route.path}`)),route._injector??currentInjector}(route,injector),runCanMatchGuards(injector,route,segments,urlSerializer).pipe((0,map.U)((v=>!0===v?result:{...noMatch})))):(0,of.of)(result)}function match(segmentGroup,route,segments){if(""===route.path)return"full"===route.pathMatch&&(segmentGroup.hasChildren()||segments.length>0)?{...noMatch}:{matched:!0,consumedSegments:[],remainingSegments:segments,parameters:{},positionalParamSegments:{}};const res=(route.matcher||defaultUrlMatcher)(segments,segmentGroup,route);if(!res)return{...noMatch};const posParams={};Object.entries(res.posParams??{}).forEach((([k,v])=>{posParams[k]=v.path}));const parameters=res.consumed.length>0?{...posParams,...res.consumed[res.consumed.length-1].parameters}:posParams;return{matched:!0,consumedSegments:res.consumed,remainingSegments:segments.slice(res.consumed.length),parameters,positionalParamSegments:res.posParams??{}}}function split(segmentGroup,consumedSegments,slicedSegments,config){if(slicedSegments.length>0&&function containsEmptyPathMatchesWithNamedOutlets(segmentGroup,slicedSegments,routes){return routes.some((r=>emptyPathMatch(segmentGroup,slicedSegments,r)&&getOutlet(r)!==PRIMARY_OUTLET))}(segmentGroup,slicedSegments,config)){return{segmentGroup:new UrlSegmentGroup(consumedSegments,function createChildrenForEmptyPaths(routes,primarySegment){const res={};res[PRIMARY_OUTLET]=primarySegment;for(const r of routes)if(""===r.path&&getOutlet(r)!==PRIMARY_OUTLET){const s=new UrlSegmentGroup([],{});res[getOutlet(r)]=s}return res}(config,new UrlSegmentGroup(slicedSegments,segmentGroup.children))),slicedSegments:[]}}if(0===slicedSegments.length&&function containsEmptyPathMatches(segmentGroup,slicedSegments,routes){return routes.some((r=>emptyPathMatch(segmentGroup,slicedSegments,r)))}(segmentGroup,slicedSegments,config)){const s=new UrlSegmentGroup(segmentGroup.segments,function addEmptyPathsToChildrenIfNeeded(segmentGroup,consumedSegments,slicedSegments,routes,children){const res={};for(const r of routes)if(emptyPathMatch(segmentGroup,slicedSegments,r)&&!children[getOutlet(r)]){const s=new UrlSegmentGroup([],{});res[getOutlet(r)]=s}return{...children,...res}}(segmentGroup,0,slicedSegments,config,segmentGroup.children));return{segmentGroup:s,slicedSegments}}return{segmentGroup:new UrlSegmentGroup(segmentGroup.segments,segmentGroup.children),slicedSegments}}function emptyPathMatch(segmentGroup,slicedSegments,r){return(!(segmentGroup.hasChildren()||slicedSegments.length>0)||"full"!==r.pathMatch)&&""===r.path}class Recognizer{constructor(injector,configLoader,rootComponentType,config,urlTree,paramsInheritanceStrategy,urlSerializer){this.injector=injector,this.configLoader=configLoader,this.rootComponentType=rootComponentType,this.config=config,this.urlTree=urlTree,this.paramsInheritanceStrategy=paramsInheritanceStrategy,this.urlSerializer=urlSerializer,this.allowRedirects=!0,this.applyRedirects=new ApplyRedirects(this.urlSerializer,this.urlTree)}noMatchError(e){return new core["ɵRuntimeError"](4002,("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}recognize(){const rootSegmentGroup=split(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,rootSegmentGroup,PRIMARY_OUTLET).pipe((0,catchError.K)((e=>{if(e instanceof AbsoluteRedirect)return this.allowRedirects=!1,this.urlTree=e.urlTree,this.match(e.urlTree);if(e instanceof NoMatch)throw this.noMatchError(e);throw e})),(0,map.U)((children=>{const root=new ActivatedRouteSnapshot([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},PRIMARY_OUTLET,this.rootComponentType,null,{}),rootNode=new TreeNode(root,children),routeState=new RouterStateSnapshot("",rootNode),tree=function createUrlTreeFromSnapshot(relativeTo,commands,queryParams=null,fragment=null){return createUrlTreeFromSegmentGroup(createSegmentGroupFromRoute(relativeTo),commands,queryParams,fragment)}(root,[],this.urlTree.queryParams,this.urlTree.fragment);return tree.queryParams=this.urlTree.queryParams,routeState.url=this.urlSerializer.serialize(tree),this.inheritParamsAndData(routeState._root),{state:routeState,tree}})))}match(tree){return this.processSegmentGroup(this.injector,this.config,tree.root,PRIMARY_OUTLET).pipe((0,catchError.K)((e=>{if(e instanceof NoMatch)throw this.noMatchError(e);throw e})))}inheritParamsAndData(routeNode){const route=routeNode.value,i=inheritedParamsDataResolve(route,this.paramsInheritanceStrategy);route.params=Object.freeze(i.params),route.data=Object.freeze(i.data),routeNode.children.forEach((n=>this.inheritParamsAndData(n)))}processSegmentGroup(injector,config,segmentGroup,outlet){return 0===segmentGroup.segments.length&&segmentGroup.hasChildren()?this.processChildren(injector,config,segmentGroup):this.processSegment(injector,config,segmentGroup,segmentGroup.segments,outlet,!0)}processChildren(injector,config,segmentGroup){const childOutlets=[];for(const child of Object.keys(segmentGroup.children))"primary"===child?childOutlets.unshift(child):childOutlets.push(child);return(0,from.D)(childOutlets).pipe((0,concatMap.b)((childOutlet=>{const child=segmentGroup.children[childOutlet],sortedConfig=function sortByMatchingOutlets(routes,outletName){const sortedConfig=routes.filter((r=>getOutlet(r)===outletName));return sortedConfig.push(...routes.filter((r=>getOutlet(r)!==outletName))),sortedConfig}(config,childOutlet);return this.processSegmentGroup(injector,sortedConfig,child,childOutlet)})),scan(((children,outletChildren)=>(children.push(...outletChildren),children))),(0,defaultIfEmpty.d)(null),function last(predicate,defaultValue){var hasDefaultValue=arguments.length>=2;return function(source){return source.pipe(predicate?(0,filter.h)((function(v,i){return predicate(v,i,source)})):identity.y,takeLast(1),hasDefaultValue?(0,defaultIfEmpty.d)(defaultValue):(0,throwIfEmpty.T)((function(){return new EmptyError.K})))}}(),(0,mergeMap.z)((children=>{if(null===children)return noMatch$1(segmentGroup);const mergedChildren=mergeEmptyPathMatches(children);return("undefined"==typeof ngDevMode||ngDevMode)&&function checkOutletNameUniqueness(nodes){const names={};nodes.forEach((n=>{const routeWithSameOutletName=names[n.value.outlet];if(routeWithSameOutletName){const p=routeWithSameOutletName.url.map((s=>s.toString())).join("/"),c=n.value.url.map((s=>s.toString())).join("/");throw new core["ɵRuntimeError"](4006,("undefined"==typeof ngDevMode||ngDevMode)&&`Two segments cannot have the same outlet name: '${p}' and '${c}'.`)}names[n.value.outlet]=n.value}))}(mergedChildren),function sortActivatedRouteSnapshots(nodes){nodes.sort(((a,b)=>a.value.outlet===PRIMARY_OUTLET?-1:b.value.outlet===PRIMARY_OUTLET?1:a.value.outlet.localeCompare(b.value.outlet)))}(mergedChildren),(0,of.of)(mergedChildren)})))}processSegment(injector,routes,segmentGroup,segments,outlet,allowRedirects){return(0,from.D)(routes).pipe((0,concatMap.b)((r=>this.processSegmentAgainstRoute(r._injector??injector,routes,r,segmentGroup,segments,outlet,allowRedirects).pipe((0,catchError.K)((e=>{if(e instanceof NoMatch)return(0,of.of)(null);throw e}))))),(0,first.P)((x=>!!x)),(0,catchError.K)((e=>{if(isEmptyError(e))return function noLeftoversInUrl(segmentGroup,segments,outlet){return 0===segments.length&&!segmentGroup.children[outlet]}(segmentGroup,segments,outlet)?(0,of.of)([]):noMatch$1(segmentGroup);throw e})))}processSegmentAgainstRoute(injector,routes,route,rawSegment,segments,outlet,allowRedirects){return function isImmediateMatch(route,rawSegment,segments,outlet){return!!(getOutlet(route)===outlet||outlet!==PRIMARY_OUTLET&&emptyPathMatch(rawSegment,segments,route))&&("**"===route.path||match(rawSegment,route,segments).matched)}(route,rawSegment,segments,outlet)?void 0===route.redirectTo?this.matchSegmentAgainstRoute(injector,rawSegment,route,segments,outlet,allowRedirects):allowRedirects&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(injector,rawSegment,routes,route,segments,outlet):noMatch$1(rawSegment):noMatch$1(rawSegment)}expandSegmentAgainstRouteUsingRedirect(injector,segmentGroup,routes,route,segments,outlet){return"**"===route.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(injector,routes,route,outlet):this.expandRegularSegmentAgainstRouteUsingRedirect(injector,segmentGroup,routes,route,segments,outlet)}expandWildCardWithParamsAgainstRouteUsingRedirect(injector,routes,route,outlet){const newTree=this.applyRedirects.applyRedirectCommands([],route.redirectTo,{});return route.redirectTo.startsWith("/")?absoluteRedirect(newTree):this.applyRedirects.lineralizeSegments(route,newTree).pipe((0,mergeMap.z)((newSegments=>{const group=new UrlSegmentGroup(newSegments,{});return this.processSegment(injector,routes,group,newSegments,outlet,!1)})))}expandRegularSegmentAgainstRouteUsingRedirect(injector,segmentGroup,routes,route,segments,outlet){const{matched,consumedSegments,remainingSegments,positionalParamSegments}=match(segmentGroup,route,segments);if(!matched)return noMatch$1(segmentGroup);const newTree=this.applyRedirects.applyRedirectCommands(consumedSegments,route.redirectTo,positionalParamSegments);return route.redirectTo.startsWith("/")?absoluteRedirect(newTree):this.applyRedirects.lineralizeSegments(route,newTree).pipe((0,mergeMap.z)((newSegments=>this.processSegment(injector,routes,segmentGroup,newSegments.concat(remainingSegments),outlet,!1))))}matchSegmentAgainstRoute(injector,rawSegment,route,segments,outlet,allowRedirects){let matchResult;if("**"===route.path){const params=segments.length>0?router_last(segments).parameters:{},snapshot=new ActivatedRouteSnapshot(segments,params,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,getData(route),getOutlet(route),route.component??route._loadedComponent??null,route,getResolve(route));matchResult=(0,of.of)({snapshot,consumedSegments:[],remainingSegments:[]}),rawSegment.children={}}else matchResult=matchWithChecks(rawSegment,route,segments,injector,this.urlSerializer).pipe((0,map.U)((({matched,consumedSegments,remainingSegments,parameters})=>{if(!matched)return null;return{snapshot:new ActivatedRouteSnapshot(consumedSegments,parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,getData(route),getOutlet(route),route.component??route._loadedComponent??null,route,getResolve(route)),consumedSegments,remainingSegments}})));return matchResult.pipe((0,switchMap.w)((result=>null===result?noMatch$1(rawSegment):(injector=route._injector??injector,this.getChildConfig(injector,route,segments).pipe((0,switchMap.w)((({routes:childConfig})=>{const childInjector=route._loadedInjector??injector,{snapshot,consumedSegments,remainingSegments}=result,{segmentGroup,slicedSegments}=split(rawSegment,consumedSegments,remainingSegments,childConfig);if(0===slicedSegments.length&&segmentGroup.hasChildren())return this.processChildren(childInjector,childConfig,segmentGroup).pipe((0,map.U)((children=>null===children?null:[new TreeNode(snapshot,children)])));if(0===childConfig.length&&0===slicedSegments.length)return(0,of.of)([new TreeNode(snapshot,[])]);const matchedOnOutlet=getOutlet(route)===outlet;return this.processSegment(childInjector,childConfig,segmentGroup,slicedSegments,matchedOnOutlet?PRIMARY_OUTLET:outlet,!0).pipe((0,map.U)((children=>[new TreeNode(snapshot,children)])))})))))))}getChildConfig(injector,route,segments){return route.children?(0,of.of)({routes:route.children,injector}):route.loadChildren?void 0!==route._loadedRoutes?(0,of.of)({routes:route._loadedRoutes,injector:route._loadedInjector}):runCanLoadGuards(injector,route,segments,this.urlSerializer).pipe((0,mergeMap.z)((shouldLoadResult=>shouldLoadResult?this.configLoader.loadChildren(injector,route).pipe((0,tap.b)((cfg=>{route._loadedRoutes=cfg.routes,route._loadedInjector=cfg.injector}))):function canLoadFails(route){return throwError(navigationCancelingError(("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot load children because the guard of the route "path: '${route.path}'" returned false`,3))}(route)))):(0,of.of)({routes:[],injector})}}function hasEmptyPathConfig(node){const config=node.value.routeConfig;return config&&""===config.path}function mergeEmptyPathMatches(nodes){const result=[],mergedNodes=new Set;for(const node of nodes){if(!hasEmptyPathConfig(node)){result.push(node);continue}const duplicateEmptyPathNode=result.find((resultNode=>node.value.routeConfig===resultNode.value.routeConfig));void 0!==duplicateEmptyPathNode?(duplicateEmptyPathNode.children.push(...node.children),mergedNodes.add(duplicateEmptyPathNode)):result.push(node)}for(const mergedNode of mergedNodes){const mergedChildren=mergeEmptyPathMatches(mergedNode.children);result.push(new TreeNode(mergedNode.value,mergedChildren))}return result.filter((n=>!mergedNodes.has(n)))}function getData(route){return route.data||{}}function getResolve(route){return route.resolve||{}}function recognize(injector,configLoader,rootComponentType,config,serializer,paramsInheritanceStrategy){return(0,mergeMap.z)((t=>function recognize$1(injector,configLoader,rootComponentType,config,urlTree,urlSerializer,paramsInheritanceStrategy="emptyOnly"){return new Recognizer(injector,configLoader,rootComponentType,config,urlTree,paramsInheritanceStrategy,urlSerializer).recognize()}(injector,configLoader,rootComponentType,config,t.extractedUrl,serializer,paramsInheritanceStrategy).pipe((0,map.U)((({state:targetSnapshot,tree:urlAfterRedirects})=>({...t,targetSnapshot,urlAfterRedirects}))))))}function resolveData(paramsInheritanceStrategy,injector){return(0,mergeMap.z)((t=>{const{targetSnapshot,guards:{canActivateChecks}}=t;if(!canActivateChecks.length)return(0,of.of)(t);let canActivateChecksResolved=0;return(0,from.D)(canActivateChecks).pipe((0,concatMap.b)((check=>function runResolve(futureARS,futureRSS,paramsInheritanceStrategy,injector){const config=futureARS.routeConfig,resolve=futureARS._resolve;void 0===config?.title||hasStaticTitle(config)||(resolve[RouteTitleKey]=config.title);return function resolveNode(resolve,futureARS,futureRSS,injector){const keys=function getDataKeys(obj){return[...Object.keys(obj),...Object.getOwnPropertySymbols(obj)]}(resolve);if(0===keys.length)return(0,of.of)({});const data={};return(0,from.D)(keys).pipe((0,mergeMap.z)((key=>function getResolver(injectionToken,futureARS,futureRSS,injector){const closestInjector=getClosestRouteInjector(futureARS)??injector,resolver=getTokenOrFunctionIdentity(injectionToken,closestInjector),resolverValue=resolver.resolve?resolver.resolve(futureARS,futureRSS):closestInjector.runInContext((()=>resolver(futureARS,futureRSS)));return wrapIntoObservable(resolverValue)}(resolve[key],futureARS,futureRSS,injector).pipe((0,first.P)(),(0,tap.b)((value=>{data[key]=value}))))),takeLast(1),function mapTo(value){return(0,map.U)((function(){return value}))}(data),(0,catchError.K)((e=>isEmptyError(e)?empty.E:throwError(e))))}(resolve,futureARS,futureRSS,injector).pipe((0,map.U)((resolvedData=>(futureARS._resolvedData=resolvedData,futureARS.data=inheritedParamsDataResolve(futureARS,paramsInheritanceStrategy).resolve,config&&hasStaticTitle(config)&&(futureARS.data[RouteTitleKey]=config.title),null))))}(check.route,targetSnapshot,paramsInheritanceStrategy,injector))),(0,tap.b)((()=>canActivateChecksResolved++)),takeLast(1),(0,mergeMap.z)((_=>canActivateChecksResolved===canActivateChecks.length?(0,of.of)(t):empty.E)))}))}function hasStaticTitle(config){return"string"==typeof config.title||null===config.title}function switchTap(next){return(0,switchMap.w)((v=>{const nextResult=next(v);return nextResult?(0,from.D)(nextResult).pipe((0,map.U)((()=>v))):(0,of.of)(v)}))}const ROUTES=new core.InjectionToken("ROUTES");class RouterConfigLoader{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,core.inject)(core.Compiler)}loadComponent(route){if(this.componentLoaders.get(route))return this.componentLoaders.get(route);if(route._loadedComponent)return(0,of.of)(route._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(route);const loadRunner=wrapIntoObservable(route.loadComponent()).pipe((0,map.U)(maybeUnwrapDefaultExport),(0,tap.b)((component=>{this.onLoadEndListener&&this.onLoadEndListener(route),("undefined"==typeof ngDevMode||ngDevMode)&&assertStandalone(route.path??"",component),route._loadedComponent=component})),(0,finalize.x)((()=>{this.componentLoaders.delete(route)}))),loader=new ConnectableObservable.c(loadRunner,(()=>new Subject.x)).pipe((0,refCount.x)());return this.componentLoaders.set(route,loader),loader}loadChildren(parentInjector,route){if(this.childrenLoaders.get(route))return this.childrenLoaders.get(route);if(route._loadedRoutes)return(0,of.of)({routes:route._loadedRoutes,injector:route._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(route);const loadRunner=this.loadModuleFactoryOrRoutes(route.loadChildren).pipe((0,map.U)((factoryOrRoutes=>{let injector,rawRoutes;this.onLoadEndListener&&this.onLoadEndListener(route);let requireStandaloneComponents=!1;Array.isArray(factoryOrRoutes)?(rawRoutes=factoryOrRoutes,requireStandaloneComponents=!0):(injector=factoryOrRoutes.create(parentInjector).injector,rawRoutes=injector.get(ROUTES,[],core.InjectFlags.Self|core.InjectFlags.Optional).flat());const routes=rawRoutes.map(standardizeConfig);return("undefined"==typeof ngDevMode||ngDevMode)&&validateConfig(routes,route.path,requireStandaloneComponents),{routes,injector}})),(0,finalize.x)((()=>{this.childrenLoaders.delete(route)}))),loader=new ConnectableObservable.c(loadRunner,(()=>new Subject.x)).pipe((0,refCount.x)());return this.childrenLoaders.set(route,loader),loader}loadModuleFactoryOrRoutes(loadChildren){return wrapIntoObservable(loadChildren()).pipe((0,map.U)(maybeUnwrapDefaultExport),(0,mergeMap.z)((t=>t instanceof core.NgModuleFactory||Array.isArray(t)?(0,of.of)(t):(0,from.D)(this.compiler.compileModuleAsync(t)))))}}function maybeUnwrapDefaultExport(input){return function isWrappedDefaultExport(value){return value&&"object"==typeof value&&"default"in value}(input)?input.default:input}(_class6=RouterConfigLoader).ɵfac=function _class6_Factory(t){return new(t||_class6)},_class6.ɵprov=core["ɵɵdefineInjectable"]({token:_class6,factory:_class6.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterConfigLoader,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class NavigationTransitions{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Subject.x,this.configLoader=(0,core.inject)(RouterConfigLoader),this.environmentInjector=(0,core.inject)(core.EnvironmentInjector),this.urlSerializer=(0,core.inject)(UrlSerializer),this.rootContexts=(0,core.inject)(ChildrenOutletContexts),this.inputBindingEnabled=null!==(0,core.inject)(INPUT_BINDER,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,of.of)(void 0),this.rootComponentType=null;this.configLoader.onLoadEndListener=r=>this.events.next(new RouteConfigLoadEnd(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new RouteConfigLoadStart(r))}complete(){this.transitions?.complete()}handleNavigationRequest(request){const id=++this.navigationId;this.transitions?.next({...this.transitions.value,...request,id})}setupNavigations(router){return this.transitions=new BehaviorSubject.X({id:0,currentUrlTree:router.currentUrlTree,currentRawUrl:router.currentUrlTree,extractedUrl:router.urlHandlingStrategy.extract(router.currentUrlTree),urlAfterRedirects:router.urlHandlingStrategy.extract(router.currentUrlTree),rawUrl:router.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:router.routerState.snapshot,targetSnapshot:null,currentRouterState:router.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,filter.h)((t=>0!==t.id)),(0,map.U)((t=>({...t,extractedUrl:router.urlHandlingStrategy.extract(t.rawUrl)}))),(0,switchMap.w)((overallTransitionState=>{let completed=!1,errored=!1;return(0,of.of)(overallTransitionState).pipe((0,tap.b)((t=>{this.currentNavigation={id:t.id,initialUrl:t.rawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}})),(0,switchMap.w)((t=>{const browserUrlTree=router.browserUrlTree.toString(),urlTransition=!router.navigated||t.extractedUrl.toString()!==browserUrlTree||browserUrlTree!==router.currentUrlTree.toString(),onSameUrlNavigation=t.extras.onSameUrlNavigation??router.onSameUrlNavigation;if(!urlTransition&&"reload"!==onSameUrlNavigation){const reason="undefined"==typeof ngDevMode||ngDevMode?`Navigation to ${t.rawUrl} was ignored because it is the same as the current Router URL.`:"";return this.events.next(new NavigationSkipped(t.id,router.serializeUrl(overallTransitionState.rawUrl),reason,0)),router.rawUrlTree=t.rawUrl,t.resolve(null),empty.E}if(router.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return isBrowserTriggeredNavigation(t.source)&&(router.browserUrlTree=t.extractedUrl),(0,of.of)(t).pipe((0,switchMap.w)((t=>{const transition=this.transitions?.getValue();return this.events.next(new NavigationStart(t.id,this.urlSerializer.serialize(t.extractedUrl),t.source,t.restoredState)),transition!==this.transitions?.getValue()?empty.E:Promise.resolve(t)})),recognize(this.environmentInjector,this.configLoader,this.rootComponentType,router.config,this.urlSerializer,router.paramsInheritanceStrategy),(0,tap.b)((t=>{if(overallTransitionState.targetSnapshot=t.targetSnapshot,overallTransitionState.urlAfterRedirects=t.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:t.urlAfterRedirects},"eager"===router.urlUpdateStrategy){if(!t.extras.skipLocationChange){const rawUrl=router.urlHandlingStrategy.merge(t.urlAfterRedirects,t.rawUrl);router.setBrowserUrl(rawUrl,t)}router.browserUrlTree=t.urlAfterRedirects}const routesRecognized=new RoutesRecognized(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(routesRecognized)})));if(urlTransition&&router.urlHandlingStrategy.shouldProcessUrl(router.rawUrlTree)){const{id,extractedUrl,source,restoredState,extras}=t,navStart=new NavigationStart(id,this.urlSerializer.serialize(extractedUrl),source,restoredState);this.events.next(navStart);const targetSnapshot=createEmptyState(0,this.rootComponentType).snapshot;return overallTransitionState={...t,targetSnapshot,urlAfterRedirects:extractedUrl,extras:{...extras,skipLocationChange:!1,replaceUrl:!1}},(0,of.of)(overallTransitionState)}{const reason="undefined"==typeof ngDevMode||ngDevMode?`Navigation was ignored because the UrlHandlingStrategy indicated neither the current URL ${router.rawUrlTree} nor target URL ${t.rawUrl} should be processed.`:"";return this.events.next(new NavigationSkipped(t.id,router.serializeUrl(overallTransitionState.extractedUrl),reason,1)),router.rawUrlTree=t.rawUrl,t.resolve(null),empty.E}})),(0,tap.b)((t=>{const guardsStart=new GuardsCheckStart(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(guardsStart)})),(0,map.U)((t=>overallTransitionState={...t,guards:getAllRouteGuards(t.targetSnapshot,t.currentSnapshot,this.rootContexts)})),checkGuards(this.environmentInjector,(evt=>this.events.next(evt))),(0,tap.b)((t=>{if(overallTransitionState.guardsResult=t.guardsResult,isUrlTree(t.guardsResult))throw redirectingNavigationError(this.urlSerializer,t.guardsResult);const guardsEnd=new GuardsCheckEnd(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);this.events.next(guardsEnd)})),(0,filter.h)((t=>!!t.guardsResult||(router.restoreHistory(t),this.cancelNavigationTransition(t,"",3),!1))),switchTap((t=>{if(t.guards.canActivateChecks.length)return(0,of.of)(t).pipe((0,tap.b)((t=>{const resolveStart=new ResolveStart(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(resolveStart)})),(0,switchMap.w)((t=>{let dataResolved=!1;return(0,of.of)(t).pipe(resolveData(router.paramsInheritanceStrategy,this.environmentInjector),(0,tap.b)({next:()=>dataResolved=!0,complete:()=>{dataResolved||(router.restoreHistory(t),this.cancelNavigationTransition(t,"undefined"==typeof ngDevMode||ngDevMode?"At least one route resolver didn't emit any value.":"",2))}}))})),(0,tap.b)((t=>{const resolveEnd=new ResolveEnd(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(resolveEnd)})))})),switchTap((t=>{const loadComponents=route=>{const loaders=[];route.routeConfig?.loadComponent&&!route.routeConfig._loadedComponent&&loaders.push(this.configLoader.loadComponent(route.routeConfig).pipe((0,tap.b)((loadedComponent=>{route.component=loadedComponent})),(0,map.U)((()=>{}))));for(const child of route.children)loaders.push(...loadComponents(child));return loaders};return(0,combineLatest.a)(loadComponents(t.targetSnapshot.root)).pipe((0,defaultIfEmpty.d)(),(0,take.q)(1))})),switchTap((()=>this.afterPreactivation())),(0,map.U)((t=>{const targetRouterState=function createRouterState(routeReuseStrategy,curr,prevState){const root=createNode(routeReuseStrategy,curr._root,prevState?prevState._root:void 0);return new RouterState(root,curr)}(router.routeReuseStrategy,t.targetSnapshot,t.currentRouterState);return overallTransitionState={...t,targetRouterState}})),(0,tap.b)((t=>{router.currentUrlTree=t.urlAfterRedirects,router.rawUrlTree=router.urlHandlingStrategy.merge(t.urlAfterRedirects,t.rawUrl),router.routerState=t.targetRouterState,"deferred"===router.urlUpdateStrategy&&(t.extras.skipLocationChange||router.setBrowserUrl(router.rawUrlTree,t),router.browserUrlTree=t.urlAfterRedirects)})),(rootContexts=this.rootContexts,routeReuseStrategy=router.routeReuseStrategy,forwardEvent=evt=>this.events.next(evt),inputBindingEnabled=this.inputBindingEnabled,(0,map.U)((t=>(new ActivateRoutes(routeReuseStrategy,t.targetRouterState,t.currentRouterState,forwardEvent,inputBindingEnabled).activate(rootContexts),t)))),(0,take.q)(1),(0,tap.b)({next:t=>{completed=!0,this.lastSuccessfulNavigation=this.currentNavigation,router.navigated=!0,this.events.next(new NavigationEnd(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(router.currentUrlTree))),router.titleStrategy?.updateTitle(t.targetRouterState.snapshot),t.resolve(!0)},complete:()=>{completed=!0}}),(0,finalize.x)((()=>{if(!completed&&!errored){const cancelationReason="undefined"==typeof ngDevMode||ngDevMode?`Navigation ID ${overallTransitionState.id} is not equal to the current navigation id ${this.navigationId}`:"";this.cancelNavigationTransition(overallTransitionState,cancelationReason,1)}this.currentNavigation?.id===overallTransitionState.id&&(this.currentNavigation=null)})),(0,catchError.K)((e=>{if(errored=!0,isNavigationCancelingError$1(e)){isRedirectingNavigationCancelingError$1(e)||(router.navigated=!0,router.restoreHistory(overallTransitionState,!0));const navCancel=new NavigationCancel(overallTransitionState.id,this.urlSerializer.serialize(overallTransitionState.extractedUrl),e.message,e.cancellationCode);if(this.events.next(navCancel),isRedirectingNavigationCancelingError$1(e)){const mergedTree=router.urlHandlingStrategy.merge(e.url,router.rawUrlTree),extras={skipLocationChange:overallTransitionState.extras.skipLocationChange,replaceUrl:"eager"===router.urlUpdateStrategy||isBrowserTriggeredNavigation(overallTransitionState.source)};router.scheduleNavigation(mergedTree,"imperative",null,extras,{resolve:overallTransitionState.resolve,reject:overallTransitionState.reject,promise:overallTransitionState.promise})}else overallTransitionState.resolve(!1)}else{router.restoreHistory(overallTransitionState,!0);const navError=new NavigationError(overallTransitionState.id,this.urlSerializer.serialize(overallTransitionState.extractedUrl),e,overallTransitionState.targetSnapshot??void 0);this.events.next(navError);try{overallTransitionState.resolve(router.errorHandler(e))}catch(ee){overallTransitionState.reject(ee)}}return empty.E})));var rootContexts,routeReuseStrategy,forwardEvent,inputBindingEnabled})))}cancelNavigationTransition(t,reason,code){const navCancel=new NavigationCancel(t.id,this.urlSerializer.serialize(t.extractedUrl),reason,code);this.events.next(navCancel),t.resolve(!1)}}function isBrowserTriggeredNavigation(source){return"imperative"!==source}(_class7=NavigationTransitions).ɵfac=function _class7_Factory(t){return new(t||_class7)},_class7.ɵprov=core["ɵɵdefineInjectable"]({token:_class7,factory:_class7.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NavigationTransitions,[{type:core.Injectable,args:[{providedIn:"root"}]}],(function(){return[]}),null);class TitleStrategy{buildTitle(snapshot){let pageTitle,route=snapshot.root;for(;void 0!==route;)pageTitle=this.getResolvedTitleForRoute(route)??pageTitle,route=route.children.find((child=>child.outlet===PRIMARY_OUTLET));return pageTitle}getResolvedTitleForRoute(snapshot){return snapshot.data[RouteTitleKey]}}(_class8=TitleStrategy).ɵfac=function _class8_Factory(t){return new(t||_class8)},_class8.ɵprov=core["ɵɵdefineInjectable"]({token:_class8,factory:function(){return(0,core.inject)(DefaultTitleStrategy)},providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](TitleStrategy,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(DefaultTitleStrategy)}]}],null,null);class DefaultTitleStrategy extends TitleStrategy{constructor(title){super(),this.title=title}updateTitle(snapshot){const title=this.buildTitle(snapshot);void 0!==title&&this.title.setTitle(title)}}(_class9=DefaultTitleStrategy).ɵfac=function _class9_Factory(t){return new(t||_class9)(core["ɵɵinject"](platform_browser.Title))},_class9.ɵprov=core["ɵɵdefineInjectable"]({token:_class9,factory:_class9.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](DefaultTitleStrategy,[{type:core.Injectable,args:[{providedIn:"root"}]}],(function(){return[{type:platform_browser.Title}]}),null);class RouteReuseStrategy{}(_class10=RouteReuseStrategy).ɵfac=function _class10_Factory(t){return new(t||_class10)},_class10.ɵprov=core["ɵɵdefineInjectable"]({token:_class10,factory:function(){return(0,core.inject)(DefaultRouteReuseStrategy)},providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouteReuseStrategy,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(DefaultRouteReuseStrategy)}]}],null,null);class BaseRouteReuseStrategy{shouldDetach(route){return!1}store(route,detachedTree){}shouldAttach(route){return!1}retrieve(route){return null}shouldReuseRoute(future,curr){return future.routeConfig===curr.routeConfig}}class DefaultRouteReuseStrategy extends BaseRouteReuseStrategy{}(_class11=DefaultRouteReuseStrategy).ɵfac=function(){let ɵ_class11_BaseFactory;return function _class11_Factory(t){return(ɵ_class11_BaseFactory||(ɵ_class11_BaseFactory=core["ɵɵgetInheritedFactory"](_class11)))(t||_class11)}}(),_class11.ɵprov=core["ɵɵdefineInjectable"]({token:_class11,factory:_class11.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](DefaultRouteReuseStrategy,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);const ROUTER_CONFIGURATION=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"router config":"",{providedIn:"root",factory:()=>({})});class UrlHandlingStrategy{}(_class12=UrlHandlingStrategy).ɵfac=function _class12_Factory(t){return new(t||_class12)},_class12.ɵprov=core["ɵɵdefineInjectable"]({token:_class12,factory:function(){return(0,core.inject)(DefaultUrlHandlingStrategy)},providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](UrlHandlingStrategy,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(DefaultUrlHandlingStrategy)}]}],null,null);class DefaultUrlHandlingStrategy{shouldProcessUrl(url){return!0}extract(url){return url}merge(newUrlPart,wholeUrl){return newUrlPart}}var NavigationResult;function afterNextNavigation(router,action){router.events.pipe((0,filter.h)((e=>e instanceof NavigationEnd||e instanceof NavigationCancel||e instanceof NavigationError||e instanceof NavigationSkipped)),(0,map.U)((e=>{if(e instanceof NavigationEnd||e instanceof NavigationSkipped)return NavigationResult.COMPLETE;return e instanceof NavigationCancel&&(0===e.code||1===e.code)?NavigationResult.REDIRECTING:NavigationResult.FAILED})),(0,filter.h)((result=>result!==NavigationResult.REDIRECTING)),(0,take.q)(1)).subscribe((()=>{action()}))}function defaultErrorHandler(error){throw error}function defaultMalformedUriErrorHandler(error,urlSerializer,url){return urlSerializer.parse("/")}(_class13=DefaultUrlHandlingStrategy).ɵfac=function _class13_Factory(t){return new(t||_class13)},_class13.ɵprov=core["ɵɵdefineInjectable"]({token:_class13,factory:_class13.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](DefaultUrlHandlingStrategy,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null),function(NavigationResult){NavigationResult[NavigationResult.COMPLETE=0]="COMPLETE",NavigationResult[NavigationResult.FAILED=1]="FAILED",NavigationResult[NavigationResult.REDIRECTING=2]="REDIRECTING"}(NavigationResult||(NavigationResult={}));const exactMatchOptions={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},subsetMatchOptions={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};class Router{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.ɵrouterPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,core.inject)(core["ɵConsole"]),this.isNgZoneEnabled=!1,this.options=(0,core.inject)(ROUTER_CONFIGURATION,{optional:!0})||{},this.pendingTasks=(0,core.inject)(core["ɵInitialRenderPendingTasks"]),this.errorHandler=this.options.errorHandler||defaultErrorHandler,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||defaultMalformedUriErrorHandler,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,core.inject)(UrlHandlingStrategy),this.routeReuseStrategy=(0,core.inject)(RouteReuseStrategy),this.titleStrategy=(0,core.inject)(TitleStrategy),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=(0,core.inject)(ROUTES,{optional:!0})?.flat()??[],this.navigationTransitions=(0,core.inject)(NavigationTransitions),this.urlSerializer=(0,core.inject)(UrlSerializer),this.location=(0,core.inject)(common.Location),this.componentInputBindingEnabled=!!(0,core.inject)(INPUT_BINDER,{optional:!0}),this.isNgZoneEnabled=(0,core.inject)(core.NgZone)instanceof core.NgZone&&core.NgZone.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new UrlTree,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=createEmptyState(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe((t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId??0}),(e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)}))}resetRootComponentType(rootComponentType){this.routerState.root.component=rootComponentType,this.navigationTransitions.rootComponentType=rootComponentType}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const state=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),"imperative",state)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe((event=>{const source="popstate"===event.type?"popstate":"hashchange";"popstate"===source&&setTimeout((()=>{this.navigateToSyncWithBrowser(event.url,source,event.state)}),0)})))}navigateToSyncWithBrowser(url,source,state){const extras={replaceUrl:!0},restoredState=state?.navigationId?state:null;if(state){const stateCopy={...state};delete stateCopy.navigationId,delete stateCopy.ɵrouterPageId,0!==Object.keys(stateCopy).length&&(extras.state=stateCopy)}const urlTree=this.parseUrl(url);this.scheduleNavigation(urlTree,source,restoredState,extras)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(config){("undefined"==typeof ngDevMode||ngDevMode)&&validateConfig(config),this.config=config.map(standardizeConfig),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(commands,navigationExtras={}){const{relativeTo,queryParams,fragment,queryParamsHandling,preserveFragment}=navigationExtras,f=preserveFragment?this.currentUrlTree.fragment:fragment;let relativeToUrlSegmentGroup,q=null;switch(queryParamsHandling){case"merge":q={...this.currentUrlTree.queryParams,...queryParams};break;case"preserve":q=this.currentUrlTree.queryParams;break;default:q=queryParams||null}null!==q&&(q=this.removeEmptyProps(q));try{relativeToUrlSegmentGroup=createSegmentGroupFromRoute(relativeTo?relativeTo.snapshot:this.routerState.snapshot.root)}catch(e){"string"==typeof commands[0]&&commands[0].startsWith("/")||(commands=[]),relativeToUrlSegmentGroup=this.currentUrlTree.root}return createUrlTreeFromSegmentGroup(relativeToUrlSegmentGroup,commands,q,f??null)}navigateByUrl(url,extras={skipLocationChange:!1}){("undefined"==typeof ngDevMode||ngDevMode)&&this.isNgZoneEnabled&&!core.NgZone.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");const urlTree=isUrlTree(url)?url:this.parseUrl(url),mergedTree=this.urlHandlingStrategy.merge(urlTree,this.rawUrlTree);return this.scheduleNavigation(mergedTree,"imperative",null,extras)}navigate(commands,extras={skipLocationChange:!1}){return function validateCommands(commands){for(let i=0;i<commands.length;i++){const cmd=commands[i];if(null==cmd)throw new core["ɵRuntimeError"](4008,("undefined"==typeof ngDevMode||ngDevMode)&&`The requested path contains ${cmd} segment at index ${i}`)}}(commands),this.navigateByUrl(this.createUrlTree(commands,extras),extras)}serializeUrl(url){return this.urlSerializer.serialize(url)}parseUrl(url){let urlTree;try{urlTree=this.urlSerializer.parse(url)}catch(e){urlTree=this.malformedUriErrorHandler(e,this.urlSerializer,url)}return urlTree}isActive(url,matchOptions){let options;if(options=!0===matchOptions?{...exactMatchOptions}:!1===matchOptions?{...subsetMatchOptions}:matchOptions,isUrlTree(url))return containsTree(this.currentUrlTree,url,options);const urlTree=this.parseUrl(url);return containsTree(this.currentUrlTree,urlTree,options)}removeEmptyProps(params){return Object.keys(params).reduce(((result,key)=>{const value=params[key];return null!=value&&(result[key]=value),result}),{})}scheduleNavigation(rawUrl,source,restoredState,extras,priorPromise){if(this.disposed)return Promise.resolve(!1);let resolve,reject,promise;priorPromise?(resolve=priorPromise.resolve,reject=priorPromise.reject,promise=priorPromise.promise):promise=new Promise(((res,rej)=>{resolve=res,reject=rej}));const taskId=this.pendingTasks.add();return afterNextNavigation(this,(()=>{queueMicrotask((()=>this.pendingTasks.remove(taskId)))})),this.navigationTransitions.handleNavigationRequest({source,restoredState,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl,extras,resolve,reject,promise,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),promise.catch((e=>Promise.reject(e)))}setBrowserUrl(url,transition){const path=this.urlSerializer.serialize(url);if(this.location.isCurrentPathEqualTo(path)||transition.extras.replaceUrl){const currentBrowserPageId=this.browserPageId,state={...transition.extras.state,...this.generateNgRouterState(transition.id,currentBrowserPageId)};this.location.replaceState(path,"",state)}else{const state={...transition.extras.state,...this.generateNgRouterState(transition.id,(this.browserPageId??0)+1)};this.location.go(path,"",state)}}restoreHistory(transition,restoringFromCaughtError=!1){if("computed"===this.canceledNavigationResolution){const currentBrowserPageId=this.browserPageId??this.currentPageId,targetPagePosition=this.currentPageId-currentBrowserPageId;0!==targetPagePosition?this.location.historyGo(targetPagePosition):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===targetPagePosition&&(this.resetState(transition),this.browserUrlTree=transition.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(restoringFromCaughtError&&this.resetState(transition),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(navigationId,routerPageId){return"computed"===this.canceledNavigationResolution?{navigationId,ɵrouterPageId:routerPageId}:{navigationId}}}(_class14=Router).ɵfac=function _class14_Factory(t){return new(t||_class14)},_class14.ɵprov=core["ɵɵdefineInjectable"]({token:_class14,factory:_class14.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](Router,[{type:core.Injectable,args:[{providedIn:"root"}]}],(function(){return[]}),null);class RouterLink{constructor(router,route,tabIndexAttribute,renderer,el,locationStrategy){this.router=router,this.route=route,this.tabIndexAttribute=tabIndexAttribute,this.renderer=renderer,this.el=el,this.locationStrategy=locationStrategy,this.href=null,this.commands=null,this.onChanges=new Subject.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const tagName=el.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===tagName||"area"===tagName,this.isAnchorElement?this.subscription=router.events.subscribe((s=>{s instanceof NavigationEnd&&this.updateHref()})):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(newTabIndex){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",newTabIndex)}ngOnChanges(changes){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(commands){null!=commands?(this.commands=Array.isArray(commands)?commands:[commands],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(button,ctrlKey,shiftKey,altKey,metaKey){if(null===this.urlTree)return!0;if(this.isAnchorElement){if(0!==button||ctrlKey||shiftKey||altKey||metaKey)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0}const extras={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state};return this.router.navigateByUrl(this.urlTree,extras),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const sanitizedValue=null===this.href?null:(0,core["ɵɵsanitizeUrlOrResourceUrl"])(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",sanitizedValue)}applyAttributeValue(attrName,attrValue){const renderer=this.renderer,nativeElement=this.el.nativeElement;null!==attrValue?renderer.setAttribute(nativeElement,attrName,attrValue):renderer.removeAttribute(nativeElement,attrName)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}(_class15=RouterLink).ɵfac=function _class15_Factory(t){return new(t||_class15)(core["ɵɵdirectiveInject"](Router),core["ɵɵdirectiveInject"](ActivatedRoute),core["ɵɵinjectAttribute"]("tabindex"),core["ɵɵdirectiveInject"](core.Renderer2),core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](common.LocationStrategy))},_class15.ɵdir=core["ɵɵdefineDirective"]({type:_class15,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function _class15_HostBindings(rf,ctx){1&rf&&core["ɵɵlistener"]("click",(function _class15_click_HostBindingHandler($event){return ctx.onClick($event.button,$event.ctrlKey,$event.shiftKey,$event.altKey,$event.metaKey)})),2&rf&&core["ɵɵattribute"]("target",ctx.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",core.booleanAttribute],skipLocationChange:["skipLocationChange","skipLocationChange",core.booleanAttribute],replaceUrl:["replaceUrl","replaceUrl",core.booleanAttribute],routerLink:"routerLink"},standalone:!0,features:[core["ɵɵInputTransformsFeature"],core["ɵɵNgOnChangesFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterLink,[{type:core.Directive,args:[{selector:"[routerLink]",standalone:!0}]}],(function(){return[{type:Router},{type:ActivatedRoute},{type:void 0,decorators:[{type:core.Attribute,args:["tabindex"]}]},{type:core.Renderer2},{type:core.ElementRef},{type:common.LocationStrategy}]}),{target:[{type:core.HostBinding,args:["attr.target"]},{type:core.Input}],queryParams:[{type:core.Input}],fragment:[{type:core.Input}],queryParamsHandling:[{type:core.Input}],state:[{type:core.Input}],relativeTo:[{type:core.Input}],preserveFragment:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],skipLocationChange:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],replaceUrl:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],routerLink:[{type:core.Input}],onClick:[{type:core.HostListener,args:["click",["$event.button","$event.ctrlKey","$event.shiftKey","$event.altKey","$event.metaKey"]]}]});class RouterLinkActive{get isActive(){return this._isActive}constructor(router,element,renderer,cdr,link){this.router=router,this.element=element,this.renderer=renderer,this.cdr=cdr,this.link=link,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new core.EventEmitter,this.routerEventsSubscription=router.events.subscribe((s=>{s instanceof NavigationEnd&&this.update()}))}ngAfterContentInit(){(0,of.of)(this.links.changes,(0,of.of)(null)).pipe((0,mergeAll.J)()).subscribe((_=>{this.update(),this.subscribeToEachLinkOnChanges()}))}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const allLinkChanges=[...this.links.toArray(),this.link].filter((link=>!!link)).map((link=>link.onChanges));this.linkInputChangesSubscription=(0,from.D)(allLinkChanges).pipe((0,mergeAll.J)()).subscribe((link=>{this._isActive!==this.isLinkActive(this.router)(link)&&this.update()}))}set routerLinkActive(data){const classes=Array.isArray(data)?data:data.split(" ");this.classes=classes.filter((c=>!!c))}ngOnChanges(changes){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){this.links&&this.router.navigated&&queueMicrotask((()=>{const hasActiveLinks=this.hasActiveLinks();this._isActive!==hasActiveLinks&&(this._isActive=hasActiveLinks,this.cdr.markForCheck(),this.classes.forEach((c=>{hasActiveLinks?this.renderer.addClass(this.element.nativeElement,c):this.renderer.removeClass(this.element.nativeElement,c)})),hasActiveLinks&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(hasActiveLinks))}))}isLinkActive(router){const options=function isActiveMatchOptions(options){return!!options.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return link=>!!link.urlTree&&router.isActive(link.urlTree,options)}hasActiveLinks(){const isActiveCheckFn=this.isLinkActive(this.router);return this.link&&isActiveCheckFn(this.link)||this.links.some(isActiveCheckFn)}}(_class16=RouterLinkActive).ɵfac=function _class16_Factory(t){return new(t||_class16)(core["ɵɵdirectiveInject"](Router),core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.Renderer2),core["ɵɵdirectiveInject"](core.ChangeDetectorRef),core["ɵɵdirectiveInject"](RouterLink,8))},_class16.ɵdir=core["ɵɵdefineDirective"]({type:_class16,selectors:[["","routerLinkActive",""]],contentQueries:function _class16_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,RouterLink,5),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.links=_t)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[core["ɵɵNgOnChangesFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterLinkActive,[{type:core.Directive,args:[{selector:"[routerLinkActive]",exportAs:"routerLinkActive",standalone:!0}]}],(function(){return[{type:Router},{type:core.ElementRef},{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:RouterLink,decorators:[{type:core.Optional}]}]}),{links:[{type:core.ContentChildren,args:[RouterLink,{descendants:!0}]}],routerLinkActiveOptions:[{type:core.Input}],ariaCurrentWhenActive:[{type:core.Input}],isActiveChange:[{type:core.Output}],routerLinkActive:[{type:core.Input}]});class PreloadingStrategy{}class PreloadAllModules{preload(route,fn){return fn().pipe((0,catchError.K)((()=>(0,of.of)(null))))}}(_class17=PreloadAllModules).ɵfac=function _class17_Factory(t){return new(t||_class17)},_class17.ɵprov=core["ɵɵdefineInjectable"]({token:_class17,factory:_class17.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](PreloadAllModules,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class NoPreloading{preload(route,fn){return(0,of.of)(null)}}(_class18=NoPreloading).ɵfac=function _class18_Factory(t){return new(t||_class18)},_class18.ɵprov=core["ɵɵdefineInjectable"]({token:_class18,factory:_class18.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NoPreloading,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class RouterPreloader{constructor(router,compiler,injector,preloadingStrategy,loader){this.router=router,this.injector=injector,this.preloadingStrategy=preloadingStrategy,this.loader=loader}setUpPreloading(){this.subscription=this.router.events.pipe((0,filter.h)((e=>e instanceof NavigationEnd)),(0,concatMap.b)((()=>this.preload()))).subscribe((()=>{}))}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(injector,routes){const res=[];for(const route of routes){route.providers&&!route._injector&&(route._injector=(0,core.createEnvironmentInjector)(route.providers,injector,`Route: ${route.path}`));const injectorForCurrentRoute=route._injector??injector,injectorForChildren=route._loadedInjector??injectorForCurrentRoute;(route.loadChildren&&!route._loadedRoutes&&void 0===route.canLoad||route.loadComponent&&!route._loadedComponent)&&res.push(this.preloadConfig(injectorForCurrentRoute,route)),(route.children||route._loadedRoutes)&&res.push(this.processRoutes(injectorForChildren,route.children??route._loadedRoutes))}return(0,from.D)(res).pipe((0,mergeAll.J)())}preloadConfig(injector,route){return this.preloadingStrategy.preload(route,(()=>{let loadedChildren$;loadedChildren$=route.loadChildren&&void 0===route.canLoad?this.loader.loadChildren(injector,route):(0,of.of)(null);const recursiveLoadChildren$=loadedChildren$.pipe((0,mergeMap.z)((config=>null===config?(0,of.of)(void 0):(route._loadedRoutes=config.routes,route._loadedInjector=config.injector,this.processRoutes(config.injector??injector,config.routes)))));if(route.loadComponent&&!route._loadedComponent){const loadComponent$=this.loader.loadComponent(route);return(0,from.D)([recursiveLoadChildren$,loadComponent$]).pipe((0,mergeAll.J)())}return recursiveLoadChildren$}))}}(_class19=RouterPreloader).ɵfac=function _class19_Factory(t){return new(t||_class19)(core["ɵɵinject"](Router),core["ɵɵinject"](core.Compiler),core["ɵɵinject"](core.EnvironmentInjector),core["ɵɵinject"](PreloadingStrategy),core["ɵɵinject"](RouterConfigLoader))},_class19.ɵprov=core["ɵɵdefineInjectable"]({token:_class19,factory:_class19.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterPreloader,[{type:core.Injectable,args:[{providedIn:"root"}]}],(function(){return[{type:Router},{type:core.Compiler},{type:core.EnvironmentInjector},{type:PreloadingStrategy},{type:RouterConfigLoader}]}),null);const ROUTER_SCROLLER=new core.InjectionToken("");class RouterScroller{constructor(urlSerializer,transitions,viewportScroller,zone,options={}){this.urlSerializer=urlSerializer,this.transitions=transitions,this.viewportScroller=viewportScroller,this.zone=zone,this.options=options,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},options.scrollPositionRestoration=options.scrollPositionRestoration||"disabled",options.anchorScrolling=options.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe((e=>{e instanceof NavigationStart?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof NavigationEnd?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof NavigationSkipped&&0===e.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))}))}consumeScrollEvents(){return this.transitions.events.subscribe((e=>{e instanceof Scroll&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))}))}scheduleScrollEvent(routerEvent,anchor){this.zone.runOutsideAngular((()=>{setTimeout((()=>{this.zone.run((()=>{this.transitions.events.next(new Scroll(routerEvent,"popstate"===this.lastSource?this.store[this.restoredId]:null,anchor))}))}),0)}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}function rootRoute(router){return router.routerState.root}function routerFeature(kind,providers){return{ɵkind:kind,ɵproviders:providers}}(_class20=RouterScroller).ɵfac=function _class20_Factory(t){core["ɵɵinvalidFactory"]()},_class20.ɵprov=core["ɵɵdefineInjectable"]({token:_class20,factory:_class20.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterScroller,[{type:core.Injectable}],(function(){return[{type:UrlSerializer},{type:NavigationTransitions},{type:common.ViewportScroller},{type:core.NgZone},{type:void 0}]}),null);const ROUTER_IS_PROVIDED=new core.InjectionToken("",{providedIn:"root",factory:()=>!1});core.ENVIRONMENT_INITIALIZER;function getBootstrapListener(){const injector=(0,core.inject)(core.Injector);return bootstrappedComponentRef=>{const ref=injector.get(core.ApplicationRef);if(bootstrappedComponentRef!==ref.components[0])return;const router=injector.get(Router),bootstrapDone=injector.get(BOOTSTRAP_DONE);1===injector.get(INITIAL_NAVIGATION)&&router.initialNavigation(),injector.get(ROUTER_PRELOADER,null,core.InjectFlags.Optional)?.setUpPreloading(),injector.get(ROUTER_SCROLLER,null,core.InjectFlags.Optional)?.init(),router.resetRootComponentType(ref.componentTypes[0]),bootstrapDone.closed||(bootstrapDone.next(),bootstrapDone.complete(),bootstrapDone.unsubscribe())}}const BOOTSTRAP_DONE=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"bootstrap done indicator":"",{factory:()=>new Subject.x}),INITIAL_NAVIGATION=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"initial navigation":"",{providedIn:"root",factory:()=>1});function withDebugTracing(){let providers=[];return providers="undefined"==typeof ngDevMode||ngDevMode?[{provide:core.ENVIRONMENT_INITIALIZER,multi:!0,useFactory:()=>{const router=(0,core.inject)(Router);return()=>router.events.subscribe((e=>{console.group?.(`Router Event: ${e.constructor.name}`),console.log(function stringifyEvent(routerEvent){switch(routerEvent.type){case 14:return`ActivationEnd(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state}, shouldActivate: ${routerEvent.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case 2:return`NavigationCancel(id: ${routerEvent.id}, url: '${routerEvent.url}')`;case 16:return`NavigationSkipped(id: ${routerEvent.id}, url: '${routerEvent.url}')`;case 1:return`NavigationEnd(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${routerEvent.id}, url: '${routerEvent.url}', error: ${routerEvent.error})`;case 0:return`NavigationStart(id: ${routerEvent.id}, url: '${routerEvent.url}')`;case 6:return`ResolveEnd(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case 5:return`ResolveStart(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case 10:return`RouteConfigLoadEnd(path: ${routerEvent.route.path})`;case 9:return`RouteConfigLoadStart(path: ${routerEvent.route.path})`;case 4:return`RoutesRecognized(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case 15:const pos=routerEvent.position?`${routerEvent.position[0]}, ${routerEvent.position[1]}`:null;return`Scroll(anchor: '${routerEvent.anchor}', position: '${pos}')`}}(e)),console.log(e),console.groupEnd?.()}))}}]:[],routerFeature(1,providers)}const ROUTER_PRELOADER=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"router preloader":"");const ROUTER_DIRECTIVES=[RouterOutlet,RouterLink,RouterLinkActive,ɵEmptyOutletComponent],ROUTER_FORROOT_GUARD=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),ROUTER_PROVIDERS=[common.Location,{provide:UrlSerializer,useClass:DefaultUrlSerializer},Router,ChildrenOutletContexts,{provide:ActivatedRoute,useFactory:rootRoute,deps:[Router]},RouterConfigLoader,"undefined"==typeof ngDevMode||ngDevMode?{provide:ROUTER_IS_PROVIDED,useValue:!0}:[]];function routerNgProbeToken(){return new core.NgProbeToken("Router",Router)}class RouterModule{constructor(guard){}static forRoot(routes,config){return{ngModule:RouterModule,providers:[ROUTER_PROVIDERS,("undefined"==typeof ngDevMode||ngDevMode)&&config?.enableTracing?withDebugTracing().ɵproviders:[],{provide:ROUTES,multi:!0,useValue:routes},{provide:ROUTER_FORROOT_GUARD,useFactory:provideForRootGuard,deps:[[Router,new core.Optional,new core.SkipSelf]]},{provide:ROUTER_CONFIGURATION,useValue:config||{}},config?.useHash?{provide:common.LocationStrategy,useClass:common.HashLocationStrategy}:{provide:common.LocationStrategy,useClass:common.PathLocationStrategy},{provide:ROUTER_SCROLLER,useFactory:()=>{const viewportScroller=(0,core.inject)(common.ViewportScroller),zone=(0,core.inject)(core.NgZone),config=(0,core.inject)(ROUTER_CONFIGURATION),transitions=(0,core.inject)(NavigationTransitions),urlSerializer=(0,core.inject)(UrlSerializer);return config.scrollOffset&&viewportScroller.setOffset(config.scrollOffset),new RouterScroller(urlSerializer,transitions,viewportScroller,zone,config)}},config?.preloadingStrategy?(preloadingStrategy=config.preloadingStrategy,routerFeature(0,[{provide:ROUTER_PRELOADER,useExisting:RouterPreloader},{provide:PreloadingStrategy,useExisting:preloadingStrategy}])).ɵproviders:[],{provide:core.NgProbeToken,multi:!0,useFactory:routerNgProbeToken},config?.initialNavigation?provideInitialNavigation(config):[],config?.bindToComponentInputs?routerFeature(8,[RoutedComponentInputBinder,{provide:INPUT_BINDER,useExisting:RoutedComponentInputBinder}]).ɵproviders:[],[{provide:ROUTER_INITIALIZER,useFactory:getBootstrapListener},{provide:core.APP_BOOTSTRAP_LISTENER,multi:!0,useExisting:ROUTER_INITIALIZER}]]};var preloadingStrategy}static forChild(routes){return{ngModule:RouterModule,providers:[{provide:ROUTES,multi:!0,useValue:routes}]}}}function provideForRootGuard(router){if(("undefined"==typeof ngDevMode||ngDevMode)&&router)throw new core["ɵRuntimeError"](4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function provideInitialNavigation(config){return["disabled"===config.initialNavigation?routerFeature(3,[{provide:core.APP_INITIALIZER,multi:!0,useFactory:()=>{const router=(0,core.inject)(Router);return()=>{router.setUpLocationChangeListener()}}},{provide:INITIAL_NAVIGATION,useValue:2}]).ɵproviders:[],"enabledBlocking"===config.initialNavigation?routerFeature(2,[{provide:INITIAL_NAVIGATION,useValue:0},{provide:core.APP_INITIALIZER,multi:!0,deps:[core.Injector],useFactory:injector=>{const locationInitialized=injector.get(common.LOCATION_INITIALIZED,Promise.resolve());return()=>locationInitialized.then((()=>new Promise((resolve=>{const router=injector.get(Router),bootstrapDone=injector.get(BOOTSTRAP_DONE);afterNextNavigation(router,(()=>{resolve(!0)})),injector.get(NavigationTransitions).afterPreactivation=()=>(resolve(!0),bootstrapDone.closed?(0,of.of)(void 0):bootstrapDone),router.initialNavigation()}))))}}]).ɵproviders:[]]}(_class21=RouterModule).ɵfac=function _class21_Factory(t){return new(t||_class21)(core["ɵɵinject"](ROUTER_FORROOT_GUARD,8))},_class21.ɵmod=core["ɵɵdefineNgModule"]({type:_class21,imports:[RouterOutlet,RouterLink,RouterLinkActive,ɵEmptyOutletComponent],exports:[RouterOutlet,RouterLink,RouterLinkActive,ɵEmptyOutletComponent]}),_class21.ɵinj=core["ɵɵdefineInjector"]({}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterModule,[{type:core.NgModule,args:[{imports:ROUTER_DIRECTIVES,exports:ROUTER_DIRECTIVES}]}],(function(){return[{type:void 0,decorators:[{type:core.Optional},{type:core.Inject,args:[ROUTER_FORROOT_GUARD]}]}]}),null);const ROUTER_INITIALIZER=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"Router Initializer":"");new core.Version("16.2.1");var angular_three_class,angular_three_class2,angular_three_class3,angular_three_class4,angular_three_class5,angular_three_class6,angular_three_class7,angular_three_class8,angular_three_class9,angular_three_class10,angular_three_class11,angular_three_class12,angular_three_class13;const _c0=["glCanvas"],_c1=["portalContentAnchor"];function _class12_ng_container_2_Template(rf,ctx){if(1&rf){const _r3=core["ɵɵgetCurrentView"]();core["ɵɵelementContainerStart"](0,2),core["ɵɵlistener"]("beforeRender",(function _class12_ng_container_2_Template_ng_container_beforeRender_0_listener($event){core["ɵɵrestoreView"](_r3);const ctx_r2=core["ɵɵnextContext"]();return core["ɵɵresetView"](ctx_r2.onBeforeRender($event))})),core["ɵɵelementContainerEnd"]()}if(2&rf){const ctx_r1=core["ɵɵnextContext"]();core["ɵɵproperty"]("renderPriority",ctx_r1.autoRenderPriority)("parentScene",ctx_r1.parentScene)("parentCamera",ctx_r1.parentCamera)}}const idCache={};function makeId(event){if(event)return(event.eventObject||event.object).uuid+"/"+event.index+event.instanceId;const newId=three_module.MathUtils.generateUUID();return idCache[newId]?makeId():(idCache[newId]=!0,newId)}function makeDpr(dpr,window){const target=window?.devicePixelRatio||1;return Array.isArray(dpr)?Math.min(Math.max(dpr[0],target),dpr[1]):dpr}function safeDetectChanges(cdr){if(cdr)try{(cdr.context||cdr._attachedToViewContainer)&&cdr.detectChanges()}catch(e){cdr.markForCheck()}}const cached=new Map;function load(loaderConstructorFactory,input,extensions,onProgress){return((0,isObservable.b)(input)?input:(0,of.of)(input)).pipe((0,map.U)((inputs=>{const loader=new(loaderConstructorFactory(inputs));extensions&&extensions(loader);return[(Array.isArray(inputs)?inputs:"string"==typeof inputs?[inputs]:Object.values(inputs)).map((url=>(cached.has(url)||cached.set(url,(0,from.D)(loader.loadAsync(url,onProgress)).pipe((0,tap.b)((data=>{data.scene&&Object.assign(data,function makeObjectGraph(object){const data={nodes:{},materials:{}};return object&&object.traverse((child=>{child.name&&(data.nodes[child.name]=child),"material"in child&&!data.materials[child.material.name]&&(data.materials[child.material.name]=child.material)})),data}(data.scene))})),(0,retry.X)(2),(0,catchError.K)((err=>(console.error(`[NGT] Error loading ${url}: ${err.message}`),(0,of.of)([])))),(0,share.B)({connector:()=>new ReplaySubject.t(1)}))),cached.get(url)))),inputs]})))}function injectNgtLoader(loaderConstructorFactory,input,extensions,onProgress){const cdr=(0,core.inject)(core.ChangeDetectorRef);return load(loaderConstructorFactory,input,extensions,onProgress).pipe((0,switchMap.w)((([observables$,inputs])=>(0,forkJoin.D)(observables$).pipe((0,map.U)((results=>{if(Array.isArray(inputs))return results;if("string"==typeof inputs)return results[0];const keys=Object.keys(inputs);return keys.reduce(((result,key)=>(result[key]=results[keys.indexOf(key)],result)),{})})),(0,tap.b)((()=>{requestAnimationFrame((()=>{safeDetectChanges(cdr)}))}))))))}injectNgtLoader.destroy=()=>{cached.clear()},injectNgtLoader.preLoad=(loaderConstructorFactory,inputs,extensions)=>{load(loaderConstructorFactory,inputs,extensions).pipe((0,take.q)(1)).subscribe()};const globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;function run(effects,timestamp){if(effects.size)for(const{callback}of effects.values())callback(timestamp)}function flushGlobalEffects(type,timestamp){switch(type){case"before":return run(globalEffects,timestamp);case"after":return run(globalAfterEffects,timestamp);case"tail":return run(globalTailEffects,timestamp)}}function render(timestamp,store,frame){const state=store.get();let delta=state.clock.getDelta();"never"===state.frameloop&&"number"==typeof timestamp&&(delta=timestamp-state.clock.elapsedTime,state.clock.oldTime=state.clock.elapsedTime,state.clock.elapsedTime=timestamp);for(let i=0;i<state.internal.subscribers.length;i++){state.internal.subscribers[i].callback({...state,delta,frame})}return!state.internal.priority&&state.gl.render&&state.gl.render(state.scene,state.camera),state.internal.frames=Math.max(0,state.internal.frames-1),"always"===state.frameloop?1:state.internal.frames}const is={obj:a=>a===Object(a)&&!Array.isArray(a)&&"function"!=typeof a,material:a=>!!a&&a.isMaterial,geometry:a=>!!a&&a.isBufferGeometry,orthographicCamera:a=>!!a&&a.isOrthographicCamera,perspectiveCamera:a=>!!a&&a.isPerspectiveCamera,camera:a=>!!a&&a.isCamera,renderer:a=>!!a&&a instanceof three_module.WebGLRenderer,scene:a=>!!a&&a.isScene,object3D:a=>!!a&&a.isObject3D,instance:a=>!!a&&!!a.__ngt__,ref:a=>a instanceof core.ElementRef,colorSpaceExist:object=>"colorSpace"in object||"outputColorSpace"in object,equ(a,b,{arrays="shallow",objects="reference",strict=!0}={}){if(typeof a!=typeof b||!!a!=!!b)return!1;if("string"==typeof a||"number"==typeof a)return a===b;const isObj=is.obj(a);if(isObj&&"reference"===objects)return a===b;const isArr=Array.isArray(a);if(isArr&&"reference"===arrays)return a===b;if((isArr||isObj)&&a===b)return!0;let i;for(i in a)if(!(i in b))return!1;for(i in strict?b:a)if(a[i]!==b[i])return!1;if(void 0===i){if(isArr&&0===a.length&&0===b.length)return!0;if(isObj&&0===Object.keys(a).length&&0===Object.keys(b).length)return!0;if(a!==b)return!1}return!0}};function checkNeedsUpdate(value){null!==value&&is.obj(value)&&"needsUpdate"in value&&(value.needsUpdate=!0,"uniformsNeedUpdate"in value&&(value.uniformsNeedUpdate=!0))}function checkUpdate(value){is.object3D(value)&&value.updateMatrix(),is.camera(value)&&((is.perspectiveCamera(value)||is.orthographicCamera(value))&&value.updateProjectionMatrix(),value.updateMatrixWorld()),checkNeedsUpdate(value)}function updateCamera(camera,size){camera.manual||(is.orthographicCamera(camera)?(camera.left=size.width/-2,camera.right=size.width/2,camera.top=size.height/2,camera.bottom=size.height/-2):camera.aspect=size.width/size.height,camera.updateProjectionMatrix(),camera.updateMatrixWorld())}function getLocalState(obj){return obj&&obj.__ngt__||{}}function invalidateInstance(instance){const state=getLocalState(instance).store?.get();state&&0===state.internal.frames&&state.invalidate(),checkUpdate(instance)}function prepare(object,localState){const instance="function"==typeof object?object():object;if(localState?.primitive||!instance.__ngt__){const{objects=new BehaviorSubject.X([]),nonObjects=new BehaviorSubject.X([]),...rest}=localState||{};instance.__ngt__={previousAttach:null,store:null,parent:null,memoized:{},eventCount:0,handlers:{},objects,nonObjects,add:(object,type)=>{const current=instance.__ngt__[type].value,foundIndex=current.indexOf((obj=>obj===object));foundIndex>-1?(current.splice(foundIndex,1,object),instance.__ngt__[type].next(current)):instance.__ngt__[type].next([...instance.__ngt__[type].value,object]),notifyAncestors(instance.__ngt__.parent)},remove:(object,type)=>{instance.__ngt__[type].next(instance.__ngt__[type].value.filter((o=>o!==object))),notifyAncestors(instance.__ngt__.parent)},...rest}}return instance}function notifyAncestors(instance){if(!instance)return;const localState=getLocalState(instance);localState.objects&&localState.objects.next(localState.objects.value),localState.nonObjects&&localState.nonObjects.next(localState.nonObjects.value),notifyAncestors(localState.parent)}function applyProps(instance,props){if(!Object.keys(props).length)return instance;const localState=getLocalState(instance),rootState=localState.store?.get(),changes=function diffProps(instance,props){const propsEntries=Object.entries(props),changes=[];for(const[propKey,propValue]of propsEntries)is.equ(propValue,instance[propKey])||changes.push([propKey,propValue]);return changes}(instance,props);for(let i=0;i<changes.length;i++){let key=changes[i][0];const currentInstance=instance,targetProp=currentInstance[key];let value=changes[i][1];if(is.colorSpaceExist(currentInstance)){const sRGBEncoding=3001,SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear";"encoding"===key?(key="colorSpace",value=value===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace):"outputEncoding"===key&&(key="outputColorSpace",value=value===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace)}if(targetProp&&targetProp.set&&(targetProp.copy||targetProp instanceof three_module.Layers)){const isColor=targetProp instanceof three_module.Color;if(Array.isArray(value))targetProp.fromArray?targetProp.fromArray(value):targetProp.set(...value);else if(targetProp.copy&&value&&value.constructor&&targetProp.constructor.name===value.constructor.name)targetProp.copy(value),three_module.ColorManagement||rootState.linear||!isColor||targetProp.convertSRGBToLinear();else if(void 0!==value){const isColor=targetProp instanceof three_module.Color;!isColor&&targetProp.setScalar?targetProp.setScalar(value):targetProp instanceof three_module.Layers&&value instanceof three_module.Layers?targetProp.mask=value.mask:targetProp.set(value),three_module.ColorManagement||rootState?.linear||!isColor||targetProp.convertSRGBToLinear()}}else if(currentInstance[key]=value,currentInstance[key]instanceof three_module.Texture&&currentInstance[key].format===three_module.RGBAFormat&&currentInstance[key].type===three_module.UnsignedByteType){const texture=currentInstance[key];is.colorSpaceExist(texture)&&is.colorSpaceExist(rootState.gl)?texture.colorSpace=rootState.gl.outputColorSpace:texture.encoding=rootState.gl.outputEncoding}checkUpdate(targetProp),invalidateInstance(instance)}const instanceHandlers=localState.eventCount;return localState.parent&&rootState.internal&&instance.raycast&&instanceHandlers!==localState.eventCount&&(rootState.removeInteraction(instance.uuid),localState.eventCount&&rootState.addInteraction(instance)),localState.parent&&localState.afterUpdate&&localState.afterUpdate.observed&&changes.length&&localState.afterUpdate.emit(instance),instance}const startWithUndefined=()=>(0,startWith.O)(void 0);class NgtRxStore extends RxState{constructor(){super(),this.set({__ngt_dummy__:"__ngt_dummy__"});const originalSet=this.set.bind(this);Object.defineProperty(this,"set",{get:()=>(...args)=>{const firstArg=args[0];if(is.obj(firstArg)){const modArgs=Object.entries(firstArg).reduce(((modded,[key,value])=>(modded[key]=void 0===value?this.get(key):value,modded)),{});return originalSet(modArgs)}return originalSet(...args)}});const originalGet=this.get.bind(this);Object.defineProperty(this,"get",{get:()=>(...args)=>0===args.length?originalGet()??{}:originalGet(...args)}),this.initialize()}initialize(){}effect(obs,sideEffectFn){return this.hold(obs.pipe(function tapEffect(effectFn){let prev,cleanupFn=()=>{},firstRun=!1;const teardown=error=>()=>{cleanupFn&&cleanupFn({prev,complete:!0,error})};return(0,tap.b)({next:value=>{cleanupFn&&firstRun&&cleanupFn({prev,complete:!1,error:!1});const cleanUpOrVoid=effectFn(value);cleanUpOrVoid&&(cleanupFn=cleanUpOrVoid),prev=value,firstRun||(firstRun=!0)},complete:teardown(!1),unsubscribe:teardown(!1),error:teardown(!0)})}(sideEffectFn)))}triggerChangeDetection(cdr,keys=[]){let $=this.$;keys.length&&($=(0,combineLatest.a)(keys.map((key=>this.select(key).pipe((0,startWith.O)(this.get(key)??void 0)))))),this.hold($,(()=>{requestAnimationFrame((()=>{safeDetectChanges(cdr)}))}))}}(angular_three_class=NgtRxStore).ɵfac=function _class_Factory(t){return new(t||angular_three_class)},angular_three_class.ɵprov=core["ɵɵdefineInjectable"]({token:angular_three_class,factory:angular_three_class.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRxStore,[{type:core.Injectable}],(function(){return[]}),null);const rootStateMap=new Map,{invalidate,advance}=function createLoop(roots){let repeat,frame,running=!1;function loop(timestamp){frame=requestAnimationFrame(loop),running=!0,repeat=0,flushGlobalEffects("before",timestamp);for(const root of roots.values()){const state=root.get();state.internal.active&&("always"===state.frameloop||state.internal.frames>0)&&!state.gl.xr?.isPresenting&&(repeat+=render(timestamp,root))}if(flushGlobalEffects("after",timestamp),0===repeat)return flushGlobalEffects("tail",timestamp),running=!1,cancelAnimationFrame(frame)}return{loop,invalidate:function invalidate(store,frames=1){const state=store?.get();if(!state)return roots.forEach((root=>invalidate(root,frames)));!state.gl.xr?.isPresenting&&state.internal.active&&"never"!==state.frameloop&&(state.internal.frames=Math.min(60,state.internal.frames+frames),running||(running=!0,requestAnimationFrame(loop)))},advance:function advance(timestamp,runGlobalEffects=!0,store,frame){const state=store?.get();if(runGlobalEffects&&flushGlobalEffects("before",timestamp),state)render(timestamp,store,frame);else for(const root of roots.values())render(timestamp,root);runGlobalEffects&&flushGlobalEffects("after",timestamp)}}}(rootStateMap),shallowLoose={objects:"shallow",strict:!1};class NgtStore extends NgtRxStore{constructor(){super(...arguments),this.parentStore=(0,core.inject)(NgtStore,{optional:!0,skipSelf:!0}),this.window=(0,core.inject)(common.DOCUMENT).defaultView,this.isInit=!1}init(){if(!this.isInit){const position=new three_module.Vector3,defaultTarget=new three_module.Vector3,tempTarget=new three_module.Vector3,getCurrentViewport=(camera=this.get("camera"),target=defaultTarget,size=this.get("size"))=>{const{width,height,top,left}=size,aspect=width/height;target instanceof three_module.Vector3?tempTarget.copy(target):tempTarget.set(...target);const distance=camera.getWorldPosition(position).distanceTo(tempTarget);if(is.orthographicCamera(camera))return{width:width/camera.zoom,height:height/camera.zoom,top,left,factor:1,distance,aspect};const fov=camera.fov*Math.PI/180,h=2*Math.tan(fov/2)*distance,w=h*aspect;return{width:w,height:h,top,left,factor:width/w,distance,aspect}};let performanceTimeout;const setPerformanceCurrent=current=>{this.set((state=>({performance:{...state.performance,current}})))};this.set({get:this.get.bind(this),set:this.set.bind(this),select:this.select.bind(this),ready:!1,scene:prepare(new three_module.Scene,{store:this}),events:{priority:1,enabled:!0,connected:!1},invalidate:(frames=1)=>invalidate(this,frames),advance:(timestamp,runGlobalEffects)=>advance(timestamp,runGlobalEffects,this),legacy:!1,linear:!1,flat:!1,controls:null,clock:new three_module.Clock,pointer:new three_module.Vector2,frameloop:"always",performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const state=this.get();performanceTimeout&&clearTimeout(performanceTimeout),state.performance.current!==state.performance.min&&setPerformanceCurrent(state.performance.min),performanceTimeout=setTimeout((()=>setPerformanceCurrent(this.get("performance","max")||1)),state.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport},previousStore:this.parentStore,internal:{active:!1,priority:0,frames:0,lastEvent:null,interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(callback,priority=0,store=this)=>{const internal=this.get("internal");return internal.priority=internal.priority+(priority>0?1:0),internal.subscribers.push({priority,store,callback}),internal.subscribers.sort(((a,b)=>(a.priority||0)-(b.priority||0))),()=>{const internal=this.get("internal");internal?.subscribers&&(internal.priority=internal.priority-(priority>0?1:0),internal.subscribers=internal.subscribers.filter((s=>s.callback!==callback)))}}},setEvents:events=>{this.set((state=>({events:{...state.events,...events}})))},setSize:(width,height,top,left)=>{const camera=this.get("camera"),size={width,height,top:top||0,left:left||0};this.set((state=>({size,viewport:{...state.viewport,...getCurrentViewport(camera,defaultTarget,size)}})))},setDpr:dpr=>{const resolved=makeDpr(dpr,this.window);this.set((state=>({viewport:{...state.viewport,dpr:resolved,initialDpr:state.viewport.initialDpr||resolved}})))},setFrameloop:(frameloop="always")=>{const clock=this.get("clock");clock.stop(),clock.elapsedTime=0,"never"!==frameloop&&(clock.start(),clock.elapsedTime=0),this.set({frameloop})},addInteraction:interaction=>{this.set((state=>({internal:{...state.internal,interaction:[...state.internal.interaction,interaction]}})))},removeInteraction:uuid=>{this.set((state=>({internal:{...state.internal,interaction:state.internal.interaction.filter((interaction=>interaction.uuid!==uuid))}})))}}),this.isInit=!0,this.resize()}}configure(inputs,canvasElement){const{gl:glOptions,size:sizeOptions,camera:cameraOptions,raycaster:raycasterOptions,events,orthographic,lookAt,shadows,linear,legacy,flat,dpr,frameloop,performance}=inputs,state=this.get(),stateToUpdate={};let gl=state.gl;state.gl||(stateToUpdate.gl=gl=function makeDefaultRenderer(glOptions,canvasElement){const customRenderer="function"==typeof glOptions?glOptions(canvasElement):glOptions;return null!=customRenderer?.render?customRenderer:new three_module.WebGLRenderer({powerPreference:"high-performance",canvas:canvasElement,antialias:!0,alpha:!0,...glOptions||{}})}(glOptions,canvasElement));let raycaster=state.raycaster;raycaster||(stateToUpdate.raycaster=raycaster=new three_module.Raycaster);const{params,...options}=raycasterOptions||{};if(is.equ(options,raycaster,shallowLoose)||applyProps(raycaster,{...options}),is.equ(params,raycaster.params,shallowLoose)||applyProps(raycaster,{params:{...raycaster.params,...params||{}}}),!state.camera){const isCamera=is.camera(cameraOptions);let camera=isCamera?cameraOptions:function makeDefaultCamera(isOrthographic,size){return isOrthographic?new three_module.OrthographicCamera(0,0,0,0,.1,1e3):new three_module.PerspectiveCamera(75,size.width/size.height,.1,1e3)}(orthographic||!1,state.size);isCamera||(cameraOptions&&applyProps(camera,cameraOptions),cameraOptions?.position||(camera.position.z=5),cameraOptions?.rotation||(Array.isArray(lookAt)?camera.lookAt(lookAt[0],lookAt[1],lookAt[2]):lookAt instanceof three_module.Vector3?camera.lookAt(lookAt):camera.lookAt(0,0,0)),camera.updateProjectionMatrix?.()),is.instance(camera)||(camera=prepare(camera,{store:this})),stateToUpdate.camera=camera}if(!state.xr){const handleXRFrame=(timestamp,frame)=>{"never"!==this.get().frameloop&&advance(timestamp,!0,this,frame)},handleSessionChange=()=>{const state=this.get();state.gl.xr.enabled=state.gl.xr.isPresenting,state.gl.xr.setAnimationLoop(state.gl.xr.isPresenting?handleXRFrame:null),state.gl.xr.isPresenting||invalidate(this)},xr={connect:()=>{gl.xr.addEventListener("sessionstart",handleSessionChange),gl.xr.addEventListener("sessionend",handleSessionChange)},disconnect:()=>{gl.xr.removeEventListener("sessionstart",handleSessionChange),gl.xr.removeEventListener("sessionend",handleSessionChange)}};gl.xr&&xr.connect(),stateToUpdate.xr=xr}if(gl.shadowMap){const isBoolean="boolean"==typeof shadows;if(isBoolean&&gl.shadowMap.enabled!==shadows||!is.equ(shadows,gl.shadowMap,shallowLoose)){const old=gl.shadowMap.enabled;gl.shadowMap.enabled=!!shadows,isBoolean?gl.shadowMap.type=three_module.PCFSoftShadowMap:Object.assign(gl.shadowMap,shadows),old!==gl.shadowMap.enabled&&checkNeedsUpdate(gl.shadowMap)}}if(three_module.ColorManagement){const ColorManagement=three_module.ColorManagement;"enabled"in ColorManagement?ColorManagement.enabled=!legacy??!1:"legacyMode"in ColorManagement&&(ColorManagement.legacyMode=legacy??!0)}applyProps(gl,{outputEncoding:linear?3e3:3001,toneMapping:flat?three_module.NoToneMapping:three_module.ACESFilmicToneMapping}),state.legacy!==legacy&&(stateToUpdate.legacy=legacy),state.linear!==linear&&(stateToUpdate.linear=linear),state.flat!==flat&&(stateToUpdate.flat=flat),gl.setClearAlpha(0),gl.setPixelRatio(makeDpr(state.viewport.dpr)),gl.setSize(state.size.width,state.size.height),!is.obj(glOptions)||"function"==typeof glOptions||is.renderer(glOptions)||is.equ(glOptions,gl,shallowLoose)||applyProps(gl,glOptions),events&&!state.events.handlers&&(stateToUpdate.events=events(this)),performance&&!is.equ(performance,state.performance,shallowLoose)&&(stateToUpdate.performance={...state.performance,...performance}),this.set(stateToUpdate),dpr&&state.viewport.dpr!==makeDpr(dpr)&&state.setDpr(dpr);const size=function computeInitialSize(canvas,defaultSize){if(defaultSize)return defaultSize;if(canvas instanceof HTMLCanvasElement&&canvas.parentElement)return canvas.parentElement.getBoundingClientRect();return{width:0,height:0,top:0,left:0}}(canvasElement,sizeOptions);is.equ(size,state.size,shallowLoose)||state.setSize(size.width,size.height,size.top,size.left),state.frameloop!==frameloop&&state.setFrameloop(frameloop),this.get("ready")||this.set({ready:!0}),this.invalidate()}destroy(canvas){this.set((state=>({internal:{...state.internal,active:!1}}))),setTimeout((()=>{const{gl,xr,events}=this.get();gl&&(events.disconnect&&events.disconnect(),gl.renderLists.dispose(),gl.forceContextLoss(),gl.xr&&gl.xr.enabled&&(gl.xr.setAnimationLoop(null),xr.disconnect()),function dispose(obj){obj.dispose&&!is.scene(obj)&&obj.dispose();for(const p in obj)p.dispose?.(),delete obj[p]}(this.get()),rootStateMap.delete(canvas))}),500)}resize(){const state=this.get();let oldSize=state.size,oldDpr=state.viewport.dpr,oldCamera=state.camera;this.hold((0,combineLatest.a)([this.select("camera"),this.select("size"),this.select("viewport"),this.select("gl")]),(([camera,size,viewport,gl])=>{size===oldSize&&viewport.dpr===oldDpr||(oldSize=size,oldDpr=viewport.dpr,updateCamera(camera,size),gl.setPixelRatio(viewport.dpr),gl.setSize(size.width,size.height)),camera!==oldCamera&&(updateCamera(camera,size),oldCamera=camera,this.set((state=>({viewport:{...state.viewport,...state.viewport.getCurrentViewport(camera)}}))))}))}invalidate(){this.hold(this.select(),(()=>invalidate(this)))}}(angular_three_class2=NgtStore).ɵfac=function(){let ɵ_class2_BaseFactory;return function _class2_Factory(t){return(ɵ_class2_BaseFactory||(ɵ_class2_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_class2)))(t||angular_three_class2)}}(),angular_three_class2.ɵprov=core["ɵɵdefineInjectable"]({token:angular_three_class2,factory:angular_three_class2.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtStore,[{type:core.Injectable}],null,null);const NGT_COMPOUND_PREFIXES=new core.InjectionToken("NgtCompoundPrefixes"),catalogue={};function extend(objects){Object.assign(catalogue,objects)}const NGT_CATALOGUE=new core.InjectionToken("THREE Constructors Catalogue",{factory:()=>catalogue});class NgtCommonDirective{constructor(){this.vcr=(0,core.inject)(core.ViewContainerRef),this.template=(0,core.inject)(core.TemplateRef),this.injected=!1,this.shouldCreateView=!0;const commentNode=this.vcr.element.nativeElement;commentNode.__ngt_renderer_add_comment__&&(commentNode.__ngt_renderer_add_comment__(),delete commentNode.__ngt_renderer_add_comment__)}createView(){this.shouldCreateView&&(this.view&&!this.view.destroyed&&this.view.destroy(),this.view=this.vcr.createEmbeddedView(this.template),safeDetectChanges(this.view))}}(angular_three_class3=NgtCommonDirective).ɵfac=function _class3_Factory(t){return new(t||angular_three_class3)},angular_three_class3.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_class3}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtCommonDirective,[{type:core.Directive}],(function(){return[]}),null);class NgtArgs extends NgtCommonDirective{constructor(){super(...arguments),this.injectedArgs=[]}set args(args){null==args||!Array.isArray(args)||1===args.length&&null===args[0]||(this.injected=!1,this.injectedArgs=args,this.createView())}get args(){return this.validate()?(this.injected=!0,this.injectedArgs):null}validate(){return!this.injected&&!!this.injectedArgs.length}}(angular_three_class4=NgtArgs).ɵfac=function(){let ɵ_class4_BaseFactory;return function _class4_Factory(t){return(ɵ_class4_BaseFactory||(ɵ_class4_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_class4)))(t||angular_three_class4)}}(),angular_three_class4.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_class4,selectors:[["","args",""]],inputs:{args:"args"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtArgs,[{type:core.Directive,args:[{selector:"[args]",standalone:!0}]}],null,{args:[{type:core.Input}]});class NgtParent extends NgtCommonDirective{constructor(){super(...arguments),this.injectedParent=null}set parent(parent){parent&&(this.injected=!1,this.injectedParent=parent,this.createView())}get parent(){return this.validate()?(this.injected=!0,this.injectedParent):null}validate(){return!this.injected&&!!this.injectedParent}}function releaseInternalPointerCapture(capturedMap,obj,captures,pointerId){const captureData=captures.get(obj);captureData&&(captures.delete(obj),0===captures.size&&(capturedMap.delete(pointerId),captureData.target.releasePointerCapture(pointerId)))}function removeInteractivity(store,object){const internal=store.get("internal");internal.interaction=internal.interaction.filter((o=>o!==object)),internal.initialHits=internal.initialHits.filter((o=>o!==object)),internal.hovered.forEach(((value,key)=>{value.eventObject!==object&&value.object!==object||internal.hovered.delete(key)})),internal.capturedMap.forEach(((captures,pointerId)=>{releaseInternalPointerCapture(internal.capturedMap,object,captures,pointerId)})),store.get("previousStore")&&removeInteractivity(store.get("previousStore"),object)}function createEvents(store){function filterPointerEvents(objects){return objects.filter((obj=>["move","over","enter","out","leave"].some((name=>{const eventName=`pointer${name}`;return getLocalState(obj).handlers?.[eventName]}))))}function cancelPointer(intersections){const{internal}=store.get();for(const hoveredObj of internal.hovered.values())if(!intersections.length||!intersections.find((hit=>hit.object===hoveredObj.object&&hit.index===hoveredObj.index&&hit.instanceId===hoveredObj.instanceId))){const instance=getLocalState(hoveredObj.eventObject),handlers=instance?.handlers;if(internal.hovered.delete(makeId(hoveredObj)),instance?.eventCount){const data={...hoveredObj,intersections};handlers?.pointerout?.(data),handlers?.pointerleave?.(data)}}}function pointerMissed(event,objects){for(let i=0;i<objects.length;i++){const instance=getLocalState(objects[i]);instance?.handlers.pointermissed?.(event)}}return{handlePointer:function handlePointer(name){switch(name){case"pointerleave":case"pointercancel":return()=>cancelPointer([]);case"lostpointercapture":return event=>{const{internal}=store.get();"pointerId"in event&&internal.capturedMap.has(event.pointerId)&&(internal.capturedMap.delete(event.pointerId),cancelPointer([]))}}return function handleEvent(event){const{onPointerMissed,internal}=store.get();internal.lastEvent=event;const isPointerMove="pointermove"===name,isClickEvent="click"===name||"contextmenu"===name||"dblclick"===name,hits=function intersect(event,filter){const state=store.get(),duplicates=new Set,intersections=[],eventObjects=filter?filter(state.internal.interaction):state.internal.interaction;for(let i=0;i<eventObjects.length;i++){const instanceState=getLocalState(eventObjects[i]).store?.get();instanceState&&(instanceState.raycaster.camera=void 0)}state.previousStore||state.events.compute?.(event,store);let hits=eventObjects.flatMap((function handleRaycast(obj){const objStore=getLocalState(obj).store,objState=objStore?.get();return objState&&objState.events.enabled&&null!==objState.raycaster.camera?(void 0===objState.raycaster.camera&&(objState.events.compute?.(event,objStore,objState.previousStore),void 0===objState.raycaster.camera&&(objState.raycaster.camera=null)),objState.raycaster.camera?objState.raycaster.intersectObject(obj,!0):[]):[]})).sort(((a,b)=>{const aState=getLocalState(a.object).store.get(),bState=getLocalState(b.object).store.get();return aState&&bState&&bState.events.priority-aState.events.priority||a.distance-b.distance})).filter((item=>{const id=makeId(item);return!duplicates.has(id)&&(duplicates.add(id),!0)}));state.events.filter&&(hits=state.events.filter(hits,store));for(const hit of hits){let eventObject=hit.object;for(;eventObject;)getLocalState(eventObject).eventCount&&intersections.push({...hit,eventObject}),eventObject=eventObject.parent}if("pointerId"in event&&state.internal.capturedMap.has(event.pointerId))for(const capturedData of state.internal.capturedMap.get(event.pointerId).values())duplicates.has(makeId(capturedData.intersection))||intersections.push(capturedData.intersection);return intersections}(event,isPointerMove?filterPointerEvents:void 0),delta=isClickEvent?function calculateDistance(event){const internal=store.get("internal"),dx=event.offsetX-internal.initialClick[0],dy=event.offsetY-internal.initialClick[1];return Math.round(Math.sqrt(dx*dx+dy*dy))}(event):0;"pointerdown"===name&&(internal.initialClick=[event.offsetX,event.offsetY],internal.initialHits=hits.map((hit=>hit.eventObject))),isClickEvent&&!hits.length&&delta<=2&&(pointerMissed(event,internal.interaction),onPointerMissed&&onPointerMissed(event)),isPointerMove&&cancelPointer(hits),function handleIntersects(intersections,event,delta,callback){const rootState=store.get();if(intersections.length){const localState={stopped:!1};for(const hit of intersections){const state=getLocalState(hit.object).store?.get()||rootState,{raycaster,pointer,camera,internal}=state,unprojectedPoint=new three_module.Vector3(pointer.x,pointer.y,0).unproject(camera),hasPointerCapture=id=>internal.capturedMap.get(id)?.has(hit.eventObject)??!1,setPointerCapture=id=>{const captureData={intersection:hit,target:event.target};internal.capturedMap.has(id)?internal.capturedMap.get(id).set(hit.eventObject,captureData):internal.capturedMap.set(id,new Map([[hit.eventObject,captureData]])),event.target.setPointerCapture(id)},releasePointerCapture=id=>{const captures=internal.capturedMap.get(id);captures&&releaseInternalPointerCapture(internal.capturedMap,hit.eventObject,captures,id)},extractEventProps={};for(const prop in event){const property=event[prop];"function"!=typeof property&&(extractEventProps[prop]=property)}const raycastEvent={...hit,...extractEventProps,pointer,intersections,stopped:localState.stopped,delta,unprojectedPoint,ray:raycaster.ray,camera,stopPropagation(){const capturesForPointer="pointerId"in event&&internal.capturedMap.get(event.pointerId);(!capturesForPointer||capturesForPointer.has(hit.eventObject))&&(raycastEvent.stopped=localState.stopped=!0,internal.hovered.size&&Array.from(internal.hovered.values()).find((i=>i.eventObject===hit.eventObject)))&&cancelPointer([...intersections.slice(0,intersections.indexOf(hit)),hit])},target:{hasPointerCapture,setPointerCapture,releasePointerCapture},currentTarget:{hasPointerCapture,setPointerCapture,releasePointerCapture},nativeEvent:event};if(callback(raycastEvent),!0===localState.stopped)break}}return intersections}(hits,event,delta,(function onIntersect(data){const eventObject=data.eventObject,instance=getLocalState(eventObject),handlers=instance?.handlers;if(instance?.eventCount)if(isPointerMove){if(handlers?.pointerover||handlers?.pointerenter||handlers?.pointerout||handlers?.pointerleave){const id=makeId(data),hoveredItem=internal.hovered.get(id);hoveredItem?hoveredItem.stopped&&data.stopPropagation():(internal.hovered.set(id,data),handlers.pointerover?.(data),handlers.pointerenter?.(data))}handlers?.pointermove?.(data)}else{const handler=handlers?.[name];handler?isClickEvent&&!internal.initialHits.includes(eventObject)||(pointerMissed(event,internal.interaction.filter((object=>!internal.initialHits.includes(object)))),handler(data)):isClickEvent&&internal.initialHits.includes(eventObject)&&pointerMissed(event,internal.interaction.filter((object=>!internal.initialHits.includes(object))))}}))}}}}function attach(object,value,paths=[]){const[base,...remaining]=paths;base&&(0===remaining.length?applyProps(object,{[base]:value}):(!function assignEmpty(obj,base){(!Object.hasOwn(obj,base)&&Reflect&&Reflect.has&&!Reflect.has(obj,base)||void 0===obj[base])&&(obj[base]={})}(object,base),attach(object[base],value,remaining)))}(angular_three_class5=NgtParent).ɵfac=function(){let ɵ_class5_BaseFactory;return function _class5_Factory(t){return(ɵ_class5_BaseFactory||(ɵ_class5_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_class5)))(t||angular_three_class5)}}(),angular_three_class5.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_class5,selectors:[["","parent",""]],inputs:{parent:"parent"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtParent,[{type:core.Directive,args:[{selector:"[parent]",standalone:!0}]}],null,{parent:[{type:core.Input}]});const SPECIAL_DOM_TAG_NGT_PORTAL="ngt-portal",SPECIAL_DOM_TAG_NGT_PRIMITIVE="ngt-primitive",SPECIAL_DOM_TAG_NGT_VALUE="ngt-value",SPECIAL_PROPERTIES_COMPOUND="ngtCompound",SPECIAL_PROPERTIES_RENDER_PRIORITY="priority",SPECIAL_PROPERTIES_ATTACH="attach",SPECIAL_PROPERTIES_VALUE="rawValue",SPECIAL_PROPERTIES_REF="ref",SPECIAL_EVENTS_BEFORE_RENDER="beforeRender",SPECIAL_EVENTS_AFTER_UPDATE="afterUpdate",SPECIAL_EVENTS_AFTER_ATTACH="afterAttach";function attachThreeChild(parent,child){const pLS=getLocalState(parent),cLS=getLocalState(child);if(!pLS||!cLS)throw new Error("[NGT] THREE instances need to be prepared with local state.");let added=!1;if(cLS.store&&cLS.store!==pLS.store.get("previousStore")||(cLS.store=pLS.store),cLS.attach){const attachProp=cLS.attach;if("function"==typeof attachProp){const attachCleanUp=attachProp(parent,child,cLS.store);attachCleanUp&&(cLS.previousAttach=attachCleanUp)}else{if("none"===attachProp[0])return void invalidateInstance(child);if("material"===attachProp[0]&&attachProp[1]&&"number"==typeof Number(attachProp[1])&&is.material(child)&&!Array.isArray(parent.material)&&(parent.material=[]),cLS.isRaw){if(cLS.parent=parent,void 0===child.__ngt_renderer__[11])return;attach(parent,child.__ngt_renderer__[11],attachProp)}else attach(parent,child,attachProp);cLS.previousAttach=attachProp.reduce(((value,property)=>value[property]),parent)}}else is.object3D(parent)&&is.object3D(child)&&(parent.add(child),added=!0);pLS.add(child,added?"objects":"nonObjects"),cLS.parent=parent,cLS.afterAttach&&cLS.afterAttach.emit({parent,node:child}),invalidateInstance(child),invalidateInstance(parent)}function removeThreeChild(parent,child,dispose){const pLS=getLocalState(parent),cLS=getLocalState(child);cLS.parent=null,pLS.objects&&pLS.remove(child,"objects"),pLS.nonObjects&&pLS.remove(child,"nonObjects"),cLS.attach?function detach(parent,child,attachProp){const childLocalState=getLocalState(child);Array.isArray(attachProp)?attach(parent,childLocalState.previousAttach,attachProp):childLocalState.previousAttach()}(parent,child,cLS.attach):is.object3D(parent)&&is.object3D(child)&&(parent.remove(child),removeInteractivity(cLS.store||pLS.store,child));const isPrimitive=cLS.primitive;isPrimitive||(removeThreeRecursive(cLS.objects?.value||[],child,!!dispose),removeThreeRecursive(child.childre,child,!!dispose)),isPrimitive||!child.dispose||is.scene(child)||queueMicrotask((()=>child.dispose())),invalidateInstance(parent)}function removeThreeRecursive(array,parent,dispose){array&&[...array].forEach((child=>removeThreeChild(parent,child,dispose)))}function eventToHandler(callback,cdr,targetCdr){return event=>{callback(event),safeDetectChanges(targetCdr),safeDetectChanges(cdr)}}class NgtRendererStore{constructor(root){this.root=root,this.comments=[]}createNode(type,node){const state=[type,null,null,[],!1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],rendererNode=Object.assign(node,{__ngt_renderer__:state});return rendererNode.ownerDocument||(rendererNode.ownerDocument=this.root.document),"three"!==state[0]&&(state[14]=()=>(0,core.getDebugNode)(rendererNode).injector),"comment"===state[0]?(rendererNode.__ngt_renderer_add_comment__=node=>{node&&"portal"===node.__ngt_renderer__[0]?this.portals.push(node):this.comments.push(rendererNode)},rendererNode):"compound"===state[0]?(state[8]=new Set,state[9]={},state[10]={},rendererNode):rendererNode}setParent(node,parent){node.__ngt_renderer__[1]||(node.__ngt_renderer__[1]=parent)}addChild(node,child){node.__ngt_renderer__[3].includes(child)||node.__ngt_renderer__[3].push(child)}removeChild(node,child){const index=node.__ngt_renderer__[3].findIndex((c=>child===c));index>=0&&node.__ngt_renderer__[3].splice(index,1)}setCompound(compound,instance){const rS=compound.__ngt_renderer__;rS[7]=instance;const attributes=Object.keys(rS[9]),properties=Object.keys(rS[10]);for(const key of attributes)this.applyAttribute(instance,key,rS[9][key]);for(const key of properties)this.applyProperty(instance,key,rS[10][key]);this.executeOperation(compound)}queueOperation(node,op){node.__ngt_renderer__[8].add(op)}executeOperation(node,type="op"){const rS=node.__ngt_renderer__;rS[8]?.size&&rS[8].forEach((op=>{op[0]===type&&(op[1](),rS[8].delete(op))}))}processPortalContainer(portal){const injectorFactory=portal.__ngt_renderer__[14],injector=injectorFactory?.();if(!injector)return;const portalStore=injector.get(NgtStore,null);if(!portalStore)return;const portalContainer=portalStore.get("scene");portalContainer&&(portal.__ngt_renderer__[13]=this.createNode("three",portalContainer))}applyAttribute(node,name,value){const rS=node.__ngt_renderer__;if(!rS[4]){if(name===SPECIAL_PROPERTIES_RENDER_PRIORITY){let priority=Number(value);isNaN(priority)&&(priority=0,console.warn('[NGT] "priority" is an invalid number, default to 0')),getLocalState(node).priority=priority}if(name!==SPECIAL_PROPERTIES_COMPOUND)if(name!==SPECIAL_PROPERTIES_ATTACH){if(name===SPECIAL_PROPERTIES_VALUE){let maybeCoerced=value;return""===maybeCoerced||"true"===maybeCoerced||"false"===maybeCoerced?maybeCoerced="true"===maybeCoerced||""===maybeCoerced:isNaN(Number(maybeCoerced))||(maybeCoerced=Number(maybeCoerced)),void(rS[11]=maybeCoerced)}applyProps(node,{[name]:value})}else{const paths=value.split(".");paths.length&&(getLocalState(node).attach=paths)}else rS[5]=[""===value||"first"===value,{}]}}applyProperty(node,name,value){const rS=node.__ngt_renderer__;if(rS[4])return;if(name===SPECIAL_PROPERTIES_REF&&is.ref(value))return rS[12]=value,void(value.nativeElement=node);const parent=getLocalState(node).parent||rS[1];if(getLocalState(node).isRaw&&name===SPECIAL_PROPERTIES_VALUE)return rS[11]=value,void(parent&&attachThreeChild(parent,node));if(name===SPECIAL_PROPERTIES_ATTACH)return getLocalState(node).attach=Array.isArray(value)?value.map((v=>v.toString())):value,void(parent&&attachThreeChild(parent,node));const compound=rS[5];compound?.[1]&&name in compound[1]&&!compound[0]&&(value=compound[1][name]),applyProps(node,{[name]:value})}isCompound(name){return this.root.compoundPrefixes.some((prefix=>name.startsWith(prefix)))}isDOM(node){const rS=node.__ngt_renderer__;return!rS||"compound"!==rS[0]&&(node instanceof Element||node instanceof Document||node instanceof Window)}get rootScene(){return this.root.store.get("scene")}get rootCdr(){return this.root.cdr}get portals(){return this.root.portals}getClosestParentWithInstance(node){let parent=node.__ngt_renderer__[1];for(;parent&&"three"!==parent.__ngt_renderer__[0];)parent=parent.__ngt_renderer__[13]?parent.__ngt_renderer__[13]:parent.__ngt_renderer__[1];return parent}getClosestParentWithCompound(node){if(node.__ngt_renderer__[6])return node.__ngt_renderer__[6];let parent=node.__ngt_renderer__[1];if(parent&&"compound"===parent.__ngt_renderer__[0]&&!parent.__ngt_renderer__[7])return parent;for(;parent&&("three"===parent.__ngt_renderer__[0]||!parent.__ngt_renderer__[6]||"compound"!==parent.__ngt_renderer__[0]);)parent=parent.__ngt_renderer__[1];return parent?"three"===parent.__ngt_renderer__[0]&&parent.__ngt_renderer__[6]?parent.__ngt_renderer__[6]:parent.__ngt_renderer__[7]?null:parent:void 0}getCreationState(){return{injectedArgs:this.firstNonInjectedDirective(NgtArgs)?.args||[],injectedParent:this.firstNonInjectedDirective(NgtParent)?.parent||null,store:this.tryGetPortalStore()}}destroy(node,parent){const rS=node.__ngt_renderer__;if(!rS[4]){if("three"===rS[0]){rS[5]=void 0,rS[6]=void 0;const localState=getLocalState(node);localState.objects&&(localState.objects.value.forEach((obj=>this.destroy(obj,parent))),localState.objects.complete()),localState.nonObjects&&(localState.nonObjects.value.forEach((obj=>this.destroy(obj,parent))),localState.nonObjects.complete()),localState.afterUpdate&&localState.afterUpdate.complete(),localState.afterAttach&&localState.afterAttach.complete(),delete localState.objects,delete localState.nonObjects,delete localState.add,delete localState.remove,delete localState.afterUpdate,delete localState.afterAttach,delete localState.store,delete localState.handlers,localState.primitive||delete node.__ngt__}if("comment"===rS[0]){rS[14]=null,delete node.__ngt_renderer_add_comment__;const index=this.comments.findIndex((comment=>comment===node));index>-1&&this.comments.splice(index,1)}if("portal"===rS[0]){rS[14]=null;const index=this.portals.findIndex((portal=>portal===node));index>-1&&this.portals.splice(index,1)}"compound"===rS[0]&&(rS[7]=void 0,rS[9]=null,rS[10]=null,this.executeOperation(node,"cleanUp"),rS[8].clear(),rS[8]=null),rS[12]&&(rS[12].nativeElement=null,rS[12]=void 0),rS[1]=null;for(const renderChild of rS[3]||[])"three"===renderChild.__ngt_renderer__[0]&&parent&&removeThreeChild(parent,renderChild,!0),this.destroy(renderChild,parent);rS[3]=[],rS[4]=!0,parent&&this.removeChild(parent,node)}}firstNonInjectedDirective(dir){let directive,i=this.comments.length-1;for(;i>=0;){const comment=this.comments[i];if(comment.__ngt_renderer__[4]){i--;continue}const injector=comment.__ngt_renderer__[14]();if(!injector){i--;continue}const instance=injector.get(dir,null);if(instance&&instance.validate()){directive=instance;break}i--}return directive}tryGetPortalStore(){let store,i=this.portals.length-1;for(;i>=0;){const portal=this.portals[i];if(portal.__ngt_renderer__[4]){i--;continue}const injector=portal.__ngt_renderer__[14]();if(!injector){i--;continue}const instance=injector.get(NgtStore,null);if(instance&&instance.get("previousStore")){store=instance;break}i--}return store||this.root.store}}class NgtRendererFactory{constructor(){this.delegateRendererFactory=(0,core.inject)(core.RendererFactory2,{skipSelf:!0}),this.catalogue=(0,core.inject)(NGT_CATALOGUE),this.rendererMap=new Map,this.routedSet=new Set,this.rendererStore=new NgtRendererStore({store:(0,core.inject)(NgtStore),cdr:(0,core.inject)(core.ChangeDetectorRef),portals:[],compoundPrefixes:(0,core.inject)(NGT_COMPOUND_PREFIXES),document:(0,core.inject)(common.DOCUMENT)})}createRenderer(hostElement,type){const delegateRenderer=this.delegateRendererFactory.createRenderer(hostElement,type);if(!type)return delegateRenderer;type.type.isRoutedScene&&this.routedSet.add(type.id);let renderer=this.rendererMap.get(type.id);return renderer||(renderer=new NgtRenderer(delegateRenderer,this.rendererStore,this.catalogue,!hostElement&&(0===this.routedSet.size||this.routedSet.has(type.id))),this.rendererMap.set(type.id,renderer)),renderer}}(angular_three_class6=NgtRendererFactory).ɵfac=function _class6_Factory(t){return new(t||angular_three_class6)},angular_three_class6.ɵprov=core["ɵɵdefineInjectable"]({token:angular_three_class6,factory:angular_three_class6.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRendererFactory,[{type:core.Injectable}],null,null);class NgtRenderer{constructor(delegate,store,catalogue,root=!0){this.delegate=delegate,this.store=store,this.catalogue=catalogue,this.root=root,this.createText=this.delegate.createText.bind(this.delegate),this.destroy=this.delegate.destroy.bind(this.delegate),this.destroyNode=null,this.selectRootElement=this.delegate.selectRootElement.bind(this.delegate),this.nextSibling=this.delegate.nextSibling.bind(this.delegate),this.removeAttribute=this.delegate.removeAttribute.bind(this.delegate),this.addClass=this.delegate.addClass.bind(this.delegate),this.removeClass=this.delegate.removeClass.bind(this.delegate),this.setStyle=this.delegate.setStyle.bind(this.delegate),this.removeStyle=this.delegate.removeStyle.bind(this.delegate),this.setValue=this.delegate.setValue.bind(this.delegate)}createElement(name,namespace){const element=this.delegate.createElement(name,namespace);if(this.root){this.root=!1;const node=this.store.createNode("three",this.store.rootScene);return node.__ngt_renderer__[14]=()=>(0,core.getDebugNode)(element).injector,node}if(this.store.isCompound(name))return this.store.createNode("compound",element);if(name===SPECIAL_DOM_TAG_NGT_PORTAL)return this.store.createNode("portal",element);if(name===SPECIAL_DOM_TAG_NGT_VALUE)return this.store.createNode("three",Object.assign({__ngt_renderer__:{rawValue:void 0}},{__ngt__:{isRaw:!0}}));const{injectedArgs,injectedParent,store}=this.store.getCreationState();let parent=injectedParent;if("string"==typeof injectedParent&&(parent=store.get("scene").getObjectByName(injectedParent)),name===SPECIAL_DOM_TAG_NGT_PRIMITIVE){if(!injectedArgs[0])throw new Error("[NGT] ngt-primitive without args is invalid");const object=injectedArgs[0];let localState=getLocalState(object);Object.keys(localState).length||(prepare(object,{store,args:injectedArgs,primitive:!0}),localState=getLocalState(object)),localState.store||(localState.store=store);const node=this.store.createNode("three",object);return parent&&(node.__ngt_renderer__[2]=parent),node}const threeName=function kebabToPascal(str){return str.split("-").map((part=>part.charAt(0).toUpperCase()+part.slice(1))).join("")}(name.startsWith("ngt")?name.slice(4):name),threeTarget=this.catalogue[threeName];if(threeTarget){const instance=prepare(new threeTarget(...injectedArgs),{store,args:injectedArgs}),node=this.store.createNode("three",instance),localState=getLocalState(instance);return is.geometry(instance)?localState.attach=["geometry"]:is.material(instance)&&(localState.attach=["material"]),parent&&(node.__ngt_renderer__[2]=parent),node}return this.store.createNode("dom",element)}createComment(value){return this.store.createNode("comment",this.delegate.createComment(value))}appendChild(parent,newChild){if(newChild instanceof Text)return;const cRS=newChild.__ngt_renderer__,pRS=parent.__ngt_renderer__;if("comment"===cRS[0])return void this.store.setParent(newChild,parent);if(cRS[2]){if(is.ref(cRS[2]))return void cRS[2].$.pipe((0,take.q)(1)).subscribe((val=>{val!==parent&&this.appendChild(val,newChild)}));if(parent!==cRS[2])return void this.appendChild(cRS[2],newChild)}if(this.store.setParent(newChild,parent),this.store.addChild(parent,newChild),"portal"===cRS[0])return this.store.processPortalContainer(newChild),void(cRS[13]&&this.appendChild(parent,cRS[13]));if("portal"===pRS[0])return this.store.processPortalContainer(parent),void(pRS[13]&&this.appendChild(pRS[13],newChild));if("three"===pRS[0]&&"three"===cRS[0]){if(getLocalState(newChild).parent)return;if(attachThreeChild(parent,newChild),!cRS[5])return;const closestGrandparentWithCompound=this.store.getClosestParentWithCompound(parent);if(!closestGrandparentWithCompound)return;return void this.appendChild(closestGrandparentWithCompound,newChild)}if("three"===pRS[0])for(const renderChild of cRS[3])this.appendChild(parent,renderChild);"compound"===pRS[0]&&(pRS[7]||"three"!==cRS[0]||(cRS[5]?this.store.setCompound(parent,newChild):cRS[6]||(cRS[6]=parent)),pRS[7]&&"three"===cRS[0]&&cRS[5]&&pRS[7]!==newChild&&this.store.setCompound(parent,newChild));if("three"===cRS[0]&&!getLocalState(newChild).parent||("dom"===pRS[0]||"compound"===pRS[0]&&!pRS[7])&&("dom"===cRS[0]||"compound"===cRS[0]&&!cRS[7])){const closestGrandparentInstance=this.store.getClosestParentWithInstance(parent);closestGrandparentInstance&&this.appendChild(closestGrandparentInstance,newChild)}}insertBefore(parent,newChild){null!=parent&&parent.__ngt_renderer__&&parent!==newChild&&this.appendChild(parent,newChild)}removeChild(parent,oldChild,isHostElement){const pRS=parent.__ngt_renderer__,cRS=oldChild.__ngt_renderer__;if("three"===pRS[0]&&"three"===cRS[0])return removeThreeChild(parent,oldChild,!0),void this.store.destroy(oldChild,parent);if("compound"===pRS[0]&&pRS[1])return void this.removeChild(pRS[1],oldChild,isHostElement);if("three"===pRS[0])return void this.store.destroy(oldChild,parent);const closestGrandparentInstance=this.store.getClosestParentWithInstance(parent);closestGrandparentInstance&&this.removeChild(closestGrandparentInstance,oldChild,isHostElement),this.store.destroy(oldChild,closestGrandparentInstance)}parentNode(node){const rS=node.__ngt_renderer__;return rS?.[1]?rS[1]:this.delegate.parentNode(node)}setAttribute(el,name,value,namespace){const rS=el.__ngt_renderer__;if("compound"===rS[0])return rS[9][name]=value,rS[7]?void this.setAttribute(rS[7],name,value,namespace):void this.store.queueOperation(el,["op",()=>this.setAttribute(el,name,value,namespace)]);"three"===rS[0]&&this.store.applyAttribute(el,name,value)}setProperty(el,name,value){const rS=el.__ngt_renderer__;if("compound"===rS[0])return rS[10][name]=value,rS[7]?(rS[7].__ngt_renderer__[5]&&Object.assign(rS[7].__ngt_renderer__[5],{props:Object.assign(rS[7].__ngt_renderer__[5],{[name]:value})}),void this.setProperty(rS[7],name,value)):void this.store.queueOperation(el,["op",()=>this.setProperty(el,name,value)]);"three"===rS[0]&&this.store.applyProperty(el,name,value)}listen(target,eventName,callback){const rS=target.__ngt_renderer__,targetCdr=rS?.[14]?.().get(core.ChangeDetectorRef,null);if("three"===rS[0]||"compound"===rS[0]&&rS[7]){return function processThreeEvent(instance,priority,eventName,callback,cdr,targetCdr){const lS=getLocalState(instance);if(eventName===SPECIAL_EVENTS_BEFORE_RENDER)return lS.store.get("internal").subscribe((state=>callback({state,object:instance})),priority||lS.priority||0);if(eventName===SPECIAL_EVENTS_AFTER_UPDATE||eventName===SPECIAL_EVENTS_AFTER_ATTACH){let emitter=lS[eventName];emitter||(emitter=lS[eventName]=new core.EventEmitter);const sub=emitter.subscribe(callback);return sub.unsubscribe.bind(sub)}lS.handlers||(lS.handlers={});const previousHandler=lS.handlers[eventName];return Object.assign(lS.handlers,{[eventName]:eventToHandler((event=>{previousHandler&&previousHandler(event),callback(event)}),cdr,targetCdr)}),lS.eventCount+=1,1===lS.eventCount&&instance.raycast&&lS.store.get("addInteraction")(instance),()=>{const localState=getLocalState(instance);localState&&localState.eventCount&&localState.store.get("removeInteraction")(instance.uuid)}}(rS[7]||target,getLocalState(target).priority||0,eventName,callback,this.store.rootCdr,targetCdr)}"compound"!==rS[0]||rS[7]||this.store.queueOperation(target,["op",()=>this.store.queueOperation(target,["cleanUp",this.listen(target,eventName,callback)])]);const callbackWithCdr=event=>{const value=callback(event);return safeDetectChanges(targetCdr),safeDetectChanges(this.store.rootCdr),value};if(!rS)return this.delegate.listen(target,eventName,callbackWithCdr);if(this.store.isDOM(target))return this.delegate.listen(target,eventName,callbackWithCdr);if(target===this.store.rootScene){let[domTarget,event]=eventName.split(":");null==event&&(event=domTarget,domTarget="");const eventTarget="window"===domTarget?target.ownerDocument.defaultView:target.ownerDocument;return this.delegate.listen(eventTarget,event,callbackWithCdr)}return()=>{}}get data(){return this.delegate.data}}function provideNgtRenderer({store,changeDetectorRef,compoundPrefixes=[]}){return compoundPrefixes.includes("ngts")||compoundPrefixes.push("ngts"),compoundPrefixes.includes("ngtp")||compoundPrefixes.push("ngtp"),(0,core.makeEnvironmentProviders)([{provide:core.RendererFactory2,useClass:NgtRendererFactory},{provide:NgtStore,useValue:store},{provide:core.ChangeDetectorRef,useValue:changeDetectorRef},{provide:NGT_COMPOUND_PREFIXES,useValue:compoundPrefixes}])}const DOM_EVENTS={click:!1,contextmenu:!1,dblclick:!1,wheel:!1,pointerdown:!0,pointerup:!0,pointerleave:!0,pointermove:!0,pointercancel:!0,lostpointercapture:!0};function createPointerEvents(store){const{handlePointer}=createEvents(store);return{priority:1,enabled:!0,compute:(event,root)=>{const state=root.get();state.pointer.set(event.offsetX/state.size.width*2-1,-event.offsetY/state.size.height*2+1),state.raycaster.setFromCamera(state.pointer,state.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce(((handlers,supportedEventName)=>(handlers[supportedEventName]=handlePointer(supportedEventName),handlers)),{}),connect:target=>{const state=store.get();state.events.disconnect?.(),state.setEvents({connected:target}),Object.entries(state.events.handlers??{}).forEach((([eventName,eventHandler])=>{const passive=DOM_EVENTS[eventName];target.addEventListener(eventName,eventHandler,{passive})}))},disconnect:()=>{const{events,setEvents}=store.get();events.connected&&(Object.entries(events.handlers??{}).forEach((([eventName,eventHandler])=>{events.connected instanceof HTMLElement&&events.connected.removeEventListener(eventName,eventHandler)})),setEvents({connected:void 0}))}}}class NgtCanvas extends NgtRxStore{constructor(){super(...arguments),this.cdr=(0,core.inject)(core.ChangeDetectorRef),this.envInjector=(0,core.inject)(core.EnvironmentInjector),this.host=(0,core.inject)(core.ElementRef),this.store=(0,core.inject)(NgtStore),this.hbClass=!0,this.sceneGraphInputs={},this.compoundPrefixes=[],this.created=new core.EventEmitter,this.pointerMissed=new core.EventEmitter}initialize(){super.initialize(),this.set({shadows:!1,linear:!1,flat:!1,legacy:!1,orthographic:!1,frameloop:"always",dpr:[1,2],events:createPointerEvents})}get hbPointerEvents(){return this.get("eventSource")!==this.host.nativeElement?"none":"auto"}set linear(linear){this.set({linear})}set legacy(legacy){this.set({legacy})}set flat(flat){this.set({flat})}set orthographic(orthographic){this.set({orthographic})}set frameloop(frameloop){this.set({frameloop})}set dpr(dpr){this.set({dpr})}set raycaster(raycaster){this.set({raycaster})}set shadows(shadows){this.set({shadows})}set camera(camera){this.set({camera})}set gl(gl){this.set({gl})}set eventSource(eventSource){this.set({eventSource})}set eventPrefix(eventPrefix){this.set({eventPrefix})}set lookAt(lookAt){this.set({lookAt})}set performance(performance){this.set({performance})}ngOnChanges(changes){changes.sceneGraphInputs&&this.glRef&&this.setSceneGraphInputs()}ngOnInit(){this.get("eventSource")||(this.eventSource=this.host.nativeElement),this.pointerMissed.observed&&this.store.set({onPointerMissed:event=>{this.pointerMissed.emit(event),safeDetectChanges(this.cdr)}}),this.store.init(),rootStateMap.set(this.glCanvas.nativeElement,this.store),this.hold(this.store.select("ready").pipe((0,filter.h)((ready=>ready))),(()=>this.storeReady()))}onResize({width,height}){width>0&&height>0&&(this.store.isInit||this.store.init(),this.store.configure(this.get(),this.glCanvas.nativeElement))}storeReady(){this.store.set((state=>({internal:{...state.internal,active:!0}})));const inputs=this.get(),state=this.store.get();state.events.connect?.(is.ref(inputs.eventSource)?inputs.eventSource.nativeElement:inputs.eventSource),inputs.eventPrefix&&state.setEvents({compute:(event,store)=>{const innerState=store.get(),x=event[inputs.eventPrefix+"X"],y=event[inputs.eventPrefix+"Y"];innerState.pointer.set(x/innerState.size.width*2-1,-y/innerState.size.height*2+1),innerState.raycaster.setFromCamera(innerState.pointer,innerState.camera)}}),this.created.observed&&this.created.emit(this.store.get()),this.glRef&&this.glRef.destroy(),requestAnimationFrame((()=>{const{store,cdr:changeDetectorRef,compoundPrefixes}=this;this.glEnvInjector=(0,core.createEnvironmentInjector)([provideNgtRenderer({store,changeDetectorRef,compoundPrefixes})],this.envInjector),this.glRef=this.glAnchor.createComponent(this.sceneGraph,{environmentInjector:this.glEnvInjector}),this.glRef.changeDetectorRef.detach(),this.setSceneGraphInputs(),this.overrideDetectChanges(),this.cdr.detectChanges()}))}ngOnDestroy(){this.glRef&&this.glRef.destroy(),this.glEnvInjector&&this.glEnvInjector.destroy(),injectNgtLoader.destroy(),this.store.destroy(this.glCanvas.nativeElement),super.ngOnDestroy()}overrideDetectChanges(){const originalDetectChanges=this.cdr.detectChanges.bind(this.cdr);this.cdr.detectChanges=()=>{originalDetectChanges(),safeDetectChanges(this.glRef?.changeDetectorRef)}}setSceneGraphInputs(){for(const key of Object.keys(this.sceneGraphInputs))this.glRef.setInput(key,this.sceneGraphInputs[key]);safeDetectChanges(this.cdr)}}function injectNgtDestroy(cb){try{const cdr=(0,core.inject)(core.ChangeDetectorRef),destroy$=new ReplaySubject.t;return queueMicrotask((()=>{cdr.onDestroy((()=>{destroy$.next(),destroy$.complete(),cb?.()}))})),{destroy$,cdr}}catch(e){throw new Error("[NGT] injectNgtDestroy is being called outside of Constructor Context")}}function injectBeforeRender(cb,priority=0){try{const store=(0,core.inject)(NgtStore),sub=store.get("internal").subscribe(cb,priority,store);return injectNgtDestroy((()=>{sub()})),sub}catch(e){throw new Error('[NGT] "injectBeforeRender" is invoked outside of Constructor Context')}}function injectNgtRef(initialValue=null){const ref=is.ref(initialValue)?initialValue:new core.ElementRef(initialValue);let lastValue=ref.nativeElement;const cdRefs=[],ref$=new BehaviorSubject.X(lastValue),{destroy$,cdr}=injectNgtDestroy((()=>{ref$.complete()}));cdRefs.push(cdr);const obs$=ref$.asObservable().pipe((0,distinctUntilChanged.x)(),(0,takeUntil.R)(destroy$)),$=obs$.pipe((0,filter.h)(((value,index)=>index>0||null!=value)),(0,takeUntil.R)(destroy$));return Object.defineProperty(ref,"nativeElement",{set:newVal=>{if(ref.nativeElement!==newVal){ref$.next(newVal),lastValue=ref.nativeElement,ref.nativeElement=newVal;const cds=[...cdRefs];for(let i=0;i<cds.length;i++){const cd=cds[i];cd.destroyed?cdRefs.splice(i,1):safeDetectChanges(cd)}}},get:()=>ref$.value}),Object.assign(ref,{subscribe:callback=>obs$.subscribe((current=>{callback(current,lastValue),lastValue=current})),$,children$:(type="objects")=>$.pipe((0,switchMap.w)((instance=>{const localState=getLocalState(instance);return localState.objects&&localState.nonObjects?(0,merge.T)(localState.objects,localState.nonObjects).pipe((0,map.U)((()=>{try{return"both"===type?[...localState.objects.value,...localState.nonObjects.value]:localState[type].value}catch(e){return console.error(`[NGT] Exception in accessing children of ${instance}`),[]}}))):(0,of.of)([])})),(0,filter.h)(((children,index)=>index>0||children.length>0)),(0,takeUntil.R)(destroy$)),useCDR:cdr=>{cdRefs.push(cdr)}})}(angular_three_class7=NgtCanvas).ɵfac=function(){let ɵ_class7_BaseFactory;return function _class7_Factory(t){return(ɵ_class7_BaseFactory||(ɵ_class7_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_class7)))(t||angular_three_class7)}}(),angular_three_class7.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_class7,selectors:[["ngt-canvas"]],viewQuery:function _class7_Query(rf,ctx){if(1&rf&&(core["ɵɵviewQuery"](_c0,7),core["ɵɵviewQuery"](_c0,7,core.ViewContainerRef)),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.glCanvas=_t.first),core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.glAnchor=_t.first)}},hostVars:4,hostBindings:function _class7_HostBindings(rf,ctx){2&rf&&(core["ɵɵstyleProp"]("pointer-events",ctx.hbPointerEvents),core["ɵɵclassProp"]("ngt-canvas",ctx.hbClass))},inputs:{sceneGraph:"sceneGraph",sceneGraphInputs:"sceneGraphInputs",compoundPrefixes:"compoundPrefixes",linear:"linear",legacy:"legacy",flat:"flat",orthographic:"orthographic",frameloop:"frameloop",dpr:"dpr",raycaster:"raycaster",shadows:"shadows",camera:"camera",gl:"gl",eventSource:"eventSource",eventPrefix:"eventPrefix",lookAt:"lookAt",performance:"performance"},outputs:{created:"created",pointerMissed:"pointerMissed"},standalone:!0,features:[core["ɵɵProvidersFeature"]([NgtStore,provideNgxResizeOptions({emitInZone:!1})]),core["ɵɵInheritDefinitionFeature"],core["ɵɵNgOnChangesFeature"],core["ɵɵStandaloneFeature"]],decls:3,vars:0,consts:[[2,"height","100%","width","100%",3,"ngxResize"],[2,"display","block"],["glCanvas",""]],template:function _class7_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"div",0),core["ɵɵlistener"]("ngxResize",(function _class7_Template_div_ngxResize_0_listener($event){return ctx.onResize($event)})),core["ɵɵelement"](1,"canvas",1,2),core["ɵɵelementEnd"]())},dependencies:[NgxResize],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%;overflow:hidden}"]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtCanvas,[{type:core.Component,args:[{selector:"ngt-canvas",standalone:!0,template:'\n        <div (ngxResize)="onResize($event)" style="height: 100%; width: 100%;">\n            <canvas #glCanvas style="display: block;"></canvas>\n        </div>\n    ',imports:[NgxResize],providers:[NgtStore,provideNgxResizeOptions({emitInZone:!1})],styles:[":host{display:block;position:relative;width:100%;height:100%;overflow:hidden}\n"]}]}],null,{hbClass:[{type:core.HostBinding,args:["class.ngt-canvas"]}],hbPointerEvents:[{type:core.HostBinding,args:["style.pointerEvents"]}],sceneGraph:[{type:core.Input}],sceneGraphInputs:[{type:core.Input}],compoundPrefixes:[{type:core.Input}],linear:[{type:core.Input}],legacy:[{type:core.Input}],flat:[{type:core.Input}],orthographic:[{type:core.Input}],frameloop:[{type:core.Input}],dpr:[{type:core.Input}],raycaster:[{type:core.Input}],shadows:[{type:core.Input}],camera:[{type:core.Input}],gl:[{type:core.Input}],eventSource:[{type:core.Input}],eventPrefix:[{type:core.Input}],lookAt:[{type:core.Input}],performance:[{type:core.Input}],created:[{type:core.Output}],pointerMissed:[{type:core.Output}],glCanvas:[{type:core.ViewChild,args:["glCanvas",{static:!0}]}],glAnchor:[{type:core.ViewChild,args:["glCanvas",{static:!0,read:core.ViewContainerRef}]}]});class NgtRepeat extends common.NgForOf{set ngForRepeat(count){this.ngForOf=Number.isInteger(count)?Array.from({length:count},((_,i)=>i)):[]}}(angular_three_class8=NgtRepeat).ɵfac=function(){let ɵ_class8_BaseFactory;return function _class8_Factory(t){return(ɵ_class8_BaseFactory||(ɵ_class8_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_class8)))(t||angular_three_class8)}}(),angular_three_class8.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_class8,selectors:[["","ngFor","","ngForRepeat",""]],inputs:{ngForRepeat:"ngForRepeat"},standalone:!0,features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRepeat,[{type:core.Directive,args:[{selector:"[ngFor][ngForRepeat]",standalone:!0}]}],null,{ngForRepeat:[{type:core.Input}]});class NgtPush{constructor(){this.cdr=(0,core.inject)(core.ChangeDetectorRef),this.parentCdr=(0,core.inject)(core.ChangeDetectorRef,{skipSelf:!0,optional:!0}),this.envCdr=(0,core.inject)(core.EnvironmentInjector).get(core.ChangeDetectorRef,null)}transform(value,defaultValue=null){if(this.obj===value)return this.latestValue;if(this.obj=value,this.latestValue=defaultValue,this.sub&&this.sub.unsubscribe(),(0,isObservable.b)(this.obj))this.sub=this.obj.subscribe(this.updateValue.bind(this));else{if(!function isPromise(value){return(value instanceof Promise||"[object Promise]"===Object.prototype.toString.call(value))&&"function"==typeof value.then}(this.obj))throw new Error("[NGT] Invalid value passed to ngtPush pipe");this.obj.then(this.updateValue.bind(this))}return this.latestValue}updateValue(val){this.latestValue=val,safeDetectChanges(this.cdr),safeDetectChanges(this.parentCdr),safeDetectChanges(this.envCdr)}ngOnDestroy(){this.sub&&this.sub.unsubscribe(),this.latestValue=void 0,this.obj=void 0}}(angular_three_class9=NgtPush).ɵfac=function _class9_Factory(t){return new(t||angular_three_class9)},angular_three_class9.ɵpipe=core["ɵɵdefinePipe"]({name:"ngtPush",type:angular_three_class9,pure:!1,standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPush,[{type:core.Pipe,args:[{name:"ngtPush",pure:!1,standalone:!0}]}],null,null);const privateKeys=["get","set","select","setSize","setDpr","setFrameloop","events","invalidate","advance","size","viewport","addInteraction","removeInteraction"];class NgtPortalBeforeRender{constructor(){this.portalStore=(0,core.inject)(NgtStore),this.renderPriority=1,this.beforeRender=new core.EventEmitter}ngOnInit(){let oldClear;this.subscription=this.portalStore.get("internal").subscribe((({delta,frame})=>{this.beforeRender.emit({...this.portalStore.get(),delta,frame});const{gl,scene,camera}=this.portalStore.get();oldClear=gl.autoClear,1===this.renderPriority&&(gl.autoClear=!0,gl.render(this.parentScene,this.parentCamera)),gl.autoClear=!1,gl.clearDepth(),gl.render(scene,camera),gl.autoClear=oldClear}),this.renderPriority,this.portalStore)}ngOnDestroy(){this.subscription?.()}}(angular_three_class10=NgtPortalBeforeRender).ɵfac=function _class10_Factory(t){return new(t||angular_three_class10)},angular_three_class10.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_class10,selectors:[["","ngtPortalBeforeRender",""]],inputs:{renderPriority:"renderPriority",parentScene:"parentScene",parentCamera:"parentCamera"},outputs:{beforeRender:"beforeRender"},standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPortalBeforeRender,[{type:core.Directive,args:[{selector:"[ngtPortalBeforeRender]",standalone:!0}]}],null,{renderPriority:[{type:core.Input}],parentScene:[{type:core.Input}],parentCamera:[{type:core.Input}],beforeRender:[{type:core.Output}]});class NgtPortalContent{constructor(vcr,parentVcr){const commentNode=vcr.element.nativeElement;commentNode.__ngt_renderer_add_comment__&&(commentNode.__ngt_renderer_add_comment__(parentVcr.element.nativeElement),delete commentNode.__ngt_renderer_add_comment__)}}(angular_three_class11=NgtPortalContent).ɵfac=function _class11_Factory(t){return new(t||angular_three_class11)(core["ɵɵdirectiveInject"](core.ViewContainerRef),core["ɵɵdirectiveInject"](core.ViewContainerRef,4))},angular_three_class11.ɵdir=core["ɵɵdefineDirective"]({type:angular_three_class11,selectors:[["ng-template","ngtPortalContent",""]],standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPortalContent,[{type:core.Directive,args:[{selector:"ng-template[ngtPortalContent]",standalone:!0}]}],(function(){return[{type:core.ViewContainerRef},{type:core.ViewContainerRef,decorators:[{type:core.SkipSelf}]}]}),null);class NgtPortal extends NgtRxStore{constructor(){super(...arguments),this.autoRender=!0,this.autoRenderPriority=1,this.beforeRender=new core.EventEmitter,this.parentStore=(0,core.inject)(NgtStore,{skipSelf:!0}),this.parentScene=this.parentStore.get("scene"),this.parentCamera=this.parentStore.get("camera"),this.portalStore=(0,core.inject)(NgtStore,{self:!0}),this.raycaster=new three_module.Raycaster,this.pointer=new three_module.Vector2,this.portalContentRendered=!1}set container(container){this.set({container})}set state(state){this.set({state})}initialize(){super.initialize(),this.set({container:injectNgtRef(prepare(new three_module.Scene))})}ngOnInit(){const previousState=this.parentStore.get(),inputsState=this.get();!inputsState.state&&this.autoRender&&(inputsState.state={events:{priority:this.autoRenderPriority+1}});const{events,size,...restInputsState}=inputsState.state||{},containerState=inputsState.container,container=is.ref(containerState)?containerState.nativeElement:containerState,localState=getLocalState(container);localState.store||(localState.store=this.portalStore),this.portalStore.set({...previousState,scene:container,raycaster:this.raycaster,pointer:this.pointer,previousStore:this.parentStore,events:{...previousState.events,...events||{}},size:{...previousState.size,...size||{}},...restInputsState,get:this.portalStore.get.bind(this.portalStore),set:this.portalStore.set.bind(this.portalStore),select:this.portalStore.select.bind(this.portalStore),setEvents:events=>this.portalStore.set((state=>({...state,events:{...state.events,...events}})))}),this.hold(this.parentStore.select(),(previous=>this.portalStore.set((state=>this.inject(previous,state))))),requestAnimationFrame((()=>{this.portalStore.set((injectState=>this.inject(this.parentStore.get(),injectState)))})),this.portalContentView=this.portalContentAnchor.createEmbeddedView(this.portalContentTemplate),this.portalContentView.detectChanges(),this.portalContentRendered=!0}onBeforeRender(portal){this.beforeRender.emit({root:{...this.parentStore.get(),delta:portal.delta,frame:portal.frame},portal})}ngOnDestroy(){this.portalContentView&&!this.portalContentView.destroyed&&this.portalContentView.destroy(),super.ngOnDestroy()}inject(rootState,injectState){const intersect={...rootState};Object.keys(intersect).forEach((key=>{(privateKeys.includes(key)||rootState[key]!==injectState[key])&&delete intersect[key]}));const inputs=this.get(),{size,events,...restInputsState}=inputs.state||{};let viewport;if(injectState&&size){const camera=injectState.camera;viewport=rootState.viewport.getCurrentViewport(camera,new three_module.Vector3,size),camera!==rootState.camera&&updateCamera(camera,size)}return{...intersect,scene:is.ref(inputs.container)?inputs.container.nativeElement:inputs.container,raycaster:this.raycaster,pointer:this.pointer,previousStore:this.parentStore,events:{...rootState.events,...injectState?.events||{},...events},size:{...rootState.size,...size},viewport:{...rootState.viewport,...viewport||{}},...restInputsState}}}(angular_three_class12=NgtPortal).ɵfac=function(){let ɵ_class12_BaseFactory;return function _class12_Factory(t){return(ɵ_class12_BaseFactory||(ɵ_class12_BaseFactory=core["ɵɵgetInheritedFactory"](angular_three_class12)))(t||angular_three_class12)}}(),angular_three_class12.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_class12,selectors:[["ngt-portal"]],contentQueries:function _class12_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,NgtPortalContent,7,core.TemplateRef),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.portalContentTemplate=_t.first)}},viewQuery:function _class12_Query(rf,ctx){if(1&rf&&core["ɵɵviewQuery"](_c1,7,core.ViewContainerRef),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.portalContentAnchor=_t.first)}},inputs:{container:"container",state:"state",autoRender:"autoRender",autoRenderPriority:"autoRenderPriority"},outputs:{beforeRender:"beforeRender"},standalone:!0,features:[core["ɵɵProvidersFeature"]([NgtStore]),core["ɵɵInheritDefinitionFeature"],core["ɵɵStandaloneFeature"]],decls:3,vars:1,consts:[["portalContentAnchor",""],["ngtPortalBeforeRender","",3,"renderPriority","parentScene","parentCamera","beforeRender",4,"ngIf"],["ngtPortalBeforeRender","",3,"renderPriority","parentScene","parentCamera","beforeRender"]],template:function _class12_Template(rf,ctx){1&rf&&(core["ɵɵelementContainerStart"](0,null,0),core["ɵɵtemplate"](2,_class12_ng_container_2_Template,1,3,"ng-container",1),core["ɵɵelementContainerEnd"]()),2&rf&&(core["ɵɵadvance"](2),core["ɵɵproperty"]("ngIf",ctx.autoRender&&ctx.portalContentRendered))},dependencies:[common.NgIf,NgtPortalBeforeRender],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPortal,[{type:core.Component,args:[{selector:"ngt-portal",standalone:!0,template:'\n        <ng-container #portalContentAnchor>\n            <ng-container\n                *ngIf="autoRender && portalContentRendered"\n                ngtPortalBeforeRender\n                [renderPriority]="autoRenderPriority"\n                [parentScene]="parentScene"\n                [parentCamera]="parentCamera"\n                (beforeRender)="onBeforeRender($event)"\n            />\n        </ng-container>\n    ',imports:[common.NgIf,NgtPortalBeforeRender],providers:[NgtStore]}]}],null,{container:[{type:core.Input}],state:[{type:core.Input}],autoRender:[{type:core.Input}],autoRenderPriority:[{type:core.Input}],beforeRender:[{type:core.Output}],portalContentTemplate:[{type:core.ContentChild,args:[NgtPortalContent,{read:core.TemplateRef,static:!0}]}],portalContentAnchor:[{type:core.ViewChild,args:["portalContentAnchor",{read:core.ViewContainerRef,static:!0}]}]});class NgtRoutedScene{constructor(router){const{destroy$,cdr}=injectNgtDestroy();router.events.pipe((0,filter.h)((event=>event instanceof ActivationEnd)),(0,takeUntil.R)(destroy$)).subscribe((()=>safeDetectChanges(cdr)))}}(angular_three_class13=NgtRoutedScene).isRoutedScene=!0,angular_three_class13.ɵfac=function _class13_Factory(t){return new(t||angular_three_class13)(core["ɵɵdirectiveInject"](Router))},angular_three_class13.ɵcmp=core["ɵɵdefineComponent"]({type:angular_three_class13,selectors:[["ngt-routed-scene"]],standalone:!0,features:[core["ɵɵStandaloneFeature"]],decls:1,vars:0,template:function _class13_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"router-outlet")},dependencies:[RouterOutlet],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRoutedScene,[{type:core.Component,args:[{standalone:!0,selector:"ngt-routed-scene",template:"<router-outlet />",imports:[RouterOutlet]}]}],(function(){return[{type:Router}]}),null)},"./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>combineLatest});var _Observable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),_util_argsArgArrayOrObject__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/argsArgArrayOrObject.js"),_from__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/from.js"),_util_identity__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js"),_util_mapOneOrManyArgs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/mapOneOrManyArgs.js"),_util_args__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/args.js"),_util_createObject__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/createObject.js"),_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_util_executeSchedule__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/executeSchedule.js");function combineLatest(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=(0,_util_args__WEBPACK_IMPORTED_MODULE_0__.yG)(args),resultSelector=(0,_util_args__WEBPACK_IMPORTED_MODULE_0__.jO)(args),_a=(0,_util_argsArgArrayOrObject__WEBPACK_IMPORTED_MODULE_1__.D)(args),observables=_a.args,keys=_a.keys;if(0===observables.length)return(0,_from__WEBPACK_IMPORTED_MODULE_2__.D)([],scheduler);var result=new _Observable__WEBPACK_IMPORTED_MODULE_3__.y(function combineLatestInit(observables,scheduler,valueTransform){void 0===valueTransform&&(valueTransform=_util_identity__WEBPACK_IMPORTED_MODULE_5__.y);return function(subscriber){maybeSchedule(scheduler,(function(){for(var length=observables.length,values=new Array(length),active=length,remainingFirstValues=length,_loop_1=function(i){maybeSchedule(scheduler,(function(){var source=(0,_from__WEBPACK_IMPORTED_MODULE_2__.D)(observables[i],scheduler),hasFirstValue=!1;source.subscribe((0,_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_7__.x)(subscriber,(function(value){values[i]=value,hasFirstValue||(hasFirstValue=!0,remainingFirstValues--),remainingFirstValues||subscriber.next(valueTransform(values.slice()))}),(function(){--active||subscriber.complete()})))}),subscriber)},i=0;i<length;i++)_loop_1(i)}),subscriber)}}(observables,scheduler,keys?function(values){return(0,_util_createObject__WEBPACK_IMPORTED_MODULE_4__.n)(keys,values)}:_util_identity__WEBPACK_IMPORTED_MODULE_5__.y));return resultSelector?result.pipe((0,_util_mapOneOrManyArgs__WEBPACK_IMPORTED_MODULE_6__.Z)(resultSelector)):result}function maybeSchedule(scheduler,execute,subscription){scheduler?(0,_util_executeSchedule__WEBPACK_IMPORTED_MODULE_8__.f)(subscription,scheduler,execute):execute()}},"./node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>forkJoin});var _Observable__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),_util_argsArgArrayOrObject__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/argsArgArrayOrObject.js"),_innerFrom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js"),_util_args__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/args.js"),_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_util_mapOneOrManyArgs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/mapOneOrManyArgs.js"),_util_createObject__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/createObject.js");function forkJoin(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var resultSelector=(0,_util_args__WEBPACK_IMPORTED_MODULE_0__.jO)(args),_a=(0,_util_argsArgArrayOrObject__WEBPACK_IMPORTED_MODULE_1__.D)(args),sources=_a.args,keys=_a.keys,result=new _Observable__WEBPACK_IMPORTED_MODULE_2__.y((function(subscriber){var length=sources.length;if(length)for(var values=new Array(length),remainingCompletions=length,remainingEmissions=length,_loop_1=function(sourceIndex){var hasValue=!1;(0,_innerFrom__WEBPACK_IMPORTED_MODULE_3__.Xf)(sources[sourceIndex]).subscribe((0,_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_4__.x)(subscriber,(function(value){hasValue||(hasValue=!0,remainingEmissions--),values[sourceIndex]=value}),(function(){return remainingCompletions--}),void 0,(function(){remainingCompletions&&hasValue||(remainingEmissions||subscriber.next(keys?(0,_util_createObject__WEBPACK_IMPORTED_MODULE_5__.n)(keys,values):values),subscriber.complete())})))},sourceIndex=0;sourceIndex<length;sourceIndex++)_loop_1(sourceIndex);else subscriber.complete()}));return resultSelector?result.pipe((0,_util_mapOneOrManyArgs__WEBPACK_IMPORTED_MODULE_6__.Z)(resultSelector)):result}},"./node_modules/rxjs/dist/esm5/internal/operators/catchError.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>catchError});var _observable_innerFrom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js"),_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_util_lift__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js");function catchError(selector){return(0,_util_lift__WEBPACK_IMPORTED_MODULE_0__.e)((function(source,subscriber){var handledResult,innerSub=null,syncUnsub=!1;innerSub=source.subscribe((0,_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_1__.x)(subscriber,void 0,void 0,(function(err){handledResult=(0,_observable_innerFrom__WEBPACK_IMPORTED_MODULE_2__.Xf)(selector(err,catchError(selector)(source))),innerSub?(innerSub.unsubscribe(),innerSub=null,handledResult.subscribe(subscriber)):syncUnsub=!0}))),syncUnsub&&(innerSub.unsubscribe(),innerSub=null,handledResult.subscribe(subscriber))}))}},"./node_modules/rxjs/dist/esm5/internal/operators/retry.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>retry});var _util_lift__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_util_identity__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js"),_observable_timer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/timer.js"),_observable_innerFrom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js");function retry(configOrCount){var config;void 0===configOrCount&&(configOrCount=1/0);var _a=(config=configOrCount&&"object"==typeof configOrCount?configOrCount:{count:configOrCount}).count,count=void 0===_a?1/0:_a,delay=config.delay,_b=config.resetOnSuccess,resetOnSuccess=void 0!==_b&&_b;return count<=0?_util_identity__WEBPACK_IMPORTED_MODULE_0__.y:(0,_util_lift__WEBPACK_IMPORTED_MODULE_1__.e)((function(source,subscriber){var innerSub,soFar=0,subscribeForRetry=function(){var syncUnsub=!1;innerSub=source.subscribe((0,_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__.x)(subscriber,(function(value){resetOnSuccess&&(soFar=0),subscriber.next(value)}),void 0,(function(err){if(soFar++<count){var resub_1=function(){innerSub?(innerSub.unsubscribe(),innerSub=null,subscribeForRetry()):syncUnsub=!0};if(null!=delay){var notifier="number"==typeof delay?(0,_observable_timer__WEBPACK_IMPORTED_MODULE_3__.H)(delay):(0,_observable_innerFrom__WEBPACK_IMPORTED_MODULE_4__.Xf)(delay(err,soFar)),notifierSubscriber_1=(0,_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__.x)(subscriber,(function(){notifierSubscriber_1.unsubscribe(),resub_1()}),(function(){subscriber.complete()}));notifier.subscribe(notifierSubscriber_1)}else resub_1()}else subscriber.error(err)}))),syncUnsub&&(innerSub.unsubscribe(),innerSub=null,subscribeForRetry())};subscribeForRetry()}))}},"./node_modules/rxjs/dist/esm5/internal/util/argsArgArrayOrObject.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>argsArgArrayOrObject});var isArray=Array.isArray,getPrototypeOf=Object.getPrototypeOf,objectProto=Object.prototype,getKeys=Object.keys;function argsArgArrayOrObject(args){if(1===args.length){var first_1=args[0];if(isArray(first_1))return{args:first_1,keys:null};if(function isPOJO(obj){return obj&&"object"==typeof obj&&getPrototypeOf(obj)===objectProto}(first_1)){var keys=getKeys(first_1);return{args:keys.map((function(key){return first_1[key]})),keys}}}return{args,keys:null}}},"./node_modules/rxjs/dist/esm5/internal/util/createObject.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function createObject(keys,values){return keys.reduce((function(result,key,i){return result[key]=values[i],result}),{})}__webpack_require__.d(__webpack_exports__,{n:()=>createObject})},"./node_modules/rxjs/dist/esm5/internal/util/mapOneOrManyArgs.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>mapOneOrManyArgs});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_operators_map__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),isArray=Array.isArray;function mapOneOrManyArgs(fn){return(0,_operators_map__WEBPACK_IMPORTED_MODULE_1__.U)((function(args){return function callOrApply(fn,args){return isArray(args)?fn.apply(void 0,(0,tslib__WEBPACK_IMPORTED_MODULE_0__.ev)([],(0,tslib__WEBPACK_IMPORTED_MODULE_0__.CR)(args))):fn(args)}(fn,args)}))}}}]);
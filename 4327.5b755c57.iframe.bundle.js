/*! For license information please see 4327.5b755c57.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_ng_components_source=self.webpackChunk_ng_components_source||[]).push([[4327],{"./node_modules/angular-three-soba/fesm2022/angular-three-soba-abstractions.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Lr:()=>NgtsLine,Ix:()=>NgtsText});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),angular_three=__webpack_require__("./node_modules/angular-three/fesm2022/angular-three.mjs"),ngxtension_inject_inputs=__webpack_require__("./node_modules/ngxtension/fesm2022/ngxtension-inject-inputs.mjs"),three_core=__webpack_require__("./node_modules/three/build/three.core.js");const _box=new three_core.NRn,_vector=new three_core.Pq0;class LineSegmentsGeometry extends three_core.CmU{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new three_core.qtW([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new three_core.qtW([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(matrix){const start=this.attributes.instanceStart,end=this.attributes.instanceEnd;return void 0!==start&&(start.applyMatrix4(matrix),end.applyMatrix4(matrix),start.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(array){let lineSegments;array instanceof Float32Array?lineSegments=array:Array.isArray(array)&&(lineSegments=new Float32Array(array));const instanceBuffer=new three_core.LuO(lineSegments,6,1);return this.setAttribute("instanceStart",new three_core.eHs(instanceBuffer,3,0)),this.setAttribute("instanceEnd",new three_core.eHs(instanceBuffer,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(array,itemSize=3){let colors;array instanceof Float32Array?colors=array:Array.isArray(array)&&(colors=new Float32Array(array));const instanceColorBuffer=new three_core.LuO(colors,2*itemSize,1);return this.setAttribute("instanceColorStart",new three_core.eHs(instanceColorBuffer,itemSize,0)),this.setAttribute("instanceColorEnd",new three_core.eHs(instanceColorBuffer,itemSize,itemSize)),this}fromWireframeGeometry(geometry){return this.setPositions(geometry.attributes.position.array),this}fromEdgesGeometry(geometry){return this.setPositions(geometry.attributes.position.array),this}fromMesh(mesh){return this.fromWireframeGeometry(new three_core.XJ7(mesh.geometry)),this}fromLineSegments(lineSegments){const geometry=lineSegments.geometry;return this.setPositions(geometry.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new three_core.NRn);const start=this.attributes.instanceStart,end=this.attributes.instanceEnd;void 0!==start&&void 0!==end&&(this.boundingBox.setFromBufferAttribute(start),_box.setFromBufferAttribute(end),this.boundingBox.union(_box))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new three_core.iyt),null===this.boundingBox&&this.computeBoundingBox();const start=this.attributes.instanceStart,end=this.attributes.instanceEnd;if(void 0!==start&&void 0!==end){const center=this.boundingSphere.center;this.boundingBox.getCenter(center);let maxRadiusSq=0;for(let i=0,il=start.count;i<il;i++)_vector.fromBufferAttribute(start,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_vector)),_vector.fromBufferAttribute(end,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_vector));this.boundingSphere.radius=Math.sqrt(maxRadiusSq),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(matrix){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(matrix)}}var three_module=__webpack_require__("./node_modules/three/build/three.module.js");const version=(()=>parseInt(three_core.sPf.replace(/\D+/g,"")))();class LineMaterial extends three_core.BKk{constructor(parameters){super({type:"LineMaterial",uniforms:three_core.LlO.clone(three_core.LlO.merge([three_module.UniformsLib.common,three_module.UniformsLib.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new three_core.I9Y(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${version>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(value){this.uniforms.diffuse.value=value}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(value){!0===value?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(value){this.uniforms.linewidth.value=value}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(value){Boolean(value)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===value?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(value){this.uniforms.dashScale.value=value}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(value){this.uniforms.dashSize.value=value}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(value){this.uniforms.dashOffset.value=value}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(value){this.uniforms.gapSize.value=value}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(value){this.uniforms.opacity.value=value}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(value){this.uniforms.resolution.value.copy(value)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(value){Boolean(value)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===value?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(parameters)}}const UV1=version>=125?"uv1":"uv2",_viewport=new three_core.IUQ,_start=new three_core.Pq0,_end=new three_core.Pq0,_start4=new three_core.IUQ,_end4=new three_core.IUQ,_ssOrigin=new three_core.IUQ,_ssOrigin3=new three_core.Pq0,_mvMatrix=new three_core.kn4,_line=new three_core.cZY,_closestPoint=new three_core.Pq0,LineSegments2_box=new three_core.NRn,_sphere=new three_core.iyt,_clipToWorldVector=new three_core.IUQ;let _ray,_lineWidth;function getWorldSpaceHalfWidth(camera,distance,resolution){return _clipToWorldVector.set(0,0,-distance,1).applyMatrix4(camera.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/resolution.width,_clipToWorldVector.y=_lineWidth/resolution.height,_clipToWorldVector.applyMatrix4(camera.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}class LineSegments2 extends three_core.eaF{constructor(geometry=new LineSegmentsGeometry,material=new LineMaterial({color:16777215*Math.random()})){super(geometry,material),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const geometry=this.geometry,instanceStart=geometry.attributes.instanceStart,instanceEnd=geometry.attributes.instanceEnd,lineDistances=new Float32Array(2*instanceStart.count);for(let i=0,j=0,l=instanceStart.count;i<l;i++,j+=2)_start.fromBufferAttribute(instanceStart,i),_end.fromBufferAttribute(instanceEnd,i),lineDistances[j]=0===j?0:lineDistances[j-1],lineDistances[j+1]=lineDistances[j]+_start.distanceTo(_end);const instanceDistanceBuffer=new three_core.LuO(lineDistances,2,1);return geometry.setAttribute("instanceDistanceStart",new three_core.eHs(instanceDistanceBuffer,1,0)),geometry.setAttribute("instanceDistanceEnd",new three_core.eHs(instanceDistanceBuffer,1,1)),this}raycast(raycaster,intersects){const worldUnits=this.material.worldUnits,camera=raycaster.camera;null!==camera||worldUnits||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const threshold=void 0!==raycaster.params.Line2&&raycaster.params.Line2.threshold||0;_ray=raycaster.ray;const matrixWorld=this.matrixWorld,geometry=this.geometry,material=this.material;let sphereMargin,boxMargin;if(_lineWidth=material.linewidth+threshold,null===geometry.boundingSphere&&geometry.computeBoundingSphere(),_sphere.copy(geometry.boundingSphere).applyMatrix4(matrixWorld),worldUnits)sphereMargin=.5*_lineWidth;else{sphereMargin=getWorldSpaceHalfWidth(camera,Math.max(camera.near,_sphere.distanceToPoint(_ray.origin)),material.resolution)}if(_sphere.radius+=sphereMargin,!1!==_ray.intersectsSphere(_sphere)){if(null===geometry.boundingBox&&geometry.computeBoundingBox(),LineSegments2_box.copy(geometry.boundingBox).applyMatrix4(matrixWorld),worldUnits)boxMargin=.5*_lineWidth;else{boxMargin=getWorldSpaceHalfWidth(camera,Math.max(camera.near,LineSegments2_box.distanceToPoint(_ray.origin)),material.resolution)}LineSegments2_box.expandByScalar(boxMargin),!1!==_ray.intersectsBox(LineSegments2_box)&&(worldUnits?function raycastWorldUnits(lineSegments,intersects){const matrixWorld=lineSegments.matrixWorld,geometry=lineSegments.geometry,instanceStart=geometry.attributes.instanceStart,instanceEnd=geometry.attributes.instanceEnd;for(let i=0,l=Math.min(geometry.instanceCount,instanceStart.count);i<l;i++){_line.start.fromBufferAttribute(instanceStart,i),_line.end.fromBufferAttribute(instanceEnd,i),_line.applyMatrix4(matrixWorld);const pointOnLine=new three_core.Pq0,point=new three_core.Pq0;_ray.distanceSqToSegment(_line.start,_line.end,point,pointOnLine),point.distanceTo(pointOnLine)<.5*_lineWidth&&intersects.push({point,pointOnLine,distance:_ray.origin.distanceTo(point),object:lineSegments,face:null,faceIndex:i,uv:null,[UV1]:null})}}(this,intersects):function raycastScreenSpace(lineSegments,camera,intersects){const projectionMatrix=camera.projectionMatrix,resolution=lineSegments.material.resolution,matrixWorld=lineSegments.matrixWorld,geometry=lineSegments.geometry,instanceStart=geometry.attributes.instanceStart,instanceEnd=geometry.attributes.instanceEnd,segmentCount=Math.min(geometry.instanceCount,instanceStart.count),near=-camera.near;_ray.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(camera.matrixWorldInverse),_ssOrigin.applyMatrix4(projectionMatrix),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=resolution.x/2,_ssOrigin.y*=resolution.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(camera.matrixWorldInverse,matrixWorld);for(let i=0,l=segmentCount;i<l;i++){if(_start4.fromBufferAttribute(instanceStart,i),_end4.fromBufferAttribute(instanceEnd,i),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>near&&_end4.z>near)continue;if(_start4.z>near){const deltaDist=_start4.z-_end4.z,t=(_start4.z-near)/deltaDist;_start4.lerp(_end4,t)}else if(_end4.z>near){const deltaDist=_end4.z-_start4.z,t=(_end4.z-near)/deltaDist;_end4.lerp(_start4,t)}_start4.applyMatrix4(projectionMatrix),_end4.applyMatrix4(projectionMatrix),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=resolution.x/2,_start4.y*=resolution.y/2,_end4.x*=resolution.x/2,_end4.y*=resolution.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const param=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(param,_closestPoint);const zPos=three_core.cj9.lerp(_start4.z,_end4.z,param),isInClipSpace=zPos>=-1&&zPos<=1,isInside=_ssOrigin3.distanceTo(_closestPoint)<.5*_lineWidth;if(isInClipSpace&&isInside){_line.start.fromBufferAttribute(instanceStart,i),_line.end.fromBufferAttribute(instanceEnd,i),_line.start.applyMatrix4(matrixWorld),_line.end.applyMatrix4(matrixWorld);const pointOnLine=new three_core.Pq0,point=new three_core.Pq0;_ray.distanceSqToSegment(_line.start,_line.end,point,pointOnLine),intersects.push({point,pointOnLine,distance:_ray.origin.distanceTo(point),object:lineSegments,face:null,faceIndex:i,uv:null,[UV1]:null})}}}(this,camera,intersects))}}onBeforeRender(renderer){const uniforms=this.material.uniforms;uniforms&&uniforms.resolution&&(renderer.getViewport(_viewport),this.material.uniforms.resolution.value.set(_viewport.z,_viewport.w))}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(array){const length=array.length-3,points=new Float32Array(2*length);for(let i=0;i<length;i+=3)points[2*i]=array[i],points[2*i+1]=array[i+1],points[2*i+2]=array[i+2],points[2*i+3]=array[i+3],points[2*i+4]=array[i+4],points[2*i+5]=array[i+5];return super.setPositions(points),this}setColors(array,itemSize=3){const length=array.length-itemSize,colors=new Float32Array(2*length);if(3===itemSize)for(let i=0;i<length;i+=itemSize)colors[2*i]=array[i],colors[2*i+1]=array[i+1],colors[2*i+2]=array[i+2],colors[2*i+3]=array[i+3],colors[2*i+4]=array[i+4],colors[2*i+5]=array[i+5];else for(let i=0;i<length;i+=itemSize)colors[2*i]=array[i],colors[2*i+1]=array[i+1],colors[2*i+2]=array[i+2],colors[2*i+3]=array[i+3],colors[2*i+4]=array[i+4],colors[2*i+5]=array[i+5],colors[2*i+6]=array[i+6],colors[2*i+7]=array[i+7];return super.setColors(colors,itemSize),this}fromLine(line){const geometry=line.geometry;return this.setPositions(geometry.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(geometry=new LineGeometry,material=new LineMaterial({color:16777215*Math.random()})){super(geometry,material),this.isLine2=!0,this.type="Line2"}}function toTrianglesDrawMode(geometry,drawMode){if(drawMode===three_core.RJ4)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),geometry;if(drawMode===three_core.rYR||drawMode===three_core.O49){let index=geometry.getIndex();if(null===index){const indices=[],position=geometry.getAttribute("position");if(void 0===position)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),geometry;for(let i=0;i<position.count;i++)indices.push(i);geometry.setIndex(indices),index=geometry.getIndex()}const numberOfTriangles=index.count-2,newIndices=[];if(index)if(drawMode===three_core.rYR)for(let i=1;i<=numberOfTriangles;i++)newIndices.push(index.getX(0)),newIndices.push(index.getX(i)),newIndices.push(index.getX(i+1));else for(let i=0;i<numberOfTriangles;i++)i%2==0?(newIndices.push(index.getX(i)),newIndices.push(index.getX(i+1)),newIndices.push(index.getX(i+2))):(newIndices.push(index.getX(i+2)),newIndices.push(index.getX(i+1)),newIndices.push(index.getX(i)));newIndices.length/3!==numberOfTriangles&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const newGeometry=geometry.clone();return newGeometry.setIndex(newIndices),newGeometry.clearGroups(),newGeometry}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",drawMode),geometry}class TextGeometry extends three_core.QCA{constructor(text,parameters={}){const{bevelEnabled=!1,bevelSize=8,bevelThickness=10,font,height=50,size=100,lineHeight=1,letterSpacing=0,...rest}=parameters;if(void 0===font)super();else{super(font.generateShapes(text,size,{lineHeight,letterSpacing}),{...rest,bevelEnabled,bevelSize,bevelThickness,depth:height})}this.type="TextGeometry"}}var common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),ngxtension_assert_injector=__webpack_require__("./node_modules/ngxtension/fesm2022/ngxtension-assert-injector.mjs");class DecalGeometry extends three_core.LoY{constructor(mesh,position,orientation,size){super();const vertices=[],normals=[],uvs=[],plane=new three_core.Pq0,projectorMatrix=new three_core.kn4;projectorMatrix.makeRotationFromEuler(orientation),projectorMatrix.setPosition(position);const projectorMatrixInverse=new three_core.kn4;function pushDecalVertex(decalVertices,vertex,normal){vertex.applyMatrix4(mesh.matrixWorld),vertex.applyMatrix4(projectorMatrixInverse),normal.transformDirection(mesh.matrixWorld),decalVertices.push(new DecalVertex(vertex.clone(),normal.clone()))}function clipGeometry(inVertices,plane2){const outVertices=[],s=.5*Math.abs(size.dot(plane2));for(let i=0;i<inVertices.length;i+=3){let v1Out,v2Out,v3Out,nV1,nV2,nV3,nV4,total=0;switch(v1Out=inVertices[i+0].position.dot(plane2)-s>0,v2Out=inVertices[i+1].position.dot(plane2)-s>0,v3Out=inVertices[i+2].position.dot(plane2)-s>0,total=(v1Out?1:0)+(v2Out?1:0)+(v3Out?1:0),total){case 0:outVertices.push(inVertices[i]),outVertices.push(inVertices[i+1]),outVertices.push(inVertices[i+2]);break;case 1:if(v1Out&&(nV1=inVertices[i+1],nV2=inVertices[i+2],nV3=clip(inVertices[i],nV1,plane2,s),nV4=clip(inVertices[i],nV2,plane2,s)),v2Out){nV1=inVertices[i],nV2=inVertices[i+2],nV3=clip(inVertices[i+1],nV1,plane2,s),nV4=clip(inVertices[i+1],nV2,plane2,s),outVertices.push(nV3),outVertices.push(nV2.clone()),outVertices.push(nV1.clone()),outVertices.push(nV2.clone()),outVertices.push(nV3.clone()),outVertices.push(nV4);break}v3Out&&(nV1=inVertices[i],nV2=inVertices[i+1],nV3=clip(inVertices[i+2],nV1,plane2,s),nV4=clip(inVertices[i+2],nV2,plane2,s)),outVertices.push(nV1.clone()),outVertices.push(nV2.clone()),outVertices.push(nV3),outVertices.push(nV4),outVertices.push(nV3.clone()),outVertices.push(nV2.clone());break;case 2:v1Out||(nV1=inVertices[i].clone(),nV2=clip(nV1,inVertices[i+1],plane2,s),nV3=clip(nV1,inVertices[i+2],plane2,s),outVertices.push(nV1),outVertices.push(nV2),outVertices.push(nV3)),v2Out||(nV1=inVertices[i+1].clone(),nV2=clip(nV1,inVertices[i+2],plane2,s),nV3=clip(nV1,inVertices[i],plane2,s),outVertices.push(nV1),outVertices.push(nV2),outVertices.push(nV3)),v3Out||(nV1=inVertices[i+2].clone(),nV2=clip(nV1,inVertices[i],plane2,s),nV3=clip(nV1,inVertices[i+1],plane2,s),outVertices.push(nV1),outVertices.push(nV2),outVertices.push(nV3))}}return outVertices}function clip(v0,v1,p,s){const d0=v0.position.dot(p)-s,s0=d0/(d0-(v1.position.dot(p)-s));return new DecalVertex(new three_core.Pq0(v0.position.x+s0*(v1.position.x-v0.position.x),v0.position.y+s0*(v1.position.y-v0.position.y),v0.position.z+s0*(v1.position.z-v0.position.z)),new three_core.Pq0(v0.normal.x+s0*(v1.normal.x-v0.normal.x),v0.normal.y+s0*(v1.normal.y-v0.normal.y),v0.normal.z+s0*(v1.normal.z-v0.normal.z)))}projectorMatrixInverse.copy(projectorMatrix).invert(),function generate(){let i,decalVertices=[];const vertex=new three_core.Pq0,normal=new three_core.Pq0;if(!0===mesh.geometry.isGeometry)return void console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");const geometry=mesh.geometry,positionAttribute=geometry.attributes.position,normalAttribute=geometry.attributes.normal;if(null!==geometry.index){const index=geometry.index;for(i=0;i<index.count;i++)vertex.fromBufferAttribute(positionAttribute,index.getX(i)),normal.fromBufferAttribute(normalAttribute,index.getX(i)),pushDecalVertex(decalVertices,vertex,normal)}else for(i=0;i<positionAttribute.count;i++)vertex.fromBufferAttribute(positionAttribute,i),normal.fromBufferAttribute(normalAttribute,i),pushDecalVertex(decalVertices,vertex,normal);for(decalVertices=clipGeometry(decalVertices,plane.set(1,0,0)),decalVertices=clipGeometry(decalVertices,plane.set(-1,0,0)),decalVertices=clipGeometry(decalVertices,plane.set(0,1,0)),decalVertices=clipGeometry(decalVertices,plane.set(0,-1,0)),decalVertices=clipGeometry(decalVertices,plane.set(0,0,1)),decalVertices=clipGeometry(decalVertices,plane.set(0,0,-1)),i=0;i<decalVertices.length;i++){const decalVertex=decalVertices[i];uvs.push(.5+decalVertex.position.x/size.x,.5+decalVertex.position.y/size.y),decalVertex.position.applyMatrix4(projectorMatrix),vertices.push(decalVertex.position.x,decalVertex.position.y,decalVertex.position.z),normals.push(decalVertex.normal.x,decalVertex.normal.y,decalVertex.normal.z)}}(),this.setAttribute("position",new three_core.qtW(vertices,3)),this.setAttribute("normal",new three_core.qtW(normals,3)),this.setAttribute("uv",new three_core.qtW(uvs,2))}}class DecalVertex{constructor(position,normal){this.position=position,this.normal=normal}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const _face=new three_core.lMl,_color=new three_core.Pq0;class MeshSurfaceSampler{constructor(mesh){let geometry=mesh.geometry;geometry.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),geometry=geometry.toNonIndexed()),this.geometry=geometry,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(name){return this.weightAttribute=name?this.geometry.getAttribute(name):null,this}build(){const positionAttribute=this.positionAttribute,weightAttribute=this.weightAttribute,faceWeights=new Float32Array(positionAttribute.count/3);for(let i=0;i<positionAttribute.count;i+=3){let faceWeight=1;weightAttribute&&(faceWeight=weightAttribute.getX(i)+weightAttribute.getX(i+1)+weightAttribute.getX(i+2)),_face.a.fromBufferAttribute(positionAttribute,i),_face.b.fromBufferAttribute(positionAttribute,i+1),_face.c.fromBufferAttribute(positionAttribute,i+2),faceWeight*=_face.getArea(),faceWeights[i/3]=faceWeight}this.distribution=new Float32Array(positionAttribute.count/3);let cumulativeTotal=0;for(let i=0;i<faceWeights.length;i++)cumulativeTotal+=faceWeights[i],this.distribution[i]=cumulativeTotal;return this}setRandomGenerator(randomFunction){return this.randomFunction=randomFunction,this}sample(targetPosition,targetNormal,targetColor){const faceIndex=this.sampleFaceIndex();return this.sampleFace(faceIndex,targetPosition,targetNormal,targetColor)}sampleFaceIndex(){const cumulativeTotal=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*cumulativeTotal)}binarySearch(x){const dist=this.distribution;let start=0,end=dist.length-1,index=-1;for(;start<=end;){const mid=Math.ceil((start+end)/2);if(0===mid||dist[mid-1]<=x&&dist[mid]>x){index=mid;break}x<dist[mid]?end=mid-1:start=mid+1}return index}sampleFace(faceIndex,targetPosition,targetNormal,targetColor){let u=this.randomFunction(),v=this.randomFunction();return u+v>1&&(u=1-u,v=1-v),_face.a.fromBufferAttribute(this.positionAttribute,3*faceIndex),_face.b.fromBufferAttribute(this.positionAttribute,3*faceIndex+1),_face.c.fromBufferAttribute(this.positionAttribute,3*faceIndex+2),targetPosition.set(0,0,0).addScaledVector(_face.a,u).addScaledVector(_face.b,v).addScaledVector(_face.c,1-(u+v)),void 0!==targetNormal&&_face.getNormal(targetNormal),void 0!==targetColor&&void 0!==this.colorAttribute&&(_face.a.fromBufferAttribute(this.colorAttribute,3*faceIndex),_face.b.fromBufferAttribute(this.colorAttribute,3*faceIndex+1),_face.c.fromBufferAttribute(this.colorAttribute,3*faceIndex+2),_color.set(0,0,0).addScaledVector(_face.a,u).addScaledVector(_face.b,v).addScaledVector(_face.c,1-(u+v)),targetColor.r=_color.x,targetColor.g=_color.y,targetColor.b=_color.z),this}}const _c0=["attribute"],_c1=["*"],_c2=a0=>[a0],_c3=a0=>["attributes",a0];function NgtsComputedAttribute_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",2,0),core["ɵɵprojection"](2),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("attach",core["ɵɵpureFunction1"](2,_c3,ctx_r0.name()))("parameters",ctx_r0.options())}}const _c4=["mesh"],_c5=["helper"];function NgtsDecal_ProjectionFallback_5_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-value",6)(1,"ngt-value",7),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("rawValue",ctx_r0.polygonOffsetFactor()),core["ɵɵadvance"](),core["ɵɵproperty"]("rawValue",ctx_r0.depthTest())}}function NgtsDecal_Conditional_7_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-mesh",null,1),core["ɵɵelement"](2,"ngt-box-geometry")(3,"ngt-mesh-normal-material",8)(4,"ngt-axes-helper"),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵadvance"](3),core["ɵɵproperty"]("wireframe",!0))}const _c6=["group"],_c7=["occlusionMesh"],_c8=["occlusionGeometry"],_c9=["*",[["","data-occlusion-geometry",""]],[["","data-occlusion-material",""]]],_c10=["*","[data-occlusion-geometry]","[data-occlusion-material]"];function NgtsHTML_Conditional_2_ProjectionFallback_2_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-plane-geometry",null,2)}function NgtsHTML_Conditional_2_ProjectionFallback_4_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-shader-material",5),2&rf){const ctx_r0=core["ɵɵnextContext"](2);core["ɵɵproperty"]("side",ctx_r0.DoubleSide)("vertexShader",ctx_r0.vertexShader())("fragmentShader",ctx_r0.fragmentShader())}}function NgtsHTML_Conditional_2_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-mesh",4,1),core["ɵɵprojection"](2,1,null,NgtsHTML_Conditional_2_ProjectionFallback_2_Template,2,0),core["ɵɵprojection"](4,2,null,NgtsHTML_Conditional_2_ProjectionFallback_4_Template,1,3),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("castShadow",ctx_r0.castShadow())("receiveShadow",ctx_r0.receiveShadow())}}const _c11=["transformOuter"],_c12=["transformInner"],_c13=["container"],_c14=["ngtsHTMLContent",""];function NgtsHTMLContent_Conditional_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"div",6,1)(2,"div",7,2)(4,"div",null,3),core["ɵɵelementContainer"](6,8),core["ɵɵelementEnd"]()()()),2&rf){const ctx_r0=core["ɵɵnextContext"](),content_r2=core["ɵɵreference"](3);core["ɵɵstyleProp"]("width",ctx_r0.size().width,"px")("height",ctx_r0.size().height,"px"),core["ɵɵadvance"](2),core["ɵɵstyleProp"]("pointer-events",ctx_r0.pointerEvents()),core["ɵɵadvance"](2),core["ɵɵstyleMap"](ctx_r0.containerStyle()),core["ɵɵclassMap"](ctx_r0.containerClass()),core["ɵɵadvance"](2),core["ɵɵproperty"]("ngTemplateOutlet",content_r2)}}function NgtsHTMLContent_Conditional_1_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"div",7,3),core["ɵɵelementContainer"](2,8),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"](),content_r2=core["ɵɵreference"](3);core["ɵɵstyleMap"](ctx_r0.containerStyle()),core["ɵɵclassMap"](ctx_r0.containerClass()),core["ɵɵstyleProp"]("transform",ctx_r0.center()?"translate3d(-50%,-50%,0)":"none")("top",ctx_r0.fullscreen()?-ctx_r0.size().height/2+"px":"unset")("left",ctx_r0.fullscreen()?-ctx_r0.size().width/2+"px":"unset")("width",ctx_r0.fullscreen()?ctx_r0.size().width:"unset")("height",ctx_r0.fullscreen()?ctx_r0.size().height:"unset"),core["ɵɵadvance"](2),core["ɵɵproperty"]("ngTemplateOutlet",content_r2)}}function NgtsHTMLContent_ng_template_2_Template(rf,ctx){1&rf&&core["ɵɵprojection"](0)}class NgtsBakeShadows{constructor(){const gl=(0,angular_three.ZQ)().select("gl");(0,core.effect)((onCleanup=>{const _gl=gl();_gl.shadowMap.autoUpdate=!1,_gl.shadowMap.needsUpdate=!0,onCleanup((()=>{_gl.shadowMap.autoUpdate=_gl.shadowMap.needsUpdate=!0}))}))}static{this.ɵfac=function NgtsBakeShadows_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsBakeShadows)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtsBakeShadows,selectors:[["ngts-bake-shadows"]]})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsBakeShadows,[{type:core.Directive,args:[{selector:"ngts-bake-shadows"}]}],(()=>[]),null);class NgtsComputedAttribute{constructor(){this.compute=core.input.required(),this.name=core.input.required(),this.options=(0,core.input)({}),this.bufferAttribute=new three_core.THS(new Float32Array(0),1),this.attributeRef=(0,core.viewChild)("attribute"),(0,core.effect)((()=>{const bufferAttribute=this.attributeRef()?.nativeElement;if(!bufferAttribute)return;const localState=(0,angular_three.h3)(bufferAttribute);if(!localState)return;const geometry=bufferAttribute.parent??localState.parent(),attribute=this.compute()(geometry);bufferAttribute.copy(attribute)}))}static{this.ɵfac=function NgtsComputedAttribute_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsComputedAttribute)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsComputedAttribute,selectors:[["ngts-computed-attribute"]],viewQuery:function NgtsComputedAttribute_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.attributeRef,_c0,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{compute:[1,"compute"],name:[1,"name"],options:[1,"options"]},ngContentSelectors:_c1,decls:1,vars:3,consts:[["attribute",""],[3,"attach","parameters",4,"args"],[3,"attach","parameters"]],template:function NgtsComputedAttribute_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsComputedAttribute_ngt_primitive_0_Template,3,4,"ngt-primitive",1)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,_c2,ctx.bufferAttribute))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}function getVersion(){return parseInt(three_core.sPf.replace(/\D+/g,""))}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsComputedAttribute,[{type:core.Component,args:[{selector:"ngts-computed-attribute",template:'\n\t\t<ngt-primitive #attribute *args="[bufferAttribute]" [attach]="[\'attributes\', name()]" [parameters]="options()">\n\t\t\t<ng-content />\n\t\t</ngt-primitive>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[angular_three.nQ]}]}],(()=>[]),null);const defaultOptions$1={polygonOffsetFactor:-10,debug:!1,depthTest:!1};class NgtsDecal{constructor(){this.mesh=(0,core.input)(),this.options=(0,core.input)(defaultOptions$1,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$1)}),this.parameters=(0,angular_three.cJ)(this.options,["debug","map","depthTest","polygonOffsetFactor","position","scale","rotation"]),this.meshRef=core.viewChild.required("mesh"),this.helperRef=(0,core.viewChild)("helper"),this.map=(0,angular_three.B4)(this.options,"map"),this.depthTest=(0,angular_three.B4)(this.options,"depthTest"),this.polygonOffsetFactor=(0,angular_three.B4)(this.options,"polygonOffsetFactor"),this.debug=(0,angular_three.B4)(this.options,"debug"),this.position=(0,angular_three.B4)(this.options,"position"),this.rotation=(0,angular_three.B4)(this.options,"rotation"),this.scale=(0,angular_three.B4)(this.options,"scale"),(0,angular_three.X$)({Mesh:three_core.eaF,BoxGeometry:three_core.iNn,MeshNormalMaterial:three_core.qBx,AxesHelper:three_core.IzY}),(0,core.effect)((onCleanup=>{const thisMesh=this.meshRef().nativeElement,localState=(0,angular_three.h3)(thisMesh);if(!localState)return;const parent=(0,angular_three.qE)(this.mesh())||localState.parent();if(parent&&!parent.isMesh)throw new Error('<ngts-decal> must have a Mesh as parent or specify its "mesh" input');if(!parent)return;const parentLocalState=(0,angular_three.h3)(parent);if(!parentLocalState)return;const parentNonObjects=parentLocalState.nonObjects();if(!parentNonObjects||!parentNonObjects.length)return;if(!parent.geometry?.attributes?.position)return;const[position,rotation,scale]=[this.position(),this.rotation(),this.scale()],state={position:new three_core.Pq0,rotation:new three_core.O9p,scale:new three_core.Pq0(1,1,1)};(0,angular_three.FT)(state,{position,scale});const matrixWorld=parent.matrixWorld.clone();if(parent.matrixWorld.identity(),rotation&&"number"!=typeof rotation)(0,angular_three.FT)(state,{rotation});else{const o=new three_core.B69;o.position.copy(state.position),o.lookAt(parent.position),"number"==typeof rotation&&o.rotateZ(rotation),(0,angular_three.FT)(state,{rotation:o.rotation})}thisMesh.geometry=new DecalGeometry(parent,state.position,state.rotation,state.scale);const helper=this.helperRef()?.nativeElement;helper&&((0,angular_three.FT)(helper,state),helper.traverse((child=>child.raycast=()=>null))),parent.matrixWorld=matrixWorld,onCleanup((()=>{thisMesh.geometry.dispose()}))}))}static{this.ɵfac=function NgtsDecal_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsDecal)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsDecal,selectors:[["ngts-decal"]],viewQuery:function NgtsDecal_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.meshRef,_c4,5),core["ɵɵviewQuerySignal"](ctx.helperRef,_c5,5)),2&rf&&core["ɵɵqueryAdvance"](2)},inputs:{mesh:[1,"mesh"],options:[1,"options"]},ngContentSelectors:_c1,decls:8,vars:5,consts:[["mesh",""],["helper",""],[3,"parameters"],["attach","material.transparent",3,"rawValue"],["attach","material.polygonOffset",3,"rawValue"],["attach","material.map",3,"rawValue"],["attach","material.polygonOffsetFactor",3,"rawValue"],["attach","material.depthTest",3,"rawValue"],[3,"wireframe"]],template:function NgtsDecal_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-mesh",2,0),core["ɵɵelement"](2,"ngt-value",3)(3,"ngt-value",4)(4,"ngt-value",5),core["ɵɵprojection"](5,0,null,NgtsDecal_ProjectionFallback_5_Template,2,2),core["ɵɵtemplate"](7,NgtsDecal_Conditional_7_Template,5,1,"ngt-mesh"),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("parameters",ctx.parameters()),core["ɵɵadvance"](2),core["ɵɵproperty"]("rawValue",!0),core["ɵɵadvance"](),core["ɵɵproperty"]("rawValue",!0),core["ɵɵadvance"](),core["ɵɵproperty"]("rawValue",ctx.map()),core["ɵɵadvance"](3),core["ɵɵconditional"](ctx.debug()?7:-1))},encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsDecal,[{type:core.Component,args:[{selector:"ngts-decal",template:'\n\t\t<ngt-mesh #mesh [parameters]="parameters()">\n\t\t\t<ngt-value [rawValue]="true" attach="material.transparent" />\n\t\t\t<ngt-value [rawValue]="true" attach="material.polygonOffset" />\n\t\t\t<ngt-value [rawValue]="map()" attach="material.map" />\n\n\t\t\t<ng-content>\n\t\t\t\t\x3c!-- we only want to pass through these material properties if they don\'t use a custom material --\x3e\n\t\t\t\t<ngt-value [rawValue]="polygonOffsetFactor()" attach="material.polygonOffsetFactor" />\n\t\t\t\t<ngt-value [rawValue]="depthTest()" attach="material.depthTest" />\n\t\t\t</ng-content>\n\n\t\t\t@if (debug()) {\n\t\t\t\t<ngt-mesh #helper>\n\t\t\t\t\t<ngt-box-geometry />\n\t\t\t\t\t<ngt-mesh-normal-material [wireframe]="true" />\n\t\t\t\t\t<ngt-axes-helper />\n\t\t\t\t</ngt-mesh>\n\t\t\t}\n\t\t</ngt-mesh>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);function injectFBO(params=()=>({}),{injector}={}){return(0,ngxtension_assert_injector.x)(injectFBO,injector,(()=>{const store=(0,angular_three.ZQ)(),size=store.select("size"),viewport=store.select("viewport"),width=(0,core.computed)((()=>{const{width}=params();return"number"==typeof width?width:size().width*viewport().dpr})),height=(0,core.computed)((()=>{const{height}=params();return"number"==typeof height?height:size().height*viewport().dpr})),settings=(0,core.computed)((()=>{const{width,settings}=params(),_settings=("number"==typeof width?settings:width)||{};return void 0===_settings.samples&&(_settings.samples=0),_settings})),target=(0,core.computed)((()=>{const[{samples=0,depth,...targetSettings},_width,_height]=[(0,core.untracked)(settings),(0,core.untracked)(width),(0,core.untracked)(height)],target=new three_core.nWS(_width,_height,{minFilter:three_core.k6q,magFilter:three_core.k6q,type:three_core.ix0,...targetSettings});return depth&&(target.depthTexture=new three_core.VCu(_width,_height,three_core.RQf)),target.samples=samples,target}));return(0,core.effect)((()=>{const[{samples=0},_width,_height,_target]=[settings(),width(),height(),target()];_target.setSize(_width,_height),samples&&(_target.samples=samples)})),(0,core.inject)(core.DestroyRef).onDestroy((()=>target().dispose())),target}))}class NgtsFBO{constructor(){let ref;this.fbo=(0,core.input)({}),this.template=(0,core.inject)(core.TemplateRef),this.viewContainerRef=(0,core.inject)(core.ViewContainerRef);const fboTarget=injectFBO((()=>{const{width,height,...settings}=this.fbo();return{width,height,settings}}));(0,core.effect)((()=>{ref=this.viewContainerRef.createEmbeddedView(this.template,{$implicit:fboTarget}),ref.detectChanges()})),(0,core.inject)(core.DestroyRef).onDestroy((()=>{ref?.destroy()}))}static ngTemplateContextGuard(_,ctx){return!0}static{this.ɵfac=function NgtsFBO_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsFBO)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtsFBO,selectors:[["ng-template","fbo",""]],inputs:{fbo:[1,"fbo"]}})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsFBO,[{type:core.Directive,args:[{selector:"ng-template[fbo]"}]}],(()=>[]),null);const defaultHtmlOptions={occlude:!1,transform:!1,castShadow:!1,receiveShadow:!1};class NgtsHTML{constructor(){this.options=(0,core.input)(defaultHtmlOptions,{transform:(0,ngxtension_inject_inputs.sg)(defaultHtmlOptions)}),this.parameters=(0,angular_three.cJ)(this.options,["occlude","castShadow","receiveShadow","transform"]),this.groupRef=core.viewChild.required("group"),this.occlusionMeshRef=(0,core.viewChild)("occlusionMesh"),this.occlusionGeometryRef=(0,core.viewChild)("occlusionGeometry"),this.occlude=(0,angular_three.B4)(this.options,"occlude"),this.transform=(0,angular_three.B4)(this.options,"transform"),this.castShadow=(0,angular_three.B4)(this.options,"castShadow"),this.receiveShadow=(0,angular_three.B4)(this.options,"receiveShadow"),this.scale=(0,angular_three.B4)(this.options,"scale"),this.isRaycastOcclusion=(0,core.computed)((()=>{const occlude=this.occlude();return occlude&&"blending"!==occlude||Array.isArray(occlude)&&occlude.length&&angular_three.is.ref(occlude[0])})),this.shaders=(0,core.computed)((()=>({vertexShader:this.transform()?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n      void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      }\n    "}))),this.vertexShader=(0,angular_three.B4)(this.shaders,"vertexShader"),this.fragmentShader=(0,angular_three.B4)(this.shaders,"fragmentShader"),this.DoubleSide=three_core.$EB,(0,angular_three.X$)({Group:three_core.YJl,Mesh:three_core.eaF,PlaneGeometry:three_core.bdM,ShaderMaterial:three_core.BKk})}static{this.ɵfac=function NgtsHTML_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsHTML)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsHTML,selectors:[["ngts-html"]],viewQuery:function NgtsHTML_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.groupRef,_c6,5),core["ɵɵviewQuerySignal"](ctx.occlusionMeshRef,_c7,5),core["ɵɵviewQuerySignal"](ctx.occlusionGeometryRef,_c8,5)),2&rf&&core["ɵɵqueryAdvance"](3)},inputs:{options:[1,"options"]},ngContentSelectors:_c10,decls:4,vars:2,consts:[["group",""],["occlusionMesh",""],["occlusionGeometry",""],[3,"parameters"],[3,"castShadow","receiveShadow"],[3,"side","vertexShader","fragmentShader"]],template:function NgtsHTML_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](_c9),core["ɵɵelementStart"](0,"ngt-group",3,0),core["ɵɵtemplate"](2,NgtsHTML_Conditional_2_Template,6,2,"ngt-mesh",4),core["ɵɵelementEnd"](),core["ɵɵprojection"](3)),2&rf&&(core["ɵɵproperty"]("parameters",ctx.parameters()),core["ɵɵadvance"](2),core["ɵɵconditional"](ctx.occlude()&&!ctx.isRaycastOcclusion()?2:-1))},encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsHTML,[{type:core.Component,args:[{selector:"ngts-html",template:'\n\t\t<ngt-group #group [parameters]="parameters()">\n\t\t\t@if (occlude() && !isRaycastOcclusion()) {\n\t\t\t\t<ngt-mesh #occlusionMesh [castShadow]="castShadow()" [receiveShadow]="receiveShadow()">\n\t\t\t\t\t<ng-content select="[data-occlusion-geometry]">\n\t\t\t\t\t\t<ngt-plane-geometry #occlusionGeometry />\n\t\t\t\t\t</ng-content>\n\t\t\t\t\t<ng-content select="[data-occlusion-material]">\n\t\t\t\t\t\t<ngt-shader-material\n\t\t\t\t\t\t\t[side]="DoubleSide"\n\t\t\t\t\t\t\t[vertexShader]="vertexShader()"\n\t\t\t\t\t\t\t[fragmentShader]="fragmentShader()"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</ng-content>\n\t\t\t\t</ngt-mesh>\n\t\t\t}\n\t\t</ngt-group>\n\n\t\t<ng-content />\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);const v1=new three_core.Pq0,v2=new three_core.Pq0,v3=new three_core.Pq0,v4=new three_core.I9Y;function epsilon(value){return Math.abs(value)<1e-10?0:value}function getCSSMatrix(matrix,multipliers,prepend=""){let matrix3d="matrix3d(";for(let i=0;16!==i;i++)matrix3d+=epsilon(multipliers[i]*matrix.elements[i])+(15!==i?",":")");return prepend+matrix3d}const getCameraCSSMatrix=(multipliers=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],matrix=>getCSSMatrix(matrix,multipliers));var multipliers;const getObjectCSSMatrix=(matrix,factor)=>{return getCSSMatrix(matrix,[1/(f=factor),1/f,1/f,1,-1/f,-1/f,-1/f,-1,1/f,1/f,1/f,1,1,1,1,1],"translate(-50%,-50%)");var f},defaultHtmlContentOptions={eps:.001,zIndexRange:[16777271,0],pointerEvents:"auto",calculatePosition:function defaultCalculatePosition(el,camera,size){const objectPos=v1.setFromMatrixPosition(el.matrixWorld);objectPos.project(camera);const widthHalf=size.width/2,heightHalf=size.height/2;return[objectPos.x*widthHalf+widthHalf,-objectPos.y*heightHalf+heightHalf]},containerClass:"",containerStyle:{},center:!1,prepend:!1,fullscreen:!1,sprite:!1};class NgtsHTMLContent extends angular_three.tF{constructor(){super(),this.options=(0,core.input)(defaultHtmlContentOptions,{transform:(0,ngxtension_inject_inputs.sg)(defaultHtmlContentOptions),alias:"ngtsHTMLContent"}),this.occluded=(0,core.output)(),this.html=(0,core.inject)(NgtsHTML),this.transformOuterRef=(0,core.viewChild)("transformOuter"),this.transformInnerRef=(0,core.viewChild)("transformInner"),this.containerRef=(0,core.viewChild)("container"),this.gl=this.store.select("gl"),this.events=this.store.select("events"),this.camera=this.store.select("camera"),this.scene=this.store.select("scene"),this.size=this.store.select("size"),this.parent=(0,angular_three.B4)(this.options,"parent"),this.zIndexRange=(0,angular_three.B4)(this.options,"zIndexRange"),this.calculatePosition=(0,angular_three.B4)(this.options,"calculatePosition"),this.prepend=(0,angular_three.B4)(this.options,"prepend"),this.center=(0,angular_three.B4)(this.options,"center"),this.fullscreen=(0,angular_three.B4)(this.options,"fullscreen"),this.pointerEvents=(0,angular_three.B4)(this.options,"pointerEvents"),this.containerClass=(0,angular_three.B4)(this.options,"containerClass"),this.containerStyle=(0,angular_three.B4)(this.options,"containerStyle"),this.target=(0,core.computed)((()=>{const parent=(0,angular_three.qE)(this.parent());return parent||(this.events().connected||this.gl().domElement.parentNode)}));const renderer=(0,core.inject)(core.Renderer2);let isMeshSizeSet=!1;(0,core.effect)((()=>{const[occlude,canvasEl,zIndexRange]=[this.html.occlude(),(0,core.untracked)(this.gl).domElement,(0,core.untracked)(this.zIndexRange)];occlude&&"blending"===occlude?(renderer.setStyle(canvasEl,"z-index",`${Math.floor(zIndexRange[0]/2)}`),renderer.setStyle(canvasEl,"position","absolute"),renderer.setStyle(canvasEl,"pointer-events","none")):(renderer.removeStyle(canvasEl,"z-index"),renderer.removeStyle(canvasEl,"position"),renderer.removeStyle(canvasEl,"pointer-events"))})),(0,core.effect)((onCleanup=>{const[transform,target,hostEl,prepend,scene,calculatePosition,group,size,camera]=[this.html.transform(),this.target(),this.host.nativeElement,(0,core.untracked)(this.prepend),(0,core.untracked)(this.scene),(0,core.untracked)(this.calculatePosition),(0,core.untracked)(this.html.groupRef).nativeElement,(0,core.untracked)(this.size),(0,core.untracked)(this.camera)];if(scene.updateMatrixWorld(),renderer.setStyle(hostEl,"position","absolute"),renderer.setStyle(hostEl,"top","0"),renderer.setStyle(hostEl,"left","0"),transform)renderer.setStyle(hostEl,"pointer-events","none"),renderer.setStyle(hostEl,"overflow","hidden"),renderer.removeStyle(hostEl,"transform"),renderer.removeStyle(hostEl,"transform-origin");else{const vec=calculatePosition(group,camera,size);renderer.setStyle(hostEl,"transform",`translate3d(${vec[0]}px,${vec[1]}px,0)`),renderer.setStyle(hostEl,"transform-origin","0 0"),renderer.removeStyle(hostEl,"pointer-events"),renderer.removeStyle(hostEl,"overflow")}prepend?target.prepend(hostEl):target.appendChild(hostEl),onCleanup((()=>{target&&target.removeChild(hostEl)}))})),(0,core.effect)((()=>{this.options(),this.html.options();isMeshSizeSet=!1}));let visible=!0,oldZoom=0,oldPosition=[0,0];(0,angular_three.bC)((({camera:rootCamera})=>{const[hostEl,transformOuterEl,transformInnerEl,group,occlusionMesh,occlusionGeometry,isRaycastOcclusion,{camera,size,viewport,raycaster,scene},{calculatePosition,eps,zIndexRange,sprite,distanceFactor},{transform,occlude,scale}]=[this.host.nativeElement,this.transformOuterRef()?.nativeElement,this.transformInnerRef()?.nativeElement,this.html.groupRef().nativeElement,this.html.occlusionMeshRef()?.nativeElement,this.html.occlusionGeometryRef()?.nativeElement,this.html.isRaycastOcclusion(),this.store.snapshot,this.options(),this.html.options()];if(group){camera.updateMatrixWorld(),group.updateWorldMatrix(!0,!1);const vec=transform?oldPosition:calculatePosition(group,camera,size);if(transform||Math.abs(oldZoom-camera.zoom)>eps||Math.abs(oldPosition[0]-vec[0])>eps||Math.abs(oldPosition[1]-vec[1])>eps){const isBehindCamera=function isObjectBehindCamera(el,camera){const objectPos=v1.setFromMatrixPosition(el.matrixWorld),cameraPos=v2.setFromMatrixPosition(camera.matrixWorld),deltaCamObj=objectPos.sub(cameraPos),camDir=camera.getWorldDirection(v3);return deltaCamObj.angleTo(camDir)>Math.PI/2}(group,camera);let raytraceTarget=!1;isRaycastOcclusion&&(Array.isArray(occlude)?raytraceTarget=occlude.map((item=>(0,angular_three.qE)(item))):"blending"!==occlude&&(raytraceTarget=[scene]));const previouslyVisible=visible;if(raytraceTarget){const isVisible=function isObjectVisible(el,camera,raycaster,occlude){const elPos=v1.setFromMatrixPosition(el.matrixWorld),screenPos=elPos.clone();screenPos.project(camera),v4.set(screenPos.x,screenPos.y),raycaster.setFromCamera(v4,camera);const intersects=raycaster.intersectObjects(occlude,!0);if(intersects.length){const intersectionDistance=intersects[0].distance;return elPos.distanceTo(raycaster.ray.origin)<intersectionDistance}return!0}(group,camera,raycaster,raytraceTarget);visible=isVisible&&!isBehindCamera}else visible=!isBehindCamera;previouslyVisible!==visible&&(this.occluded.listeners?this.occluded.emit(!visible):renderer.setStyle(hostEl,"display",visible?"block":"none"));const halfRange=Math.floor(zIndexRange[0]/2),zRange=occlude?isRaycastOcclusion?[zIndexRange[0],halfRange]:[halfRange-1,0]:zIndexRange;if(renderer.setStyle(hostEl,"z-index",`${function objectZIndex(el,camera,zIndexRange){if(camera instanceof three_core.ubm||camera instanceof three_core.qUd){const objectPos=v1.setFromMatrixPosition(el.matrixWorld),cameraPos=v2.setFromMatrixPosition(camera.matrixWorld),dist=objectPos.distanceTo(cameraPos),A=(zIndexRange[1]-zIndexRange[0])/(camera.far-camera.near),B=zIndexRange[1]-A*camera.far;return Math.round(A*dist+B)}}(group,camera,zRange)}`),transform){const[widthHalf,heightHalf]=[size.width/2,size.height/2],fov=camera.projectionMatrix.elements[5]*heightHalf,{isOrthographicCamera,top,left,bottom,right}=camera,cameraMatrix=getCameraCSSMatrix(camera.matrixWorldInverse),cameraTransform=isOrthographicCamera?`scale(${fov})translate(${epsilon(-(right+left)/2)}px,${epsilon((top+bottom)/2)}px)`:`translateZ(${fov}px)`;let matrix=group.matrixWorld;sprite&&(matrix=camera.matrixWorldInverse.clone().transpose().copyPosition(matrix).scale(group.scale),matrix.elements[3]=matrix.elements[7]=matrix.elements[11]=0,matrix.elements[15]=1),renderer.setStyle(hostEl,"width",size.width+"px"),renderer.setStyle(hostEl,"height",size.height+"px"),renderer.setStyle(hostEl,"perspective",isOrthographicCamera?"":`${fov}px`),transformOuterEl&&transformInnerEl&&(renderer.setStyle(transformOuterEl,"transform",`${cameraTransform}${cameraMatrix}translate(${widthHalf}px,${heightHalf}px)`),renderer.setStyle(transformInnerEl,"transform",getObjectCSSMatrix(matrix,1/((distanceFactor||10)/400))))}else{const scale=void 0===distanceFactor?1:function objectScale(el,camera){if(camera instanceof three_core.qUd)return camera.zoom;if(camera instanceof three_core.ubm){const objectPos=v1.setFromMatrixPosition(el.matrixWorld),cameraPos=v2.setFromMatrixPosition(camera.matrixWorld),vFOV=camera.fov*Math.PI/180,dist=objectPos.distanceTo(cameraPos);return 1/(2*Math.tan(vFOV/2)*dist)}return 1}(group,camera)*distanceFactor;renderer.setStyle(hostEl,"transform",`translate3d(${vec[0]}px,${vec[1]}px,0) scale(${scale})`)}oldPosition=vec,oldZoom=camera.zoom}}if(!isRaycastOcclusion&&occlusionMesh&&!isMeshSizeSet)if(transform){if(transformOuterEl){const el=transformOuterEl.children[0];if(el?.clientWidth&&el?.clientHeight){const{isOrthographicCamera}=camera;if(isOrthographicCamera||occlusionGeometry)scale&&(Array.isArray(scale)?scale instanceof three_core.Pq0?occlusionMesh.scale.copy(scale.clone().divideScalar(1)):occlusionMesh.scale.set(1/scale[0],1/scale[1],1/scale[2]):occlusionMesh.scale.setScalar(1/scale));else{const ratio=(distanceFactor||10)/400,w=el.clientWidth*ratio,h=el.clientHeight*ratio;occlusionMesh.scale.set(w,h,1)}isMeshSizeSet=!0}}}else{const ele=hostEl.children[0];if(ele?.clientWidth&&ele?.clientHeight){const ratio=1/viewport.factor,w=ele.clientWidth*ratio,h=ele.clientHeight*ratio;occlusionMesh.scale.set(w,h,1),isMeshSizeSet=!0}occlusionMesh.lookAt(rootCamera.position)}}))}static{this.ɵfac=function NgtsHTMLContent_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsHTMLContent)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsHTMLContent,selectors:[["","ngtsHTMLContent",""]],viewQuery:function NgtsHTMLContent_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.transformOuterRef,_c11,5),core["ɵɵviewQuerySignal"](ctx.transformInnerRef,_c12,5),core["ɵɵviewQuerySignal"](ctx.containerRef,_c13,5)),2&rf&&core["ɵɵqueryAdvance"](3)},hostAttrs:["data-ngts-html-content",""],inputs:{options:[1,"ngtsHTMLContent","options"]},outputs:{occluded:"occluded"},features:[core["ɵɵInheritDefinitionFeature"]],attrs:_c14,ngContentSelectors:_c1,decls:4,vars:1,consts:[["content",""],["transformOuter",""],["transformInner",""],["container",""],[2,"position","absolute","top","0","left","0","transform-style","preserve-3d","pointer-events","none",3,"width","height"],[2,"position","absolute",3,"transform","top","left","width","height","class","style"],[2,"position","absolute","top","0","left","0","transform-style","preserve-3d","pointer-events","none"],[2,"position","absolute"],[3,"ngTemplateOutlet"]],template:function NgtsHTMLContent_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsHTMLContent_Conditional_0_Template,7,11,"div",4)(1,NgtsHTMLContent_Conditional_1_Template,3,15,"div",5)(2,NgtsHTMLContent_ng_template_2_Template,1,0,"ng-template",null,0,core["ɵɵtemplateRefExtractor"])),2&rf&&core["ɵɵconditional"](ctx.html.transform()?0:1)},dependencies:[common.NgTemplateOutlet],encapsulation:2,changeDetection:0})}}function injectIntersect(object,{injector,source=(0,core.signal)(!1)}={}){return(0,ngxtension_assert_injector.x)(injectIntersect,injector,(()=>{let check=!1,temp=!1;return(0,core.effect)((onCleanup=>{const obj=(0,angular_three.qE)(object());if(!obj)return;const unsub1=(0,angular_three.f7)((()=>(check=!1,!0))),oldOnRender=obj.onBeforeRender.bind(obj);obj.onBeforeRender=()=>check=!0;const unsub2=(0,angular_three.tz)((()=>(check!==temp&&source.set(temp=check),!0)));onCleanup((()=>{obj.onBeforeRender=oldOnRender,unsub1(),unsub2()}))})),source.asReadonly()}))}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsHTMLContent,[{type:core.Component,args:[{selector:"[ngtsHTMLContent]",template:'\n\t\t@if (html.transform()) {\n\t\t\t<div\n\t\t\t\t#transformOuter\n\t\t\t\tstyle="position: absolute; top: 0; left: 0; transform-style: preserve-3d; pointer-events: none;"\n\t\t\t\t[style.width.px]="size().width"\n\t\t\t\t[style.height.px]="size().height"\n\t\t\t>\n\t\t\t\t<div #transformInner style="position: absolute" [style.pointer-events]="pointerEvents()">\n\t\t\t\t\t<div #container [class]="containerClass()" [style]="containerStyle()">\n\t\t\t\t\t\t<ng-container [ngTemplateOutlet]="content" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t} @else {\n\t\t\t<div\n\t\t\t\t#container\n\t\t\t\tstyle="position:absolute"\n\t\t\t\t[style.transform]="center() ? \'translate3d(-50%,-50%,0)\' : \'none\'"\n\t\t\t\t[style.top]="fullscreen() ? -size().height / 2 + \'px\' : \'unset\'"\n\t\t\t\t[style.left]="fullscreen() ? -size().width / 2 + \'px\' : \'unset\'"\n\t\t\t\t[style.width]="fullscreen() ? size().width : \'unset\'"\n\t\t\t\t[style.height]="fullscreen() ? size().height : \'unset\'"\n\t\t\t\t[class]="containerClass()"\n\t\t\t\t[style]="containerStyle()"\n\t\t\t>\n\t\t\t\t<ng-container [ngTemplateOutlet]="content" />\n\t\t\t</div>\n\t\t}\n\n\t\t<ng-template #content>\n\t\t\t<ng-content />\n\t\t</ng-template>\n\t',changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[common.NgTemplateOutlet],host:{"data-ngts-html-content":""}}]}],(()=>[]),null);class NgtsIntersect{constructor(){this.intersect=(0,core.model)(!1);const host=(0,core.inject)(core.ElementRef);injectIntersect((()=>host),{source:this.intersect})}static{this.ɵfac=function NgtsIntersect_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsIntersect)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtsIntersect,selectors:[["","intersect",""]],inputs:{intersect:[1,"intersect"]},outputs:{intersect:"intersectChange"}})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsIntersect,[{type:core.Directive,args:[{selector:"[intersect]"}]}],(()=>[]),null);class NgtsPreload{constructor(){this.all=(0,core.model)(),this.scene=(0,core.model)(),this.camera=(0,core.model)(),this.store=(0,angular_three.ZQ)(),this.gl=this.store.select("gl"),this.defaultScene=this.store.select("scene"),this.defaultCamera=this.store.select("camera"),this.trueScene=(0,core.computed)((()=>{const scene=this.scene();return scene?(0,angular_three.qE)(scene):this.defaultScene()})),this.trueCamera=(0,core.computed)((()=>{const camera=this.camera();return camera?(0,angular_three.qE)(camera):this.defaultCamera()})),(0,core.effect)((()=>{const invisible=[],[all,scene,camera,gl]=[this.all(),this.trueScene(),this.trueCamera(),this.gl()];if(!scene||!camera)return;all&&scene.traverse((object=>{object.visible||(invisible.push(object),object.visible=!0)})),gl.compile(scene,camera);const cubeRenderTarget=new three_core.o6l(128);new three_core.F1T(.01,1e5,cubeRenderTarget).update(gl,scene),cubeRenderTarget.dispose(),invisible.forEach((object=>object.visible=!1))}))}static{this.ɵfac=function NgtsPreload_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsPreload)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtsPreload,selectors:[["ngts-preload"]],inputs:{all:[1,"all"],scene:[1,"scene"],camera:[1,"camera"]},outputs:{all:"allChange",scene:"sceneChange",camera:"cameraChange"}})}}function injectSurfaceSampler(mesh,options=()=>({}),{injector}={}){return(0,ngxtension_assert_injector.x)(injectSurfaceSampler,injector,(()=>{const initialBufferAttribute=(()=>{const arr=Array.from({length:options().count??16},(()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])).flat();return new three_core.uWO(Float32Array.from(arr),16)})();return(0,core.computed)((()=>{const currentMesh=(0,angular_three.qE)(mesh());if(!currentMesh)return initialBufferAttribute;const localState=(0,angular_three.h3)(currentMesh);if(!localState)return initialBufferAttribute;const nonObjects=localState.nonObjects();if(!nonObjects||!nonObjects.length||nonObjects.every((nonObject=>!nonObject.isBufferGeometry)))return initialBufferAttribute;const sampler=new MeshSurfaceSampler(currentMesh),{weight,count=16,transform,instanceMesh}=options();weight&&sampler.setWeightAttribute(weight),sampler.build();const position=new three_core.Pq0,normal=new three_core.Pq0,color=new three_core.Q1f,dummy=new three_core.B69,instance=(0,angular_three.qE)(instanceMesh);currentMesh.updateMatrixWorld(!0);for(let i=0;i<count;i++)sampler.sample(position,normal,color),"function"==typeof transform?transform({dummy,sampledMesh:currentMesh,position,normal,color},i):dummy.position.copy(position),dummy.updateMatrix(),instance&&instance.setMatrixAt(i,dummy.matrix),dummy.matrix.toArray(initialBufferAttribute.array,16*i);return instance&&(0,angular_three.Ug)(instance.instanceMatrix),(0,angular_three.Ug)(initialBufferAttribute),new three_core.uWO(initialBufferAttribute.array,initialBufferAttribute.itemSize).copy(initialBufferAttribute)}))}))}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsPreload,[{type:core.Directive,args:[{selector:"ngts-preload"}]}],(()=>[]),null);const defaultOptions={count:16};class NgtsSampler{constructor(){this.mesh=(0,core.input)(null),this.instances=(0,core.input)(null),this.options=(0,core.input)(defaultOptions,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions)}),this.parameters=(0,angular_three.cJ)(this.options,["weight","transform","count"]),this.groupRef=(0,core.viewChild)("group"),(0,angular_three.X$)({Group:three_core.YJl});const sampleState=(0,core.computed)((()=>{const group=this.groupRef()?.nativeElement,localState=(0,angular_three.h3)(group);if(!localState)return{mesh:null,instanced:null};const[mesh,instances]=[(0,angular_three.qE)(this.mesh()),(0,angular_three.qE)(this.instances())],objects=localState.objects();return{mesh:mesh??objects.find((c=>"Mesh"===c.type)),instanced:instances??objects.find((c=>!!Object.getOwnPropertyDescriptor(c,"instanceMatrix")))}})),meshToSample=(0,angular_three.B4)(sampleState,"mesh"),instancedToSample=(0,angular_three.B4)(sampleState,"instanced"),sampler=injectSurfaceSampler(meshToSample,(()=>({count:this.options().count,transform:this.options().transform,weight:this.options().weight,instanceMesh:instancedToSample()})));(0,core.effect)(sampler)}static{this.ɵfac=function NgtsSampler_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsSampler)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsSampler,selectors:[["ngts-sampler"]],viewQuery:function NgtsSampler_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.groupRef,_c6,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{mesh:[1,"mesh"],instances:[1,"instances"],options:[1,"options"]},ngContentSelectors:_c1,decls:3,vars:1,consts:[["group",""],[3,"parameters"]],template:function NgtsSampler_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-group",1,0),core["ɵɵprojection"](2),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("parameters",ctx.parameters())},encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsSampler,[{type:core.Component,args:[{selector:"ngts-sampler",template:'\n\t\t<ngt-group #group [parameters]="parameters()">\n\t\t\t<ng-content />\n\t\t</ngt-group>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);new three_core.Pq0,new three_core.Pq0,new three_core.Pq0;function shaderMaterial(uniforms,vertexShader,fragmentShader,onInit){const entries=Object.entries(uniforms);class Material extends three_core.BKk{constructor(parameters){super({uniforms:entries.reduce(((acc,[name,value])=>({...acc,...three_core.LlO.clone({[name]:{value}})})),{}),vertexShader,fragmentShader});for(const[name]of entries)Object.defineProperty(this,name,{get:()=>this.uniforms[name].value,set:v=>this.uniforms[name].value=v});Object.assign(this,parameters),null==onInit||onInit(this)}}return Material.key=three_core.cj9.generateUUID(),Material}function countToIntFormat(count){switch(count){case 1:return three_core.ZQM;case 2:return three_core.TkQ;case 3:case 4:return three_core.c90}}class VertexAttributeTexture extends three_core.GYF{constructor(){super(),this.minFilter=three_core.hxR,this.magFilter=three_core.hxR,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(attr){const overrideItemSize=this.overrideItemSize,originalItemSize=attr.itemSize,originalCount=attr.count;if(null!==overrideItemSize){if(originalItemSize*originalCount%overrideItemSize!=0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");attr.itemSize=overrideItemSize,attr.count=originalCount*originalItemSize/overrideItemSize}const itemSize=attr.itemSize,count=attr.count,normalized=attr.normalized,originalBufferCons=attr.array.constructor,byteCount=originalBufferCons.BYTES_PER_ELEMENT;let type,format,normalizeValue,targetBufferCons,targetType=this._forcedType,finalStride=itemSize;if(null===targetType)switch(originalBufferCons){case Float32Array:targetType=three_core.RQf;break;case Uint8Array:case Uint16Array:case Uint32Array:targetType=three_core.bkx;break;case Int8Array:case Int16Array:case Int32Array:targetType=three_core.Yuy}let internalFormat=function countToStringFormat(count){switch(count){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw new Error}(itemSize);switch(targetType){case three_core.RQf:normalizeValue=1,format=function countToFormat(count){switch(count){case 1:return three_core.VT0;case 2:return three_core.paN;case 3:case 4:return three_core.GWd}}(itemSize),normalized&&1===byteCount?(targetBufferCons=originalBufferCons,internalFormat+="8",originalBufferCons===Uint8Array?type=three_core.OUM:(type=three_core.tJf,internalFormat+="_SNORM")):(targetBufferCons=Float32Array,internalFormat+="32F",type=three_core.RQf);break;case three_core.Yuy:internalFormat+=8*byteCount+"I",normalizeValue=normalized?Math.pow(2,8*originalBufferCons.BYTES_PER_ELEMENT-1):1,format=countToIntFormat(itemSize),1===byteCount?(targetBufferCons=Int8Array,type=three_core.tJf):2===byteCount?(targetBufferCons=Int16Array,type=three_core.fBL):(targetBufferCons=Int32Array,type=three_core.Yuy);break;case three_core.bkx:internalFormat+=8*byteCount+"UI",normalizeValue=normalized?Math.pow(2,8*originalBufferCons.BYTES_PER_ELEMENT-1):1,format=countToIntFormat(itemSize),1===byteCount?(targetBufferCons=Uint8Array,type=three_core.OUM):2===byteCount?(targetBufferCons=Uint16Array,type=three_core.cHt):(targetBufferCons=Uint32Array,type=three_core.bkx)}3!==finalStride||format!==three_core.GWd&&format!==three_core.c90||(finalStride=4);const dimension=Math.ceil(Math.sqrt(count))||1,dataArray=new targetBufferCons(finalStride*dimension*dimension),originalNormalized=attr.normalized;attr.normalized=!1;for(let i=0;i<count;i++){const ii=finalStride*i;dataArray[ii]=attr.getX(i)/normalizeValue,itemSize>=2&&(dataArray[ii+1]=attr.getY(i)/normalizeValue),itemSize>=3&&(dataArray[ii+2]=attr.getZ(i)/normalizeValue,4===finalStride&&(dataArray[ii+3]=1)),itemSize>=4&&(dataArray[ii+3]=attr.getW(i)/normalizeValue)}attr.normalized=originalNormalized,this.internalFormat=internalFormat,this.format=format,this.type=type,this.image.width=dimension,this.image.height=dimension,this.image.data=dataArray,this.needsUpdate=!0,this.dispose(),attr.itemSize=originalItemSize,attr.count=originalCount}}class UIntVertexAttributeTexture extends VertexAttributeTexture{constructor(){super(),this._forcedType=three_core.bkx}}class FloatVertexAttributeTexture extends VertexAttributeTexture{constructor(){super(),this._forcedType=three_core.RQf}}Math.pow(2,-24),Symbol("SKIP_GENERATION");function IS_LEAF(n16,uint16Array){return 65535===uint16Array[n16+15]}function OFFSET(n32,uint32Array){return uint32Array[n32+6]}function COUNT(n16,uint16Array){return uint16Array[n16+14]}function RIGHT_NODE(n32,uint32Array){return uint32Array[n32+6]}function SPLIT_AXIS(n32,uint32Array){return uint32Array[n32+7]}function getVertexCount(geo){return geo.index?geo.index.count:geo.attributes.position.count}function getIndexArray(vertexCount,BufferConstructor=ArrayBuffer){return vertexCount>65535?new Uint32Array(new BufferConstructor(4*vertexCount)):new Uint16Array(new BufferConstructor(2*vertexCount))}const GridMaterial=shaderMaterial({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new three_core.Q1f,sectionColor:new three_core.Q1f,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new three_core.Pq0,worldPlanePosition:new three_core.Pq0},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n\n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform float cellSize;\n    uniform float sectionSize;\n    uniform vec3 cellColor;\n    uniform vec3 sectionColor;\n    uniform float fadeDistance;\n    uniform float fadeStrength;\n    uniform float fadeFrom;\n    uniform float cellThickness;\n    uniform float sectionThickness;\n\n    float getGrid(float size, float thickness) {\n      vec2 r = localPosition.xz / size;\n      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n      float line = min(grid.x, grid.y) + 1.0 - thickness;\n      return 1.0 - min(line, 1.0);\n    }\n\n    void main() {\n      float g1 = getGrid(cellSize, cellThickness);\n      float g2 = getGrid(sectionSize, sectionThickness);\n\n      vec3 from = worldCamProjPosition*vec3(fadeFrom);\n      float dist = distance(from, worldPosition.xyz);\n      float d = 1.0 - min(dist / fadeDistance, 1.0);\n      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));\n\n      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));\n      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n      if (gl_FragColor.a <= 0.0) discard;\n\n      #include <tonemapping_fragment>\n      #include <${getVersion()>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `);shaderMaterial({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new class MeshBVHUniformStruct{constructor(){this.index=new UIntVertexAttributeTexture,this.position=new FloatVertexAttributeTexture,this.bvhBounds=new three_core.GYF,this.bvhContents=new three_core.GYF,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(bvh){const{geometry}=bvh;if(function bvhToTextures(bvh,boundsTexture,contentsTexture){const roots=bvh._roots;if(1!==roots.length)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const root=roots[0],uint16Array=new Uint16Array(root),uint32Array=new Uint32Array(root),float32Array=new Float32Array(root),nodeCount=root.byteLength/32,boundsDimension=2*Math.ceil(Math.sqrt(nodeCount/2)),boundsArray=new Float32Array(4*boundsDimension*boundsDimension),contentsDimension=Math.ceil(Math.sqrt(nodeCount)),contentsArray=new Uint32Array(2*contentsDimension*contentsDimension);for(let i=0;i<nodeCount;i++){const nodeIndex32=32*i/4,nodeIndex16=2*nodeIndex32,boundsIndex=nodeIndex32;for(let b=0;b<3;b++)boundsArray[8*i+0+b]=float32Array[boundsIndex+0+b],boundsArray[8*i+4+b]=float32Array[boundsIndex+3+b];if(IS_LEAF(nodeIndex16,uint16Array)){const count=COUNT(nodeIndex16,uint16Array),offset=OFFSET(nodeIndex32,uint32Array),mergedLeafCount=4294901760|count;contentsArray[2*i+0]=mergedLeafCount,contentsArray[2*i+1]=offset}else{const rightIndex=4*RIGHT_NODE(nodeIndex32,uint32Array)/32,splitAxis=SPLIT_AXIS(nodeIndex32,uint32Array);contentsArray[2*i+0]=splitAxis,contentsArray[2*i+1]=rightIndex}}boundsTexture.image.data=boundsArray,boundsTexture.image.width=boundsDimension,boundsTexture.image.height=boundsDimension,boundsTexture.format=three_core.GWd,boundsTexture.type=three_core.RQf,boundsTexture.internalFormat="RGBA32F",boundsTexture.minFilter=three_core.hxR,boundsTexture.magFilter=three_core.hxR,boundsTexture.generateMipmaps=!1,boundsTexture.needsUpdate=!0,boundsTexture.dispose(),contentsTexture.image.data=contentsArray,contentsTexture.image.width=contentsDimension,contentsTexture.image.height=contentsDimension,contentsTexture.format=three_core.TkQ,contentsTexture.type=three_core.bkx,contentsTexture.internalFormat="RG32UI",contentsTexture.minFilter=three_core.hxR,contentsTexture.magFilter=three_core.hxR,contentsTexture.generateMipmaps=!1,contentsTexture.needsUpdate=!0,contentsTexture.dispose()}(bvh,this.bvhBounds,this.bvhContents),this.position.updateFrom(geometry.attributes.position),bvh.indirect){const indirectBuffer=bvh._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==indirectBuffer.length)if(geometry.index)this._cachedIndexAttr=geometry.index.clone();else{const array=getIndexArray(getVertexCount(geometry));this._cachedIndexAttr=new three_core.THS(array,1,!1)}!function dereferenceIndex(geometry,indirectBuffer,target){const unpacked=target.array,indexArray=geometry.index?geometry.index.array:null;for(let i=0,l=indirectBuffer.length;i<l;i++){const i3=3*i,v3=3*indirectBuffer[i];for(let c=0;c<3;c++)unpacked[i3+c]=indexArray?indexArray[v3+c]:v3+c}}(geometry,indirectBuffer,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(geometry.index)}dispose(){const{index,position,bvhBounds,bvhContents}=this;index&&index.dispose(),position&&position.dispose(),bvhBounds&&bvhBounds.dispose(),bvhContents&&bvhContents.dispose()}},color:new three_core.Q1f("white"),opacity:1,resolution:new three_core.I9Y,viewMatrixInverse:new three_core.kn4,projectionMatrixInverse:new three_core.kn4},"\n  uniform mat4 viewMatrixInverse;\n\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n  varying mat4 vModelMatrixInverse;\n\n  #include <color_pars_vertex>\n\n  void main() {\n    #include <color_vertex>\n\n    vec4 transformedNormal = vec4(normal, 0.0);\n    vec4 transformedPosition = vec4(position, 1.0);\n    #ifdef USE_INSTANCING\n      transformedNormal = instanceMatrix * transformedNormal;\n      transformedPosition = instanceMatrix * transformedPosition;\n    #endif\n\n    #ifdef USE_INSTANCING\n      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);\n    #else\n      vModelMatrixInverse = inverse(modelMatrix);\n    #endif\n\n    vWorldPosition = (modelMatrix * transformedPosition).xyz;\n    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;\n  }",`\n  #define ENVMAP_TYPE_CUBE_UV\n  precision highp isampler2D;\n  precision highp usampler2D;\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n  varying mat4 vModelMatrixInverse;\n\n  #include <color_pars_fragment>\n\n  #ifdef ENVMAP_TYPE_CUBEM\n    uniform samplerCube envMap;\n  #else\n    uniform sampler2D envMap;\n  #endif\n\n  uniform float bounces;\n  \nstruct BVH {\n\n\tusampler2D index;\n\tsampler2D position;\n\n\tsampler2D bvhBounds;\n\tusampler2D bvhContents;\n\n};\n\n  \n\t\n\n// A stack of uint32 indices can can store the indices for\n// a perfectly balanced tree with a depth up to 31. Lower stack\n// depth gets higher performance.\n//\n// However not all trees are balanced. Best value to set this to\n// is the trees max depth.\n#ifndef BVH_STACK_DEPTH\n#define BVH_STACK_DEPTH 60\n#endif\n\n#ifndef INFINITY\n#define INFINITY 1e20\n#endif\n\n// Utilities\nuvec4 uTexelFetch1D( usampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nivec4 iTexelFetch1D( isampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 texelFetch1D( sampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {\n\n\treturn\n\t\tbarycoord.x * texelFetch1D( tex, faceIndices.x ) +\n\t\tbarycoord.y * texelFetch1D( tex, faceIndices.y ) +\n\t\tbarycoord.z * texelFetch1D( tex, faceIndices.z );\n\n}\n\nvoid ndcToCameraRay(\n\tvec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,\n\tout vec3 rayOrigin, out vec3 rayDirection\n) {\n\n\t// get camera look direction and near plane for camera clipping\n\tvec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );\n\tvec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );\n\tfloat near = abs( nearVector.z / nearVector.w );\n\n\t// get the camera direction and position from camera matrices\n\tvec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );\n\tdirection /= direction.w;\n\tdirection = cameraWorld * direction - origin;\n\n\t// slide the origin along the ray until it sits at the near clip plane position\n\torigin.xyz += direction.xyz * near / dot( direction, lookDirection );\n\n\trayOrigin = origin.xyz;\n\trayDirection = direction.xyz;\n\n}\n\n\t\n\n#ifndef TRI_INTERSECT_EPSILON\n#define TRI_INTERSECT_EPSILON 1e-5\n#endif\n\n// Raycasting\nbool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {\n\n\t// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/\n\t// https://tavianator.com/2011/ray_box.html\n\tvec3 invDir = 1.0 / rayDirection;\n\n\t// find intersection distances for each plane\n\tvec3 tMinPlane = invDir * ( boundsMin - rayOrigin );\n\tvec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );\n\n\t// get the min and max distances from each intersection\n\tvec3 tMinHit = min( tMaxPlane, tMinPlane );\n\tvec3 tMaxHit = max( tMaxPlane, tMinPlane );\n\n\t// get the furthest hit distance\n\tvec2 t = max( tMinHit.xx, tMinHit.yz );\n\tfloat t0 = max( t.x, t.y );\n\n\t// get the minimum hit distance\n\tt = min( tMaxHit.xx, tMaxHit.yz );\n\tfloat t1 = min( t.x, t.y );\n\n\t// set distance to 0.0 if the ray starts inside the box\n\tdist = max( t0, 0.0 );\n\n\treturn t1 >= dist;\n\n}\n\nbool intersectsTriangle(\n\tvec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,\n\tout vec3 barycoord, out vec3 norm, out float dist, out float side\n) {\n\n\t// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d\n\tvec3 edge1 = b - a;\n\tvec3 edge2 = c - a;\n\tnorm = cross( edge1, edge2 );\n\n\tfloat det = - dot( rayDirection, norm );\n\tfloat invdet = 1.0 / det;\n\n\tvec3 AO = rayOrigin - a;\n\tvec3 DAO = cross( AO, rayDirection );\n\n\tvec4 uvt;\n\tuvt.x = dot( edge2, DAO ) * invdet;\n\tuvt.y = - dot( edge1, DAO ) * invdet;\n\tuvt.z = dot( AO, norm ) * invdet;\n\tuvt.w = 1.0 - uvt.x - uvt.y;\n\n\t// set the hit information\n\tbarycoord = uvt.wxy; // arranged in A, B, C order\n\tdist = uvt.z;\n\tside = sign( det );\n\tnorm = side * normalize( norm );\n\n\t// add an epsilon to avoid misses between triangles\n\tuvt += vec4( TRI_INTERSECT_EPSILON );\n\n\treturn all( greaterThanEqual( uvt, vec4( 0.0 ) ) );\n\n}\n\nbool intersectTriangles(\n\t// geometry info and triangle range\n\tsampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// outputs\n\tinout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\tbool found = false;\n\tvec3 localBarycoord, localNormal;\n\tfloat localDist, localSide;\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\n\n\t\tuvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;\n\t\tvec3 a = texelFetch1D( positionAttr, indices.x ).rgb;\n\t\tvec3 b = texelFetch1D( positionAttr, indices.y ).rgb;\n\t\tvec3 c = texelFetch1D( positionAttr, indices.z ).rgb;\n\n\t\tif (\n\t\t\tintersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )\n\t\t\t&& localDist < minDistance\n\t\t) {\n\n\t\t\tfound = true;\n\t\t\tminDistance = localDist;\n\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\n\t\t\tfaceNormal = localNormal;\n\n\t\t\tside = localSide;\n\t\t\tbarycoord = localBarycoord;\n\t\t\tdist = localDist;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\nbool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {\n\n\tuint cni2 = currNodeIndex * 2u;\n\tvec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;\n\tvec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;\n\treturn intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );\n\n}\n\n// use a macro to hide the fact that we need to expand the struct into separate fields\n#define\tbvhIntersectFirstHit(\t\tbvh,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\t_bvhIntersectFirstHit(\t\tbvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\n\nbool _bvhIntersectFirstHit(\n\t// bvh info\n\tsampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// output variables split into separate variables due to output precision\n\tinout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\t// stack needs to be twice as long as the deepest tree we expect because\n\t// we push both the left and right child onto the stack every traversal\n\tint ptr = 0;\n\tuint stack[ BVH_STACK_DEPTH ];\n\tstack[ 0 ] = 0u;\n\n\tfloat triangleDistance = INFINITY;\n\tbool found = false;\n\twhile ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {\n\n\t\tuint currNodeIndex = stack[ ptr ];\n\t\tptr --;\n\n\t\t// check if we intersect the current bounds\n\t\tfloat boundsHitDistance;\n\t\tif (\n\t\t\t! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )\n\t\t\t|| boundsHitDistance > triangleDistance\n\t\t) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\n\n\t\tif ( isLeaf ) {\n\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint offset = boundsInfo.y;\n\n\t\t\tfound = intersectTriangles(\n\t\t\t\tbvh_position, bvh_index, offset, count,\n\t\t\t\trayOrigin, rayDirection, triangleDistance,\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, dist\n\t\t\t) || found;\n\n\t\t} else {\n\n\t\t\tuint leftIndex = currNodeIndex + 1u;\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint rightIndex = boundsInfo.y;\n\n\t\t\tbool leftToRight = rayDirection[ splitAxis ] >= 0.0;\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\n\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\n\t\t\t// traversed first\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c2;\n\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c1;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\n\n  uniform BVH bvh;\n  uniform float ior;\n  uniform bool correctMips;\n  uniform vec2 resolution;\n  uniform float fresnel;\n  uniform mat4 modelMatrix;\n  uniform mat4 projectionMatrixInverse;\n  uniform mat4 viewMatrixInverse;\n  uniform float aberrationStrength;\n  uniform vec3 color;\n  uniform float opacity;\n\n  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {\n    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );\n  }\n\n  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {\n    vec3 rayOrigin = ro;\n    vec3 rayDirection = rd;\n    rayDirection = refract(rayDirection, normal, 1.0 / ior);\n    rayOrigin = vWorldPosition + rayDirection * 0.001;\n    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;\n    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);\n    for(float i = 0.0; i < bounces; i++) {\n      uvec4 faceIndices = uvec4( 0u );\n      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n      vec3 barycoord = vec3( 0.0 );\n      float side = 1.0;\n      float dist = 0.0;\n      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );\n      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);\n      vec3 tempDir = refract(rayDirection, faceNormal, ior);\n      if (length(tempDir) != 0.0) {\n        rayDirection = tempDir;\n        break;\n      }\n      rayDirection = reflect(rayDirection, faceNormal);\n      rayOrigin = hitPos + rayDirection * 0.01;\n    }\n    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);\n    return rayDirection;\n  }\n\n  #include <common>\n  #include <cube_uv_reflection_fragment>\n\n  #ifdef ENVMAP_TYPE_CUBEM\n    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));\n    }\n  #else\n    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      vec2 uvv = equirectUv( rayDirection );\n      vec2 smoothUv = equirectUv( directionCamPerfect );\n      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));\n    }\n  #endif\n\n  void main() {\n    vec2 uv = gl_FragCoord.xy / resolution;\n    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;\n    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;\n    directionCamPerfect = normalize(directionCamPerfect);\n    vec3 normal = vNormal;\n    vec3 rayOrigin = cameraPosition;\n    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);\n\n    vec4 diffuseColor = vec4(color, opacity);\n    #include <color_fragment>\n\n    #ifdef CHROMATIC_ABERRATIONS\n      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);\n      #ifdef FAST_CHROMA\n        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));\n        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));\n      #else\n        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);\n        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);\n      #endif\n      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;\n      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;\n      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;\n      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);\n    #else\n      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);\n      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;\n    #endif\n\n    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);\n    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;\n    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);\n\n    #include <tonemapping_fragment>\n    #include <${getVersion()>=154?"colorspace_fragment":"encodings_fragment"}>\n  }`),getVersion();three_core.BH$;__webpack_require__("./node_modules/process/browser.js");function workerBootstrap(){var modules=Object.create(null);function registerModule(ref,callback){var id=ref.id,name=ref.name,dependencies=ref.dependencies;void 0===dependencies&&(dependencies=[]);var init=ref.init;void 0===init&&(init=function(){});var getTransferables=ref.getTransferables;if(void 0===getTransferables&&(getTransferables=null),!modules[id])try{dependencies=dependencies.map((function(dep){return dep&&dep.isWorkerModule&&(registerModule(dep,(function(depResult){if(depResult instanceof Error)throw depResult})),dep=modules[dep.id].value),dep})),init=rehydrate("<"+name+">.init",init),getTransferables&&(getTransferables=rehydrate("<"+name+">.getTransferables",getTransferables));var value=null;"function"==typeof init?value=init.apply(void 0,dependencies):console.error("worker module init function failed to rehydrate"),modules[id]={id,value,getTransferables},callback(value)}catch(err){err&&err.noLog||console.error(err),callback(err)}}function rehydrate(name,str){var result=void 0;self.troikaDefine=function(r){return result=r};var url=URL.createObjectURL(new Blob(["/** "+name.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+str+"\n)"],{type:"application/javascript"}));try{importScripts(url)}catch(err){console.error(err)}return URL.revokeObjectURL(url),delete self.troikaDefine,result}self.addEventListener("message",(function(e){var ref=e.data,messageId=ref.messageId,action=ref.action,data=ref.data;try{"registerModule"===action&&registerModule(data,(function(result){result instanceof Error?postMessage({messageId,success:!1,error:result.message}):postMessage({messageId,success:!0,result:{isCallable:"function"==typeof result}})})),"callModule"===action&&function callModule(ref,callback){var ref$1,id=ref.id,args=ref.args;modules[id]&&"function"==typeof modules[id].value||callback(new Error("Worker module "+id+": not found or its 'init' did not return a function"));try{var result=(ref$1=modules[id]).value.apply(ref$1,args);result&&"function"==typeof result.then?result.then(handleResult,(function(rej){return callback(rej instanceof Error?rej:new Error(""+rej))})):handleResult(result)}catch(err){callback(err)}function handleResult(result){try{var tx=modules[id].getTransferables&&modules[id].getTransferables(result);tx&&Array.isArray(tx)&&tx.length||(tx=void 0),callback(result,tx)}catch(err){console.error(err),callback(err)}}}(data,(function(result,transferables){result instanceof Error?postMessage({messageId,success:!1,error:result.message}):postMessage({messageId,success:!0,result},transferables||void 0)}))}catch(err){postMessage({messageId,success:!1,error:err.stack})}}))}var supportsWorkers=function(){var supported=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),supported=!0}catch(err){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+err.message+"]")}return supportsWorkers=function(){return supported},supported},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(options){if(!(options&&"function"==typeof options.init||_allowInitAsString))throw new Error("requires `options.init` function");var dependencies=options.dependencies,init=options.init,getTransferables=options.getTransferables,workerId=options.workerId,onMainThread=function defineMainThreadModule(options){var moduleFunc=function(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];return moduleFunc._getInitResult().then((function(initResult){if("function"==typeof initResult)return initResult.apply(void 0,args);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return moduleFunc._getInitResult=function(){var dependencies=options.dependencies,init=options.init;dependencies=Array.isArray(dependencies)?dependencies.map((function(dep){return dep&&(dep=dep.onMainThread||dep)._getInitResult&&(dep=dep._getInitResult()),dep})):[];var initPromise=Promise.all(dependencies).then((function(deps){return init.apply(null,deps)}));return moduleFunc._getInitResult=function(){return initPromise},initPromise},moduleFunc}(options);null==workerId&&(workerId="#default");var id="workerModule"+ ++_workerModuleId,name=options.name||id,registrationPromise=null;function moduleFunc(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];if(!supportsWorkers())return onMainThread.apply(void 0,args);if(!registrationPromise){registrationPromise=callWorker(workerId,"registerModule",moduleFunc.workerModuleData);var unregister=function(){registrationPromise=null,registeredModules[workerId].delete(unregister)};(registeredModules[workerId]||(registeredModules[workerId]=new Set)).add(unregister)}return registrationPromise.then((function(ref){if(ref.isCallable)return callWorker(workerId,"callModule",{id,args});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return dependencies=dependencies&&dependencies.map((function(dep){return"function"!=typeof dep||dep.workerModuleData||(_allowInitAsString=!0,dep=defineWorkerModule({workerId,name:"<"+name+"> function dependency: "+dep.name,init:"function(){return (\n"+stringifyFunction(dep)+"\n)}"}),_allowInitAsString=!1),dep&&dep.workerModuleData&&(dep=dep.workerModuleData),dep})),moduleFunc.workerModuleData={isWorkerModule:!0,id,name,dependencies,init:stringifyFunction(init),getTransferables:getTransferables&&stringifyFunction(getTransferables)},moduleFunc.onMainThread=onMainThread,moduleFunc}function stringifyFunction(fn){var str=fn.toString();return!/^function/.test(str)&&/^\w+\s*\(/.test(str)&&(str="function "+str),str}function callWorker(workerId,action,data){return new Promise((function(resolve,reject){var messageId=++_messageId;openRequests[messageId]=function(response){response.success?resolve(response.result):reject(new Error("Error in worker "+action+" call: "+response.error))},function getWorker(workerId){var worker=workers[workerId];if(!worker){var bootstrap=stringifyFunction(workerBootstrap);(worker=workers[workerId]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+workerId.replace(/\*/g,"")+" **/\n\n;("+bootstrap+")()"],{type:"application/javascript"})))).onmessage=function(e){var response=e.data,msgId=response.messageId,callback=openRequests[msgId];if(!callback)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[msgId],callback(response)}}return worker}(workerId).postMessage({messageId,action,data})}))}function SDFGenerator(){var exports=function(exports){function pointOnCubicBezier(x0,y0,x1,y1,x2,y2,x3,y3,t,pointOut){var t2=1-t;pointOut.x=t2*t2*t2*x0+3*t2*t2*t*x1+3*t2*t*t*x2+t*t*t*x3,pointOut.y=t2*t2*t2*y0+3*t2*t2*t*y1+3*t2*t*t*y2+t*t*t*y3}function forEachPathCommand(pathString,commandCallback){for(var match,firstX,firstY,prevX,prevY,segmentRE=/([MLQCZ])([^MLQCZ]*)/g;match=segmentRE.exec(pathString);){var args=match[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(v){return parseFloat(v)}));switch(match[1]){case"M":prevX=firstX=args[0],prevY=firstY=args[1];break;case"L":args[0]===prevX&&args[1]===prevY||commandCallback("L",prevX,prevY,prevX=args[0],prevY=args[1]);break;case"Q":commandCallback("Q",prevX,prevY,prevX=args[2],prevY=args[3],args[0],args[1]);break;case"C":commandCallback("C",prevX,prevY,prevX=args[4],prevY=args[5],args[0],args[1],args[2],args[3]);break;case"Z":prevX===firstX&&prevY===firstY||commandCallback("L",prevX,prevY,firstX,firstY)}}}function pathToLineSegments(pathString,segmentCallback,curvePoints){void 0===curvePoints&&(curvePoints=16);var tempPoint={x:0,y:0};forEachPathCommand(pathString,(function(command,startX,startY,endX,endY,ctrl1X,ctrl1Y,ctrl2X,ctrl2Y){switch(command){case"L":segmentCallback(startX,startY,endX,endY);break;case"Q":for(var prevCurveX=startX,prevCurveY=startY,i=1;i<curvePoints;i++)y0=startY,y1=ctrl1Y,y2=endY,t2=void 0,t2=1-(t=i/(curvePoints-1)),(pointOut=tempPoint).x=t2*t2*startX+2*t2*t*ctrl1X+t*t*endX,pointOut.y=t2*t2*y0+2*t2*t*y1+t*t*y2,segmentCallback(prevCurveX,prevCurveY,tempPoint.x,tempPoint.y),prevCurveX=tempPoint.x,prevCurveY=tempPoint.y;break;case"C":for(var prevCurveX$1=startX,prevCurveY$1=startY,i$1=1;i$1<curvePoints;i$1++)pointOnCubicBezier(startX,startY,ctrl1X,ctrl1Y,ctrl2X,ctrl2Y,endX,endY,i$1/(curvePoints-1),tempPoint),segmentCallback(prevCurveX$1,prevCurveY$1,tempPoint.x,tempPoint.y),prevCurveX$1=tempPoint.x,prevCurveY$1=tempPoint.y}var y0,y1,y2,t,pointOut,t2}))}var viewportQuadVertex="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",cache=new WeakMap,glContextParams={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function withWebGLContext(glOrCanvas,callback){var gl=glOrCanvas.getContext?glOrCanvas.getContext("webgl",glContextParams):glOrCanvas,wrapper=cache.get(gl);if(!wrapper){var isWebGL2="undefined"!=typeof WebGL2RenderingContext&&gl instanceof WebGL2RenderingContext,extensions={},programs={},textures={},textureUnit=-1,framebufferStack=[];function getExtension(name){var ext=extensions[name];if(!ext&&!(ext=extensions[name]=gl.getExtension(name)))throw new Error(name+" not supported");return ext}function compileShader(src,type){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function withProgram(name,vert,frag,func){if(!programs[name]){var attributes={},uniforms={},program=gl.createProgram();gl.attachShader(program,compileShader(vert,gl.VERTEX_SHADER)),gl.attachShader(program,compileShader(frag,gl.FRAGMENT_SHADER)),gl.linkProgram(program),programs[name]={program,transaction:function transaction(func){gl.useProgram(program),func({setUniform:function setUniform(type,name){for(var values=[],len=arguments.length-2;len-- >0;)values[len]=arguments[len+2];var uniformLoc=uniforms[name]||(uniforms[name]=gl.getUniformLocation(program,name));gl["uniform"+type].apply(gl,[uniformLoc].concat(values))},setAttribute:function setAttribute(name,size,usage,instancingDivisor,data){var attr=attributes[name];attr||(attr=attributes[name]={buf:gl.createBuffer(),loc:gl.getAttribLocation(program,name),data:null}),gl.bindBuffer(gl.ARRAY_BUFFER,attr.buf),gl.vertexAttribPointer(attr.loc,size,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(attr.loc),isWebGL2?gl.vertexAttribDivisor(attr.loc,instancingDivisor):getExtension("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(attr.loc,instancingDivisor),data!==attr.data&&(gl.bufferData(gl.ARRAY_BUFFER,data,usage),attr.data=data)}})}}}programs[name].transaction(func)}function withTexture(name,func){textureUnit++;try{gl.activeTexture(gl.TEXTURE0+textureUnit);var texture=textures[name];texture||(texture=textures[name]=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)),gl.bindTexture(gl.TEXTURE_2D,texture),func(texture,textureUnit)}finally{textureUnit--}}function withTextureFramebuffer(texture,textureUnit,func){var framebuffer=gl.createFramebuffer();framebufferStack.push(framebuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.activeTexture(gl.TEXTURE0+textureUnit),gl.bindTexture(gl.TEXTURE_2D,texture),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);try{func(framebuffer)}finally{gl.deleteFramebuffer(framebuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,framebufferStack[--framebufferStack.length-1]||null)}}function handleContextLoss(){extensions={},programs={},textures={},textureUnit=-1,framebufferStack.length=0}gl.canvas.addEventListener("webglcontextlost",(function(e){handleContextLoss(),e.preventDefault()}),!1),cache.set(gl,wrapper={gl,isWebGL2,getExtension,withProgram,withTexture,withTextureFramebuffer,handleContextLoss})}callback(wrapper)}function renderImageData(glOrCanvas,imageData,x,y,width,height,channels,framebuffer){void 0===channels&&(channels=15),void 0===framebuffer&&(framebuffer=null),withWebGLContext(glOrCanvas,(function(ref){var gl=ref.gl,withProgram=ref.withProgram;(0,ref.withTexture)("copy",(function(tex,texUnit){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,imageData),withProgram("copy",viewportQuadVertex,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",(function(ref){var setUniform=ref.setUniform;(0,ref.setAttribute)("aUV",2,gl.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),setUniform("1i","image",texUnit),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer||null),gl.disable(gl.BLEND),gl.colorMask(8&channels,4&channels,2&channels,1&channels),gl.viewport(x,y,width,height),gl.scissor(x,y,width,height),gl.drawArrays(gl.TRIANGLES,0,3)}))}))}))}var webglUtils=Object.freeze({__proto__:null,withWebGLContext,renderImageData,resizeWebGLCanvasWithoutClearing:function resizeWebGLCanvasWithoutClearing(canvas,newWidth,newHeight){var width=canvas.width,height=canvas.height;withWebGLContext(canvas,(function(ref){var gl=ref.gl,data=new Uint8Array(width*height*4);gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,data),canvas.width=newWidth,canvas.height=newHeight,renderImageData(gl,data,0,0,width,height)}))}});function generate$2(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent){void 0===sdfExponent&&(sdfExponent=1);var textureData=new Uint8Array(sdfWidth*sdfHeight),viewBoxWidth=viewBox[2]-viewBox[0],viewBoxHeight=viewBox[3]-viewBox[1],segments=[];pathToLineSegments(path,(function(x1,y1,x2,y2){segments.push({x1,y1,x2,y2,minX:Math.min(x1,x2),minY:Math.min(y1,y2),maxX:Math.max(x1,x2),maxY:Math.max(y1,y2)})})),segments.sort((function(a,b){return a.maxX-b.maxX}));for(var sdfX=0;sdfX<sdfWidth;sdfX++)for(var sdfY=0;sdfY<sdfHeight;sdfY++){var signedDist=findNearestSignedDistance(viewBox[0]+viewBoxWidth*(sdfX+.5)/sdfWidth,viewBox[1]+viewBoxHeight*(sdfY+.5)/sdfHeight),alpha=Math.pow(1-Math.abs(signedDist)/maxDistance,sdfExponent)/2;signedDist<0&&(alpha=1-alpha),alpha=Math.max(0,Math.min(255,Math.round(255*alpha))),textureData[sdfY*sdfWidth+sdfX]=alpha}return textureData;function findNearestSignedDistance(x,y){for(var closestDistSq=1/0,closestDist=1/0,i=segments.length;i--;){var seg=segments[i];if(seg.maxX+closestDist<=x)break;if(x+closestDist>seg.minX&&y-closestDist<seg.maxY&&y+closestDist>seg.minY){var distSq=absSquareDistanceToLineSegment(x,y,seg.x1,seg.y1,seg.x2,seg.y2);distSq<closestDistSq&&(closestDistSq=distSq,closestDist=Math.sqrt(closestDistSq))}}return function isPointInPoly(x,y){for(var winding=0,i=segments.length;i--;){var seg=segments[i];if(seg.maxX<=x)break;seg.y1>y!=seg.y2>y&&x<(seg.x2-seg.x1)*(y-seg.y1)/(seg.y2-seg.y1)+seg.x1&&(winding+=seg.y1<seg.y2?1:-1)}return 0!==winding}(x,y)&&(closestDist=-closestDist),closestDist}}function generateIntoCanvas$2(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0),generateIntoFramebuffer$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,null,x,y,channel)}function generateIntoFramebuffer$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,glOrCanvas,framebuffer,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0);for(var data=generate$2(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent),rgbaData=new Uint8Array(4*data.length),i=0;i<data.length;i++)rgbaData[4*i+channel]=data[i];renderImageData(glOrCanvas,rgbaData,x,y,sdfWidth,sdfHeight,1<<3-channel,framebuffer)}function absSquareDistanceToLineSegment(x,y,lineX0,lineY0,lineX1,lineY1){var ldx=lineX1-lineX0,ldy=lineY1-lineY0,lengthSq=ldx*ldx+ldy*ldy,t=lengthSq?Math.max(0,Math.min(1,((x-lineX0)*ldx+(y-lineY0)*ldy)/lengthSq)):0,dx=x-(lineX0+t*ldx),dy=y-(lineY0+t*ldy);return dx*dx+dy*dy}var javascript=Object.freeze({__proto__:null,generate:generate$2,generateIntoCanvas:generateIntoCanvas$2,generateIntoFramebuffer:generateIntoFramebuffer$1}),viewportUVs=new Float32Array([0,0,2,0,0,2]),implicitContext=null,isTestingSupport=!1,NULL_OBJECT={},supportByCanvas=new WeakMap;function validateSupport(glOrCanvas){if(!isTestingSupport&&!isSupported(glOrCanvas))throw new Error("WebGL generation not supported")}function generate$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,glOrCanvas){if(void 0===sdfExponent&&(sdfExponent=1),void 0===glOrCanvas&&(glOrCanvas=null),!glOrCanvas&&!(glOrCanvas=implicitContext)){var canvas="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!canvas)throw new Error("OffscreenCanvas or DOM canvas not supported");glOrCanvas=implicitContext=canvas.getContext("webgl",{depth:!1})}validateSupport(glOrCanvas);var rgbaData=new Uint8Array(sdfWidth*sdfHeight*4);withWebGLContext(glOrCanvas,(function(ref){var gl=ref.gl,withTexture=ref.withTexture,withTextureFramebuffer=ref.withTextureFramebuffer;withTexture("readable",(function(texture,textureUnit){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,sdfWidth,sdfHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null),withTextureFramebuffer(texture,textureUnit,(function(framebuffer){generateIntoFramebuffer(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,gl,framebuffer,0,0,0),gl.readPixels(0,0,sdfWidth,sdfHeight,gl.RGBA,gl.UNSIGNED_BYTE,rgbaData)}))}))}));for(var data=new Uint8Array(sdfWidth*sdfHeight),i=0,j=0;i<rgbaData.length;i+=4)data[j++]=rgbaData[i];return data}function generateIntoCanvas$1(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0),generateIntoFramebuffer(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,null,x,y,channel)}function generateIntoFramebuffer(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,glOrCanvas,framebuffer,x,y,channel){void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0),validateSupport(glOrCanvas);var lineSegmentCoords=[];pathToLineSegments(path,(function(x1,y1,x2,y2){lineSegmentCoords.push(x1,y1,x2,y2)})),lineSegmentCoords=new Float32Array(lineSegmentCoords),withWebGLContext(glOrCanvas,(function(ref){var gl=ref.gl,isWebGL2=ref.isWebGL2,getExtension=ref.getExtension,withProgram=ref.withProgram,withTexture=ref.withTexture,withTextureFramebuffer=ref.withTextureFramebuffer,handleContextLoss=ref.handleContextLoss;if(withTexture("rawDistances",(function(intermediateTexture,intermediateTextureUnit){sdfWidth===intermediateTexture._lastWidth&&sdfHeight===intermediateTexture._lastHeight||gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,intermediateTexture._lastWidth=sdfWidth,intermediateTexture._lastHeight=sdfHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null),withProgram("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",(function(ref){var setAttribute=ref.setAttribute,setUniform=ref.setUniform,instancingExtension=!isWebGL2&&getExtension("ANGLE_instanced_arrays"),blendMinMaxExtension=!isWebGL2&&getExtension("EXT_blend_minmax");setAttribute("aUV",2,gl.STATIC_DRAW,0,viewportUVs),setAttribute("aLineSegment",4,gl.DYNAMIC_DRAW,1,lineSegmentCoords),setUniform.apply(void 0,["4f","uGlyphBounds"].concat(viewBox)),setUniform("1f","uMaxDistance",maxDistance),setUniform("1f","uExponent",sdfExponent),withTextureFramebuffer(intermediateTexture,intermediateTextureUnit,(function(framebuffer){gl.enable(gl.BLEND),gl.colorMask(!0,!0,!0,!0),gl.viewport(0,0,sdfWidth,sdfHeight),gl.scissor(0,0,sdfWidth,sdfHeight),gl.blendFunc(gl.ONE,gl.ONE),gl.blendEquationSeparate(gl.FUNC_ADD,isWebGL2?gl.MAX:blendMinMaxExtension.MAX_EXT),gl.clear(gl.COLOR_BUFFER_BIT),isWebGL2?gl.drawArraysInstanced(gl.TRIANGLES,0,3,lineSegmentCoords.length/4):instancingExtension.drawArraysInstancedANGLE(gl.TRIANGLES,0,3,lineSegmentCoords.length/4)}))})),withProgram("post",viewportQuadVertex,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",(function(program){program.setAttribute("aUV",2,gl.STATIC_DRAW,0,viewportUVs),program.setUniform("1i","tex",intermediateTextureUnit),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.disable(gl.BLEND),gl.colorMask(0===channel,1===channel,2===channel,3===channel),gl.viewport(x,y,sdfWidth,sdfHeight),gl.scissor(x,y,sdfWidth,sdfHeight),gl.drawArrays(gl.TRIANGLES,0,3)}))})),gl.isContextLost())throw handleContextLoss(),new Error("webgl context lost")}))}function isSupported(glOrCanvas){var key=glOrCanvas&&glOrCanvas!==implicitContext?glOrCanvas.canvas||glOrCanvas:NULL_OBJECT,supported=supportByCanvas.get(key);if(void 0===supported){isTestingSupport=!0;var failReason=null;try{var expectedResult=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],testResult=generate$1(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,glOrCanvas);supported=testResult&&expectedResult.length===testResult.length&&testResult.every((function(val,i){return val===expectedResult[i]})),supported||(failReason="bad trial run results",console.info(expectedResult,testResult))}catch(err){supported=!1,failReason=err.message}failReason&&console.warn("WebGL SDF generation not supported:",failReason),isTestingSupport=!1,supportByCanvas.set(key,supported)}return supported}var webgl=Object.freeze({__proto__:null,generate:generate$1,generateIntoCanvas:generateIntoCanvas$1,generateIntoFramebuffer,isSupported});return exports.forEachPathCommand=forEachPathCommand,exports.generate=function generate(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent){void 0===maxDistance&&(maxDistance=Math.max(viewBox[2]-viewBox[0],viewBox[3]-viewBox[1])/2),void 0===sdfExponent&&(sdfExponent=1);try{return generate$1.apply(webgl,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),generate$2.apply(javascript,arguments)}},exports.generateIntoCanvas=function generateIntoCanvas(sdfWidth,sdfHeight,path,viewBox,maxDistance,sdfExponent,canvas,x,y,channel){void 0===maxDistance&&(maxDistance=Math.max(viewBox[2]-viewBox[0],viewBox[3]-viewBox[1])/2),void 0===sdfExponent&&(sdfExponent=1),void 0===x&&(x=0),void 0===y&&(y=0),void 0===channel&&(channel=0);try{return generateIntoCanvas$1.apply(webgl,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),generateIntoCanvas$2.apply(javascript,arguments)}},exports.javascript=javascript,exports.pathToLineSegments=pathToLineSegments,exports.webgl=webgl,exports.webglUtils=webglUtils,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({});return exports}const bidi=function bidiFactory(){var bidi=function(exports){var DATA={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},TYPES={},TYPES_TO_NAMES={};TYPES.L=1,TYPES_TO_NAMES[1]="L",Object.keys(DATA).forEach((function(type,i){TYPES[type]=1<<i+1,TYPES_TO_NAMES[TYPES[type]]=type})),Object.freeze(TYPES);var ISOLATE_INIT_TYPES=TYPES.LRI|TYPES.RLI|TYPES.FSI,STRONG_TYPES=TYPES.L|TYPES.R|TYPES.AL,NEUTRAL_ISOLATE_TYPES=TYPES.B|TYPES.S|TYPES.WS|TYPES.ON|TYPES.FSI|TYPES.LRI|TYPES.RLI|TYPES.PDI,BN_LIKE_TYPES=TYPES.BN|TYPES.RLE|TYPES.LRE|TYPES.RLO|TYPES.LRO|TYPES.PDF,TRAILING_TYPES=TYPES.S|TYPES.WS|TYPES.B|ISOLATE_INIT_TYPES|TYPES.PDI|BN_LIKE_TYPES,map=null;function getBidiCharType(char){return function parseData(){if(!map){map=new Map;var loop=function(type){if(DATA.hasOwnProperty(type)){var lastCode=0;DATA[type].split(",").forEach((function(range){var ref=range.split("+"),skip=ref[0],step=ref[1];skip=parseInt(skip,36),step=step?parseInt(step,36):0,map.set(lastCode+=skip,TYPES[type]);for(var i=0;i<step;i++)map.set(++lastCode,TYPES[type])}))}};for(var type in DATA)loop(type)}}(),map.get(char.codePointAt(0))||TYPES.L}var openToClose,closeToOpen,canonical,data$1_pairs="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",data$1_canonical="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function parseCharacterMap(encodedString,includeReverse){var prevPair,lastCode=0,map=new Map,reverseMap=includeReverse&&new Map;return encodedString.split(",").forEach((function visit(entry){if(-1!==entry.indexOf("+"))for(var i=+entry;i--;)visit(prevPair);else{prevPair=entry;var ref=entry.split(">"),a=ref[0],b=ref[1];a=String.fromCodePoint(lastCode+=parseInt(a,36)),b=String.fromCodePoint(lastCode+=parseInt(b,36)),map.set(a,b),includeReverse&&reverseMap.set(b,a)}})),{map,reverseMap}}function parse$1(){if(!openToClose){var ref=parseCharacterMap(data$1_pairs,!0),map=ref.map,reverseMap=ref.reverseMap;openToClose=map,closeToOpen=reverseMap,canonical=parseCharacterMap(data$1_canonical,!1).map}}function openingToClosingBracket(char){return parse$1(),openToClose.get(char)||null}function closingToOpeningBracket(char){return parse$1(),closeToOpen.get(char)||null}function getCanonicalBracket(char){return parse$1(),canonical.get(char)||null}var TYPE_L=TYPES.L,TYPE_R=TYPES.R,TYPE_EN=TYPES.EN,TYPE_ES=TYPES.ES,TYPE_ET=TYPES.ET,TYPE_AN=TYPES.AN,TYPE_CS=TYPES.CS,TYPE_B=TYPES.B,TYPE_S=TYPES.S,TYPE_ON=TYPES.ON,TYPE_BN=TYPES.BN,TYPE_NSM=TYPES.NSM,TYPE_AL=TYPES.AL,TYPE_LRO=TYPES.LRO,TYPE_RLO=TYPES.RLO,TYPE_LRE=TYPES.LRE,TYPE_RLE=TYPES.RLE,TYPE_PDF=TYPES.PDF,TYPE_LRI=TYPES.LRI,TYPE_RLI=TYPES.RLI,TYPE_FSI=TYPES.FSI,TYPE_PDI=TYPES.PDI;var mirrorMap;function getMirroredCharacter(char){return function parse(){if(!mirrorMap){var ref=parseCharacterMap("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),map=ref.map;ref.reverseMap.forEach((function(value,key){map.set(key,value)})),mirrorMap=map}}(),mirrorMap.get(char)||null}function getReorderSegments(string,embeddingLevelsResult,start,end){var strLen=string.length;start=Math.max(0,null==start?0:+start),end=Math.min(strLen-1,null==end?strLen-1:+end);var segments=[];return embeddingLevelsResult.paragraphs.forEach((function(paragraph){var lineStart=Math.max(start,paragraph.start),lineEnd=Math.min(end,paragraph.end);if(lineStart<lineEnd){for(var lineLevels=embeddingLevelsResult.levels.slice(lineStart,lineEnd+1),i=lineEnd;i>=lineStart&&getBidiCharType(string[i])&TRAILING_TYPES;i--)lineLevels[i]=paragraph.level;for(var maxLevel=paragraph.level,minOddLevel=1/0,i$1=0;i$1<lineLevels.length;i$1++){var level=lineLevels[i$1];level>maxLevel&&(maxLevel=level),level<minOddLevel&&(minOddLevel=1|level)}for(var lvl=maxLevel;lvl>=minOddLevel;lvl--)for(var i$2=0;i$2<lineLevels.length;i$2++)if(lineLevels[i$2]>=lvl){for(var segStart=i$2;i$2+1<lineLevels.length&&lineLevels[i$2+1]>=lvl;)i$2++;i$2>segStart&&segments.push([segStart+lineStart,i$2+lineStart])}}})),segments}function getReorderedIndices(string,embedLevelsResult,start,end){for(var segments=getReorderSegments(string,embedLevelsResult,start,end),indices=[],i=0;i<string.length;i++)indices[i]=i;return segments.forEach((function(ref){for(var start=ref[0],end=ref[1],slice=indices.slice(start,end+1),i=slice.length;i--;)indices[end-i]=slice[i]})),indices}return exports.closingToOpeningBracket=closingToOpeningBracket,exports.getBidiCharType=getBidiCharType,exports.getBidiCharTypeName=function getBidiCharTypeName(char){return TYPES_TO_NAMES[getBidiCharType(char)]},exports.getCanonicalBracket=getCanonicalBracket,exports.getEmbeddingLevels=function getEmbeddingLevels(string,baseDirection){for(var charTypes=new Uint32Array(string.length),i=0;i<string.length;i++)charTypes[i]=getBidiCharType(string[i]);var charTypeCounts=new Map;function changeCharType(i,type){var oldType=charTypes[i];charTypes[i]=type,charTypeCounts.set(oldType,charTypeCounts.get(oldType)-1),oldType&NEUTRAL_ISOLATE_TYPES&&charTypeCounts.set(NEUTRAL_ISOLATE_TYPES,charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)-1),charTypeCounts.set(type,(charTypeCounts.get(type)||0)+1),type&NEUTRAL_ISOLATE_TYPES&&charTypeCounts.set(NEUTRAL_ISOLATE_TYPES,(charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)||0)+1)}for(var embedLevels=new Uint8Array(string.length),isolationPairs=new Map,paragraphs=[],paragraph=null,i$1=0;i$1<string.length;i$1++)paragraph||paragraphs.push(paragraph={start:i$1,end:string.length-1,level:"rtl"===baseDirection?1:"ltr"===baseDirection?0:determineAutoEmbedLevel(i$1,!1)}),charTypes[i$1]&TYPE_B&&(paragraph.end=i$1,paragraph=null);for(var FORMATTING_TYPES=TYPE_RLE|TYPE_LRE|TYPE_RLO|TYPE_LRO|ISOLATE_INIT_TYPES|TYPE_PDI|TYPE_PDF|TYPE_B,nextEven=function(n){return n+(1&n?1:2)},nextOdd=function(n){return n+(1&n?2:1)},paraIdx=0;paraIdx<paragraphs.length;paraIdx++){var statusStack=[{_level:(paragraph=paragraphs[paraIdx]).level,_override:0,_isolate:0}],stackTop=void 0,overflowIsolateCount=0,overflowEmbeddingCount=0,validIsolateCount=0;charTypeCounts.clear();for(var i$2=paragraph.start;i$2<=paragraph.end;i$2++){var charType=charTypes[i$2];if(stackTop=statusStack[statusStack.length-1],charTypeCounts.set(charType,(charTypeCounts.get(charType)||0)+1),charType&NEUTRAL_ISOLATE_TYPES&&charTypeCounts.set(NEUTRAL_ISOLATE_TYPES,(charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)||0)+1),charType&FORMATTING_TYPES)if(charType&(TYPE_RLE|TYPE_LRE)){embedLevels[i$2]=stackTop._level;var level=(charType===TYPE_RLE?nextOdd:nextEven)(stackTop._level);level<=125&&!overflowIsolateCount&&!overflowEmbeddingCount?statusStack.push({_level:level,_override:0,_isolate:0}):overflowIsolateCount||overflowEmbeddingCount++}else if(charType&(TYPE_RLO|TYPE_LRO)){embedLevels[i$2]=stackTop._level;var level$1=(charType===TYPE_RLO?nextOdd:nextEven)(stackTop._level);level$1<=125&&!overflowIsolateCount&&!overflowEmbeddingCount?statusStack.push({_level:level$1,_override:charType&TYPE_RLO?TYPE_R:TYPE_L,_isolate:0}):overflowIsolateCount||overflowEmbeddingCount++}else if(charType&ISOLATE_INIT_TYPES){charType&TYPE_FSI&&(charType=1===determineAutoEmbedLevel(i$2+1,!0)?TYPE_RLI:TYPE_LRI),embedLevels[i$2]=stackTop._level,stackTop._override&&changeCharType(i$2,stackTop._override);var level$2=(charType===TYPE_RLI?nextOdd:nextEven)(stackTop._level);level$2<=125&&0===overflowIsolateCount&&0===overflowEmbeddingCount?(validIsolateCount++,statusStack.push({_level:level$2,_override:0,_isolate:1,_isolInitIndex:i$2})):overflowIsolateCount++}else if(charType&TYPE_PDI){if(overflowIsolateCount>0)overflowIsolateCount--;else if(validIsolateCount>0){for(overflowEmbeddingCount=0;!statusStack[statusStack.length-1]._isolate;)statusStack.pop();var isolInitIndex=statusStack[statusStack.length-1]._isolInitIndex;null!=isolInitIndex&&(isolationPairs.set(isolInitIndex,i$2),isolationPairs.set(i$2,isolInitIndex)),statusStack.pop(),validIsolateCount--}stackTop=statusStack[statusStack.length-1],embedLevels[i$2]=stackTop._level,stackTop._override&&changeCharType(i$2,stackTop._override)}else charType&TYPE_PDF?(0===overflowIsolateCount&&(overflowEmbeddingCount>0?overflowEmbeddingCount--:!stackTop._isolate&&statusStack.length>1&&(statusStack.pop(),stackTop=statusStack[statusStack.length-1])),embedLevels[i$2]=stackTop._level):charType&TYPE_B&&(embedLevels[i$2]=paragraph.level);else embedLevels[i$2]=stackTop._level,stackTop._override&&charType!==TYPE_BN&&changeCharType(i$2,stackTop._override)}for(var levelRuns=[],currentRun=null,i$3=paragraph.start;i$3<=paragraph.end;i$3++){var charType$1=charTypes[i$3];if(!(charType$1&BN_LIKE_TYPES)){var lvl=embedLevels[i$3],isIsolInit=charType$1&ISOLATE_INIT_TYPES,isPDI=charType$1===TYPE_PDI;currentRun&&lvl===currentRun._level?(currentRun._end=i$3,currentRun._endsWithIsolInit=isIsolInit):levelRuns.push(currentRun={_start:i$3,_end:i$3,_level:lvl,_startsWithPDI:isPDI,_endsWithIsolInit:isIsolInit})}}for(var isolatingRunSeqs=[],runIdx=0;runIdx<levelRuns.length;runIdx++){var run=levelRuns[runIdx];if(!run._startsWithPDI||run._startsWithPDI&&!isolationPairs.has(run._start)){for(var seqRuns=[currentRun=run],pdiIndex=void 0;currentRun&&currentRun._endsWithIsolInit&&null!=(pdiIndex=isolationPairs.get(currentRun._end));)for(var i$4=runIdx+1;i$4<levelRuns.length;i$4++)if(levelRuns[i$4]._start===pdiIndex){seqRuns.push(currentRun=levelRuns[i$4]);break}for(var seqIndices=[],i$5=0;i$5<seqRuns.length;i$5++)for(var run$1=seqRuns[i$5],j=run$1._start;j<=run$1._end;j++)seqIndices.push(j);for(var firstLevel=embedLevels[seqIndices[0]],prevLevel=paragraph.level,i$6=seqIndices[0]-1;i$6>=0;i$6--)if(!(charTypes[i$6]&BN_LIKE_TYPES)){prevLevel=embedLevels[i$6];break}var lastIndex=seqIndices[seqIndices.length-1],lastLevel=embedLevels[lastIndex],nextLevel=paragraph.level;if(!(charTypes[lastIndex]&ISOLATE_INIT_TYPES))for(var i$7=lastIndex+1;i$7<=paragraph.end;i$7++)if(!(charTypes[i$7]&BN_LIKE_TYPES)){nextLevel=embedLevels[i$7];break}isolatingRunSeqs.push({_seqIndices:seqIndices,_sosType:Math.max(prevLevel,firstLevel)%2?TYPE_R:TYPE_L,_eosType:Math.max(nextLevel,lastLevel)%2?TYPE_R:TYPE_L})}}for(var seqIdx=0;seqIdx<isolatingRunSeqs.length;seqIdx++){var ref=isolatingRunSeqs[seqIdx],seqIndices$1=ref._seqIndices,sosType=ref._sosType,eosType=ref._eosType,embedDirection=1&embedLevels[seqIndices$1[0]]?TYPE_R:TYPE_L;if(charTypeCounts.get(TYPE_NSM))for(var si=0;si<seqIndices$1.length;si++){var i$8=seqIndices$1[si];if(charTypes[i$8]&TYPE_NSM){for(var prevType=sosType,sj=si-1;sj>=0;sj--)if(!(charTypes[seqIndices$1[sj]]&BN_LIKE_TYPES)){prevType=charTypes[seqIndices$1[sj]];break}changeCharType(i$8,prevType&(ISOLATE_INIT_TYPES|TYPE_PDI)?TYPE_ON:prevType)}}if(charTypeCounts.get(TYPE_EN))for(var si$1=0;si$1<seqIndices$1.length;si$1++){var i$9=seqIndices$1[si$1];if(charTypes[i$9]&TYPE_EN)for(var sj$1=si$1-1;sj$1>=-1;sj$1--){var prevCharType=-1===sj$1?sosType:charTypes[seqIndices$1[sj$1]];if(prevCharType&STRONG_TYPES){prevCharType===TYPE_AL&&changeCharType(i$9,TYPE_AN);break}}}if(charTypeCounts.get(TYPE_AL))for(var si$2=0;si$2<seqIndices$1.length;si$2++){var i$10=seqIndices$1[si$2];charTypes[i$10]&TYPE_AL&&changeCharType(i$10,TYPE_R)}if(charTypeCounts.get(TYPE_ES)||charTypeCounts.get(TYPE_CS))for(var si$3=1;si$3<seqIndices$1.length-1;si$3++){var i$11=seqIndices$1[si$3];if(charTypes[i$11]&(TYPE_ES|TYPE_CS)){for(var prevType$1=0,nextType=0,sj$2=si$3-1;sj$2>=0&&(prevType$1=charTypes[seqIndices$1[sj$2]])&BN_LIKE_TYPES;sj$2--);for(var sj$3=si$3+1;sj$3<seqIndices$1.length&&(nextType=charTypes[seqIndices$1[sj$3]])&BN_LIKE_TYPES;sj$3++);prevType$1===nextType&&(charTypes[i$11]===TYPE_ES?prevType$1===TYPE_EN:prevType$1&(TYPE_EN|TYPE_AN))&&changeCharType(i$11,prevType$1)}}if(charTypeCounts.get(TYPE_EN))for(var si$4=0;si$4<seqIndices$1.length;si$4++){var i$12=seqIndices$1[si$4];if(charTypes[i$12]&TYPE_EN){for(var sj$4=si$4-1;sj$4>=0&&charTypes[seqIndices$1[sj$4]]&(TYPE_ET|BN_LIKE_TYPES);sj$4--)changeCharType(seqIndices$1[sj$4],TYPE_EN);for(si$4++;si$4<seqIndices$1.length&&charTypes[seqIndices$1[si$4]]&(TYPE_ET|BN_LIKE_TYPES|TYPE_EN);si$4++)charTypes[seqIndices$1[si$4]]!==TYPE_EN&&changeCharType(seqIndices$1[si$4],TYPE_EN)}}if(charTypeCounts.get(TYPE_ET)||charTypeCounts.get(TYPE_ES)||charTypeCounts.get(TYPE_CS))for(var si$5=0;si$5<seqIndices$1.length;si$5++){var i$13=seqIndices$1[si$5];if(charTypes[i$13]&(TYPE_ET|TYPE_ES|TYPE_CS)){changeCharType(i$13,TYPE_ON);for(var sj$5=si$5-1;sj$5>=0&&charTypes[seqIndices$1[sj$5]]&BN_LIKE_TYPES;sj$5--)changeCharType(seqIndices$1[sj$5],TYPE_ON);for(var sj$6=si$5+1;sj$6<seqIndices$1.length&&charTypes[seqIndices$1[sj$6]]&BN_LIKE_TYPES;sj$6++)changeCharType(seqIndices$1[sj$6],TYPE_ON)}}if(charTypeCounts.get(TYPE_EN))for(var si$6=0,prevStrongType=sosType;si$6<seqIndices$1.length;si$6++){var i$14=seqIndices$1[si$6],type=charTypes[i$14];type&TYPE_EN?prevStrongType===TYPE_L&&changeCharType(i$14,TYPE_L):type&STRONG_TYPES&&(prevStrongType=type)}if(charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)){for(var R_TYPES_FOR_N_STEPS=TYPE_R|TYPE_EN|TYPE_AN,STRONG_TYPES_FOR_N_STEPS=R_TYPES_FOR_N_STEPS|TYPE_L,bracketPairs=[],openerStack=[],si$7=0;si$7<seqIndices$1.length;si$7++)if(charTypes[seqIndices$1[si$7]]&NEUTRAL_ISOLATE_TYPES){var char=string[seqIndices$1[si$7]],oppositeBracket=void 0;if(null!==openingToClosingBracket(char)){if(!(openerStack.length<63))break;openerStack.push({char,seqIndex:si$7})}else if(null!==(oppositeBracket=closingToOpeningBracket(char)))for(var stackIdx=openerStack.length-1;stackIdx>=0;stackIdx--){var stackChar=openerStack[stackIdx].char;if(stackChar===oppositeBracket||stackChar===closingToOpeningBracket(getCanonicalBracket(char))||openingToClosingBracket(getCanonicalBracket(stackChar))===char){bracketPairs.push([openerStack[stackIdx].seqIndex,si$7]),openerStack.length=stackIdx;break}}}bracketPairs.sort((function(a,b){return a[0]-b[0]}));for(var pairIdx=0;pairIdx<bracketPairs.length;pairIdx++){for(var ref$1=bracketPairs[pairIdx],openSeqIdx=ref$1[0],closeSeqIdx=ref$1[1],foundStrongType=!1,useStrongType=0,si$8=openSeqIdx+1;si$8<closeSeqIdx;si$8++){var i$15=seqIndices$1[si$8];if(charTypes[i$15]&STRONG_TYPES_FOR_N_STEPS){foundStrongType=!0;var lr=charTypes[i$15]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;if(lr===embedDirection){useStrongType=lr;break}}}if(foundStrongType&&!useStrongType){useStrongType=sosType;for(var si$9=openSeqIdx-1;si$9>=0;si$9--){var i$16=seqIndices$1[si$9];if(charTypes[i$16]&STRONG_TYPES_FOR_N_STEPS){var lr$1=charTypes[i$16]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;useStrongType=lr$1!==embedDirection?lr$1:embedDirection;break}}}if(useStrongType){if(charTypes[seqIndices$1[openSeqIdx]]=charTypes[seqIndices$1[closeSeqIdx]]=useStrongType,useStrongType!==embedDirection)for(var si$10=openSeqIdx+1;si$10<seqIndices$1.length;si$10++)if(!(charTypes[seqIndices$1[si$10]]&BN_LIKE_TYPES)){getBidiCharType(string[seqIndices$1[si$10]])&TYPE_NSM&&(charTypes[seqIndices$1[si$10]]=useStrongType);break}if(useStrongType!==embedDirection)for(var si$11=closeSeqIdx+1;si$11<seqIndices$1.length;si$11++)if(!(charTypes[seqIndices$1[si$11]]&BN_LIKE_TYPES)){getBidiCharType(string[seqIndices$1[si$11]])&TYPE_NSM&&(charTypes[seqIndices$1[si$11]]=useStrongType);break}}}for(var si$12=0;si$12<seqIndices$1.length;si$12++)if(charTypes[seqIndices$1[si$12]]&NEUTRAL_ISOLATE_TYPES){for(var niRunStart=si$12,niRunEnd=si$12,prevType$2=sosType,si2=si$12-1;si2>=0;si2--){if(!(charTypes[seqIndices$1[si2]]&BN_LIKE_TYPES)){prevType$2=charTypes[seqIndices$1[si2]]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;break}niRunStart=si2}for(var nextType$1=eosType,si2$1=si$12+1;si2$1<seqIndices$1.length;si2$1++){if(!(charTypes[seqIndices$1[si2$1]]&(NEUTRAL_ISOLATE_TYPES|BN_LIKE_TYPES))){nextType$1=charTypes[seqIndices$1[si2$1]]&R_TYPES_FOR_N_STEPS?TYPE_R:TYPE_L;break}niRunEnd=si2$1}for(var sj$7=niRunStart;sj$7<=niRunEnd;sj$7++)charTypes[seqIndices$1[sj$7]]=prevType$2===nextType$1?prevType$2:embedDirection;si$12=niRunEnd}}}for(var i$17=paragraph.start;i$17<=paragraph.end;i$17++){var level$3=embedLevels[i$17],type$1=charTypes[i$17];if(1&level$3?type$1&(TYPE_L|TYPE_EN|TYPE_AN)&&embedLevels[i$17]++:type$1&TYPE_R?embedLevels[i$17]++:type$1&(TYPE_AN|TYPE_EN)&&(embedLevels[i$17]+=2),type$1&BN_LIKE_TYPES&&(embedLevels[i$17]=0===i$17?paragraph.level:embedLevels[i$17-1]),i$17===paragraph.end||getBidiCharType(string[i$17])&(TYPE_S|TYPE_B))for(var j$1=i$17;j$1>=0&&getBidiCharType(string[j$1])&TRAILING_TYPES;j$1--)embedLevels[j$1]=paragraph.level}}return{levels:embedLevels,paragraphs};function determineAutoEmbedLevel(start,isFSI){for(var i=start;i<string.length;i++){var charType=charTypes[i];if(charType&(TYPE_R|TYPE_AL))return 1;if(charType&(TYPE_B|TYPE_L)||isFSI&&charType===TYPE_PDI)return 0;if(charType&ISOLATE_INIT_TYPES){var pdi=indexOfMatchingPDI(i);i=-1===pdi?string.length:pdi}}return 0}function indexOfMatchingPDI(isolateStart){for(var isolationLevel=1,i=isolateStart+1;i<string.length;i++){var charType=charTypes[i];if(charType&TYPE_B)break;if(charType&TYPE_PDI){if(0==--isolationLevel)return i}else charType&ISOLATE_INIT_TYPES&&isolationLevel++}return-1}},exports.getMirroredCharacter=getMirroredCharacter,exports.getMirroredCharactersMap=function getMirroredCharactersMap(string,embeddingLevels,start,end){var strLen=string.length;start=Math.max(0,null==start?0:+start),end=Math.min(strLen-1,null==end?strLen-1:+end);for(var map=new Map,i=start;i<=end;i++)if(1&embeddingLevels[i]){var mirror=getMirroredCharacter(string[i]);null!==mirror&&map.set(i,mirror)}return map},exports.getReorderSegments=getReorderSegments,exports.getReorderedIndices=getReorderedIndices,exports.getReorderedString=function getReorderedString(string,embedLevelsResult,start,end){var indices=getReorderedIndices(string,embedLevelsResult,start,end),chars=[].concat(string);return indices.forEach((function(charIndex,i){chars[i]=(1&embedLevelsResult.levels[charIndex]?getMirroredCharacter(string[charIndex]):null)||string[charIndex]})),chars.join("")},exports.openingToClosingBracket=openingToClosingBracket,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({});return bidi},voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(source){return source.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function replace(match,include){let chunk=three_module.ShaderChunk[include];return chunk?expandShaderIncludes(chunk):match}))}const _lut=[];for(let i=0;i<256;i++)_lut[i]=(i<16?"0":"")+i.toString(16);const troika_three_utils_esm_assign=Object.assign||function(){let target=arguments[0];for(let i=1,len=arguments.length;i<len;i++){let source=arguments[i];if(source)for(let prop in source)Object.prototype.hasOwnProperty.call(source,prop)&&(target[prop]=source[prop])}return target},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(baseMaterial,options){const optionsKey=function getKeyForOptions(options){const optionsHash=JSON.stringify(options,optionsJsonReplacer);let id=optionsHashesToIds.get(optionsHash);null==id&&optionsHashesToIds.set(optionsHash,id=++_idCtr);return id}(options);let ctorsByDerivation=CONSTRUCTOR_CACHE.get(baseMaterial);if(ctorsByDerivation||CONSTRUCTOR_CACHE.set(baseMaterial,ctorsByDerivation=Object.create(null)),ctorsByDerivation[optionsKey])return new ctorsByDerivation[optionsKey];const privateBeforeCompileProp=`_onBeforeCompile${optionsKey}`,onBeforeCompile=function(shaderInfo,renderer){baseMaterial.onBeforeCompile.call(this,shaderInfo,renderer);const cacheKey=this.customProgramCacheKey()+"|"+shaderInfo.vertexShader+"|"+shaderInfo.fragmentShader;let upgradedShaders=SHADER_UPGRADE_CACHE[cacheKey];if(!upgradedShaders){const upgraded=function upgradeShaders(material,{vertexShader,fragmentShader},options,key){let{vertexDefs,vertexMainIntro,vertexMainOutro,vertexTransform,fragmentDefs,fragmentMainIntro,fragmentMainOutro,fragmentColorTransform,customRewriter,timeUniform}=options;vertexDefs=vertexDefs||"",vertexMainIntro=vertexMainIntro||"",vertexMainOutro=vertexMainOutro||"",fragmentDefs=fragmentDefs||"",fragmentMainIntro=fragmentMainIntro||"",fragmentMainOutro=fragmentMainOutro||"",(vertexTransform||customRewriter)&&(vertexShader=expandShaderIncludes(vertexShader));(fragmentColorTransform||customRewriter)&&(fragmentShader=expandShaderIncludes(fragmentShader=fragmentShader.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(customRewriter){let res=customRewriter({vertexShader,fragmentShader});vertexShader=res.vertexShader,fragmentShader=res.fragmentShader}if(fragmentColorTransform){let postChunks=[];fragmentShader=fragmentShader.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(match=>(postChunks.push(match),""))),fragmentMainOutro=`${fragmentColorTransform}\n${postChunks.join("\n")}\n${fragmentMainOutro}`}if(timeUniform){const code=`\nuniform float ${timeUniform};\n`;vertexDefs=code+vertexDefs,fragmentDefs=code+fragmentDefs}vertexTransform&&(vertexDefs=`${vertexDefs}\nvoid troikaVertexTransform${key}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${vertexTransform}\n}\n`,vertexMainIntro=`\ntroika_position_${key} = vec3(position);\ntroika_normal_${key} = vec3(normal);\ntroika_uv_${key} = vec2(uv);\ntroikaVertexTransform${key}(troika_position_${key}, troika_normal_${key}, troika_uv_${key});\n${vertexMainIntro}\n`,vertexShader=(vertexShader=`vec3 troika_position_${key};\nvec3 troika_normal_${key};\nvec2 troika_uv_${key};\n${vertexShader}\n`).replace(/\b(position|normal|uv)\b/g,((match,match1,index,fullStr)=>/\battribute\s+vec[23]\s+$/.test(fullStr.substr(0,index))?match1:`troika_${match1}_${key}`)),material.map&&material.map.channel>0||(vertexShader=vertexShader.replace(/\bMAP_UV\b/g,`troika_uv_${key}`)));return vertexShader=injectIntoShaderCode(vertexShader,key,vertexDefs,vertexMainIntro,vertexMainOutro),fragmentShader=injectIntoShaderCode(fragmentShader,key,fragmentDefs,fragmentMainIntro,fragmentMainOutro),{vertexShader,fragmentShader}}(this,shaderInfo,options,optionsKey);upgradedShaders=SHADER_UPGRADE_CACHE[cacheKey]=upgraded}shaderInfo.vertexShader=upgradedShaders.vertexShader,shaderInfo.fragmentShader=upgradedShaders.fragmentShader,troika_three_utils_esm_assign(shaderInfo.uniforms,this.uniforms),options.timeUniform&&(shaderInfo.uniforms[options.timeUniform]={get value(){return Date.now()-epoch}}),this[privateBeforeCompileProp]&&this[privateBeforeCompileProp](shaderInfo)},DerivedMaterial=function DerivedMaterial(){return derive(options.chained?baseMaterial:baseMaterial.clone())},derive=function(base){const derived=Object.create(base,descriptor);return Object.defineProperty(derived,"baseMaterial",{value:baseMaterial}),Object.defineProperty(derived,"id",{value:materialInstanceId++}),derived.uuid=function generateUUID(){const d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return(_lut[255&d0]+_lut[d0>>8&255]+_lut[d0>>16&255]+_lut[d0>>24&255]+"-"+_lut[255&d1]+_lut[d1>>8&255]+"-"+_lut[d1>>16&15|64]+_lut[d1>>24&255]+"-"+_lut[63&d2|128]+_lut[d2>>8&255]+"-"+_lut[d2>>16&255]+_lut[d2>>24&255]+_lut[255&d3]+_lut[d3>>8&255]+_lut[d3>>16&255]+_lut[d3>>24&255]).toUpperCase()}(),derived.uniforms=troika_three_utils_esm_assign({},base.uniforms,options.uniforms),derived.defines=troika_three_utils_esm_assign({},base.defines,options.defines),derived.defines[`TROIKA_DERIVED_MATERIAL_${optionsKey}`]="",derived.extensions=troika_three_utils_esm_assign({},base.extensions,options.extensions),derived._listeners=void 0,derived},descriptor={constructor:{value:DerivedMaterial},isDerivedMaterial:{value:!0},type:{get:()=>baseMaterial.type,set:value=>{baseMaterial.type=value}},isDerivedFrom:{writable:!0,configurable:!0,value:function(testMaterial){const base=this.baseMaterial;return testMaterial===base||base.isDerivedMaterial&&base.isDerivedFrom(testMaterial)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return baseMaterial.customProgramCacheKey()+"|"+optionsKey}},onBeforeCompile:{get:()=>onBeforeCompile,set(fn){this[privateBeforeCompileProp]=fn}},copy:{writable:!0,configurable:!0,value:function(source){return baseMaterial.copy.call(this,source),baseMaterial.isShaderMaterial||baseMaterial.isDerivedMaterial||(troika_three_utils_esm_assign(this.extensions,source.extensions),troika_three_utils_esm_assign(this.defines,source.defines),troika_three_utils_esm_assign(this.uniforms,three_core.LlO.clone(source.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const newBase=new baseMaterial.constructor;return derive(newBase).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let depthMaterial=this._depthMaterial;return depthMaterial||(depthMaterial=this._depthMaterial=createDerivedMaterial(baseMaterial.isDerivedMaterial?baseMaterial.getDepthMaterial():new three_core.CSG({depthPacking:three_core.N5j}),options),depthMaterial.defines.IS_DEPTH_MATERIAL="",depthMaterial.uniforms=this.uniforms),depthMaterial}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let distanceMaterial=this._distanceMaterial;return distanceMaterial||(distanceMaterial=this._distanceMaterial=createDerivedMaterial(baseMaterial.isDerivedMaterial?baseMaterial.getDistanceMaterial():new three_core.aVO,options),distanceMaterial.defines.IS_DISTANCE_MATERIAL="",distanceMaterial.uniforms=this.uniforms),distanceMaterial}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial,_distanceMaterial}=this;_depthMaterial&&_depthMaterial.dispose(),_distanceMaterial&&_distanceMaterial.dispose(),baseMaterial.dispose.call(this)}}};return ctorsByDerivation[optionsKey]=DerivedMaterial,new DerivedMaterial}function injectIntoShaderCode(shaderCode,id,defs,intro,outro){return(intro||outro||defs)&&(shaderCode=shaderCode.replace(voidMainRegExp,`\n${defs}\nvoid troikaOrigMain${id}() {`),shaderCode+=`\nvoid main() {\n  ${intro}\n  troikaOrigMain${id}();\n  ${outro}\n}`),shaderCode}function optionsJsonReplacer(key,value){return"uniforms"===key?void 0:"function"==typeof value?value.toString():value}let _idCtr=0;const optionsHashesToIds=new Map;three_core.$EB;three_core.eaF;const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[function typrFactory(){return"undefined"==typeof window&&(self.window=self),function(r){var e={parse:function(r){var t=e._bin,a=new Uint8Array(r);if("ttcf"==t.readASCII(a,0,4)){var n=4;t.readUshort(a,n),n+=2,t.readUshort(a,n),n+=2;var o=t.readUint(a,n);n+=4;for(var s=[],i=0;i<o;i++){var h=t.readUint(a,n);n+=4,s.push(e._readFont(a,h))}return s}return[e._readFont(a,0)]},_readFont:function(r,t){var a=e._bin,n=t;a.readFixed(r,t),t+=4;var o=a.readUshort(r,t);t+=2,a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2;for(var s=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],i={_data:r,_offset:n},h={},d=0;d<o;d++){var f=a.readASCII(r,t,4);t+=4,a.readUint(r,t),t+=4;var u=a.readUint(r,t);t+=4;var l=a.readUint(r,t);t+=4,h[f]={offset:u,length:l}}for(d=0;d<s.length;d++){var v=s[d];h[v]&&(i[v.trim()]=e[v.trim()].parse(r,h[v].offset,h[v].length,i))}return i},_tabOffset:function(r,t,a){for(var n=e._bin,o=n.readUshort(r,a+4),s=a+12,i=0;i<o;i++){var h=n.readASCII(r,s,4);s+=4,n.readUint(r,s),s+=4;var d=n.readUint(r,s);if(s+=4,n.readUint(r,s),s+=4,h==t)return d}return 0}};e._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,t){return e._bin.readShort(r,t)/16384},readInt:function(r,t){return e._bin._view(r).getInt32(t)},readInt8:function(r,t){return e._bin._view(r).getInt8(t)},readShort:function(r,t){return e._bin._view(r).getInt16(t)},readUshort:function(r,t){return e._bin._view(r).getUint16(t)},readUshorts:function(r,t,a){for(var n=[],o=0;o<a;o++)n.push(e._bin.readUshort(r,t+2*o));return n},readUint:function(r,t){return e._bin._view(r).getUint32(t)},readUint64:function(r,t){return 4294967296*e._bin.readUint(r,t)+e._bin.readUint(r,t+4)},readASCII:function(r,e,t){for(var a="",n=0;n<t;n++)a+=String.fromCharCode(r[e+n]);return a},readUnicode:function(r,e,t){for(var a="",n=0;n<t;n++){var o=r[e++]<<8|r[e++];a+=String.fromCharCode(o)}return a},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,t,a){var n=e._bin._tdec;return n&&0==t&&a==r.length?n.decode(r):e._bin.readASCII(r,t,a)},readBytes:function(r,e,t){for(var a=[],n=0;n<t;n++)a.push(r[e+n]);return a},readASCIIArray:function(r,e,t){for(var a=[],n=0;n<t;n++)a.push(String.fromCharCode(r[e+n]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,t,a,n,o){var s=e._bin,i={},h=t;s.readFixed(r,t),t+=4;var d=s.readUshort(r,t);t+=2;var f=s.readUshort(r,t);t+=2;var u=s.readUshort(r,t);return t+=2,i.scriptList=e._lctf.readScriptList(r,h+d),i.featureList=e._lctf.readFeatureList(r,h+f),i.lookupList=e._lctf.readLookupList(r,h+u,o),i},e._lctf.readLookupList=function(r,t,a){var n=e._bin,o=t,s=[],i=n.readUshort(r,t);t+=2;for(var h=0;h<i;h++){var d=n.readUshort(r,t);t+=2;var f=e._lctf.readLookupTable(r,o+d,a);s.push(f)}return s},e._lctf.readLookupTable=function(r,t,a){var n=e._bin,o=t,s={tabs:[]};s.ltype=n.readUshort(r,t),t+=2,s.flag=n.readUshort(r,t),t+=2;var i=n.readUshort(r,t);t+=2;for(var h=s.ltype,d=0;d<i;d++){var f=n.readUshort(r,t);t+=2;var u=a(r,h,o+f,s);s.tabs.push(u)}return s},e._lctf.numOfOnes=function(r){for(var e=0,t=0;t<32;t++)r>>>t&1&&e++;return e},e._lctf.readClassDef=function(r,t){var a=e._bin,n=[],o=a.readUshort(r,t);if(t+=2,1==o){var s=a.readUshort(r,t);t+=2;var i=a.readUshort(r,t);t+=2;for(var h=0;h<i;h++)n.push(s+h),n.push(s+h),n.push(a.readUshort(r,t)),t+=2}if(2==o){var d=a.readUshort(r,t);for(t+=2,h=0;h<d;h++)n.push(a.readUshort(r,t)),t+=2,n.push(a.readUshort(r,t)),t+=2,n.push(a.readUshort(r,t)),t+=2}return n},e._lctf.getInterval=function(r,e){for(var t=0;t<r.length;t+=3){var a=r[t],n=r[t+1];if(r[t+2],a<=e&&e<=n)return t}return-1},e._lctf.readCoverage=function(r,t){var a=e._bin,n={};n.fmt=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);return t+=2,1==n.fmt&&(n.tab=a.readUshorts(r,t,o)),2==n.fmt&&(n.tab=a.readUshorts(r,t,3*o)),n},e._lctf.coverageIndex=function(r,t){var a=r.tab;if(1==r.fmt)return a.indexOf(t);if(2==r.fmt){var n=e._lctf.getInterval(a,t);if(-1!=n)return a[n+2]+(t-a[n])}return-1},e._lctf.readFeatureList=function(r,t){var a=e._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readASCII(r,t,4);t+=4;var d=a.readUshort(r,t);t+=2;var f=e._lctf.readFeatureTable(r,n+d);f.tag=h.trim(),o.push(f)}return o},e._lctf.readFeatureTable=function(r,t){var a=e._bin,n=t,o={},s=a.readUshort(r,t);t+=2,s>0&&(o.featureParams=n+s);var i=a.readUshort(r,t);t+=2,o.tab=[];for(var h=0;h<i;h++)o.tab.push(a.readUshort(r,t+2*h));return o},e._lctf.readScriptList=function(r,t){var a=e._bin,n=t,o={},s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readASCII(r,t,4);t+=4;var d=a.readUshort(r,t);t+=2,o[h.trim()]=e._lctf.readScriptTable(r,n+d)}return o},e._lctf.readScriptTable=function(r,t){var a=e._bin,n=t,o={},s=a.readUshort(r,t);t+=2,s>0&&(o.default=e._lctf.readLangSysTable(r,n+s));var i=a.readUshort(r,t);t+=2;for(var h=0;h<i;h++){var d=a.readASCII(r,t,4);t+=4;var f=a.readUshort(r,t);t+=2,o[d.trim()]=e._lctf.readLangSysTable(r,n+f)}return o},e._lctf.readLangSysTable=function(r,t){var a=e._bin,n={};a.readUshort(r,t),t+=2,n.reqFeature=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);return t+=2,n.features=a.readUshorts(r,t,o),n},e.CFF={},e.CFF.parse=function(r,t,a){var n=e._bin;(r=new Uint8Array(r.buffer,t,a))[t=0],r[++t],r[++t],r[++t],t++;var o=[];t=e.CFF.readIndex(r,t,o);for(var s=[],i=0;i<o.length-1;i++)s.push(n.readASCII(r,t+o[i],o[i+1]-o[i]));t+=o[o.length-1];var h=[];t=e.CFF.readIndex(r,t,h);var d=[];for(i=0;i<h.length-1;i++)d.push(e.CFF.readDict(r,t+h[i],t+h[i+1]));t+=h[h.length-1];var f=d[0],u=[];t=e.CFF.readIndex(r,t,u);var l=[];for(i=0;i<u.length-1;i++)l.push(n.readASCII(r,t+u[i],u[i+1]-u[i]));if(t+=u[u.length-1],e.CFF.readSubrs(r,t,f),f.CharStrings){t=f.CharStrings,u=[],t=e.CFF.readIndex(r,t,u);var v=[];for(i=0;i<u.length-1;i++)v.push(n.readBytes(r,t+u[i],u[i+1]-u[i]));f.CharStrings=v}if(f.ROS){t=f.FDArray;var c=[];for(t=e.CFF.readIndex(r,t,c),f.FDArray=[],i=0;i<c.length-1;i++){var p=e.CFF.readDict(r,t+c[i],t+c[i+1]);e.CFF._readFDict(r,p,l),f.FDArray.push(p)}t+=c[c.length-1],t=f.FDSelect,f.FDSelect=[];var U=r[t];if(t++,3!=U)throw U;var g=n.readUshort(r,t);for(t+=2,i=0;i<g+1;i++)f.FDSelect.push(n.readUshort(r,t),r[t+2]),t+=3}return f.Encoding&&(f.Encoding=e.CFF.readEncoding(r,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=e.CFF.readCharset(r,f.charset,f.CharStrings.length)),e.CFF._readFDict(r,f,l),f},e.CFF._readFDict=function(r,t,a){var n;for(var o in t.Private&&(n=t.Private[1],t.Private=e.CFF.readDict(r,n,n+t.Private[0]),t.Private.Subrs&&e.CFF.readSubrs(r,n+t.Private.Subrs,t.Private)),t)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(t[o]=a[t[o]-426+35])},e.CFF.readSubrs=function(r,t,a){var n=e._bin,o=[];t=e.CFF.readIndex(r,t,o);var s,i=o.length;s=i<1240?107:i<33900?1131:32768,a.Bias=s,a.Subrs=[];for(var h=0;h<o.length-1;h++)a.Subrs.push(n.readBytes(r,t+o[h],o[h+1]-o[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,e){for(var t=0;t<r.charset.length;t++)if(r.charset[t]==e)return t;return-1},e.CFF.glyphBySE=function(r,t){return t<0||t>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[t])},e.CFF.readEncoding=function(r,t,a){e._bin;var n=[".notdef"],o=r[t];if(t++,0!=o)throw"error: unknown encoding format: "+o;var s=r[t];t++;for(var i=0;i<s;i++)n.push(r[t+i]);return n},e.CFF.readCharset=function(r,t,a){var n=e._bin,o=[".notdef"],s=r[t];if(t++,0==s)for(var i=0;i<a;i++){var h=n.readUshort(r,t);t+=2,o.push(h)}else{if(1!=s&&2!=s)throw"error: format: "+s;for(;o.length<a;){h=n.readUshort(r,t),t+=2;var d=0;for(1==s?(d=r[t],t++):(d=n.readUshort(r,t),t+=2),i=0;i<=d;i++)o.push(h),h++}}return o},e.CFF.readIndex=function(r,t,a){var n=e._bin,o=n.readUshort(r,t)+1,s=r[t+=2];if(t++,1==s)for(var i=0;i<o;i++)a.push(r[t+i]);else if(2==s)for(i=0;i<o;i++)a.push(n.readUshort(r,t+2*i));else if(3==s)for(i=0;i<o;i++)a.push(16777215&n.readUint(r,t+3*i-1));else if(1!=o)throw"unsupported offset size: "+s+", count: "+o;return(t+=o*s)-1},e.CFF.getCharString=function(r,t,a){var n=e._bin,o=r[t],s=r[t+1];r[t+2],r[t+3],r[t+4];var i=1,h=null,d=null;o<=20&&(h=o,i=1),12==o&&(h=100*o+s,i=2),21<=o&&o<=27&&(h=o,i=1),28==o&&(d=n.readShort(r,t+1),i=3),29<=o&&o<=31&&(h=o,i=1),32<=o&&o<=246&&(d=o-139,i=1),247<=o&&o<=250&&(d=256*(o-247)+s+108,i=2),251<=o&&o<=254&&(d=256*-(o-251)-s-108,i=2),255==o&&(d=n.readInt(r,t+1)/65535,i=5),a.val=null!=d?d:"o"+h,a.size=i},e.CFF.readCharString=function(r,t,a){for(var n=t+a,o=e._bin,s=[];t<n;){var i=r[t],h=r[t+1];r[t+2],r[t+3],r[t+4];var d=1,f=null,u=null;i<=20&&(f=i,d=1),12==i&&(f=100*i+h,d=2),19!=i&&20!=i||(f=i,d=2),21<=i&&i<=27&&(f=i,d=1),28==i&&(u=o.readShort(r,t+1),d=3),29<=i&&i<=31&&(f=i,d=1),32<=i&&i<=246&&(u=i-139,d=1),247<=i&&i<=250&&(u=256*(i-247)+h+108,d=2),251<=i&&i<=254&&(u=256*-(i-251)-h-108,d=2),255==i&&(u=o.readInt(r,t+1)/65535,d=5),s.push(null!=u?u:"o"+f),t+=d}return s},e.CFF.readDict=function(r,t,a){for(var n=e._bin,o={},s=[];t<a;){var i=r[t],h=r[t+1];r[t+2],r[t+3],r[t+4];var d=1,f=null,u=null;if(28==i&&(u=n.readShort(r,t+1),d=3),29==i&&(u=n.readInt(r,t+1),d=5),32<=i&&i<=246&&(u=i-139,d=1),247<=i&&i<=250&&(u=256*(i-247)+h+108,d=2),251<=i&&i<=254&&(u=256*-(i-251)-h-108,d=2),255==i)throw u=n.readInt(r,t+1)/65535,d=5,"unknown number";if(30==i){var l=[];for(d=1;;){var v=r[t+d];d++;var c=v>>4,p=15&v;if(15!=c&&l.push(c),15!=p&&l.push(p),15==p)break}for(var U="",g=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<l.length;S++)U+=g[l[S]];u=parseFloat(U)}i<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][i],d=1,12==i&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],d=2)),null!=f?(o[f]=1==s.length?s[0]:s,s=[]):s.push(u),t+=d}return o},e.cmap={},e.cmap.parse=function(r,t,a){r=new Uint8Array(r.buffer,t,a),t=0;var n=e._bin,o={};n.readUshort(r,t),t+=2;var s=n.readUshort(r,t);t+=2;var i=[];o.tables=[];for(var h=0;h<s;h++){var d=n.readUshort(r,t);t+=2;var f=n.readUshort(r,t);t+=2;var u=n.readUint(r,t);t+=4;var l="p"+d+"e"+f,v=i.indexOf(u);if(-1==v){var c;v=o.tables.length,i.push(u);var p=n.readUshort(r,u);0==p?c=e.cmap.parse0(r,u):4==p?c=e.cmap.parse4(r,u):6==p?c=e.cmap.parse6(r,u):12==p?c=e.cmap.parse12(r,u):console.debug("unknown format: "+p,d,f,u),o.tables.push(c)}if(null!=o[l])throw"multiple tables for one platform+encoding";o[l]=v}return o},e.cmap.parse0=function(r,t){var a=e._bin,n={};n.format=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);t+=2,a.readUshort(r,t),t+=2,n.map=[];for(var s=0;s<o-6;s++)n.map.push(r[t+s]);return n},e.cmap.parse4=function(r,t){var a=e._bin,n=t,o={};o.format=a.readUshort(r,t),t+=2;var s=a.readUshort(r,t);t+=2,a.readUshort(r,t),t+=2;var i=a.readUshort(r,t);t+=2;var h=i/2;o.searchRange=a.readUshort(r,t),t+=2,o.entrySelector=a.readUshort(r,t),t+=2,o.rangeShift=a.readUshort(r,t),t+=2,o.endCount=a.readUshorts(r,t,h),t+=2*h,t+=2,o.startCount=a.readUshorts(r,t,h),t+=2*h,o.idDelta=[];for(var d=0;d<h;d++)o.idDelta.push(a.readShort(r,t)),t+=2;for(o.idRangeOffset=a.readUshorts(r,t,h),t+=2*h,o.glyphIdArray=[];t<n+s;)o.glyphIdArray.push(a.readUshort(r,t)),t+=2;return o},e.cmap.parse6=function(r,t){var a=e._bin,n={};n.format=a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2,a.readUshort(r,t),t+=2,n.firstCode=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);t+=2,n.glyphIdArray=[];for(var s=0;s<o;s++)n.glyphIdArray.push(a.readUshort(r,t)),t+=2;return n},e.cmap.parse12=function(r,t){var a=e._bin,n={};n.format=a.readUshort(r,t),t+=2,t+=2,a.readUint(r,t),t+=4,a.readUint(r,t),t+=4;var o=a.readUint(r,t);t+=4,n.groups=[];for(var s=0;s<o;s++){var i=t+12*s,h=a.readUint(r,i+0),d=a.readUint(r,i+4),f=a.readUint(r,i+8);n.groups.push([h,d,f])}return n},e.glyf={},e.glyf.parse=function(r,e,t,a){for(var n=[],o=0;o<a.maxp.numGlyphs;o++)n.push(null);return n},e.glyf._parseGlyf=function(r,t){var a=e._bin,n=r._data,o=e._tabOffset(n,"glyf",r._offset)+r.loca[t];if(r.loca[t]==r.loca[t+1])return null;var s={};if(s.noc=a.readShort(n,o),o+=2,s.xMin=a.readShort(n,o),o+=2,s.yMin=a.readShort(n,o),o+=2,s.xMax=a.readShort(n,o),o+=2,s.yMax=a.readShort(n,o),o+=2,s.xMin>=s.xMax||s.yMin>=s.yMax)return null;if(s.noc>0){s.endPts=[];for(var i=0;i<s.noc;i++)s.endPts.push(a.readUshort(n,o)),o+=2;var h=a.readUshort(n,o);if(o+=2,n.length-o<h)return null;s.instructions=a.readBytes(n,o,h),o+=h;var d=s.endPts[s.noc-1]+1;for(s.flags=[],i=0;i<d;i++){var f=n[o];if(o++,s.flags.push(f),8&f){var u=n[o];o++;for(var l=0;l<u;l++)s.flags.push(f),i++}}for(s.xs=[],i=0;i<d;i++){var v=!!(2&s.flags[i]),c=!!(16&s.flags[i]);v?(s.xs.push(c?n[o]:-n[o]),o++):c?s.xs.push(0):(s.xs.push(a.readShort(n,o)),o+=2)}for(s.ys=[],i=0;i<d;i++)v=!!(4&s.flags[i]),c=!!(32&s.flags[i]),v?(s.ys.push(c?n[o]:-n[o]),o++):c?s.ys.push(0):(s.ys.push(a.readShort(n,o)),o+=2);var p=0,U=0;for(i=0;i<d;i++)p+=s.xs[i],U+=s.ys[i],s.xs[i]=p,s.ys[i]=U}else{var g;s.parts=[];do{g=a.readUshort(n,o),o+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(s.parts.push(S),S.glyphIndex=a.readUshort(n,o),o+=2,1&g){var m=a.readShort(n,o);o+=2;var b=a.readShort(n,o);o+=2}else m=a.readInt8(n,o),o++,b=a.readInt8(n,o),o++;2&g?(S.m.tx=m,S.m.ty=b):(S.p1=m,S.p2=b),8&g?(S.m.a=S.m.d=a.readF2dot14(n,o),o+=2):64&g?(S.m.a=a.readF2dot14(n,o),o+=2,S.m.d=a.readF2dot14(n,o),o+=2):128&g&&(S.m.a=a.readF2dot14(n,o),o+=2,S.m.b=a.readF2dot14(n,o),o+=2,S.m.c=a.readF2dot14(n,o),o+=2,S.m.d=a.readF2dot14(n,o),o+=2)}while(32&g);if(256&g){var y=a.readUshort(n,o);for(o+=2,s.instr=[],i=0;i<y;i++)s.instr.push(n[o]),o++}}return s},e.GDEF={},e.GDEF.parse=function(r,t,a,n){var o=t;t+=4;var s=e._bin.readUshort(r,t);return{glyphClassDef:0===s?null:e._lctf.readClassDef(r,o+s)}},e.GPOS={},e.GPOS.parse=function(r,t,a,n){return e._lctf.parse(r,t,a,n,e.GPOS.subt)},e.GPOS.subt=function(r,t,a,n){var o=e._bin,s=a,i={};if(i.fmt=o.readUshort(r,a),a+=2,1==t||2==t||3==t||7==t||8==t&&i.fmt<=2){var h=o.readUshort(r,a);a+=2,i.coverage=e._lctf.readCoverage(r,h+s)}if(1==t&&1==i.fmt){var d=o.readUshort(r,a);a+=2,0!=d&&(i.pos=e.GPOS.readValueRecord(r,a,d))}else if(2==t&&i.fmt>=1&&i.fmt<=2){d=o.readUshort(r,a),a+=2;var f=o.readUshort(r,a);a+=2;var u=e._lctf.numOfOnes(d),l=e._lctf.numOfOnes(f);if(1==i.fmt){i.pairsets=[];var v=o.readUshort(r,a);a+=2;for(var c=0;c<v;c++){var p=s+o.readUshort(r,a);a+=2;var U=o.readUshort(r,p);p+=2;for(var g=[],S=0;S<U;S++){var m=o.readUshort(r,p);p+=2,0!=d&&(P=e.GPOS.readValueRecord(r,p,d),p+=2*u),0!=f&&(x=e.GPOS.readValueRecord(r,p,f),p+=2*l),g.push({gid2:m,val1:P,val2:x})}i.pairsets.push(g)}}if(2==i.fmt){var b=o.readUshort(r,a);a+=2;var y=o.readUshort(r,a);a+=2;var F=o.readUshort(r,a);a+=2;var C=o.readUshort(r,a);for(a+=2,i.classDef1=e._lctf.readClassDef(r,s+b),i.classDef2=e._lctf.readClassDef(r,s+y),i.matrix=[],c=0;c<F;c++){var _=[];for(S=0;S<C;S++){var P=null,x=null;0!=d&&(P=e.GPOS.readValueRecord(r,a,d),a+=2*u),0!=f&&(x=e.GPOS.readValueRecord(r,a,f),a+=2*l),_.push({val1:P,val2:x})}i.matrix.push(_)}}}else if(4==t&&1==i.fmt)i.markCoverage=e._lctf.readCoverage(r,o.readUshort(r,a)+s),i.baseCoverage=e._lctf.readCoverage(r,o.readUshort(r,a+2)+s),i.markClassCount=o.readUshort(r,a+4),i.markArray=e.GPOS.readMarkArray(r,o.readUshort(r,a+6)+s),i.baseArray=e.GPOS.readBaseArray(r,o.readUshort(r,a+8)+s,i.markClassCount);else if(6==t&&1==i.fmt)i.mark1Coverage=e._lctf.readCoverage(r,o.readUshort(r,a)+s),i.mark2Coverage=e._lctf.readCoverage(r,o.readUshort(r,a+2)+s),i.markClassCount=o.readUshort(r,a+4),i.mark1Array=e.GPOS.readMarkArray(r,o.readUshort(r,a+6)+s),i.mark2Array=e.GPOS.readBaseArray(r,o.readUshort(r,a+8)+s,i.markClassCount);else{if(9==t&&1==i.fmt){var I=o.readUshort(r,a);a+=2;var w=o.readUint(r,a);if(a+=4,9==n.ltype)n.ltype=I;else if(n.ltype!=I)throw"invalid extension substitution";return e.GPOS.subt(r,n.ltype,s+w)}console.debug("unsupported GPOS table LookupType",t,"format",i.fmt)}return i},e.GPOS.readValueRecord=function(r,t,a){var n=e._bin,o=[];return o.push(1&a?n.readShort(r,t):0),t+=1&a?2:0,o.push(2&a?n.readShort(r,t):0),t+=2&a?2:0,o.push(4&a?n.readShort(r,t):0),t+=4&a?2:0,o.push(8&a?n.readShort(r,t):0),t+=8&a?2:0,o},e.GPOS.readBaseArray=function(r,t,a){var n=e._bin,o=[],s=t,i=n.readUshort(r,t);t+=2;for(var h=0;h<i;h++){for(var d=[],f=0;f<a;f++)d.push(e.GPOS.readAnchorRecord(r,s+n.readUshort(r,t))),t+=2;o.push(d)}return o},e.GPOS.readMarkArray=function(r,t){var a=e._bin,n=[],o=t,s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=e.GPOS.readAnchorRecord(r,a.readUshort(r,t+2)+o);h.markClass=a.readUshort(r,t),n.push(h),t+=4}return n},e.GPOS.readAnchorRecord=function(r,t){var a=e._bin,n={};return n.fmt=a.readUshort(r,t),n.x=a.readShort(r,t+2),n.y=a.readShort(r,t+4),n},e.GSUB={},e.GSUB.parse=function(r,t,a,n){return e._lctf.parse(r,t,a,n,e.GSUB.subt)},e.GSUB.subt=function(r,t,a,n){var o=e._bin,s=a,i={};if(i.fmt=o.readUshort(r,a),a+=2,1!=t&&2!=t&&4!=t&&5!=t&&6!=t)return null;if(1==t||2==t||4==t||5==t&&i.fmt<=2||6==t&&i.fmt<=2){var h=o.readUshort(r,a);a+=2,i.coverage=e._lctf.readCoverage(r,s+h)}if(1==t&&i.fmt>=1&&i.fmt<=2){if(1==i.fmt)i.delta=o.readShort(r,a),a+=2;else if(2==i.fmt){var d=o.readUshort(r,a);a+=2,i.newg=o.readUshorts(r,a,d),a+=2*i.newg.length}}else if(2==t&&1==i.fmt){d=o.readUshort(r,a),a+=2,i.seqs=[];for(var f=0;f<d;f++){var u=o.readUshort(r,a)+s;a+=2;var l=o.readUshort(r,u);i.seqs.push(o.readUshorts(r,u+2,l))}}else if(4==t)for(i.vals=[],d=o.readUshort(r,a),a+=2,f=0;f<d;f++){var v=o.readUshort(r,a);a+=2,i.vals.push(e.GSUB.readLigatureSet(r,s+v))}else if(5==t&&2==i.fmt){if(2==i.fmt){var c=o.readUshort(r,a);a+=2,i.cDef=e._lctf.readClassDef(r,s+c),i.scset=[];var p=o.readUshort(r,a);for(a+=2,f=0;f<p;f++){var U=o.readUshort(r,a);a+=2,i.scset.push(0==U?null:e.GSUB.readSubClassSet(r,s+U))}}}else if(6==t&&3==i.fmt){if(3==i.fmt){for(f=0;f<3;f++){d=o.readUshort(r,a),a+=2;for(var g=[],S=0;S<d;S++)g.push(e._lctf.readCoverage(r,s+o.readUshort(r,a+2*S)));a+=2*d,0==f&&(i.backCvg=g),1==f&&(i.inptCvg=g),2==f&&(i.ahedCvg=g)}d=o.readUshort(r,a),a+=2,i.lookupRec=e.GSUB.readSubstLookupRecords(r,a,d)}}else{if(7==t&&1==i.fmt){var m=o.readUshort(r,a);a+=2;var b=o.readUint(r,a);if(a+=4,9==n.ltype)n.ltype=m;else if(n.ltype!=m)throw"invalid extension substitution";return e.GSUB.subt(r,n.ltype,s+b)}console.debug("unsupported GSUB table LookupType",t,"format",i.fmt)}return i},e.GSUB.readSubClassSet=function(r,t){var a=e._bin.readUshort,n=t,o=[],s=a(r,t);t+=2;for(var i=0;i<s;i++){var h=a(r,t);t+=2,o.push(e.GSUB.readSubClassRule(r,n+h))}return o},e.GSUB.readSubClassRule=function(r,t){var a=e._bin.readUshort,n={},o=a(r,t),s=a(r,t+=2);t+=2,n.input=[];for(var i=0;i<o-1;i++)n.input.push(a(r,t)),t+=2;return n.substLookupRecords=e.GSUB.readSubstLookupRecords(r,t,s),n},e.GSUB.readSubstLookupRecords=function(r,t,a){for(var n=e._bin.readUshort,o=[],s=0;s<a;s++)o.push(n(r,t),n(r,t+2)),t+=4;return o},e.GSUB.readChainSubClassSet=function(r,t){var a=e._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readUshort(r,t);t+=2,o.push(e.GSUB.readChainSubClassRule(r,n+h))}return o},e.GSUB.readChainSubClassRule=function(r,t){for(var a=e._bin,n={},o=["backtrack","input","lookahead"],s=0;s<o.length;s++){var i=a.readUshort(r,t);t+=2,1==s&&i--,n[o[s]]=a.readUshorts(r,t,i),t+=2*n[o[s]].length}return i=a.readUshort(r,t),t+=2,n.subst=a.readUshorts(r,t,2*i),t+=2*n.subst.length,n},e.GSUB.readLigatureSet=function(r,t){var a=e._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readUshort(r,t);t+=2,o.push(e.GSUB.readLigature(r,n+h))}return o},e.GSUB.readLigature=function(r,t){var a=e._bin,n={chain:[]};n.nglyph=a.readUshort(r,t),t+=2;var o=a.readUshort(r,t);t+=2;for(var s=0;s<o-1;s++)n.chain.push(a.readUshort(r,t)),t+=2;return n},e.head={},e.head.parse=function(r,t,a){var n=e._bin,o={};return n.readFixed(r,t),t+=4,o.fontRevision=n.readFixed(r,t),t+=4,n.readUint(r,t),t+=4,n.readUint(r,t),t+=4,o.flags=n.readUshort(r,t),t+=2,o.unitsPerEm=n.readUshort(r,t),t+=2,o.created=n.readUint64(r,t),t+=8,o.modified=n.readUint64(r,t),t+=8,o.xMin=n.readShort(r,t),t+=2,o.yMin=n.readShort(r,t),t+=2,o.xMax=n.readShort(r,t),t+=2,o.yMax=n.readShort(r,t),t+=2,o.macStyle=n.readUshort(r,t),t+=2,o.lowestRecPPEM=n.readUshort(r,t),t+=2,o.fontDirectionHint=n.readShort(r,t),t+=2,o.indexToLocFormat=n.readShort(r,t),t+=2,o.glyphDataFormat=n.readShort(r,t),t+=2,o},e.hhea={},e.hhea.parse=function(r,t,a){var n=e._bin,o={};return n.readFixed(r,t),t+=4,o.ascender=n.readShort(r,t),t+=2,o.descender=n.readShort(r,t),t+=2,o.lineGap=n.readShort(r,t),t+=2,o.advanceWidthMax=n.readUshort(r,t),t+=2,o.minLeftSideBearing=n.readShort(r,t),t+=2,o.minRightSideBearing=n.readShort(r,t),t+=2,o.xMaxExtent=n.readShort(r,t),t+=2,o.caretSlopeRise=n.readShort(r,t),t+=2,o.caretSlopeRun=n.readShort(r,t),t+=2,o.caretOffset=n.readShort(r,t),t+=2,t+=8,o.metricDataFormat=n.readShort(r,t),t+=2,o.numberOfHMetrics=n.readUshort(r,t),t+=2,o},e.hmtx={},e.hmtx.parse=function(r,t,a,n){for(var o=e._bin,s={aWidth:[],lsBearing:[]},i=0,h=0,d=0;d<n.maxp.numGlyphs;d++)d<n.hhea.numberOfHMetrics&&(i=o.readUshort(r,t),t+=2,h=o.readShort(r,t),t+=2),s.aWidth.push(i),s.lsBearing.push(h);return s},e.kern={},e.kern.parse=function(r,t,a,n){var o=e._bin,s=o.readUshort(r,t);if(t+=2,1==s)return e.kern.parseV1(r,t-2,a,n);var i=o.readUshort(r,t);t+=2;for(var h={glyph1:[],rval:[]},d=0;d<i;d++){t+=2,a=o.readUshort(r,t),t+=2;var f=o.readUshort(r,t);t+=2;var u=f>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;t=e.kern.readFormat0(r,t,h)}return h},e.kern.parseV1=function(r,t,a,n){var o=e._bin;o.readFixed(r,t),t+=4;var s=o.readUint(r,t);t+=4;for(var i={glyph1:[],rval:[]},h=0;h<s;h++){o.readUint(r,t),t+=4;var d=o.readUshort(r,t);t+=2,o.readUshort(r,t),t+=2;var f=d>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;t=e.kern.readFormat0(r,t,i)}return i},e.kern.readFormat0=function(r,t,a){var n=e._bin,o=-1,s=n.readUshort(r,t);t+=2,n.readUshort(r,t),t+=2,n.readUshort(r,t),t+=2,n.readUshort(r,t),t+=2;for(var i=0;i<s;i++){var h=n.readUshort(r,t);t+=2;var d=n.readUshort(r,t);t+=2;var f=n.readShort(r,t);t+=2,h!=o&&(a.glyph1.push(h),a.rval.push({glyph2:[],vals:[]}));var u=a.rval[a.rval.length-1];u.glyph2.push(d),u.vals.push(f),o=h}return t},e.loca={},e.loca.parse=function(r,t,a,n){var o=e._bin,s=[],i=n.head.indexToLocFormat,h=n.maxp.numGlyphs+1;if(0==i)for(var d=0;d<h;d++)s.push(o.readUshort(r,t+(d<<1))<<1);if(1==i)for(d=0;d<h;d++)s.push(o.readUint(r,t+(d<<2)));return s},e.maxp={},e.maxp.parse=function(r,t,a){var n=e._bin,o={},s=n.readUint(r,t);return t+=4,o.numGlyphs=n.readUshort(r,t),t+=2,65536==s&&(o.maxPoints=n.readUshort(r,t),t+=2,o.maxContours=n.readUshort(r,t),t+=2,o.maxCompositePoints=n.readUshort(r,t),t+=2,o.maxCompositeContours=n.readUshort(r,t),t+=2,o.maxZones=n.readUshort(r,t),t+=2,o.maxTwilightPoints=n.readUshort(r,t),t+=2,o.maxStorage=n.readUshort(r,t),t+=2,o.maxFunctionDefs=n.readUshort(r,t),t+=2,o.maxInstructionDefs=n.readUshort(r,t),t+=2,o.maxStackElements=n.readUshort(r,t),t+=2,o.maxSizeOfInstructions=n.readUshort(r,t),t+=2,o.maxComponentElements=n.readUshort(r,t),t+=2,o.maxComponentDepth=n.readUshort(r,t),t+=2),o},e.name={},e.name.parse=function(r,t,a){var n=e._bin,o={};n.readUshort(r,t),t+=2;var s=n.readUshort(r,t);t+=2,n.readUshort(r,t);for(var i,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=t+=2,f=0;f<s;f++){var u=n.readUshort(r,t);t+=2;var l=n.readUshort(r,t);t+=2;var v=n.readUshort(r,t);t+=2;var c=n.readUshort(r,t);t+=2;var p=n.readUshort(r,t);t+=2;var U=n.readUshort(r,t);t+=2;var g,S=h[c],m=d+12*s+U;if(0==u)g=n.readUnicode(r,m,p/2);else if(3==u&&0==l)g=n.readUnicode(r,m,p/2);else if(0==l)g=n.readASCII(r,m,p);else if(1==l)g=n.readUnicode(r,m,p/2);else if(3==l)g=n.readUnicode(r,m,p/2);else{if(1!=u)throw"unknown encoding "+l+", platformID: "+u;g=n.readASCII(r,m,p),console.debug("reading unknown MAC encoding "+l+" as ASCII")}var b="p"+u+","+v.toString(16);null==o[b]&&(o[b]={}),o[b][void 0!==S?S:c]=g,o[b]._lang=v}for(var y in o)if(null!=o[y].postScriptName&&1033==o[y]._lang)return o[y];for(var y in o)if(null!=o[y].postScriptName&&0==o[y]._lang)return o[y];for(var y in o)if(null!=o[y].postScriptName&&3084==o[y]._lang)return o[y];for(var y in o)if(null!=o[y].postScriptName)return o[y];for(var y in o){i=y;break}return console.debug("returning name table with languageID "+o[i]._lang),o[i]},e["OS/2"]={},e["OS/2"].parse=function(r,t,a){var n=e._bin.readUshort(r,t);t+=2;var o={};if(0==n)e["OS/2"].version0(r,t,o);else if(1==n)e["OS/2"].version1(r,t,o);else if(2==n||3==n||4==n)e["OS/2"].version2(r,t,o);else{if(5!=n)throw"unknown OS/2 table version: "+n;e["OS/2"].version5(r,t,o)}return o},e["OS/2"].version0=function(r,t,a){var n=e._bin;return a.xAvgCharWidth=n.readShort(r,t),t+=2,a.usWeightClass=n.readUshort(r,t),t+=2,a.usWidthClass=n.readUshort(r,t),t+=2,a.fsType=n.readUshort(r,t),t+=2,a.ySubscriptXSize=n.readShort(r,t),t+=2,a.ySubscriptYSize=n.readShort(r,t),t+=2,a.ySubscriptXOffset=n.readShort(r,t),t+=2,a.ySubscriptYOffset=n.readShort(r,t),t+=2,a.ySuperscriptXSize=n.readShort(r,t),t+=2,a.ySuperscriptYSize=n.readShort(r,t),t+=2,a.ySuperscriptXOffset=n.readShort(r,t),t+=2,a.ySuperscriptYOffset=n.readShort(r,t),t+=2,a.yStrikeoutSize=n.readShort(r,t),t+=2,a.yStrikeoutPosition=n.readShort(r,t),t+=2,a.sFamilyClass=n.readShort(r,t),t+=2,a.panose=n.readBytes(r,t,10),t+=10,a.ulUnicodeRange1=n.readUint(r,t),t+=4,a.ulUnicodeRange2=n.readUint(r,t),t+=4,a.ulUnicodeRange3=n.readUint(r,t),t+=4,a.ulUnicodeRange4=n.readUint(r,t),t+=4,a.achVendID=[n.readInt8(r,t),n.readInt8(r,t+1),n.readInt8(r,t+2),n.readInt8(r,t+3)],t+=4,a.fsSelection=n.readUshort(r,t),t+=2,a.usFirstCharIndex=n.readUshort(r,t),t+=2,a.usLastCharIndex=n.readUshort(r,t),t+=2,a.sTypoAscender=n.readShort(r,t),t+=2,a.sTypoDescender=n.readShort(r,t),t+=2,a.sTypoLineGap=n.readShort(r,t),t+=2,a.usWinAscent=n.readUshort(r,t),t+=2,a.usWinDescent=n.readUshort(r,t),t+2},e["OS/2"].version1=function(r,t,a){var n=e._bin;return t=e["OS/2"].version0(r,t,a),a.ulCodePageRange1=n.readUint(r,t),t+=4,a.ulCodePageRange2=n.readUint(r,t),t+4},e["OS/2"].version2=function(r,t,a){var n=e._bin;return t=e["OS/2"].version1(r,t,a),a.sxHeight=n.readShort(r,t),t+=2,a.sCapHeight=n.readShort(r,t),t+=2,a.usDefault=n.readUshort(r,t),t+=2,a.usBreak=n.readUshort(r,t),t+=2,a.usMaxContext=n.readUshort(r,t),t+2},e["OS/2"].version5=function(r,t,a){var n=e._bin;return t=e["OS/2"].version2(r,t,a),a.usLowerOpticalPointSize=n.readUshort(r,t),t+=2,a.usUpperOpticalPointSize=n.readUshort(r,t),t+2},e.post={},e.post.parse=function(r,t,a){var n=e._bin,o={};return o.version=n.readFixed(r,t),t+=4,o.italicAngle=n.readFixed(r,t),t+=4,o.underlinePosition=n.readShort(r,t),t+=2,o.underlineThickness=n.readShort(r,t),t+=2,o},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(r,e){var t=r.cmap,a=-1;if(null!=t.p0e4?a=t.p0e4:null!=t.p3e1?a=t.p3e1:null!=t.p1e0?a=t.p1e0:null!=t.p0e3&&(a=t.p0e3),-1==a)throw"no familiar platform and encoding!";var n=t.tables[a];if(0==n.format)return e>=n.map.length?0:n.map[e];if(4==n.format){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return-1==o||n.startCount[o]>e?0:65535&(0!=n.idRangeOffset[o]?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(12==n.format){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var i=n.groups[s];if(i[0]<=e&&e<=i[1])return i[2]+(e-i[0])}return 0}throw"unknown cmap table format "+n.format},e.U.glyphToPath=function(r,t){var a={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[t]){var n=r.SVG.entries[t];return null==n?a:("string"==typeof n&&(n=e.SVG.toPath(n),r.SVG.entries[t]=n),n)}if(r.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},s=r.CFF,i=r.CFF.Private;if(s.ROS){for(var h=0;s.FDSelect[h+2]<=t;)h+=2;i=s.FDArray[s.FDSelect[h+1]].Private}e.U._drawCFF(r.CFF.CharStrings[t],o,s,i,a)}else r.glyf&&e.U._drawGlyf(t,r,a);return a},e.U._drawGlyf=function(r,t,a){var n=t.glyf[r];null==n&&(n=t.glyf[r]=e.glyf._parseGlyf(t,r)),null!=n&&(n.noc>-1?e.U._simpleGlyph(n,a):e.U._compoGlyph(n,t,a))},e.U._simpleGlyph=function(r,t){for(var a=0;a<r.noc;a++){for(var n=0==a?0:r.endPts[a-1]+1,o=r.endPts[a],s=n;s<=o;s++){var i=s==n?o:s-1,h=s==o?n:s+1,d=1&r.flags[s],f=1&r.flags[i],u=1&r.flags[h],l=r.xs[s],v=r.ys[s];if(s==n)if(d){if(!f){e.U.P.moveTo(t,l,v);continue}e.U.P.moveTo(t,r.xs[i],r.ys[i])}else f?e.U.P.moveTo(t,r.xs[i],r.ys[i]):e.U.P.moveTo(t,(r.xs[i]+l)/2,(r.ys[i]+v)/2);d?f&&e.U.P.lineTo(t,l,v):u?e.U.P.qcurveTo(t,l,v,r.xs[h],r.ys[h]):e.U.P.qcurveTo(t,l,v,(l+r.xs[h])/2,(v+r.ys[h])/2)}e.U.P.closePath(t)}},e.U._compoGlyph=function(r,t,a){for(var n=0;n<r.parts.length;n++){var o={cmds:[],crds:[]},s=r.parts[n];e.U._drawGlyf(s.glyphIndex,t,o);for(var i=s.m,h=0;h<o.crds.length;h+=2){var d=o.crds[h],f=o.crds[h+1];a.crds.push(d*i.a+f*i.b+i.tx),a.crds.push(d*i.c+f*i.d+i.ty)}for(h=0;h<o.cmds.length;h++)a.cmds.push(o.cmds[h])}},e.U._getGlyphClass=function(r,t){var a=e._lctf.getInterval(t,r);return-1==a?0:t[a+2]},e.U._applySubs=function(r,t,a,n){for(var o=r.length-t-1,s=0;s<a.tabs.length;s++)if(null!=a.tabs[s]){var i,h=a.tabs[s];if(!h.coverage||-1!=(i=e._lctf.coverageIndex(h.coverage,r[t])))if(1==a.ltype)r[t],1==h.fmt?r[t]=r[t]+h.delta:r[t]=h.newg[i];else if(4==a.ltype)for(var d=h.vals[i],f=0;f<d.length;f++){var u=d[f],l=u.chain.length;if(!(l>o)){for(var v=!0,c=0,p=0;p<l;p++){for(;-1==r[t+c+(1+p)];)c++;u.chain[p]!=r[t+c+(1+p)]&&(v=!1)}if(v){for(r[t]=u.nglyph,p=0;p<l+c;p++)r[t+p+1]=-1;break}}}else if(5==a.ltype&&2==h.fmt)for(var U=e._lctf.getInterval(h.cDef,r[t]),g=h.cDef[U+2],S=h.scset[g],m=0;m<S.length;m++){var b=S[m],y=b.input;if(!(y.length>o)){for(v=!0,p=0;p<y.length;p++){var F=e._lctf.getInterval(h.cDef,r[t+1+p]);if(-1==U&&h.cDef[F+2]!=y[p]){v=!1;break}}if(v){var C=b.substLookupRecords;for(f=0;f<C.length;f+=2)C[f],C[f+1]}}}else if(6==a.ltype&&3==h.fmt){if(!e.U._glsCovered(r,h.backCvg,t-h.backCvg.length))continue;if(!e.U._glsCovered(r,h.inptCvg,t))continue;if(!e.U._glsCovered(r,h.ahedCvg,t+h.inptCvg.length))continue;var _=h.lookupRec;for(m=0;m<_.length;m+=2){U=_[m];var P=n[_[m+1]];e.U._applySubs(r,t+U,P,n)}}}},e.U._glsCovered=function(r,t,a){for(var n=0;n<t.length;n++)if(-1==e._lctf.coverageIndex(t[n],r[a+n]))return!1;return!0},e.U.glyphsToPath=function(r,t,a){for(var n={cmds:[],crds:[]},o=0,s=0;s<t.length;s++){var i=t[s];if(-1!=i){for(var h=s<t.length-1&&-1!=t[s+1]?t[s+1]:0,d=e.U.glyphToPath(r,i),f=0;f<d.crds.length;f+=2)n.crds.push(d.crds[f]+o),n.crds.push(d.crds[f+1]);for(a&&n.cmds.push(a),f=0;f<d.cmds.length;f++)n.cmds.push(d.cmds[f]);a&&n.cmds.push("X"),o+=r.hmtx.aWidth[i],s<t.length-1&&(o+=e.U.getPairAdjustment(r,i,h))}}return n},e.U.P={},e.U.P.moveTo=function(r,e,t){r.cmds.push("M"),r.crds.push(e,t)},e.U.P.lineTo=function(r,e,t){r.cmds.push("L"),r.crds.push(e,t)},e.U.P.curveTo=function(r,e,t,a,n,o,s){r.cmds.push("C"),r.crds.push(e,t,a,n,o,s)},e.U.P.qcurveTo=function(r,e,t,a,n){r.cmds.push("Q"),r.crds.push(e,t,a,n)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,t,a,n,o){for(var s=t.stack,i=t.nStems,h=t.haveWidth,d=t.width,f=t.open,u=0,l=t.x,v=t.y,c=0,p=0,U=0,g=0,S=0,m=0,b=0,y=0,F=0,C=0,_={val:0,size:0};u<r.length;){e.CFF.getCharString(r,u,_);var P=_.val;if(u+=_.size,"o1"==P||"o18"==P)s.length%2!=0&&!h&&(d=s.shift()+n.nominalWidthX),i+=s.length>>1,s.length=0,h=!0;else if("o3"==P||"o23"==P)s.length%2!=0&&!h&&(d=s.shift()+n.nominalWidthX),i+=s.length>>1,s.length=0,h=!0;else if("o4"==P)s.length>1&&!h&&(d=s.shift()+n.nominalWidthX,h=!0),f&&e.U.P.closePath(o),v+=s.pop(),e.U.P.moveTo(o,l,v),f=!0;else if("o5"==P)for(;s.length>0;)l+=s.shift(),v+=s.shift(),e.U.P.lineTo(o,l,v);else if("o6"==P||"o7"==P)for(var x=s.length,I="o6"==P,w=0;w<x;w++){var k=s.shift();I?l+=k:v+=k,I=!I,e.U.P.lineTo(o,l,v)}else if("o8"==P||"o24"==P){x=s.length;for(var G=0;G+6<=x;)c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),l=U+s.shift(),v=g+s.shift(),e.U.P.curveTo(o,c,p,U,g,l,v),G+=6;"o24"==P&&(l+=s.shift(),v+=s.shift(),e.U.P.lineTo(o,l,v))}else{if("o11"==P)break;if("o1234"==P||"o1235"==P||"o1236"==P||"o1237"==P)"o1234"==P&&(p=v,U=(c=l+s.shift())+s.shift(),C=g=p+s.shift(),m=g,y=v,l=(b=(S=(F=U+s.shift())+s.shift())+s.shift())+s.shift(),e.U.P.curveTo(o,c,p,U,g,F,C),e.U.P.curveTo(o,S,m,b,y,l,v)),"o1235"==P&&(c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),F=U+s.shift(),C=g+s.shift(),S=F+s.shift(),m=C+s.shift(),b=S+s.shift(),y=m+s.shift(),l=b+s.shift(),v=y+s.shift(),s.shift(),e.U.P.curveTo(o,c,p,U,g,F,C),e.U.P.curveTo(o,S,m,b,y,l,v)),"o1236"==P&&(c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),C=g=p+s.shift(),m=g,b=(S=(F=U+s.shift())+s.shift())+s.shift(),y=m+s.shift(),l=b+s.shift(),e.U.P.curveTo(o,c,p,U,g,F,C),e.U.P.curveTo(o,S,m,b,y,l,v)),"o1237"==P&&(c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),F=U+s.shift(),C=g+s.shift(),S=F+s.shift(),m=C+s.shift(),b=S+s.shift(),y=m+s.shift(),Math.abs(b-l)>Math.abs(y-v)?l=b+s.shift():v=y+s.shift(),e.U.P.curveTo(o,c,p,U,g,F,C),e.U.P.curveTo(o,S,m,b,y,l,v));else if("o14"==P){if(s.length>0&&!h&&(d=s.shift()+a.nominalWidthX,h=!0),4==s.length){var O=s.shift(),T=s.shift(),D=s.shift(),B=s.shift(),A=e.CFF.glyphBySE(a,D),R=e.CFF.glyphBySE(a,B);e.U._drawCFF(a.CharStrings[A],t,a,n,o),t.x=O,t.y=T,e.U._drawCFF(a.CharStrings[R],t,a,n,o)}f&&(e.U.P.closePath(o),f=!1)}else if("o19"==P||"o20"==P)s.length%2!=0&&!h&&(d=s.shift()+n.nominalWidthX),i+=s.length>>1,s.length=0,h=!0,u+=i+7>>3;else if("o21"==P)s.length>2&&!h&&(d=s.shift()+n.nominalWidthX,h=!0),v+=s.pop(),l+=s.pop(),f&&e.U.P.closePath(o),e.U.P.moveTo(o,l,v),f=!0;else if("o22"==P)s.length>1&&!h&&(d=s.shift()+n.nominalWidthX,h=!0),l+=s.pop(),f&&e.U.P.closePath(o),e.U.P.moveTo(o,l,v),f=!0;else if("o25"==P){for(;s.length>6;)l+=s.shift(),v+=s.shift(),e.U.P.lineTo(o,l,v);c=l+s.shift(),p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),l=U+s.shift(),v=g+s.shift(),e.U.P.curveTo(o,c,p,U,g,l,v)}else if("o26"==P)for(s.length%2&&(l+=s.shift());s.length>0;)c=l,p=v+s.shift(),l=U=c+s.shift(),v=(g=p+s.shift())+s.shift(),e.U.P.curveTo(o,c,p,U,g,l,v);else if("o27"==P)for(s.length%2&&(v+=s.shift());s.length>0;)p=v,U=(c=l+s.shift())+s.shift(),g=p+s.shift(),l=U+s.shift(),v=g,e.U.P.curveTo(o,c,p,U,g,l,v);else if("o10"==P||"o29"==P){var L="o10"==P?n:a;if(0==s.length)console.debug("error: empty stack");else{var W=s.pop(),M=L.Subrs[W+L.Bias];t.x=l,t.y=v,t.nStems=i,t.haveWidth=h,t.width=d,t.open=f,e.U._drawCFF(M,t,a,n,o),l=t.x,v=t.y,i=t.nStems,h=t.haveWidth,d=t.width,f=t.open}}else if("o30"==P||"o31"==P){var V=s.length,E=(G=0,"o31"==P);for(G+=V-(x=-3&V);G<x;)E?(p=v,U=(c=l+s.shift())+s.shift(),v=(g=p+s.shift())+s.shift(),x-G==5?(l=U+s.shift(),G++):l=U,E=!1):(c=l,p=v+s.shift(),U=c+s.shift(),g=p+s.shift(),l=U+s.shift(),x-G==5?(v=g+s.shift(),G++):v=g,E=!0),e.U.P.curveTo(o,c,p,U,g,l,v),G+=4}else{if("o"==(P+"").charAt(0))throw console.debug("Unknown operation: "+P,r),P;s.push(P)}}}t.x=l,t.y=v,t.nStems=i,t.haveWidth=h,t.width=d,t.open=f};var t=e,a={Typr:t};return r.Typr=t,r.default=a,Object.defineProperty(r,"__esModule",{value:!0}),r}({}).Typr},function woff2otfFactory(){return function(r){var e=Uint8Array,n=Uint16Array,t=Uint32Array,a=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(r,e){for(var a=new n(31),i=0;i<31;++i)a[i]=e+=1<<r[i-1];var o=new t(a[30]);for(i=1;i<30;++i)for(var f=a[i];f<a[i+1];++f)o[f]=f-a[i]<<5|i;return[a,o]},u=f(a,2),v=u[0],s=u[1];v[28]=258,s[258]=28;for(var l=f(i,0)[0],c=new n(32768),g=0;g<32768;++g){var h=(43690&g)>>>1|(21845&g)<<1;h=(61680&(h=(52428&h)>>>2|(13107&h)<<2))>>>4|(3855&h)<<4,c[g]=((65280&h)>>>8|(255&h)<<8)>>>1}var w=function(r,e,t){for(var a=r.length,i=0,o=new n(e);i<a;++i)++o[r[i]-1];var f,u=new n(e);for(i=0;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;if(t){f=new n(1<<e);var v=15-e;for(i=0;i<a;++i)if(r[i])for(var s=i<<4|r[i],l=e-r[i],g=u[r[i]-1]++<<l,h=g|(1<<l)-1;g<=h;++g)f[c[g]>>>v]=s}else for(f=new n(a),i=0;i<a;++i)r[i]&&(f[i]=c[u[r[i]-1]++]>>>15-r[i]);return f},d=new e(288);for(g=0;g<144;++g)d[g]=8;for(g=144;g<256;++g)d[g]=9;for(g=256;g<280;++g)d[g]=7;for(g=280;g<288;++g)d[g]=8;var m=new e(32);for(g=0;g<32;++g)m[g]=5;var b=w(d,9,1),p=w(m,5,1),y=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},L=function(r,e,n){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(7&e)&n},U=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(7&e)},k=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(r,e,n){var t=new Error(e||k[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,T),!n)throw t;return t},O=function(r,f,u){var s=r.length;if(!s||u&&!u.l&&s<5)return f||new e(0);var c=!f||u,g=!u||u.i;u||(u={}),f||(f=new e(3*s));var h,d=function(r){var n=f.length;if(r>n){var t=new e(Math.max(2*n,r));t.set(f),f=t}},m=u.f||0,k=u.p||0,O=u.b||0,A=u.l,x=u.d,E=u.m,D=u.n,M=8*s;do{if(!A){u.f=m=L(r,k,1);var S=L(r,k+1,3);if(k+=3,!S){var V=r[(I=((h=k)/8|0)+(7&h&&1)+4)-4]|r[I-3]<<8,_=I+V;if(_>s){g&&T(0);break}c&&d(O+V),f.set(r.subarray(I,_),O),u.b=O+=V,u.p=k=8*_;continue}if(1==S)A=b,x=p,E=9,D=5;else if(2==S){var j=L(r,k,31)+257,z=L(r,k+10,15)+4,C=j+L(r,k+5,31)+1;k+=14;for(var F=new e(C),P=new e(19),q=0;q<z;++q)P[o[q]]=L(r,k+3*q,7);k+=3*z;var B=y(P),G=(1<<B)-1,H=w(P,B,1);for(q=0;q<C;){var I,J=H[L(r,k,G)];if(k+=15&J,(I=J>>>4)<16)F[q++]=I;else{var K=0,N=0;for(16==I?(N=3+L(r,k,3),k+=2,K=F[q-1]):17==I?(N=3+L(r,k,7),k+=3):18==I&&(N=11+L(r,k,127),k+=7);N--;)F[q++]=K}}var Q=F.subarray(0,j),R=F.subarray(j);E=y(Q),D=y(R),A=w(Q,E,1),x=w(R,D,1)}else T(1);if(k>M){g&&T(0);break}}c&&d(O+131072);for(var W=(1<<E)-1,X=(1<<D)-1,Y=k;;Y=k){var Z=(K=A[U(r,k)&W])>>>4;if((k+=15&K)>M){g&&T(0);break}if(K||T(2),Z<256)f[O++]=Z;else{if(256==Z){Y=k,A=null;break}var $=Z-254;if(Z>264){var rr=a[q=Z-257];$=L(r,k,(1<<rr)-1)+v[q],k+=rr}var er=x[U(r,k)&X],nr=er>>>4;if(er||T(3),k+=15&er,R=l[nr],nr>3&&(rr=i[nr],R+=U(r,k)&(1<<rr)-1,k+=rr),k>M){g&&T(0);break}c&&d(O+131072);for(var tr=O+$;O<tr;O+=4)f[O]=f[O-R],f[O+1]=f[O+1-R],f[O+2]=f[O+2-R],f[O+3]=f[O+3-R];O=tr}}u.l=A,u.p=Y,u.b=O,A&&(m=1,u.m=E,u.d=x,u.n=D)}while(!m);return O==f.length?f:function(r,a,i){(null==a||a<0)&&(a=0),(null==i||i>r.length)&&(i=r.length);var o=new(r instanceof n?n:r instanceof t?t:e)(i-a);return o.set(r.subarray(a,i)),o}(f,0,O)},A=new e(0),x="undefined"!=typeof TextDecoder&&new TextDecoder;try{x.decode(A,{stream:!0})}catch(r){}return r.convert_streams=function(r){var e=new DataView(r),n=0;function t(){var r=e.getUint16(n);return n+=2,r}function a(){var r=e.getUint32(n);return n+=4,r}function i(r){m.setUint16(b,r),b+=2}function o(r){m.setUint32(b,r),b+=4}for(var f={signature:a(),flavor:a(),length:a(),numTables:t(),reserved:t(),totalSfntSize:a(),majorVersion:t(),minorVersion:t(),metaOffset:a(),metaLength:a(),metaOrigLength:a(),privOffset:a(),privLength:a()},u=0;Math.pow(2,u)<=f.numTables;)u++;u--;for(var v=16*Math.pow(2,u),s=16*f.numTables-v,l=12,c=[],g=0;g<f.numTables;g++)c.push({tag:a(),offset:a(),compLength:a(),origLength:a(),origChecksum:a()}),l+=16;var h,w=new Uint8Array(12+16*c.length+c.reduce((function(r,e){return r+e.origLength+4}),0)),d=w.buffer,m=new DataView(d),b=0;return o(f.flavor),i(f.numTables),i(v),i(u),i(s),c.forEach((function(r){o(r.tag),o(r.origChecksum),o(l),o(r.origLength),r.outOffset=l,(l+=r.origLength)%4!=0&&(l+=4-l%4)})),c.forEach((function(e){var n,t=r.slice(e.offset,e.offset+e.compLength);if(e.compLength!=e.origLength){var a=new Uint8Array(e.origLength);n=new Uint8Array(t,2),O(n,a)}else a=new Uint8Array(t);w.set(a,e.outOffset);var i=0;(l=e.outOffset+e.origLength)%4!=0&&(i=4-l%4),w.set(new Uint8Array(i).buffer,e.outOffset+e.origLength),h=l+i})),d.slice(0,h)},Object.defineProperty(r,"__esModule",{value:!0}),r}({}).convert_streams},function parserFactory(Typr,woff2otf){const cmdArgLengths={M:2,L:2,Q:4,C:6,Z:0},joiningTypeRawData={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let joiningTypeMap;function getCharJoiningType(ch){if(!joiningTypeMap){const m={R:2,L:1,D:4,C:16,U:32,T:8};joiningTypeMap=new Map;for(let type in joiningTypeRawData){let lastCode=0;joiningTypeRawData[type].split(",").forEach((range=>{let[skip,step]=range.split("+");skip=parseInt(skip,36),step=step?parseInt(step,36):0,joiningTypeMap.set(lastCode+=skip,m[type]);for(let i=step;i--;)joiningTypeMap.set(++lastCode,m[type])}))}}return joiningTypeMap.get(ch)||32}const formsToFeatures=[null,"isol","init","fina","medi"];function detectJoiningForms(str){const joiningForms=new Uint8Array(str.length);let prevJoiningType=32,prevForm=1,prevIndex=-1;for(let i=0;i<str.length;i++){const code=str.codePointAt(i);let joiningType=0|getCharJoiningType(code),form=1;8&joiningType||(21&prevJoiningType?22&joiningType?(form=3,1!==prevForm&&3!==prevForm||joiningForms[prevIndex]++):33&joiningType&&(2!==prevForm&&4!==prevForm||joiningForms[prevIndex]--):34&prevJoiningType&&(2!==prevForm&&4!==prevForm||joiningForms[prevIndex]--),prevForm=joiningForms[i]=form,prevJoiningType=joiningType,prevIndex=i,code>65535&&i++)}return joiningForms}function getGlyphClass(font,glyphId){const classDef=font.GDEF&&font.GDEF.glyphClassDef;return classDef?Typr.U._getGlyphClass(glyphId,classDef):0}function firstNum(...args){for(let i=0;i<args.length;i++)if("number"==typeof args[i])return args[i]}function wrapFontObj(typrFont){const glyphMap=Object.create(null),os2=typrFont["OS/2"],hhea=typrFont.hhea,unitsPerEm=typrFont.head.unitsPerEm,ascender=firstNum(os2&&os2.sTypoAscender,hhea&&hhea.ascender,unitsPerEm),fontObj={unitsPerEm,ascender,descender:firstNum(os2&&os2.sTypoDescender,hhea&&hhea.descender,0),capHeight:firstNum(os2&&os2.sCapHeight,ascender),xHeight:firstNum(os2&&os2.sxHeight,ascender),lineGap:firstNum(os2&&os2.sTypoLineGap,hhea&&hhea.lineGap),supportsCodePoint:code=>Typr.U.codeToGlyph(typrFont,code)>0,forEachGlyph(text,fontSize,letterSpacing,callback){let penX=0;const fontScale=1/fontObj.unitsPerEm*fontSize,glyphIds=function stringToGlyphs(font,str){const glyphIds=[];for(let i=0;i<str.length;i++){const cc=str.codePointAt(i);cc>65535&&i++,glyphIds.push(Typr.U.codeToGlyph(font,cc))}const gsub=font.GSUB;if(gsub){const{lookupList,featureList}=gsub;let joiningForms;const supportedFeatures=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,usedLookups=[];featureList.forEach((feature=>{if(supportedFeatures.test(feature.tag))for(let ti=0;ti<feature.tab.length;ti++){if(usedLookups[feature.tab[ti]])continue;usedLookups[feature.tab[ti]]=!0;const tab=lookupList[feature.tab[ti]],isJoiningFeature=/^(isol|init|fina|medi)$/.test(feature.tag);isJoiningFeature&&!joiningForms&&(joiningForms=detectJoiningForms(str));for(let ci=0;ci<glyphIds.length;ci++)joiningForms&&isJoiningFeature&&formsToFeatures[joiningForms[ci]]!==feature.tag||Typr.U._applySubs(glyphIds,ci,tab,lookupList)}}))}return glyphIds}(typrFont,text);let charIndex=0;const positions=function calcGlyphPositions(font,glyphIds){const positions=new Int16Array(3*glyphIds.length);let glyphIndex=0;for(;glyphIndex<glyphIds.length;glyphIndex++){const glyphId=glyphIds[glyphIndex];if(-1===glyphId)continue;positions[3*glyphIndex+2]=font.hmtx.aWidth[glyphId];const gpos=font.GPOS;if(gpos){const llist=gpos.lookupList;for(let i=0;i<llist.length;i++){const lookup=llist[i];for(let j=0;j<lookup.tabs.length;j++){const tab=lookup.tabs[j];if(1===lookup.ltype){if(-1!==Typr._lctf.coverageIndex(tab.coverage,glyphId)&&tab.pos){applyValueRecord(tab.pos,glyphIndex);break}}else if(2===lookup.ltype){let adj=null,prevGlyphIndex=getPrevGlyphIndex();if(-1!==prevGlyphIndex){const coverageIndex=Typr._lctf.coverageIndex(tab.coverage,glyphIds[prevGlyphIndex]);if(-1!==coverageIndex){if(1===tab.fmt){const right=tab.pairsets[coverageIndex];for(let k=0;k<right.length;k++)right[k].gid2===glyphId&&(adj=right[k])}else if(2===tab.fmt){const c1=Typr.U._getGlyphClass(glyphIds[prevGlyphIndex],tab.classDef1),c2=Typr.U._getGlyphClass(glyphId,tab.classDef2);adj=tab.matrix[c1][c2]}if(adj){adj.val1&&applyValueRecord(adj.val1,prevGlyphIndex),adj.val2&&applyValueRecord(adj.val2,glyphIndex);break}}}}else if(4===lookup.ltype){const markArrIndex=Typr._lctf.coverageIndex(tab.markCoverage,glyphId);if(-1!==markArrIndex){const baseGlyphIndex=getPrevGlyphIndex(isBaseGlyph),baseArrIndex=-1===baseGlyphIndex?-1:Typr._lctf.coverageIndex(tab.baseCoverage,glyphIds[baseGlyphIndex]);if(-1!==baseArrIndex){const markRecord=tab.markArray[markArrIndex],baseAnchor=tab.baseArray[baseArrIndex][markRecord.markClass];positions[3*glyphIndex]=baseAnchor.x-markRecord.x+positions[3*baseGlyphIndex]-positions[3*baseGlyphIndex+2],positions[3*glyphIndex+1]=baseAnchor.y-markRecord.y+positions[3*baseGlyphIndex+1];break}}}else if(6===lookup.ltype){const mark1ArrIndex=Typr._lctf.coverageIndex(tab.mark1Coverage,glyphId);if(-1!==mark1ArrIndex){const prevGlyphIndex=getPrevGlyphIndex();if(-1!==prevGlyphIndex){const prevGlyphId=glyphIds[prevGlyphIndex];if(3===getGlyphClass(font,prevGlyphId)){const mark2ArrIndex=Typr._lctf.coverageIndex(tab.mark2Coverage,prevGlyphId);if(-1!==mark2ArrIndex){const mark1Record=tab.mark1Array[mark1ArrIndex],mark2Anchor=tab.mark2Array[mark2ArrIndex][mark1Record.markClass];positions[3*glyphIndex]=mark2Anchor.x-mark1Record.x+positions[3*prevGlyphIndex]-positions[3*prevGlyphIndex+2],positions[3*glyphIndex+1]=mark2Anchor.y-mark1Record.y+positions[3*prevGlyphIndex+1];break}}}}}}}}else if(font.kern&&!font.cff){const prevGlyphIndex=getPrevGlyphIndex();if(-1!==prevGlyphIndex){const ind1=font.kern.glyph1.indexOf(glyphIds[prevGlyphIndex]);if(-1!==ind1){const ind2=font.kern.rval[ind1].glyph2.indexOf(glyphId);-1!==ind2&&(positions[3*prevGlyphIndex+2]+=font.kern.rval[ind1].vals[ind2])}}}}return positions;function getPrevGlyphIndex(filter){for(let i=glyphIndex-1;i>=0;i--)if(-1!==glyphIds[i]&&(!filter||filter(glyphIds[i])))return i;return-1}function isBaseGlyph(glyphId){return 1===getGlyphClass(font,glyphId)}function applyValueRecord(source,gi){for(let i=0;i<3;i++)positions[3*gi+i]+=source[i]||0}}(typrFont,glyphIds);return glyphIds.forEach(((glyphId,i)=>{if(-1!==glyphId){let glyphObj=glyphMap[glyphId];if(!glyphObj){const{cmds,crds}=Typr.U.glyphToPath(typrFont,glyphId);let xMin,yMin,xMax,yMax,path="",crdsIdx=0;for(let i=0,len=cmds.length;i<len;i++){const numArgs=cmdArgLengths[cmds[i]];path+=cmds[i];for(let j=1;j<=numArgs;j++)path+=(j>1?",":"")+crds[crdsIdx++]}if(crds.length){xMin=yMin=1/0,xMax=yMax=-1/0;for(let i=0,len=crds.length;i<len;i+=2){let x=crds[i],y=crds[i+1];x<xMin&&(xMin=x),y<yMin&&(yMin=y),x>xMax&&(xMax=x),y>yMax&&(yMax=y)}}else xMin=xMax=yMin=yMax=0;glyphObj=glyphMap[glyphId]={index:glyphId,advanceWidth:typrFont.hmtx.aWidth[glyphId],xMin,yMin,xMax,yMax,path}}callback.call(null,glyphObj,penX+positions[3*i]*fontScale,positions[3*i+1]*fontScale,charIndex),penX+=positions[3*i+2]*fontScale,letterSpacing&&(penX+=letterSpacing*fontSize)}charIndex+=text.codePointAt(charIndex)>65535?2:1})),penX}};return fontObj}return function parse(buffer){const peek=new Uint8Array(buffer,0,4),tag=Typr._bin.readASCII(peek,0,4);if("wOFF"===tag)buffer=woff2otf(buffer);else if("wOF2"===tag)throw new Error("woff2 fonts not supported");return wrapFontObj(Typr.parse(buffer)[0])}}],init:(typrFactory,woff2otfFactory,parserFactory)=>parserFactory(typrFactory(),woff2otfFactory())});const fontResolverWorkerModule=defineWorkerModule({name:"FontResolver",dependencies:[function createFontResolver(fontParser,unicodeFontResolverClient){const parsedFonts=Object.create(null),loadingFonts=Object.create(null);function loadFont(fontUrl,callback){let font=parsedFonts[fontUrl];font?callback(font):loadingFonts[fontUrl]?loadingFonts[fontUrl].push(callback):(loadingFonts[fontUrl]=[callback],function doLoadFont(url,callback){const onError=err=>{console.error(`Failure loading font ${url}`,err)};try{const request=new XMLHttpRequest;request.open("get",url,!0),request.responseType="arraybuffer",request.onload=function(){if(request.status>=400)onError(new Error(request.statusText));else if(request.status>0)try{const fontObj=fontParser(request.response);fontObj.src=url,callback(fontObj)}catch(e){onError(e)}},request.onerror=onError,request.send()}catch(err){onError(err)}}(fontUrl,(fontObj=>{fontObj.src=fontUrl,parsedFonts[fontUrl]=fontObj,loadingFonts[fontUrl].forEach((cb=>cb(fontObj))),delete loadingFonts[fontUrl]})))}return function(text,callback,{lang,fonts:userFonts=[],style="normal",weight="normal",unicodeFontsURL}={}){const charResolutions=new Uint8Array(text.length),fontResolutions=[];text.length||allDone();const fontIndices=new Map,fallbackRanges=[];if("italic"!==style&&(style="normal"),"number"!=typeof weight&&(weight="bold"===weight?700:400),userFonts&&!Array.isArray(userFonts)&&(userFonts=[userFonts]),(userFonts=userFonts.slice().filter((def=>!def.lang||def.lang.test(lang))).reverse()).length){const RESOLVED=1,NEEDS_FALLBACK=2;let prevCharResult=0;!function resolveUserFonts(startIndex=0){for(let i=startIndex,iLen=text.length;i<iLen;i++){const codePoint=text.codePointAt(i);if(prevCharResult===RESOLVED&&fontResolutions[charResolutions[i-1]].supportsCodePoint(codePoint)||i>0&&/\s/.test(text[i]))charResolutions[i]=charResolutions[i-1],prevCharResult===NEEDS_FALLBACK&&(fallbackRanges[fallbackRanges.length-1][1]=i);else for(let j=charResolutions[i],jLen=userFonts.length;j<=jLen;j++)if(j===jLen){(prevCharResult===NEEDS_FALLBACK?fallbackRanges[fallbackRanges.length-1]:fallbackRanges[fallbackRanges.length]=[i,i])[1]=i,prevCharResult=NEEDS_FALLBACK}else{charResolutions[i]=j;const{src,unicodeRange}=userFonts[j];if(!unicodeRange||isCodeInRanges(codePoint,unicodeRange)){const fontObj=parsedFonts[src];if(!fontObj)return void loadFont(src,(()=>{resolveUserFonts(i)}));if(fontObj.supportsCodePoint(codePoint)){let fontIndex=fontIndices.get(fontObj);"number"!=typeof fontIndex&&(fontIndex=fontResolutions.length,fontResolutions.push(fontObj),fontIndices.set(fontObj,fontIndex)),charResolutions[i]=fontIndex,prevCharResult=RESOLVED;break}}}codePoint>65535&&i+1<iLen&&(charResolutions[i+1]=charResolutions[i],i++,prevCharResult===NEEDS_FALLBACK&&(fallbackRanges[fallbackRanges.length-1][1]=i))}resolveFallbacks()}()}else fallbackRanges.push([0,text.length-1]),resolveFallbacks();function resolveFallbacks(){if(fallbackRanges.length){const fallbackString=fallbackRanges.map((range=>text.substring(range[0],range[1]+1))).join("\n");unicodeFontResolverClient.getFontsForString(fallbackString,{lang:lang||void 0,style,weight,dataUrl:unicodeFontsURL}).then((({fontUrls,chars})=>{const fontIndexOffset=fontResolutions.length;let charIdx=0;fallbackRanges.forEach((range=>{for(let i=0,endIdx=range[1]-range[0];i<=endIdx;i++)charResolutions[range[0]+i]=chars[charIdx++]+fontIndexOffset;charIdx++}));let loadedCount=0;fontUrls.forEach(((url,i)=>{loadFont(url,(fontObj=>{fontResolutions[i+fontIndexOffset]=fontObj,++loadedCount===fontUrls.length&&allDone()}))}))}))}else allDone()}function allDone(){callback({chars:charResolutions,fonts:fontResolutions})}function isCodeInRanges(code,ranges){for(let k=0;k<ranges.length;k++){const[start,end=start]=ranges[k];if(start<=code&&code<=end)return!0}return!1}}},workerModule,function unicodeFontResolverClientFactory(){return function(t){var n=function(){this.buckets=new Map};n.prototype.add=function(t){var n=t>>5;this.buckets.set(n,(this.buckets.get(n)||0)|1<<(31&t))},n.prototype.has=function(t){var n=this.buckets.get(t>>5);return void 0!==n&&!!(n&1<<(31&t))},n.prototype.serialize=function(){var t=[];return this.buckets.forEach((function(n,r){t.push((+r).toString(36)+":"+n.toString(36))})),t.join(",")},n.prototype.deserialize=function(t){var n=this;this.buckets.clear(),t.split(",").forEach((function(t){var r=t.split(":");n.buckets.set(parseInt(r[0],36),parseInt(r[1],36))}))};var r=Math.pow(2,8),e=r-1,o=~e;function a(t){var n=function(t){return t&o}(t).toString(16),e=function(t){return(t&o)+r-1}(t).toString(16);return"codepoint-index/plane"+(t>>16)+"/"+n+"-"+e+".json"}function i(t,n){var r=t&e,o=n.codePointAt(r/6|0);return!!((o=(o||48)-48)&1<<r%6)}function c(t,n){!function u(t,n){var r;(r=t,r.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(t){return t.split("-").map((function(t){return parseInt(t.trim(),16)}))}))).forEach((function(t){var r=t[0],e=t[1];void 0===e&&(e=r),n(r,e)}))}(t,(function(t,r){for(var e=t;e<=r;e++)n(e)}))}var s={},f={},l=new WeakMap,v="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(t){var r=l.get(t);return r||(r=new n,c(t.ranges,(function(t){return r.add(t)})),l.set(t,r)),r}var h,p=new Map;function g(t,n,r){return t[n]?n:t[r]?r:function(t){for(var n in t)return n}(t)}function w(t,n){var r=n;if(!t.includes(r)){r=1/0;for(var e=0;e<t.length;e++)Math.abs(t[e]-n)<Math.abs(r-n)&&(r=t[e])}return r}function k(t){return h||(h=new Set,c("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(t){h.add(t)}))),h.has(t)}return t.CodePointSet=n,t.clearCache=function(){s={},f={}},t.getFontsForString=function(t,n){void 0===n&&(n={});var r,e=n.lang;void 0===e&&(e=/\p{Script=Hangul}/u.test(r=t)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(r)?"ja":"en");var o=n.category;void 0===o&&(o="sans-serif");var u=n.style;void 0===u&&(u="normal");var c=n.weight;void 0===c&&(c=400);var l=(n.dataUrl||v).replace(/\/$/g,""),h=new Map,y=new Uint8Array(t.length),b={},m={},A=new Array(t.length),S=new Map,j=!1;function M(t){var n=p.get(t);return n||(n=fetch(l+"/"+t).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.json().then((function(t){if(!Array.isArray(t)||1!==t[0])throw new Error("Incorrect schema version; need 1, got "+t[0]);return t[1]}))})).catch((function(n){if(l!==v)return j||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+l+'", trying default CDN. '+n.message),j=!0),l=v,p.delete(t),M(t);throw n})),p.set(t,n)),n}for(var P=function(n){var r=t.codePointAt(n),e=a(r);A[n]=e,s[e]||S.has(e)||S.set(e,M(e).then((function(t){s[e]=t}))),r>65535&&(n++,E=n)},E=0;E<t.length;E++)P(E);return Promise.all(S.values()).then((function(){S.clear();for(var n=function(n){var o=t.codePointAt(n),a=null,u=s[A[n]],c=void 0;for(var l in u){var v=m[l];if(void 0===v&&(v=m[l]=new RegExp(l).test(e||"en")),v){for(var d in c=l,u[l])if(i(o,u[l][d])){a=d;break}break}}if(!a)t:for(var h in u)if(h!==c)for(var p in u[h])if(i(o,u[h][p])){a=p;break t}a||(console.debug("No font coverage for U+"+o.toString(16)),a="latin"),A[n]=a,f[a]||S.has(a)||S.set(a,M("font-meta/"+a+".json").then((function(t){f[a]=t}))),o>65535&&(n++,r=n)},r=0;r<t.length;r++)n(r);return Promise.all(S.values())})).then((function(){for(var n,r=null,e=0;e<t.length;e++){var a=t.codePointAt(e);if(r&&(k(a)||d(r).has(a)))y[e]=y[e-1];else{r=f[A[e]];var i=b[r.id];if(!i){var s=r.typeforms,v=g(s,o,"sans-serif"),p=g(s[v],u,"normal"),m=w(null===(n=s[v])||void 0===n?void 0:n[p],c);i=b[r.id]=l+"/font-files/"+r.id+"/"+v+"."+p+"."+m+".woff"}var S=h.get(i);null==S&&(S=h.size,h.set(i,S)),y[e]=S}a>65535&&(e++,y[e]=y[e-1])}return{fontUrls:Array.from(h.keys()),chars:y}}))},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(createFontResolver,fontParser,unicodeFontResolverClientFactory)=>createFontResolver(fontParser,unicodeFontResolverClientFactory())});const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;const queue=[];let timer=0;function nextChunk(){const start=now();for(;queue.length&&now()-start<5;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...args)=>new Promise(((resolve,reject)=>{queue.push((()=>{const start=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...args),resolve({timing:now()-start})}catch(err){reject(err)}})),timer||(timer=setTimeout(nextChunk,0))})),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(width,height,path,viewBox,distance,exponent,canvas,x,y,channel){const workerId="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let thread=threads[workerId];return thread||(thread=threads[workerId]={workerModule:defineWorkerModule({name:workerId,workerId,dependencies:[SDFGenerator,now],init(_createSDFGenerator,now){const generate=_createSDFGenerator().javascript.generate;return function(...args){const start=now();return{textureData:generate(...args),timing:now()-start}}},getTransferables:result=>[result.textureData.buffer]}),requests:0,idleTimer:null}),thread.requests++,clearTimeout(thread.idleTimer),thread.workerModule(width,height,path,viewBox,distance,exponent).then((({textureData,timing})=>{const start=now(),imageData=new Uint8Array(4*textureData.length);for(let i=0;i<textureData.length;i++)imageData[4*i+channel]=textureData[i];return mainThreadGenerator.webglUtils.renderImageData(canvas,imageData,x,y,width,height,1<<3-channel),timing+=now()-start,0==--thread.requests&&(thread.idleTimer=setTimeout((()=>{!function terminateWorker(workerId){registeredModules[workerId]&&registeredModules[workerId].forEach((function(unregister){unregister()})),workers[workerId]&&(workers[workerId].terminate(),delete workers[workerId])}(workerId)}),idleTimeout)),{timing}}))}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing,CONFIG={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},tempColor=new three_core.Q1f;let hasRequested=!1;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(args,callback){hasRequested=!0,args=troika_three_text_esm_assign({},args);const totalStart=now$1(),{defaultFontURL}=CONFIG,fonts=[];if(defaultFontURL&&fonts.push({label:"default",src:toAbsoluteURL(defaultFontURL)}),args.font&&fonts.push({label:"user",src:toAbsoluteURL(args.font)}),args.font=fonts,args.text=""+args.text,args.sdfGlyphSize=args.sdfGlyphSize||CONFIG.sdfGlyphSize,args.unicodeFontsURL=args.unicodeFontsURL||CONFIG.unicodeFontsURL,null!=args.colorRanges){let colors={};for(let key in args.colorRanges)if(args.colorRanges.hasOwnProperty(key)){let val=args.colorRanges[key];"number"!=typeof val&&(val=tempColor.set(val).getHex()),colors[key]=val}args.colorRanges=colors}Object.freeze(args);const{textureWidth,sdfExponent}=CONFIG,{sdfGlyphSize}=args,glyphsPerRow=textureWidth/sdfGlyphSize*4;let atlas=atlases[sdfGlyphSize];if(!atlas){const canvas=document.createElement("canvas");canvas.width=textureWidth,canvas.height=256*sdfGlyphSize/glyphsPerRow,atlas=atlases[sdfGlyphSize]={glyphCount:0,sdfGlyphSize,sdfCanvas:canvas,sdfTexture:new three_core.gPd(canvas,void 0,void 0,void 0,three_core.k6q,three_core.k6q),contextLost:!1,glyphsByFont:new Map},atlas.sdfTexture.generateMipmaps=!1,function initContextLossHandling(atlas){const canvas=atlas.sdfCanvas;canvas.addEventListener("webglcontextlost",(event=>{console.log("Context Lost",event),event.preventDefault(),atlas.contextLost=!0})),canvas.addEventListener("webglcontextrestored",(event=>{console.log("Context Restored",event),atlas.contextLost=!1;const promises=[];atlas.glyphsByFont.forEach((glyphMap=>{glyphMap.forEach((glyph=>{promises.push(generateGlyphSDF(glyph,atlas,!0))}))})),Promise.all(promises).then((()=>{safariPre15Workaround(atlas),atlas.sdfTexture.needsUpdate=!0}))}))}(atlas)}const{sdfTexture,sdfCanvas}=atlas;(CONFIG.useWorker?typesetInWorker:typesetOnMainThread)(args).then((result=>{const{glyphIds,glyphFontIndices,fontData,glyphPositions,fontSize,timings}=result,neededSDFs=[],glyphBounds=new Float32Array(4*glyphIds.length);let boundsIdx=0,positionsIdx=0;const quadsStart=now$1(),fontGlyphMaps=fontData.map((font=>{let map=atlas.glyphsByFont.get(font.src);return map||atlas.glyphsByFont.set(font.src,map=new Map),map}));glyphIds.forEach(((glyphId,i)=>{const fontIndex=glyphFontIndices[i],{src:fontSrc,unitsPerEm}=fontData[fontIndex];let glyphInfo=fontGlyphMaps[fontIndex].get(glyphId);if(!glyphInfo){const{path,pathBounds}=result.glyphData[fontSrc][glyphId],fontUnitsMargin=Math.max(pathBounds[2]-pathBounds[0],pathBounds[3]-pathBounds[1])/sdfGlyphSize*(CONFIG.sdfMargin*sdfGlyphSize+.5),atlasIndex=atlas.glyphCount++,sdfViewBox=[pathBounds[0]-fontUnitsMargin,pathBounds[1]-fontUnitsMargin,pathBounds[2]+fontUnitsMargin,pathBounds[3]+fontUnitsMargin];fontGlyphMaps[fontIndex].set(glyphId,glyphInfo={path,atlasIndex,sdfViewBox}),neededSDFs.push(glyphInfo)}const{sdfViewBox}=glyphInfo,posX=glyphPositions[positionsIdx++],posY=glyphPositions[positionsIdx++],fontSizeMult=fontSize/unitsPerEm;glyphBounds[boundsIdx++]=posX+sdfViewBox[0]*fontSizeMult,glyphBounds[boundsIdx++]=posY+sdfViewBox[1]*fontSizeMult,glyphBounds[boundsIdx++]=posX+sdfViewBox[2]*fontSizeMult,glyphBounds[boundsIdx++]=posY+sdfViewBox[3]*fontSizeMult,glyphIds[i]=glyphInfo.atlasIndex})),timings.quads=(timings.quads||0)+(now$1()-quadsStart);const sdfStart=now$1();timings.sdf={};const currentHeight=sdfCanvas.height,neededRows=Math.ceil(atlas.glyphCount/glyphsPerRow),neededHeight=Math.pow(2,Math.ceil(Math.log2(neededRows*sdfGlyphSize)));neededHeight>currentHeight&&(console.info(`Increasing SDF texture size ${currentHeight}->${neededHeight}`),resizeWebGLCanvasWithoutClearing(sdfCanvas,textureWidth,neededHeight),sdfTexture.dispose()),Promise.all(neededSDFs.map((glyphInfo=>generateGlyphSDF(glyphInfo,atlas,args.gpuAccelerateSDF).then((({timing})=>{timings.sdf[glyphInfo.atlasIndex]=timing}))))).then((()=>{neededSDFs.length&&!atlas.contextLost&&(safariPre15Workaround(atlas),sdfTexture.needsUpdate=!0),timings.sdfTotal=now$1()-sdfStart,timings.total=now$1()-totalStart,callback(Object.freeze({parameters:args,sdfTexture,sdfGlyphSize,sdfExponent,glyphBounds,glyphAtlasIndices:glyphIds,glyphColors:result.glyphColors,caretPositions:result.caretPositions,chunkedBounds:result.chunkedBounds,ascender:result.ascender,descender:result.descender,lineHeight:result.lineHeight,capHeight:result.capHeight,xHeight:result.xHeight,topBaseline:result.topBaseline,blockBounds:result.blockBounds,visibleBounds:result.visibleBounds,timings:result.timings}))}))})),Promise.resolve().then((()=>{atlas.contextLost||function warmUpSDFCanvas(canvas){canvas._warm||(mainThreadGenerator.webgl.isSupported(canvas),canvas._warm=!0)}(sdfCanvas)}))}function generateGlyphSDF({path,atlasIndex,sdfViewBox},{sdfGlyphSize,sdfCanvas,contextLost},useGPU){if(contextLost)return Promise.resolve({timing:-1});const{textureWidth,sdfExponent}=CONFIG,maxDist=Math.max(sdfViewBox[2]-sdfViewBox[0],sdfViewBox[3]-sdfViewBox[1]),squareIndex=Math.floor(atlasIndex/4);return function generateSDF(width,height,path,viewBox,distance,exponent,canvas,x,y,channel,useWebGL=!0){return useWebGL?generateSDF_GL(width,height,path,viewBox,distance,exponent,canvas,x,y,channel).then(null,(err=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",err),warned=!0),generateSDF_JS_Worker(width,height,path,viewBox,distance,exponent,canvas,x,y,channel)))):generateSDF_JS_Worker(width,height,path,viewBox,distance,exponent,canvas,x,y,channel)}(sdfGlyphSize,sdfGlyphSize,path,sdfViewBox,maxDist,sdfExponent,sdfCanvas,squareIndex%(textureWidth/sdfGlyphSize)*sdfGlyphSize,Math.floor(squareIndex/(textureWidth/sdfGlyphSize))*sdfGlyphSize,atlasIndex%4,useGPU)}function troika_three_text_esm_assign(toObj,fromObj){for(let key in fromObj)fromObj.hasOwnProperty(key)&&(toObj[key]=fromObj[key]);return toObj}let linkEl;function toAbsoluteURL(path){return linkEl||(linkEl="undefined"==typeof document?{}:document.createElement("a")),linkEl.href=path,linkEl.href}function safariPre15Workaround(atlas){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas,sdfTexture}=atlas,{width,height}=sdfCanvas,gl=atlas.sdfCanvas.getContext("webgl");let pixels=sdfTexture.image.data;pixels&&pixels.length===width*height*4||(pixels=new Uint8Array(width*height*4),sdfTexture.image={width,height,data:pixels},sdfTexture.flipY=!1,sdfTexture.isDataTexture=!0),gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,pixels)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[function createTypesetter(resolveFonts,bidi){const INF=1/0,DEFAULT_IGNORABLE_CHARS=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,BREAK_AFTER_CHARS=new RegExp("[^\\S\\u00A0]|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]");function typeset({text="",font,lang,sdfGlyphSize=64,fontSize=400,fontWeight=1,fontStyle="normal",letterSpacing=0,lineHeight="normal",maxWidth=INF,direction,textAlign="left",textIndent=0,whiteSpace="normal",overflowWrap="normal",anchorX=0,anchorY=0,metricsOnly=!1,unicodeFontsURL,preResolvedFonts=null,includeCaretPositions=!1,chunkedBoundsSize=8192,colorRanges=null},callback){const mainStart=now(),timings={fontLoad:0,typesetting:0};text.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),text=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),fontSize=+fontSize,letterSpacing=+letterSpacing,maxWidth=+maxWidth,lineHeight=lineHeight||"normal",textIndent=+textIndent,function calculateFontRuns({text,lang,fonts,style,weight,preResolvedFonts,unicodeFontsURL},onDone){const onResolved=({chars,fonts:parsedFonts})=>{let curRun,prevVal;const runs=[];for(let i=0;i<chars.length;i++)chars[i]!==prevVal?(prevVal=chars[i],runs.push(curRun={start:i,end:i,fontObj:parsedFonts[chars[i]]})):curRun.end=i;onDone(runs)};preResolvedFonts?onResolved(preResolvedFonts):resolveFonts(text,onResolved,{lang,fonts,style,weight,unicodeFontsURL})}({text,lang,style:fontStyle,weight:fontWeight,fonts:"string"==typeof font?[{src:font}]:font,unicodeFontsURL,preResolvedFonts},(runs=>{timings.fontLoad=now()-mainStart;const hasMaxWidth=isFinite(maxWidth);let glyphIds=null,glyphFontIndices=null,glyphPositions=null,glyphData=null,glyphColors=null,caretPositions=null,visibleBounds=null,chunkedBounds=null,maxLineWidth=0,renderableGlyphCount=0,canWrap="nowrap"!==whiteSpace;const metricsByFont=new Map,typesetStart=now();let lineXOffset=textIndent,prevRunEndX=0,currentLine=new TextLine;const lines=[currentLine];runs.forEach((run=>{const{fontObj}=run,{ascender,descender,unitsPerEm,lineGap,capHeight,xHeight}=fontObj;let fontData=metricsByFont.get(fontObj);if(!fontData){const fontSizeMult=fontSize/unitsPerEm,calcLineHeight="normal"===lineHeight?(ascender-descender+lineGap)*fontSizeMult:lineHeight*fontSize,halfLeading=(calcLineHeight-(ascender-descender)*fontSizeMult)/2,caretHeight=Math.min(calcLineHeight,(ascender-descender)*fontSizeMult),caretTop=(ascender+descender)/2*fontSizeMult+caretHeight/2;fontData={index:metricsByFont.size,src:fontObj.src,fontObj,fontSizeMult,unitsPerEm,ascender:ascender*fontSizeMult,descender:descender*fontSizeMult,capHeight:capHeight*fontSizeMult,xHeight:xHeight*fontSizeMult,lineHeight:calcLineHeight,baseline:-halfLeading-ascender*fontSizeMult,caretTop,caretBottom:caretTop-caretHeight},metricsByFont.set(fontObj,fontData)}const{fontSizeMult}=fontData,runText=text.slice(run.start,run.end+1);let prevGlyphX,prevGlyphObj;fontObj.forEachGlyph(runText,fontSize,letterSpacing,((glyphObj,glyphX,glyphY,charIndex)=>{glyphX+=prevRunEndX,charIndex+=run.start,prevGlyphX=glyphX,prevGlyphObj=glyphObj;const char=text.charAt(charIndex),glyphWidth=glyphObj.advanceWidth*fontSizeMult,curLineCount=currentLine.count;let nextLine;if("isEmpty"in glyphObj||(glyphObj.isWhitespace=!!char&&new RegExp("[^\\S\\u00A0]").test(char),glyphObj.canBreakAfter=!!char&&BREAK_AFTER_CHARS.test(char),glyphObj.isEmpty=glyphObj.xMin===glyphObj.xMax||glyphObj.yMin===glyphObj.yMax||DEFAULT_IGNORABLE_CHARS.test(char)),glyphObj.isWhitespace||glyphObj.isEmpty||renderableGlyphCount++,canWrap&&hasMaxWidth&&!glyphObj.isWhitespace&&glyphX+glyphWidth+lineXOffset>maxWidth&&curLineCount){if(currentLine.glyphAt(curLineCount-1).glyphObj.canBreakAfter)nextLine=new TextLine,lineXOffset=-glyphX;else for(let i=curLineCount;i--;){if(0===i&&"break-word"===overflowWrap){nextLine=new TextLine,lineXOffset=-glyphX;break}if(currentLine.glyphAt(i).glyphObj.canBreakAfter){nextLine=currentLine.splitAt(i+1);const adjustX=nextLine.glyphAt(0).x;lineXOffset-=adjustX;for(let j=nextLine.count;j--;)nextLine.glyphAt(j).x-=adjustX;break}}nextLine&&(currentLine.isSoftWrapped=!0,currentLine=nextLine,lines.push(currentLine),maxLineWidth=maxWidth)}let fly=currentLine.glyphAt(currentLine.count);fly.glyphObj=glyphObj,fly.x=glyphX+lineXOffset,fly.y=glyphY,fly.width=glyphWidth,fly.charIndex=charIndex,fly.fontData=fontData,"\n"===char&&(currentLine=new TextLine,lines.push(currentLine),lineXOffset=-(glyphX+glyphWidth+letterSpacing*fontSize)+textIndent)})),prevRunEndX=prevGlyphX+prevGlyphObj.advanceWidth*fontSizeMult+letterSpacing*fontSize}));let totalHeight=0;lines.forEach((line=>{let isTrailingWhitespace=!0;for(let i=line.count;i--;){const glyphInfo=line.glyphAt(i);isTrailingWhitespace&&!glyphInfo.glyphObj.isWhitespace&&(line.width=glyphInfo.x+glyphInfo.width,line.width>maxLineWidth&&(maxLineWidth=line.width),isTrailingWhitespace=!1);let{lineHeight,capHeight,xHeight,baseline}=glyphInfo.fontData;lineHeight>line.lineHeight&&(line.lineHeight=lineHeight);const baselineDiff=baseline-line.baseline;baselineDiff<0&&(line.baseline+=baselineDiff,line.cap+=baselineDiff,line.ex+=baselineDiff),line.cap=Math.max(line.cap,line.baseline+capHeight),line.ex=Math.max(line.ex,line.baseline+xHeight)}line.baseline-=totalHeight,line.cap-=totalHeight,line.ex-=totalHeight,totalHeight+=line.lineHeight}));let anchorXOffset=0,anchorYOffset=0;if(anchorX&&("number"==typeof anchorX?anchorXOffset=-anchorX:"string"==typeof anchorX&&(anchorXOffset=-maxLineWidth*("left"===anchorX?0:"center"===anchorX?.5:"right"===anchorX?1:parsePercent(anchorX)))),anchorY&&("number"==typeof anchorY?anchorYOffset=-anchorY:"string"==typeof anchorY&&(anchorYOffset="top"===anchorY?0:"top-baseline"===anchorY?-lines[0].baseline:"top-cap"===anchorY?-lines[0].cap:"top-ex"===anchorY?-lines[0].ex:"middle"===anchorY?totalHeight/2:"bottom"===anchorY?totalHeight:"bottom-baseline"===anchorY?-lines[lines.length-1].baseline:parsePercent(anchorY)*totalHeight)),!metricsOnly){const bidiLevelsResult=bidi.getEmbeddingLevels(text,direction);glyphIds=new Uint16Array(renderableGlyphCount),glyphFontIndices=new Uint8Array(renderableGlyphCount),glyphPositions=new Float32Array(2*renderableGlyphCount),glyphData={},visibleBounds=[INF,INF,-1/0,-1/0],chunkedBounds=[],includeCaretPositions&&(caretPositions=new Float32Array(4*text.length)),colorRanges&&(glyphColors=new Uint8Array(3*renderableGlyphCount));let chunk,currentColor,renderableGlyphIndex=0,prevCharIndex=-1,colorCharIndex=-1;if(lines.forEach(((line,lineIndex)=>{let{count:lineGlyphCount,width:lineWidth}=line;if(lineGlyphCount>0){let trailingWhitespaceCount=0;for(let i=lineGlyphCount;i--&&line.glyphAt(i).glyphObj.isWhitespace;)trailingWhitespaceCount++;let lineXOffset=0,justifyAdjust=0;if("center"===textAlign)lineXOffset=(maxLineWidth-lineWidth)/2;else if("right"===textAlign)lineXOffset=maxLineWidth-lineWidth;else if("justify"===textAlign&&line.isSoftWrapped){let whitespaceCount=0;for(let i=lineGlyphCount-trailingWhitespaceCount;i--;)line.glyphAt(i).glyphObj.isWhitespace&&whitespaceCount++;justifyAdjust=(maxLineWidth-lineWidth)/whitespaceCount}if(justifyAdjust||lineXOffset){let justifyOffset=0;for(let i=0;i<lineGlyphCount;i++){let glyphInfo=line.glyphAt(i);const glyphObj=glyphInfo.glyphObj;glyphInfo.x+=lineXOffset+justifyOffset,0!==justifyAdjust&&glyphObj.isWhitespace&&i<lineGlyphCount-trailingWhitespaceCount&&(justifyOffset+=justifyAdjust,glyphInfo.width+=justifyAdjust)}}const flips=bidi.getReorderSegments(text,bidiLevelsResult,line.glyphAt(0).charIndex,line.glyphAt(line.count-1).charIndex);for(let fi=0;fi<flips.length;fi++){const[start,end]=flips[fi];let left=1/0,right=-1/0;for(let i=0;i<lineGlyphCount;i++)if(line.glyphAt(i).charIndex>=start){let startInLine=i,endInLine=i;for(;endInLine<lineGlyphCount;endInLine++){let info=line.glyphAt(endInLine);if(info.charIndex>end)break;endInLine<lineGlyphCount-trailingWhitespaceCount&&(left=Math.min(left,info.x),right=Math.max(right,info.x+info.width))}for(let j=startInLine;j<endInLine;j++){const glyphInfo=line.glyphAt(j);glyphInfo.x=right-(glyphInfo.x+glyphInfo.width-left)}break}}let glyphObj;const setGlyphObj=g=>glyphObj=g;for(let i=0;i<lineGlyphCount;i++){const glyphInfo=line.glyphAt(i);glyphObj=glyphInfo.glyphObj;const glyphId=glyphObj.index,rtl=1&bidiLevelsResult.levels[glyphInfo.charIndex];if(rtl){const mirrored=bidi.getMirroredCharacter(text[glyphInfo.charIndex]);mirrored&&glyphInfo.fontData.fontObj.forEachGlyph(mirrored,0,0,setGlyphObj)}if(includeCaretPositions){const{charIndex,fontData}=glyphInfo,caretLeft=glyphInfo.x+anchorXOffset,caretRight=glyphInfo.x+glyphInfo.width+anchorXOffset;caretPositions[4*charIndex]=rtl?caretRight:caretLeft,caretPositions[4*charIndex+1]=rtl?caretLeft:caretRight,caretPositions[4*charIndex+2]=line.baseline+fontData.caretBottom+anchorYOffset,caretPositions[4*charIndex+3]=line.baseline+fontData.caretTop+anchorYOffset;const ligCount=charIndex-prevCharIndex;ligCount>1&&fillLigatureCaretPositions(caretPositions,prevCharIndex,ligCount),prevCharIndex=charIndex}if(colorRanges){const{charIndex}=glyphInfo;for(;charIndex>colorCharIndex;)colorCharIndex++,colorRanges.hasOwnProperty(colorCharIndex)&&(currentColor=colorRanges[colorCharIndex])}if(!glyphObj.isWhitespace&&!glyphObj.isEmpty){const idx=renderableGlyphIndex++,{fontSizeMult,src:fontSrc,index:fontIndex}=glyphInfo.fontData,fontGlyphData=glyphData[fontSrc]||(glyphData[fontSrc]={});fontGlyphData[glyphId]||(fontGlyphData[glyphId]={path:glyphObj.path,pathBounds:[glyphObj.xMin,glyphObj.yMin,glyphObj.xMax,glyphObj.yMax]});const glyphX=glyphInfo.x+anchorXOffset,glyphY=glyphInfo.y+line.baseline+anchorYOffset;glyphPositions[2*idx]=glyphX,glyphPositions[2*idx+1]=glyphY;const visX0=glyphX+glyphObj.xMin*fontSizeMult,visY0=glyphY+glyphObj.yMin*fontSizeMult,visX1=glyphX+glyphObj.xMax*fontSizeMult,visY1=glyphY+glyphObj.yMax*fontSizeMult;visX0<visibleBounds[0]&&(visibleBounds[0]=visX0),visY0<visibleBounds[1]&&(visibleBounds[1]=visY0),visX1>visibleBounds[2]&&(visibleBounds[2]=visX1),visY1>visibleBounds[3]&&(visibleBounds[3]=visY1),idx%chunkedBoundsSize==0&&(chunk={start:idx,end:idx,rect:[INF,INF,-1/0,-1/0]},chunkedBounds.push(chunk)),chunk.end++;const chunkRect=chunk.rect;if(visX0<chunkRect[0]&&(chunkRect[0]=visX0),visY0<chunkRect[1]&&(chunkRect[1]=visY0),visX1>chunkRect[2]&&(chunkRect[2]=visX1),visY1>chunkRect[3]&&(chunkRect[3]=visY1),glyphIds[idx]=glyphId,glyphFontIndices[idx]=fontIndex,colorRanges){const start=3*idx;glyphColors[start]=currentColor>>16&255,glyphColors[start+1]=currentColor>>8&255,glyphColors[start+2]=255&currentColor}}}}})),caretPositions){const ligCount=text.length-prevCharIndex;ligCount>1&&fillLigatureCaretPositions(caretPositions,prevCharIndex,ligCount)}}const fontData=[];metricsByFont.forEach((({index,src,unitsPerEm,ascender,descender,lineHeight,capHeight,xHeight})=>{fontData[index]={src,unitsPerEm,ascender,descender,lineHeight,capHeight,xHeight}})),timings.typesetting=now()-typesetStart,callback({glyphIds,glyphFontIndices,glyphPositions,glyphData,fontData,caretPositions,glyphColors,chunkedBounds,fontSize,topBaseline:anchorYOffset+lines[0].baseline,blockBounds:[anchorXOffset,anchorYOffset-totalHeight,anchorXOffset+maxLineWidth,anchorYOffset],visibleBounds,timings})}))}function parsePercent(str){let match=str.match(/^([\d.]+)%$/),pct=match?parseFloat(match[1]):NaN;return isNaN(pct)?0:pct/100}function fillLigatureCaretPositions(caretPositions,ligStartIndex,ligCount){const ligStartX=caretPositions[4*ligStartIndex],ligEndX=caretPositions[4*ligStartIndex+1],ligBottom=caretPositions[4*ligStartIndex+2],ligTop=caretPositions[4*ligStartIndex+3],guessedAdvanceX=(ligEndX-ligStartX)/ligCount;for(let i=0;i<ligCount;i++){const startIndex=4*(ligStartIndex+i);caretPositions[startIndex]=ligStartX+guessedAdvanceX*i,caretPositions[startIndex+1]=ligStartX+guessedAdvanceX*(i+1),caretPositions[startIndex+2]=ligBottom,caretPositions[startIndex+3]=ligTop}}function now(){return(self.performance||Date).now()}function TextLine(){this.data=[]}const textLineProps=["glyphObj","x","y","width","charIndex","fontData"];return TextLine.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/textLineProps.length)},glyphAt(i){let fly=TextLine.flyweight;return fly.data=this.data,fly.index=i,fly},splitAt(i){let newLine=new TextLine;return newLine.data=this.data.splice(i*textLineProps.length),newLine}},TextLine.flyweight=textLineProps.reduce(((obj,prop,i,all)=>(Object.defineProperty(obj,prop,{get(){return this.data[this.index*textLineProps.length+i]},set(val){this.data[this.index*textLineProps.length+i]=val}}),obj)),{data:null,index:0}),{typeset,measure:function measure(args,callback){typeset({...args,metricsOnly:!0},(result=>{const[x0,y0,x1,y1]=result.blockBounds;callback({width:x1-x0,height:y1-y0})}))}}},fontResolverWorkerModule,bidi],init:(createTypesetter,fontResolver,bidiFactory)=>createTypesetter(fontResolver,bidiFactory())}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init:typesetter=>function(args){return new Promise((resolve=>{typesetter.typeset(args,resolve)}))},getTransferables(result){const transferables=[];for(let p in result)result[p]&&result[p].buffer&&transferables.push(result[p].buffer);return transferables}}),typesetOnMainThread=typesetInWorker.onMainThread;const templateGeometries={};class GlyphsGeometry extends three_core.CmU{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new three_core.iyt,this.boundingBox=new three_core.NRn}computeBoundingSphere(){}computeBoundingBox(){}set detail(detail){if(detail!==this._detail){this._detail=detail,("number"!=typeof detail||detail<1)&&(detail=1);let tpl=function getTemplateGeometry(detail){let geom=templateGeometries[detail];return geom||(geom=templateGeometries[detail]=new three_core.bdM(1,1,detail,detail).translate(.5,.5,0)),geom}(detail);["position","normal","uv"].forEach((attr=>{this.attributes[attr]=tpl.attributes[attr].clone()})),this.setIndex(tpl.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(glyphBounds,glyphAtlasIndices,blockBounds,chunkedBounds,glyphColors){this.updateAttributeData("aTroikaGlyphBounds",glyphBounds,4),this.updateAttributeData("aTroikaGlyphIndex",glyphAtlasIndices,1),this.updateAttributeData("aTroikaGlyphColor",glyphColors,3),this._blockBounds=blockBounds,this._chunkedBounds=chunkedBounds,this.instanceCount=glyphAtlasIndices.length,this._updateBounds()}_updateBounds(){const bounds=this._blockBounds;if(bounds){const{curveRadius,boundingBox:bbox}=this;if(curveRadius){const{PI,floor,min,max,sin,cos}=Math,halfPi=PI/2,twoPi=2*PI,absR=Math.abs(curveRadius),leftAngle=bounds[0]/absR,rightAngle=bounds[2]/absR,minX=floor((leftAngle+halfPi)/twoPi)!==floor((rightAngle+halfPi)/twoPi)?-absR:min(sin(leftAngle)*absR,sin(rightAngle)*absR),maxX=floor((leftAngle-halfPi)/twoPi)!==floor((rightAngle-halfPi)/twoPi)?absR:max(sin(leftAngle)*absR,sin(rightAngle)*absR),maxZ=floor((leftAngle+PI)/twoPi)!==floor((rightAngle+PI)/twoPi)?2*absR:max(absR-cos(leftAngle)*absR,absR-cos(rightAngle)*absR);bbox.min.set(minX,bounds[1],curveRadius<0?-maxZ:0),bbox.max.set(maxX,bounds[3],curveRadius<0?0:maxZ)}else bbox.min.set(bounds[0],bounds[1],0),bbox.max.set(bounds[2],bounds[3],0);bbox.getBoundingSphere(this.boundingSphere)}}applyClipRect(clipRect){let count=this.getAttribute("aTroikaGlyphIndex").count,chunks=this._chunkedBounds;if(chunks)for(let i=chunks.length;i--;){count=chunks[i].end;let rect=chunks[i].rect;if(rect[1]<clipRect.w&&rect[3]>clipRect.y&&rect[0]<clipRect.z&&rect[2]>clipRect.x)break}this.instanceCount=count}updateAttributeData(attrName,newArray,itemSize){const attr=this.getAttribute(attrName);newArray?attr&&attr.array.length===newArray.length?(attr.array.set(newArray),attr.needsUpdate=!0):(this.setAttribute(attrName,new three_core.uWO(newArray,itemSize)),delete this._maxInstanceCount,this.dispose()):attr&&this.deleteAttribute(attrName)}}function createTextDerivedMaterial(baseMaterial){const textMaterial=createDerivedMaterial(baseMaterial,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new three_core.I9Y},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new three_core.IUQ(0,0,0,0)},uTroikaClipRect:{value:new three_core.IUQ(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new three_core.I9Y},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new three_core.Q1f},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new three_core.dwI},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader,fragmentShader}){let uDiffuseRE=/\buniform\s+vec3\s+diffuse\b/;return uDiffuseRE.test(fragmentShader)&&(fragmentShader=fragmentShader.replace(uDiffuseRE,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),uDiffuseRE.test(vertexShader)||(vertexShader=vertexShader.replace(voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader,fragmentShader}}});return textMaterial.transparent=!0,textMaterial.forceSinglePass=!0,Object.defineProperties(textMaterial,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),textMaterial}const defaultMaterial=new three_core.V9B({color:16777215,side:three_core.$EB,transparent:!0}),tempMat4=new three_core.kn4,tempVec3a=new three_core.Pq0,tempVec3b=new three_core.Pq0,tempArray=[],origin=new three_core.Pq0;function first(o){return Array.isArray(o)?o[0]:o}let getFlatRaycastMesh=()=>{const mesh=new three_core.eaF(new three_core.bdM(1,1),defaultMaterial);return getFlatRaycastMesh=()=>mesh,mesh},getCurvedRaycastMesh=()=>{const mesh=new three_core.eaF(new three_core.bdM(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>mesh,mesh};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Text extends three_core.eaF{constructor(){super(new GlyphsGeometry,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation="+x+y",this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(callback){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(callback):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},(textRenderInfo=>{this._isSyncing=!1,this._textRenderInfo=textRenderInfo,this.geometry.updateGlyphs(textRenderInfo.glyphBounds,textRenderInfo.glyphAtlasIndices,textRenderInfo.blockBounds,textRenderInfo.chunkedBounds,textRenderInfo.glyphColors);const queued=this._queuedSyncs;queued&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{queued.forEach((fn=>fn&&fn()))}))),this.dispatchEvent(syncCompleteEvent),callback&&callback()}))))}onBeforeRender(renderer,scene,camera,geometry,material,group){this.sync(),material.isTroikaTextMaterial&&this._prepareForRender(material)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(baseMaterial){return createTextDerivedMaterial(baseMaterial)}get material(){let derivedMaterial=this._derivedMaterial;const baseMaterial=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if(derivedMaterial&&derivedMaterial.isDerivedFrom(baseMaterial)||(derivedMaterial=this._derivedMaterial=this.createDerivedMaterial(baseMaterial),baseMaterial.addEventListener("dispose",(function onDispose(){baseMaterial.removeEventListener("dispose",onDispose),derivedMaterial.dispose()}))),this.hasOutline()){let outlineMaterial=derivedMaterial._outlineMtl;return outlineMaterial||(outlineMaterial=derivedMaterial._outlineMtl=Object.create(derivedMaterial,{id:{value:derivedMaterial.id+.1}}),outlineMaterial.isTextOutlineMaterial=!0,outlineMaterial.depthWrite=!1,outlineMaterial.map=null,derivedMaterial.addEventListener("dispose",(function onDispose(){derivedMaterial.removeEventListener("dispose",onDispose),outlineMaterial.dispose()}))),[outlineMaterial,derivedMaterial]}return derivedMaterial}set material(baseMaterial){baseMaterial&&baseMaterial.isTroikaTextMaterial?(this._derivedMaterial=baseMaterial,this._baseMaterial=baseMaterial.baseMaterial):this._baseMaterial=baseMaterial}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(detail){this.geometry.detail=detail}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(material){const isOutline=material.isTextOutlineMaterial,uniforms=material.uniforms,textInfo=this.textRenderInfo;if(textInfo){const{sdfTexture,blockBounds}=textInfo;uniforms.uTroikaSDFTexture.value=sdfTexture,uniforms.uTroikaSDFTextureSize.value.set(sdfTexture.image.width,sdfTexture.image.height),uniforms.uTroikaSDFGlyphSize.value=textInfo.sdfGlyphSize,uniforms.uTroikaSDFExponent.value=textInfo.sdfExponent,uniforms.uTroikaTotalBounds.value.fromArray(blockBounds),uniforms.uTroikaUseGlyphColors.value=!isOutline&&!!textInfo.glyphColors;let fillOpacity,strokeOpacity,strokeColor,distanceOffset=0,blurRadius=0,strokeWidth=0,offsetX=0,offsetY=0;if(isOutline){let{outlineWidth,outlineOffsetX,outlineOffsetY,outlineBlur,outlineOpacity}=this;distanceOffset=this._parsePercent(outlineWidth)||0,blurRadius=Math.max(0,this._parsePercent(outlineBlur)||0),fillOpacity=outlineOpacity,offsetX=this._parsePercent(outlineOffsetX)||0,offsetY=this._parsePercent(outlineOffsetY)||0}else strokeWidth=Math.max(0,this._parsePercent(this.strokeWidth)||0),strokeWidth&&(strokeColor=this.strokeColor,uniforms.uTroikaStrokeColor.value.set(null==strokeColor?8421504:strokeColor),strokeOpacity=this.strokeOpacity,null==strokeOpacity&&(strokeOpacity=1)),fillOpacity=this.fillOpacity;uniforms.uTroikaEdgeOffset.value=distanceOffset,uniforms.uTroikaPositionOffset.value.set(offsetX,offsetY),uniforms.uTroikaBlurRadius.value=blurRadius,uniforms.uTroikaStrokeWidth.value=strokeWidth,uniforms.uTroikaStrokeOpacity.value=strokeOpacity,uniforms.uTroikaFillOpacity.value=null==fillOpacity?1:fillOpacity,uniforms.uTroikaCurveRadius.value=this.curveRadius||0;let clipRect=this.clipRect;if(clipRect&&Array.isArray(clipRect)&&4===clipRect.length)uniforms.uTroikaClipRect.value.fromArray(clipRect);else{const pad=100*(this.fontSize||.1);uniforms.uTroikaClipRect.value.set(blockBounds[0]-pad,blockBounds[1]-pad,blockBounds[2]+pad,blockBounds[3]+pad)}this.geometry.applyClipRect(uniforms.uTroikaClipRect.value)}uniforms.uTroikaSDFDebug.value=!!this.debugSDF,material.polygonOffset=!!this.depthOffset,material.polygonOffsetFactor=material.polygonOffsetUnits=this.depthOffset||0;const color=isOutline?this.outlineColor||0:this.color;if(null==color)delete material.color;else{const colorObj=material.hasOwnProperty("color")?material.color:material.color=new three_core.Q1f;color===colorObj._input&&"object"!=typeof color||colorObj.set(colorObj._input=color)}let orient=this.orientation||"+x+y";if(orient!==material._orientation){let rotMat=uniforms.uTroikaOrient.value;orient=orient.replace(/[^-+xyz]/g,"");let match="+x+y"!==orient&&orient.match(/^([-+])([xyz])([-+])([xyz])$/);if(match){let[,hSign,hAxis,vSign,vAxis]=match;tempVec3a.set(0,0,0)[hAxis]="-"===hSign?1:-1,tempVec3b.set(0,0,0)[vAxis]="-"===vSign?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),rotMat.setFromMatrix4(tempMat4)}else rotMat.identity();material._orientation=orient}}_parsePercent(value){if("string"==typeof value){let match=value.match(/^(-?[\d.]+)%$/),pct=match?parseFloat(match[1]):NaN;value=(isNaN(pct)?0:pct/100)*this.fontSize}return value}localPositionToTextCoords(position,target=new three_core.I9Y){target.copy(position);const r=this.curveRadius;return r&&(target.x=Math.atan2(position.x,Math.abs(r)-Math.abs(position.z))*Math.abs(r)),target}worldPositionToTextCoords(position,target=new three_core.I9Y){return tempVec3a.copy(position),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),target)}raycast(raycaster,intersects){const{textRenderInfo,curveRadius}=this;if(textRenderInfo){const bounds=textRenderInfo.blockBounds,raycastMesh=curveRadius?getCurvedRaycastMesh():getFlatRaycastMesh(),geom=raycastMesh.geometry,{position,uv}=geom.attributes;for(let i=0;i<uv.count;i++){let x=bounds[0]+uv.getX(i)*(bounds[2]-bounds[0]);const y=bounds[1]+uv.getY(i)*(bounds[3]-bounds[1]);let z=0;curveRadius&&(z=curveRadius-Math.cos(x/curveRadius)*curveRadius,x=Math.sin(x/curveRadius)*curveRadius),position.setXYZ(i,x,y,z)}geom.boundingSphere=this.geometry.boundingSphere,geom.boundingBox=this.geometry.boundingBox,raycastMesh.matrixWorld=this.matrixWorld,raycastMesh.material.side=this.material.side,tempArray.length=0,raycastMesh.raycast(raycaster,tempArray);for(let i=0;i<tempArray.length;i++)tempArray[i].object=this,intersects.push(tempArray[i])}}copy(source){const geom=this.geometry;return super.copy(source),this.geometry=geom,COPYABLE_PROPS.forEach((prop=>{this[prop]=source[prop]})),this}clone(){return(new this.constructor).copy(this)}}SYNCABLE_PROPS.forEach((prop=>{const privateKey="_private_"+prop;Object.defineProperty(Text.prototype,prop,{get(){return this[privateKey]},set(value){value!==this[privateKey]&&(this[privateKey]=value,this._needsSync=!0)}})}));new three_core.NRn,new three_core.Q1f;new WeakMap;new WeakMap;var asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(eb,start){for(var b=new u16(31),i=0;i<31;++i)b[i]=start+=1<<eb[i-1];var r=new u32(b[30]);for(i=1;i<30;++i)for(var j=b[i];j<b[i+1];++j)r[j]=j-b[i]<<5|i;return[b,r]},_a=freb(fleb,2),fl=_a[0],revfl=_a[1];fl[28]=258,revfl[258]=28;for(var _b=freb(fdeb,0),fd=_b[0],rev=(_b[1],new u16(32768)),i=0;i<32768;++i){var x=(43690&i)>>>1|(21845&i)<<1;x=(61680&(x=(52428&x)>>>2|(13107&x)<<2))>>>4|(3855&x)<<4,rev[i]=((65280&x)>>>8|(255&x)<<8)>>>1}var hMap=function(cd,mb,r){for(var s=cd.length,i=0,l=new u16(mb);i<s;++i)++l[cd[i]-1];var co,le=new u16(mb);for(i=0;i<mb;++i)le[i]=le[i-1]+l[i-1]<<1;if(r){co=new u16(1<<mb);var rvb=15-mb;for(i=0;i<s;++i)if(cd[i])for(var sv=i<<4|cd[i],r_1=mb-cd[i],v=le[cd[i]-1]++<<r_1,m=v|(1<<r_1)-1;v<=m;++v)co[rev[v]>>>rvb]=sv}else for(co=new u16(s),i=0;i<s;++i)cd[i]&&(co[i]=rev[le[cd[i]-1]++]>>>15-cd[i]);return co},flt=new u8(288);for(i=0;i<144;++i)flt[i]=8;for(i=144;i<256;++i)flt[i]=9;for(i=256;i<280;++i)flt[i]=7;for(i=280;i<288;++i)flt[i]=8;var fdt=new u8(32);for(i=0;i<32;++i)fdt[i]=5;var flrm=hMap(flt,9,1),fdrm=hMap(fdt,5,1),max=function(a){for(var m=a[0],i=1;i<a.length;++i)a[i]>m&&(m=a[i]);return m},bits=function(d,p,m){var o=p/8|0;return(d[o]|d[o+1]<<8)>>(7&p)&m},bits16=function(d,p){var o=p/8|0;return(d[o]|d[o+1]<<8|d[o+2]<<16)>>(7&p)},shft=function(p){return(p/8|0)+(7&p&&1)},slc=function(v,s,e){(null==s||s<0)&&(s=0),(null==e||e>v.length)&&(e=v.length);var n=new(v instanceof u16?u16:v instanceof u32?u32:u8)(e-s);return n.set(v.subarray(s,e)),n},inflt=function(dat,buf,st){var sl=dat.length;if(!sl||st&&!st.l&&sl<5)return buf||new u8(0);var noBuf=!buf||st,noSt=!st||st.i;st||(st={}),buf||(buf=new u8(3*sl));var cbuf=function(l){var bl=buf.length;if(l>bl){var nbuf=new u8(Math.max(2*bl,l));nbuf.set(buf),buf=nbuf}},final=st.f||0,pos=st.p||0,bt=st.b||0,lm=st.l,dm=st.d,lbt=st.m,dbt=st.n,tbts=8*sl;do{if(!lm){st.f=final=bits(dat,pos,1);var type=bits(dat,pos+1,3);if(pos+=3,!type){var l=dat[(s=shft(pos)+4)-4]|dat[s-3]<<8,t=s+l;if(t>sl){if(noSt)throw"unexpected EOF";break}noBuf&&cbuf(bt+l),buf.set(dat.subarray(s,t),bt),st.b=bt+=l,st.p=pos=8*t;continue}if(1==type)lm=flrm,dm=fdrm,lbt=9,dbt=5;else{if(2!=type)throw"invalid block type";var hLit=bits(dat,pos,31)+257,hcLen=bits(dat,pos+10,15)+4,tl=hLit+bits(dat,pos+5,31)+1;pos+=14;for(var ldt=new u8(tl),clt=new u8(19),i=0;i<hcLen;++i)clt[clim[i]]=bits(dat,pos+3*i,7);pos+=3*hcLen;var clb=max(clt),clbmsk=(1<<clb)-1,clm=hMap(clt,clb,1);for(i=0;i<tl;){var s,r=clm[bits(dat,pos,clbmsk)];if(pos+=15&r,(s=r>>>4)<16)ldt[i++]=s;else{var c=0,n=0;for(16==s?(n=3+bits(dat,pos,3),pos+=2,c=ldt[i-1]):17==s?(n=3+bits(dat,pos,7),pos+=3):18==s&&(n=11+bits(dat,pos,127),pos+=7);n--;)ldt[i++]=c}}var lt=ldt.subarray(0,hLit),dt=ldt.subarray(hLit);lbt=max(lt),dbt=max(dt),lm=hMap(lt,lbt,1),dm=hMap(dt,dbt,1)}if(pos>tbts){if(noSt)throw"unexpected EOF";break}}noBuf&&cbuf(bt+131072);for(var lms=(1<<lbt)-1,dms=(1<<dbt)-1,lpos=pos;;lpos=pos){var sym=(c=lm[bits16(dat,pos)&lms])>>>4;if((pos+=15&c)>tbts){if(noSt)throw"unexpected EOF";break}if(!c)throw"invalid length/literal";if(sym<256)buf[bt++]=sym;else{if(256==sym){lpos=pos,lm=null;break}var add=sym-254;if(sym>264){var b=fleb[i=sym-257];add=bits(dat,pos,(1<<b)-1)+fl[i],pos+=b}var d=dm[bits16(dat,pos)&dms],dsym=d>>>4;if(!d)throw"invalid distance";pos+=15&d;dt=fd[dsym];if(dsym>3){b=fdeb[dsym];dt+=bits16(dat,pos)&(1<<b)-1,pos+=b}if(pos>tbts){if(noSt)throw"unexpected EOF";break}noBuf&&cbuf(bt+131072);for(var end=bt+add;bt<end;bt+=4)buf[bt]=buf[bt-dt],buf[bt+1]=buf[bt+1-dt],buf[bt+2]=buf[bt+2-dt],buf[bt+3]=buf[bt+3-dt];bt=end}}st.l=lm,st.p=lpos,st.b=bt,lm&&(final=1,st.m=lbt,st.d=dm,st.n=dbt)}while(!final);return bt==buf.length?buf:slc(buf,0,bt)},et=new u8(0),zlv=function(d){if(8!=(15&d[0])||d[0]>>>4>7||(d[0]<<8|d[1])%31)throw"invalid zlib data";if(32&d[1])throw"invalid zlib data: preset dictionaries not supported"};function unzlibSync(data,out){return inflt((zlv(data),data.subarray(2,-4)),out)}var td="undefined"!=typeof TextDecoder&&new TextDecoder;try{td.decode(et,{stream:!0})}catch(e){}function findSpan(p,u,U){const n=U.length-p-1;if(u>=U[n])return n-1;if(u<=U[p])return p;let low=p,high=n,mid=Math.floor((low+high)/2);for(;u<U[mid]||u>=U[mid+1];)u<U[mid]?high=mid:low=mid,mid=Math.floor((low+high)/2);return mid}function calcBasisFunctions(span,u,p,U){const N=[],left=[],right=[];N[0]=1;for(let j=1;j<=p;++j){left[j]=u-U[span+1-j],right[j]=U[span+j]-u;let saved=0;for(let r=0;r<j;++r){const rv=right[r+1],lv=left[j-r],temp=N[r]/(rv+lv);N[r]=saved+rv*temp,saved=lv*temp}N[j]=saved}return N}function calcKoverI(k,i){let nom=1;for(let j=2;j<=k;++j)nom*=j;let denom=1;for(let j=2;j<=i;++j)denom*=j;for(let j=2;j<=k-i;++j)denom*=j;return nom/denom}function calcNURBSDerivatives(p,U,P,u,nd){const Pders=function calcBSplineDerivatives(p,U,P,u,nd){const du=nd<p?nd:p,CK=[],span=findSpan(p,u,U),nders=function calcBasisFunctionDerivatives(span,u,p,n,U){const zeroArr=[];for(let i=0;i<=p;++i)zeroArr[i]=0;const ders=[];for(let i=0;i<=n;++i)ders[i]=zeroArr.slice(0);const ndu=[];for(let i=0;i<=p;++i)ndu[i]=zeroArr.slice(0);ndu[0][0]=1;const left=zeroArr.slice(0),right=zeroArr.slice(0);for(let j=1;j<=p;++j){left[j]=u-U[span+1-j],right[j]=U[span+j]-u;let saved=0;for(let r2=0;r2<j;++r2){const rv=right[r2+1],lv=left[j-r2];ndu[j][r2]=rv+lv;const temp=ndu[r2][j-1]/ndu[j][r2];ndu[r2][j]=saved+rv*temp,saved=lv*temp}ndu[j][j]=saved}for(let j=0;j<=p;++j)ders[0][j]=ndu[j][p];for(let r2=0;r2<=p;++r2){let s1=0,s2=1;const a=[];for(let i=0;i<=p;++i)a[i]=zeroArr.slice(0);a[0][0]=1;for(let k=1;k<=n;++k){let d=0;const rk=r2-k,pk=p-k;r2>=k&&(a[s2][0]=a[s1][0]/ndu[pk+1][rk],d=a[s2][0]*ndu[rk][pk]);const j2=r2-1<=pk?k-1:p-r2;for(let j3=rk>=-1?1:-rk;j3<=j2;++j3)a[s2][j3]=(a[s1][j3]-a[s1][j3-1])/ndu[pk+1][rk+j3],d+=a[s2][j3]*ndu[rk+j3][pk];r2<=pk&&(a[s2][k]=-a[s1][k-1]/ndu[pk+1][r2],d+=a[s2][k]*ndu[r2][pk]),ders[k][r2]=d;const j=s1;s1=s2,s2=j}}let r=p;for(let k=1;k<=n;++k){for(let j=0;j<=p;++j)ders[k][j]*=r;r*=p-k}return ders}(span,u,p,du,U),Pw=[];for(let i=0;i<P.length;++i){const point=P[i].clone(),w=point.w;point.x*=w,point.y*=w,point.z*=w,Pw[i]=point}for(let k=0;k<=du;++k){const point=Pw[span-p].clone().multiplyScalar(nders[k][0]);for(let j=1;j<=p;++j)point.add(Pw[span-p+j].clone().multiplyScalar(nders[k][j]));CK[k]=point}for(let k=du+1;k<=nd+1;++k)CK[k]=new three_core.IUQ(0,0,0);return CK}(p,U,P,u,nd);return function calcRationalCurveDerivatives(Pders){const nd=Pders.length,Aders=[],wders=[];for(let i=0;i<nd;++i){const point=Pders[i];Aders[i]=new three_core.Pq0(point.x,point.y,point.z),wders[i]=point.w}const CK=[];for(let k=0;k<nd;++k){const v=Aders[k].clone();for(let i=1;i<=k;++i)v.sub(CK[k-i].clone().multiplyScalar(calcKoverI(k,i)*wders[i]));CK[k]=v.divideScalar(wders[0])}return CK}(Pders)}class NURBSCurve extends three_core.Ipv{constructor(degree,knots,controlPoints,startKnot,endKnot){super(),this.degree=degree,this.knots=knots,this.controlPoints=[],this.startKnot=startKnot||0,this.endKnot=endKnot||this.knots.length-1;for(let i=0;i<controlPoints.length;++i){const point=controlPoints[i];this.controlPoints[i]=new three_core.IUQ(point.x,point.y,point.z,point.w)}}getPoint(t,optionalTarget){const point=optionalTarget||new three_core.Pq0,u=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),hpoint=function calcBSplinePoint(p,U,P,u){const span=findSpan(p,u,U),N=calcBasisFunctions(span,u,p,U),C=new three_core.IUQ(0,0,0,0);for(let j=0;j<=p;++j){const point=P[span-p+j],Nj=N[j],wNj=point.w*Nj;C.x+=point.x*wNj,C.y+=point.y*wNj,C.z+=point.z*wNj,C.w+=point.w*Nj}return C}(this.degree,this.knots,this.controlPoints,u);return 1!=hpoint.w&&hpoint.divideScalar(hpoint.w),point.set(hpoint.x,hpoint.y,hpoint.z)}getTangent(t,optionalTarget){const tangent=optionalTarget||new three_core.Pq0,u=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),ders=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,u,1);return tangent.copy(ders[1]).normalize(),tangent}}function decodeText(array){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(array);let s="";for(let i=0,il=array.length;i<il;i++)s+=String.fromCharCode(array[i]);try{return decodeURIComponent(escape(s))}catch(e){return s}}let fbxTree,connections,sceneGraph;class FBXLoader extends three_core.aHM{constructor(manager){super(manager)}load(url,onLoad,onProgress,onError){const scope=this,path=""===scope.path?three_core.r6x.extractUrlBase(url):scope.path,loader=new three_core.Y9S(this.manager);loader.setPath(scope.path),loader.setResponseType("arraybuffer"),loader.setRequestHeader(scope.requestHeader),loader.setWithCredentials(scope.withCredentials),loader.load(url,(function(buffer){try{onLoad(scope.parse(buffer,path))}catch(e){onError?onError(e):console.error(e),scope.manager.itemError(url)}}),onProgress,onError)}parse(FBXBuffer,path){if(function isFbxFormatBinary(buffer){const CORRECT="Kaydara FBX Binary  \0";return buffer.byteLength>=CORRECT.length&&CORRECT===convertArrayBufferToString(buffer,0,CORRECT.length)}(FBXBuffer))fbxTree=(new BinaryParser).parse(FBXBuffer);else{const FBXText=convertArrayBufferToString(FBXBuffer);if(!function isFbxFormatASCII(text){const CORRECT=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let cursor=0;function read(offset){const result=text[offset-1];return text=text.slice(cursor+offset),cursor++,result}for(let i=0;i<CORRECT.length;++i){if(read(1)===CORRECT[i])return!1}return!0}(FBXText))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(FBXText)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(FBXText));fbxTree=(new TextParser).parse(FBXText)}const textureLoader=new three_core.Tap(this.manager).setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin);return new FBXTreeParser(textureLoader,this.manager).parse(fbxTree)}}class FBXTreeParser{constructor(textureLoader,manager){this.textureLoader=textureLoader,this.manager=manager}parse(){connections=this.parseConnections();const images=this.parseImages(),textures=this.parseTextures(images),materials=this.parseMaterials(textures),deformers=this.parseDeformers(),geometryMap=(new GeometryParser).parse(deformers);return this.parseScene(deformers,geometryMap,materials),sceneGraph}parseConnections(){const connectionMap=new Map;if("Connections"in fbxTree){fbxTree.Connections.connections.forEach((function(rawConnection){const fromID=rawConnection[0],toID=rawConnection[1],relationship=rawConnection[2];connectionMap.has(fromID)||connectionMap.set(fromID,{parents:[],children:[]});const parentRelationship={ID:toID,relationship};connectionMap.get(fromID).parents.push(parentRelationship),connectionMap.has(toID)||connectionMap.set(toID,{parents:[],children:[]});const childRelationship={ID:fromID,relationship};connectionMap.get(toID).children.push(childRelationship)}))}return connectionMap}parseImages(){const images={},blobs={};if("Video"in fbxTree.Objects){const videoNodes=fbxTree.Objects.Video;for(const nodeID in videoNodes){const videoNode=videoNodes[nodeID];if(images[parseInt(nodeID)]=videoNode.RelativeFilename||videoNode.Filename,"Content"in videoNode){const arrayBufferContent=videoNode.Content instanceof ArrayBuffer&&videoNode.Content.byteLength>0,base64Content="string"==typeof videoNode.Content&&""!==videoNode.Content;if(arrayBufferContent||base64Content){const image=this.parseImage(videoNodes[nodeID]);blobs[videoNode.RelativeFilename||videoNode.Filename]=image}}}}for(const id in images){const filename=images[id];void 0!==blobs[filename]?images[id]=blobs[filename]:images[id]=images[id].split("\\").pop()}return images}parseImage(videoNode){const content=videoNode.Content,fileName=videoNode.RelativeFilename||videoNode.Filename,extension=fileName.slice(fileName.lastIndexOf(".")+1).toLowerCase();let type;switch(extension){case"bmp":type="image/bmp";break;case"jpg":case"jpeg":type="image/jpeg";break;case"png":type="image/png";break;case"tif":type="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",fileName),type="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+extension+'" is not supported.')}if("string"==typeof content)return"data:"+type+";base64,"+content;{const array=new Uint8Array(content);return window.URL.createObjectURL(new Blob([array],{type}))}}parseTextures(images){const textureMap=new Map;if("Texture"in fbxTree.Objects){const textureNodes=fbxTree.Objects.Texture;for(const nodeID in textureNodes){const texture=this.parseTexture(textureNodes[nodeID],images);textureMap.set(parseInt(nodeID),texture)}}return textureMap}parseTexture(textureNode,images){const texture=this.loadTexture(textureNode,images);texture.ID=textureNode.id,texture.name=textureNode.attrName;const wrapModeU=textureNode.WrapModeU,wrapModeV=textureNode.WrapModeV,valueU=void 0!==wrapModeU?wrapModeU.value:0,valueV=void 0!==wrapModeV?wrapModeV.value:0;if(texture.wrapS=0===valueU?three_core.GJx:three_core.ghU,texture.wrapT=0===valueV?three_core.GJx:three_core.ghU,"Scaling"in textureNode){const values=textureNode.Scaling.value;texture.repeat.x=values[0],texture.repeat.y=values[1]}return texture}loadTexture(textureNode,images){let fileName;const currentPath=this.textureLoader.path,children=connections.get(textureNode.id).children;let texture;void 0!==children&&children.length>0&&void 0!==images[children[0].ID]&&(fileName=images[children[0].ID],0!==fileName.indexOf("blob:")&&0!==fileName.indexOf("data:")||this.textureLoader.setPath(void 0));const extension=textureNode.FileName.slice(-3).toLowerCase();if("tga"===extension){const loader=this.manager.getHandler(".tga");null===loader?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",textureNode.RelativeFilename),texture=new three_core.gPd):(loader.setPath(this.textureLoader.path),texture=loader.load(fileName))}else"psd"===extension?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",textureNode.RelativeFilename),texture=new three_core.gPd):texture=this.textureLoader.load(fileName);return this.textureLoader.setPath(currentPath),texture}parseMaterials(textureMap){const materialMap=new Map;if("Material"in fbxTree.Objects){const materialNodes=fbxTree.Objects.Material;for(const nodeID in materialNodes){const material=this.parseMaterial(materialNodes[nodeID],textureMap);null!==material&&materialMap.set(parseInt(nodeID),material)}}return materialMap}parseMaterial(materialNode,textureMap){const ID=materialNode.id,name=materialNode.attrName;let type=materialNode.ShadingModel;if("object"==typeof type&&(type=type.value),!connections.has(ID))return null;const parameters=this.parseParameters(materialNode,textureMap,ID);let material;switch(type.toLowerCase()){case"phong":material=new three_core.tXL;break;case"lambert":material=new three_core.G_z;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',type),material=new three_core.tXL}return material.setValues(parameters),material.name=name,material}parseParameters(materialNode,textureMap,ID){const parameters={};materialNode.BumpFactor&&(parameters.bumpScale=materialNode.BumpFactor.value),materialNode.Diffuse?parameters.color=(new three_core.Q1f).fromArray(materialNode.Diffuse.value):!materialNode.DiffuseColor||"Color"!==materialNode.DiffuseColor.type&&"ColorRGB"!==materialNode.DiffuseColor.type||(parameters.color=(new three_core.Q1f).fromArray(materialNode.DiffuseColor.value)),materialNode.DisplacementFactor&&(parameters.displacementScale=materialNode.DisplacementFactor.value),materialNode.Emissive?parameters.emissive=(new three_core.Q1f).fromArray(materialNode.Emissive.value):!materialNode.EmissiveColor||"Color"!==materialNode.EmissiveColor.type&&"ColorRGB"!==materialNode.EmissiveColor.type||(parameters.emissive=(new three_core.Q1f).fromArray(materialNode.EmissiveColor.value)),materialNode.EmissiveFactor&&(parameters.emissiveIntensity=parseFloat(materialNode.EmissiveFactor.value)),materialNode.Opacity&&(parameters.opacity=parseFloat(materialNode.Opacity.value)),parameters.opacity<1&&(parameters.transparent=!0),materialNode.ReflectionFactor&&(parameters.reflectivity=materialNode.ReflectionFactor.value),materialNode.Shininess&&(parameters.shininess=materialNode.Shininess.value),materialNode.Specular?parameters.specular=(new three_core.Q1f).fromArray(materialNode.Specular.value):materialNode.SpecularColor&&"Color"===materialNode.SpecularColor.type&&(parameters.specular=(new three_core.Q1f).fromArray(materialNode.SpecularColor.value));const scope=this;return connections.get(ID).children.forEach((function(child){const type=child.relationship;switch(type){case"Bump":parameters.bumpMap=scope.getTexture(textureMap,child.ID);break;case"Maya|TEX_ao_map":parameters.aoMap=scope.getTexture(textureMap,child.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":parameters.map=scope.getTexture(textureMap,child.ID),void 0!==parameters.map&&("colorSpace"in parameters.map?parameters.map.colorSpace="srgb":parameters.map.encoding=3001);break;case"DisplacementColor":parameters.displacementMap=scope.getTexture(textureMap,child.ID);break;case"EmissiveColor":parameters.emissiveMap=scope.getTexture(textureMap,child.ID),void 0!==parameters.emissiveMap&&("colorSpace"in parameters.emissiveMap?parameters.emissiveMap.colorSpace="srgb":parameters.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":parameters.normalMap=scope.getTexture(textureMap,child.ID);break;case"ReflectionColor":parameters.envMap=scope.getTexture(textureMap,child.ID),void 0!==parameters.envMap&&(parameters.envMap.mapping=three_core.wfO,"colorSpace"in parameters.envMap?parameters.envMap.colorSpace="srgb":parameters.envMap.encoding=3001);break;case"SpecularColor":parameters.specularMap=scope.getTexture(textureMap,child.ID),void 0!==parameters.specularMap&&("colorSpace"in parameters.specularMap?parameters.specularMap.colorSpace="srgb":parameters.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":parameters.alphaMap=scope.getTexture(textureMap,child.ID),parameters.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",type)}})),parameters}getTexture(textureMap,id){return"LayeredTexture"in fbxTree.Objects&&id in fbxTree.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),id=connections.get(id).children[0].ID),textureMap.get(id)}parseDeformers(){const skeletons={},morphTargets={};if("Deformer"in fbxTree.Objects){const DeformerNodes=fbxTree.Objects.Deformer;for(const nodeID in DeformerNodes){const deformerNode=DeformerNodes[nodeID],relationships=connections.get(parseInt(nodeID));if("Skin"===deformerNode.attrType){const skeleton=this.parseSkeleton(relationships,DeformerNodes);skeleton.ID=nodeID,relationships.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),skeleton.geometryID=relationships.parents[0].ID,skeletons[nodeID]=skeleton}else if("BlendShape"===deformerNode.attrType){const morphTarget={id:nodeID};morphTarget.rawTargets=this.parseMorphTargets(relationships,DeformerNodes),morphTarget.id=nodeID,relationships.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),morphTargets[nodeID]=morphTarget}}}return{skeletons,morphTargets}}parseSkeleton(relationships,deformerNodes){const rawBones=[];return relationships.children.forEach((function(child){const boneNode=deformerNodes[child.ID];if("Cluster"!==boneNode.attrType)return;const rawBone={ID:child.ID,indices:[],weights:[],transformLink:(new three_core.kn4).fromArray(boneNode.TransformLink.a)};"Indexes"in boneNode&&(rawBone.indices=boneNode.Indexes.a,rawBone.weights=boneNode.Weights.a),rawBones.push(rawBone)})),{rawBones,bones:[]}}parseMorphTargets(relationships,deformerNodes){const rawMorphTargets=[];for(let i=0;i<relationships.children.length;i++){const child=relationships.children[i],morphTargetNode=deformerNodes[child.ID],rawMorphTarget={name:morphTargetNode.attrName,initialWeight:morphTargetNode.DeformPercent,id:morphTargetNode.id,fullWeights:morphTargetNode.FullWeights.a};if("BlendShapeChannel"!==morphTargetNode.attrType)return;rawMorphTarget.geoID=connections.get(parseInt(child.ID)).children.filter((function(child2){return void 0===child2.relationship}))[0].ID,rawMorphTargets.push(rawMorphTarget)}return rawMorphTargets}parseScene(deformers,geometryMap,materialMap){sceneGraph=new three_core.YJl;const modelMap=this.parseModels(deformers.skeletons,geometryMap,materialMap),modelNodes=fbxTree.Objects.Model,scope=this;modelMap.forEach((function(model){const modelNode=modelNodes[model.ID];scope.setLookAtProperties(model,modelNode);connections.get(model.ID).parents.forEach((function(connection){const parent=modelMap.get(connection.ID);void 0!==parent&&parent.add(model)})),null===model.parent&&sceneGraph.add(model)})),this.bindSkeleton(deformers.skeletons,geometryMap,modelMap),this.createAmbientLight(),sceneGraph.traverse((function(node){if(node.userData.transformData){node.parent&&(node.userData.transformData.parentMatrix=node.parent.matrix,node.userData.transformData.parentMatrixWorld=node.parent.matrixWorld);const transform=generateTransform(node.userData.transformData);node.applyMatrix4(transform),node.updateWorldMatrix()}}));const animations=(new AnimationParser).parse();1===sceneGraph.children.length&&sceneGraph.children[0].isGroup&&(sceneGraph.children[0].animations=animations,sceneGraph=sceneGraph.children[0]),sceneGraph.animations=animations}parseModels(skeletons,geometryMap,materialMap){const modelMap=new Map,modelNodes=fbxTree.Objects.Model;for(const nodeID in modelNodes){const id=parseInt(nodeID),node=modelNodes[nodeID],relationships=connections.get(id);let model=this.buildSkeleton(relationships,skeletons,id,node.attrName);if(!model){switch(node.attrType){case"Camera":model=this.createCamera(relationships);break;case"Light":model=this.createLight(relationships);break;case"Mesh":model=this.createMesh(relationships,geometryMap,materialMap);break;case"NurbsCurve":model=this.createCurve(relationships,geometryMap);break;case"LimbNode":case"Root":model=new three_core.$Kf;break;default:model=new three_core.YJl}model.name=node.attrName?three_core.Nwf.sanitizeNodeName(node.attrName):"",model.ID=id}this.getTransformData(model,node),modelMap.set(id,model)}return modelMap}buildSkeleton(relationships,skeletons,id,name){let bone=null;return relationships.parents.forEach((function(parent){for(const ID in skeletons){const skeleton=skeletons[ID];skeleton.rawBones.forEach((function(rawBone,i){if(rawBone.ID===parent.ID){const subBone=bone;bone=new three_core.$Kf,bone.matrixWorld.copy(rawBone.transformLink),bone.name=name?three_core.Nwf.sanitizeNodeName(name):"",bone.ID=id,skeleton.bones[i]=bone,null!==subBone&&bone.add(subBone)}}))}})),bone}createCamera(relationships){let model,cameraAttribute;if(relationships.children.forEach((function(child){const attr=fbxTree.Objects.NodeAttribute[child.ID];void 0!==attr&&(cameraAttribute=attr)})),void 0===cameraAttribute)model=new three_core.B69;else{let type=0;void 0!==cameraAttribute.CameraProjectionType&&1===cameraAttribute.CameraProjectionType.value&&(type=1);let nearClippingPlane=1;void 0!==cameraAttribute.NearPlane&&(nearClippingPlane=cameraAttribute.NearPlane.value/1e3);let farClippingPlane=1e3;void 0!==cameraAttribute.FarPlane&&(farClippingPlane=cameraAttribute.FarPlane.value/1e3);let width=window.innerWidth,height=window.innerHeight;void 0!==cameraAttribute.AspectWidth&&void 0!==cameraAttribute.AspectHeight&&(width=cameraAttribute.AspectWidth.value,height=cameraAttribute.AspectHeight.value);const aspect=width/height;let fov=45;void 0!==cameraAttribute.FieldOfView&&(fov=cameraAttribute.FieldOfView.value);const focalLength=cameraAttribute.FocalLength?cameraAttribute.FocalLength.value:null;switch(type){case 0:model=new three_core.ubm(fov,aspect,nearClippingPlane,farClippingPlane),null!==focalLength&&model.setFocalLength(focalLength);break;case 1:model=new three_core.qUd(-width/2,width/2,height/2,-height/2,nearClippingPlane,farClippingPlane);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+type+"."),model=new three_core.B69}}return model}createLight(relationships){let model,lightAttribute;if(relationships.children.forEach((function(child){const attr=fbxTree.Objects.NodeAttribute[child.ID];void 0!==attr&&(lightAttribute=attr)})),void 0===lightAttribute)model=new three_core.B69;else{let type;type=void 0===lightAttribute.LightType?0:lightAttribute.LightType.value;let color=16777215;void 0!==lightAttribute.Color&&(color=(new three_core.Q1f).fromArray(lightAttribute.Color.value));let intensity=void 0===lightAttribute.Intensity?1:lightAttribute.Intensity.value/100;void 0!==lightAttribute.CastLightOnObject&&0===lightAttribute.CastLightOnObject.value&&(intensity=0);let distance=0;void 0!==lightAttribute.FarAttenuationEnd&&(distance=void 0!==lightAttribute.EnableFarAttenuation&&0===lightAttribute.EnableFarAttenuation.value?0:lightAttribute.FarAttenuationEnd.value);const decay=1;switch(type){case 0:model=new three_core.HiM(color,intensity,distance,decay);break;case 1:model=new three_core.ZyN(color,intensity);break;case 2:let angle=Math.PI/3;void 0!==lightAttribute.InnerAngle&&(angle=three_core.cj9.degToRad(lightAttribute.InnerAngle.value));let penumbra=0;void 0!==lightAttribute.OuterAngle&&(penumbra=three_core.cj9.degToRad(lightAttribute.OuterAngle.value),penumbra=Math.max(penumbra,1)),model=new three_core.nCl(color,intensity,distance,angle,penumbra,decay);break;default:console.warn("THREE.FBXLoader: Unknown light type "+lightAttribute.LightType.value+", defaulting to a PointLight."),model=new three_core.HiM(color,intensity)}void 0!==lightAttribute.CastShadows&&1===lightAttribute.CastShadows.value&&(model.castShadow=!0)}return model}createMesh(relationships,geometryMap,materialMap){let model,geometry=null,material=null;const materials=[];return relationships.children.forEach((function(child){geometryMap.has(child.ID)&&(geometry=geometryMap.get(child.ID)),materialMap.has(child.ID)&&materials.push(materialMap.get(child.ID))})),materials.length>1?material=materials:materials.length>0?material=materials[0]:(material=new three_core.tXL({color:13421772}),materials.push(material)),"color"in geometry.attributes&&materials.forEach((function(material2){material2.vertexColors=!0})),geometry.FBX_Deformer?(model=new three_core.I46(geometry,material),model.normalizeSkinWeights()):model=new three_core.eaF(geometry,material),model}createCurve(relationships,geometryMap){const geometry=relationships.children.reduce((function(geo,child){return geometryMap.has(child.ID)&&(geo=geometryMap.get(child.ID)),geo}),null),material=new three_core.mrM({color:3342591,linewidth:1});return new three_core.N1A(geometry,material)}getTransformData(model,modelNode){const transformData={};"InheritType"in modelNode&&(transformData.inheritType=parseInt(modelNode.InheritType.value)),transformData.eulerOrder="RotationOrder"in modelNode?getEulerOrder(modelNode.RotationOrder.value):"ZYX","Lcl_Translation"in modelNode&&(transformData.translation=modelNode.Lcl_Translation.value),"PreRotation"in modelNode&&(transformData.preRotation=modelNode.PreRotation.value),"Lcl_Rotation"in modelNode&&(transformData.rotation=modelNode.Lcl_Rotation.value),"PostRotation"in modelNode&&(transformData.postRotation=modelNode.PostRotation.value),"Lcl_Scaling"in modelNode&&(transformData.scale=modelNode.Lcl_Scaling.value),"ScalingOffset"in modelNode&&(transformData.scalingOffset=modelNode.ScalingOffset.value),"ScalingPivot"in modelNode&&(transformData.scalingPivot=modelNode.ScalingPivot.value),"RotationOffset"in modelNode&&(transformData.rotationOffset=modelNode.RotationOffset.value),"RotationPivot"in modelNode&&(transformData.rotationPivot=modelNode.RotationPivot.value),model.userData.transformData=transformData}setLookAtProperties(model,modelNode){if("LookAtProperty"in modelNode){connections.get(model.ID).children.forEach((function(child){if("LookAtProperty"===child.relationship){const lookAtTarget=fbxTree.Objects.Model[child.ID];if("Lcl_Translation"in lookAtTarget){const pos=lookAtTarget.Lcl_Translation.value;void 0!==model.target?(model.target.position.fromArray(pos),sceneGraph.add(model.target)):model.lookAt((new three_core.Pq0).fromArray(pos))}}}))}}bindSkeleton(skeletons,geometryMap,modelMap){const bindMatrices=this.parsePoseNodes();for(const ID in skeletons){const skeleton=skeletons[ID];connections.get(parseInt(skeleton.ID)).parents.forEach((function(parent){if(geometryMap.has(parent.ID)){const geoID=parent.ID;connections.get(geoID).parents.forEach((function(geoConnParent){if(modelMap.has(geoConnParent.ID)){modelMap.get(geoConnParent.ID).bind(new three_core.EAD(skeleton.bones),bindMatrices[geoConnParent.ID])}}))}}))}}parsePoseNodes(){const bindMatrices={};if("Pose"in fbxTree.Objects){const BindPoseNode=fbxTree.Objects.Pose;for(const nodeID in BindPoseNode)if("BindPose"===BindPoseNode[nodeID].attrType&&BindPoseNode[nodeID].NbPoseNodes>0){const poseNodes=BindPoseNode[nodeID].PoseNode;Array.isArray(poseNodes)?poseNodes.forEach((function(poseNode){bindMatrices[poseNode.Node]=(new three_core.kn4).fromArray(poseNode.Matrix.a)})):bindMatrices[poseNodes.Node]=(new three_core.kn4).fromArray(poseNodes.Matrix.a)}}return bindMatrices}createAmbientLight(){if("GlobalSettings"in fbxTree&&"AmbientColor"in fbxTree.GlobalSettings){const ambientColor=fbxTree.GlobalSettings.AmbientColor.value,r=ambientColor[0],g=ambientColor[1],b=ambientColor[2];if(0!==r||0!==g||0!==b){const color=new three_core.Q1f(r,g,b);sceneGraph.add(new three_core.$p8(color,1))}}}}class GeometryParser{parse(deformers){const geometryMap=new Map;if("Geometry"in fbxTree.Objects){const geoNodes=fbxTree.Objects.Geometry;for(const nodeID in geoNodes){const relationships=connections.get(parseInt(nodeID)),geo=this.parseGeometry(relationships,geoNodes[nodeID],deformers);geometryMap.set(parseInt(nodeID),geo)}}return geometryMap}parseGeometry(relationships,geoNode,deformers){switch(geoNode.attrType){case"Mesh":return this.parseMeshGeometry(relationships,geoNode,deformers);case"NurbsCurve":return this.parseNurbsGeometry(geoNode)}}parseMeshGeometry(relationships,geoNode,deformers){const skeletons=deformers.skeletons,morphTargets=[],modelNodes=relationships.parents.map((function(parent){return fbxTree.Objects.Model[parent.ID]}));if(0===modelNodes.length)return;const skeleton=relationships.children.reduce((function(skeleton2,child){return void 0!==skeletons[child.ID]&&(skeleton2=skeletons[child.ID]),skeleton2}),null);relationships.children.forEach((function(child){void 0!==deformers.morphTargets[child.ID]&&morphTargets.push(deformers.morphTargets[child.ID])}));const modelNode=modelNodes[0],transformData={};"RotationOrder"in modelNode&&(transformData.eulerOrder=getEulerOrder(modelNode.RotationOrder.value)),"InheritType"in modelNode&&(transformData.inheritType=parseInt(modelNode.InheritType.value)),"GeometricTranslation"in modelNode&&(transformData.translation=modelNode.GeometricTranslation.value),"GeometricRotation"in modelNode&&(transformData.rotation=modelNode.GeometricRotation.value),"GeometricScaling"in modelNode&&(transformData.scale=modelNode.GeometricScaling.value);const transform=generateTransform(transformData);return this.genGeometry(geoNode,skeleton,morphTargets,transform)}genGeometry(geoNode,skeleton,morphTargets,preTransform){const geo=new three_core.LoY;geoNode.attrName&&(geo.name=geoNode.attrName);const geoInfo=this.parseGeoNode(geoNode,skeleton),buffers=this.genBuffers(geoInfo),positionAttribute=new three_core.qtW(buffers.vertex,3);if(positionAttribute.applyMatrix4(preTransform),geo.setAttribute("position",positionAttribute),buffers.colors.length>0&&geo.setAttribute("color",new three_core.qtW(buffers.colors,3)),skeleton&&(geo.setAttribute("skinIndex",new three_core.A$4(buffers.weightsIndices,4)),geo.setAttribute("skinWeight",new three_core.qtW(buffers.vertexWeights,4)),geo.FBX_Deformer=skeleton),buffers.normal.length>0){const normalMatrix=(new three_core.dwI).getNormalMatrix(preTransform),normalAttribute=new three_core.qtW(buffers.normal,3);normalAttribute.applyNormalMatrix(normalMatrix),geo.setAttribute("normal",normalAttribute)}if(buffers.uvs.forEach((function(uvBuffer,i){"uv2"===UV1&&i++;const name=0===i?"uv":`uv${i}`;geo.setAttribute(name,new three_core.qtW(buffers.uvs[i],2))})),geoInfo.material&&"AllSame"!==geoInfo.material.mappingType){let prevMaterialIndex=buffers.materialIndex[0],startIndex=0;if(buffers.materialIndex.forEach((function(currentIndex,i){currentIndex!==prevMaterialIndex&&(geo.addGroup(startIndex,i-startIndex,prevMaterialIndex),prevMaterialIndex=currentIndex,startIndex=i)})),geo.groups.length>0){const lastGroup=geo.groups[geo.groups.length-1],lastIndex=lastGroup.start+lastGroup.count;lastIndex!==buffers.materialIndex.length&&geo.addGroup(lastIndex,buffers.materialIndex.length-lastIndex,prevMaterialIndex)}0===geo.groups.length&&geo.addGroup(0,buffers.materialIndex.length,buffers.materialIndex[0])}return this.addMorphTargets(geo,geoNode,morphTargets,preTransform),geo}parseGeoNode(geoNode,skeleton){const geoInfo={};if(geoInfo.vertexPositions=void 0!==geoNode.Vertices?geoNode.Vertices.a:[],geoInfo.vertexIndices=void 0!==geoNode.PolygonVertexIndex?geoNode.PolygonVertexIndex.a:[],geoNode.LayerElementColor&&(geoInfo.color=this.parseVertexColors(geoNode.LayerElementColor[0])),geoNode.LayerElementMaterial&&(geoInfo.material=this.parseMaterialIndices(geoNode.LayerElementMaterial[0])),geoNode.LayerElementNormal&&(geoInfo.normal=this.parseNormals(geoNode.LayerElementNormal[0])),geoNode.LayerElementUV){geoInfo.uv=[];let i=0;for(;geoNode.LayerElementUV[i];)geoNode.LayerElementUV[i].UV&&geoInfo.uv.push(this.parseUVs(geoNode.LayerElementUV[i])),i++}return geoInfo.weightTable={},null!==skeleton&&(geoInfo.skeleton=skeleton,skeleton.rawBones.forEach((function(rawBone,i){rawBone.indices.forEach((function(index,j){void 0===geoInfo.weightTable[index]&&(geoInfo.weightTable[index]=[]),geoInfo.weightTable[index].push({id:i,weight:rawBone.weights[j]})}))}))),geoInfo}genBuffers(geoInfo){const buffers={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let polygonIndex=0,faceLength=0,displayedWeightsWarning=!1,facePositionIndexes=[],faceNormals=[],faceColors=[],faceUVs=[],faceWeights=[],faceWeightIndices=[];const scope=this;return geoInfo.vertexIndices.forEach((function(vertexIndex,polygonVertexIndex){let materialIndex,endOfFace=!1;vertexIndex<0&&(vertexIndex=~vertexIndex,endOfFace=!0);let weightIndices=[],weights=[];if(facePositionIndexes.push(3*vertexIndex,3*vertexIndex+1,3*vertexIndex+2),geoInfo.color){const data=getData(polygonVertexIndex,polygonIndex,vertexIndex,geoInfo.color);faceColors.push(data[0],data[1],data[2])}if(geoInfo.skeleton){if(void 0!==geoInfo.weightTable[vertexIndex]&&geoInfo.weightTable[vertexIndex].forEach((function(wt){weights.push(wt.weight),weightIndices.push(wt.id)})),weights.length>4){displayedWeightsWarning||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),displayedWeightsWarning=!0);const wIndex=[0,0,0,0],Weight=[0,0,0,0];weights.forEach((function(weight,weightIndex){let currentWeight=weight,currentIndex=weightIndices[weightIndex];Weight.forEach((function(comparedWeight,comparedWeightIndex,comparedWeightArray){if(currentWeight>comparedWeight){comparedWeightArray[comparedWeightIndex]=currentWeight,currentWeight=comparedWeight;const tmp=wIndex[comparedWeightIndex];wIndex[comparedWeightIndex]=currentIndex,currentIndex=tmp}}))})),weightIndices=wIndex,weights=Weight}for(;weights.length<4;)weights.push(0),weightIndices.push(0);for(let i=0;i<4;++i)faceWeights.push(weights[i]),faceWeightIndices.push(weightIndices[i])}if(geoInfo.normal){const data=getData(polygonVertexIndex,polygonIndex,vertexIndex,geoInfo.normal);faceNormals.push(data[0],data[1],data[2])}geoInfo.material&&"AllSame"!==geoInfo.material.mappingType&&(materialIndex=getData(polygonVertexIndex,polygonIndex,vertexIndex,geoInfo.material)[0]),geoInfo.uv&&geoInfo.uv.forEach((function(uv,i){const data=getData(polygonVertexIndex,polygonIndex,vertexIndex,uv);void 0===faceUVs[i]&&(faceUVs[i]=[]),faceUVs[i].push(data[0]),faceUVs[i].push(data[1])})),faceLength++,endOfFace&&(scope.genFace(buffers,geoInfo,facePositionIndexes,materialIndex,faceNormals,faceColors,faceUVs,faceWeights,faceWeightIndices,faceLength),polygonIndex++,faceLength=0,facePositionIndexes=[],faceNormals=[],faceColors=[],faceUVs=[],faceWeights=[],faceWeightIndices=[])})),buffers}genFace(buffers,geoInfo,facePositionIndexes,materialIndex,faceNormals,faceColors,faceUVs,faceWeights,faceWeightIndices,faceLength){for(let i=2;i<faceLength;i++)buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[0]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[1]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[2]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*(i-1)]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*(i-1)+1]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*(i-1)+2]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*i]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*i+1]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*i+2]]),geoInfo.skeleton&&(buffers.vertexWeights.push(faceWeights[0]),buffers.vertexWeights.push(faceWeights[1]),buffers.vertexWeights.push(faceWeights[2]),buffers.vertexWeights.push(faceWeights[3]),buffers.vertexWeights.push(faceWeights[4*(i-1)]),buffers.vertexWeights.push(faceWeights[4*(i-1)+1]),buffers.vertexWeights.push(faceWeights[4*(i-1)+2]),buffers.vertexWeights.push(faceWeights[4*(i-1)+3]),buffers.vertexWeights.push(faceWeights[4*i]),buffers.vertexWeights.push(faceWeights[4*i+1]),buffers.vertexWeights.push(faceWeights[4*i+2]),buffers.vertexWeights.push(faceWeights[4*i+3]),buffers.weightsIndices.push(faceWeightIndices[0]),buffers.weightsIndices.push(faceWeightIndices[1]),buffers.weightsIndices.push(faceWeightIndices[2]),buffers.weightsIndices.push(faceWeightIndices[3]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)+1]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)+2]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)+3]),buffers.weightsIndices.push(faceWeightIndices[4*i]),buffers.weightsIndices.push(faceWeightIndices[4*i+1]),buffers.weightsIndices.push(faceWeightIndices[4*i+2]),buffers.weightsIndices.push(faceWeightIndices[4*i+3])),geoInfo.color&&(buffers.colors.push(faceColors[0]),buffers.colors.push(faceColors[1]),buffers.colors.push(faceColors[2]),buffers.colors.push(faceColors[3*(i-1)]),buffers.colors.push(faceColors[3*(i-1)+1]),buffers.colors.push(faceColors[3*(i-1)+2]),buffers.colors.push(faceColors[3*i]),buffers.colors.push(faceColors[3*i+1]),buffers.colors.push(faceColors[3*i+2])),geoInfo.material&&"AllSame"!==geoInfo.material.mappingType&&(buffers.materialIndex.push(materialIndex),buffers.materialIndex.push(materialIndex),buffers.materialIndex.push(materialIndex)),geoInfo.normal&&(buffers.normal.push(faceNormals[0]),buffers.normal.push(faceNormals[1]),buffers.normal.push(faceNormals[2]),buffers.normal.push(faceNormals[3*(i-1)]),buffers.normal.push(faceNormals[3*(i-1)+1]),buffers.normal.push(faceNormals[3*(i-1)+2]),buffers.normal.push(faceNormals[3*i]),buffers.normal.push(faceNormals[3*i+1]),buffers.normal.push(faceNormals[3*i+2])),geoInfo.uv&&geoInfo.uv.forEach((function(uv,j){void 0===buffers.uvs[j]&&(buffers.uvs[j]=[]),buffers.uvs[j].push(faceUVs[j][0]),buffers.uvs[j].push(faceUVs[j][1]),buffers.uvs[j].push(faceUVs[j][2*(i-1)]),buffers.uvs[j].push(faceUVs[j][2*(i-1)+1]),buffers.uvs[j].push(faceUVs[j][2*i]),buffers.uvs[j].push(faceUVs[j][2*i+1])}))}addMorphTargets(parentGeo,parentGeoNode,morphTargets,preTransform){if(0===morphTargets.length)return;parentGeo.morphTargetsRelative=!0,parentGeo.morphAttributes.position=[];const scope=this;morphTargets.forEach((function(morphTarget){morphTarget.rawTargets.forEach((function(rawTarget){const morphGeoNode=fbxTree.Objects.Geometry[rawTarget.geoID];void 0!==morphGeoNode&&scope.genMorphGeometry(parentGeo,parentGeoNode,morphGeoNode,preTransform,rawTarget.name)}))}))}genMorphGeometry(parentGeo,parentGeoNode,morphGeoNode,preTransform,name){const vertexIndices=void 0!==parentGeoNode.PolygonVertexIndex?parentGeoNode.PolygonVertexIndex.a:[],morphPositionsSparse=void 0!==morphGeoNode.Vertices?morphGeoNode.Vertices.a:[],indices=void 0!==morphGeoNode.Indexes?morphGeoNode.Indexes.a:[],length=3*parentGeo.attributes.position.count,morphPositions=new Float32Array(length);for(let i=0;i<indices.length;i++){const morphIndex=3*indices[i];morphPositions[morphIndex]=morphPositionsSparse[3*i],morphPositions[morphIndex+1]=morphPositionsSparse[3*i+1],morphPositions[morphIndex+2]=morphPositionsSparse[3*i+2]}const morphGeoInfo={vertexIndices,vertexPositions:morphPositions},morphBuffers=this.genBuffers(morphGeoInfo),positionAttribute=new three_core.qtW(morphBuffers.vertex,3);positionAttribute.name=name||morphGeoNode.attrName,positionAttribute.applyMatrix4(preTransform),parentGeo.morphAttributes.position.push(positionAttribute)}parseNormals(NormalNode){const mappingType=NormalNode.MappingInformationType,referenceType=NormalNode.ReferenceInformationType,buffer=NormalNode.Normals.a;let indexBuffer=[];return"IndexToDirect"===referenceType&&("NormalIndex"in NormalNode?indexBuffer=NormalNode.NormalIndex.a:"NormalsIndex"in NormalNode&&(indexBuffer=NormalNode.NormalsIndex.a)),{dataSize:3,buffer,indices:indexBuffer,mappingType,referenceType}}parseUVs(UVNode){const mappingType=UVNode.MappingInformationType,referenceType=UVNode.ReferenceInformationType,buffer=UVNode.UV.a;let indexBuffer=[];return"IndexToDirect"===referenceType&&(indexBuffer=UVNode.UVIndex.a),{dataSize:2,buffer,indices:indexBuffer,mappingType,referenceType}}parseVertexColors(ColorNode){const mappingType=ColorNode.MappingInformationType,referenceType=ColorNode.ReferenceInformationType,buffer=ColorNode.Colors.a;let indexBuffer=[];return"IndexToDirect"===referenceType&&(indexBuffer=ColorNode.ColorIndex.a),{dataSize:4,buffer,indices:indexBuffer,mappingType,referenceType}}parseMaterialIndices(MaterialNode){const mappingType=MaterialNode.MappingInformationType,referenceType=MaterialNode.ReferenceInformationType;if("NoMappingInformation"===mappingType)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType};const materialIndexBuffer=MaterialNode.Materials.a,materialIndices=[];for(let i=0;i<materialIndexBuffer.length;++i)materialIndices.push(i);return{dataSize:1,buffer:materialIndexBuffer,indices:materialIndices,mappingType,referenceType}}parseNurbsGeometry(geoNode){if(void 0===NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new three_core.LoY;const order=parseInt(geoNode.Order);if(isNaN(order))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",geoNode.Order,geoNode.id),new three_core.LoY;const degree=order-1,knots=geoNode.KnotVector.a,controlPoints=[],pointsValues=geoNode.Points.a;for(let i=0,l=pointsValues.length;i<l;i+=4)controlPoints.push((new three_core.IUQ).fromArray(pointsValues,i));let startKnot,endKnot;if("Closed"===geoNode.Form)controlPoints.push(controlPoints[0]);else if("Periodic"===geoNode.Form){startKnot=degree,endKnot=knots.length-1-startKnot;for(let i=0;i<degree;++i)controlPoints.push(controlPoints[i])}const points=new NURBSCurve(degree,knots,controlPoints,startKnot,endKnot).getPoints(12*controlPoints.length);return(new three_core.LoY).setFromPoints(points)}}class AnimationParser{parse(){const animationClips=[],rawClips=this.parseClips();if(void 0!==rawClips)for(const key in rawClips){const rawClip=rawClips[key],clip=this.addClip(rawClip);animationClips.push(clip)}return animationClips}parseClips(){if(void 0===fbxTree.Objects.AnimationCurve)return;const curveNodesMap=this.parseAnimationCurveNodes();this.parseAnimationCurves(curveNodesMap);const layersMap=this.parseAnimationLayers(curveNodesMap);return this.parseAnimStacks(layersMap)}parseAnimationCurveNodes(){const rawCurveNodes=fbxTree.Objects.AnimationCurveNode,curveNodesMap=new Map;for(const nodeID in rawCurveNodes){const rawCurveNode=rawCurveNodes[nodeID];if(null!==rawCurveNode.attrName.match(/S|R|T|DeformPercent/)){const curveNode={id:rawCurveNode.id,attr:rawCurveNode.attrName,curves:{}};curveNodesMap.set(curveNode.id,curveNode)}}return curveNodesMap}parseAnimationCurves(curveNodesMap){const rawCurves=fbxTree.Objects.AnimationCurve;for(const nodeID in rawCurves){const animationCurve={id:rawCurves[nodeID].id,times:rawCurves[nodeID].KeyTime.a.map(convertFBXTimeToSeconds),values:rawCurves[nodeID].KeyValueFloat.a},relationships=connections.get(animationCurve.id);if(void 0!==relationships){const animationCurveID=relationships.parents[0].ID,animationCurveRelationship=relationships.parents[0].relationship;animationCurveRelationship.match(/X/)?curveNodesMap.get(animationCurveID).curves.x=animationCurve:animationCurveRelationship.match(/Y/)?curveNodesMap.get(animationCurveID).curves.y=animationCurve:animationCurveRelationship.match(/Z/)?curveNodesMap.get(animationCurveID).curves.z=animationCurve:animationCurveRelationship.match(/d|DeformPercent/)&&curveNodesMap.has(animationCurveID)&&(curveNodesMap.get(animationCurveID).curves.morph=animationCurve)}}}parseAnimationLayers(curveNodesMap){const rawLayers=fbxTree.Objects.AnimationLayer,layersMap=new Map;for(const nodeID in rawLayers){const layerCurveNodes=[],connection=connections.get(parseInt(nodeID));if(void 0!==connection){connection.children.forEach((function(child,i){if(curveNodesMap.has(child.ID)){const curveNode=curveNodesMap.get(child.ID);if(void 0!==curveNode.curves.x||void 0!==curveNode.curves.y||void 0!==curveNode.curves.z){if(void 0===layerCurveNodes[i]){const modelID=connections.get(child.ID).parents.filter((function(parent){return void 0!==parent.relationship}))[0].ID;if(void 0!==modelID){const rawModel=fbxTree.Objects.Model[modelID.toString()];if(void 0===rawModel)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",child);const node={modelName:rawModel.attrName?three_core.Nwf.sanitizeNodeName(rawModel.attrName):"",ID:rawModel.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};sceneGraph.traverse((function(child2){child2.ID===rawModel.id&&(node.transform=child2.matrix,child2.userData.transformData&&(node.eulerOrder=child2.userData.transformData.eulerOrder))})),node.transform||(node.transform=new three_core.kn4),"PreRotation"in rawModel&&(node.preRotation=rawModel.PreRotation.value),"PostRotation"in rawModel&&(node.postRotation=rawModel.PostRotation.value),layerCurveNodes[i]=node}}layerCurveNodes[i]&&(layerCurveNodes[i][curveNode.attr]=curveNode)}else if(void 0!==curveNode.curves.morph){if(void 0===layerCurveNodes[i]){const deformerID=connections.get(child.ID).parents.filter((function(parent){return void 0!==parent.relationship}))[0].ID,morpherID=connections.get(deformerID).parents[0].ID,geoID=connections.get(morpherID).parents[0].ID,modelID=connections.get(geoID).parents[0].ID,rawModel=fbxTree.Objects.Model[modelID],node={modelName:rawModel.attrName?three_core.Nwf.sanitizeNodeName(rawModel.attrName):"",morphName:fbxTree.Objects.Deformer[deformerID].attrName};layerCurveNodes[i]=node}layerCurveNodes[i][curveNode.attr]=curveNode}}})),layersMap.set(parseInt(nodeID),layerCurveNodes)}}return layersMap}parseAnimStacks(layersMap){const rawStacks=fbxTree.Objects.AnimationStack,rawClips={};for(const nodeID in rawStacks){const children=connections.get(parseInt(nodeID)).children;children.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const layer=layersMap.get(children[0].ID);rawClips[nodeID]={name:rawStacks[nodeID].attrName,layer}}return rawClips}addClip(rawClip){let tracks=[];const scope=this;return rawClip.layer.forEach((function(rawTracks){tracks=tracks.concat(scope.generateTracks(rawTracks))})),new three_core.tz3(rawClip.name,-1,tracks)}generateTracks(rawTracks){const tracks=[];let initialPosition=new three_core.Pq0,initialRotation=new three_core.PTz,initialScale=new three_core.Pq0;if(rawTracks.transform&&rawTracks.transform.decompose(initialPosition,initialRotation,initialScale),initialPosition=initialPosition.toArray(),initialRotation=(new three_core.O9p).setFromQuaternion(initialRotation,rawTracks.eulerOrder).toArray(),initialScale=initialScale.toArray(),void 0!==rawTracks.T&&Object.keys(rawTracks.T.curves).length>0){const positionTrack=this.generateVectorTrack(rawTracks.modelName,rawTracks.T.curves,initialPosition,"position");void 0!==positionTrack&&tracks.push(positionTrack)}if(void 0!==rawTracks.R&&Object.keys(rawTracks.R.curves).length>0){const rotationTrack=this.generateRotationTrack(rawTracks.modelName,rawTracks.R.curves,initialRotation,rawTracks.preRotation,rawTracks.postRotation,rawTracks.eulerOrder);void 0!==rotationTrack&&tracks.push(rotationTrack)}if(void 0!==rawTracks.S&&Object.keys(rawTracks.S.curves).length>0){const scaleTrack=this.generateVectorTrack(rawTracks.modelName,rawTracks.S.curves,initialScale,"scale");void 0!==scaleTrack&&tracks.push(scaleTrack)}if(void 0!==rawTracks.DeformPercent){const morphTrack=this.generateMorphTrack(rawTracks);void 0!==morphTrack&&tracks.push(morphTrack)}return tracks}generateVectorTrack(modelName,curves,initialValue,type){const times=this.getTimesForAllAxes(curves),values=this.getKeyframeTrackValues(times,curves,initialValue);return new three_core.RiT(modelName+"."+type,times,values)}generateRotationTrack(modelName,curves,initialValue,preRotation,postRotation,eulerOrder){void 0!==curves.x&&(this.interpolateRotations(curves.x),curves.x.values=curves.x.values.map(three_core.cj9.degToRad)),void 0!==curves.y&&(this.interpolateRotations(curves.y),curves.y.values=curves.y.values.map(three_core.cj9.degToRad)),void 0!==curves.z&&(this.interpolateRotations(curves.z),curves.z.values=curves.z.values.map(three_core.cj9.degToRad));const times=this.getTimesForAllAxes(curves),values=this.getKeyframeTrackValues(times,curves,initialValue);void 0!==preRotation&&((preRotation=preRotation.map(three_core.cj9.degToRad)).push(eulerOrder),preRotation=(new three_core.O9p).fromArray(preRotation),preRotation=(new three_core.PTz).setFromEuler(preRotation)),void 0!==postRotation&&((postRotation=postRotation.map(three_core.cj9.degToRad)).push(eulerOrder),postRotation=(new three_core.O9p).fromArray(postRotation),postRotation=(new three_core.PTz).setFromEuler(postRotation).invert());const quaternion=new three_core.PTz,euler=new three_core.O9p,quaternionValues=[];for(let i=0;i<values.length;i+=3)euler.set(values[i],values[i+1],values[i+2],eulerOrder),quaternion.setFromEuler(euler),void 0!==preRotation&&quaternion.premultiply(preRotation),void 0!==postRotation&&quaternion.multiply(postRotation),quaternion.toArray(quaternionValues,i/3*4);return new three_core.MBL(modelName+".quaternion",times,quaternionValues)}generateMorphTrack(rawTracks){const curves=rawTracks.DeformPercent.curves.morph,values=curves.values.map((function(val){return val/100})),morphNum=sceneGraph.getObjectByName(rawTracks.modelName).morphTargetDictionary[rawTracks.morphName];return new three_core.Hit(rawTracks.modelName+".morphTargetInfluences["+morphNum+"]",curves.times,values)}getTimesForAllAxes(curves){let times=[];if(void 0!==curves.x&&(times=times.concat(curves.x.times)),void 0!==curves.y&&(times=times.concat(curves.y.times)),void 0!==curves.z&&(times=times.concat(curves.z.times)),times=times.sort((function(a,b){return a-b})),times.length>1){let targetIndex=1,lastValue=times[0];for(let i=1;i<times.length;i++){const currentValue=times[i];currentValue!==lastValue&&(times[targetIndex]=currentValue,lastValue=currentValue,targetIndex++)}times=times.slice(0,targetIndex)}return times}getKeyframeTrackValues(times,curves,initialValue){const prevValue=initialValue,values=[];let xIndex=-1,yIndex=-1,zIndex=-1;return times.forEach((function(time){if(curves.x&&(xIndex=curves.x.times.indexOf(time)),curves.y&&(yIndex=curves.y.times.indexOf(time)),curves.z&&(zIndex=curves.z.times.indexOf(time)),-1!==xIndex){const xValue=curves.x.values[xIndex];values.push(xValue),prevValue[0]=xValue}else values.push(prevValue[0]);if(-1!==yIndex){const yValue=curves.y.values[yIndex];values.push(yValue),prevValue[1]=yValue}else values.push(prevValue[1]);if(-1!==zIndex){const zValue=curves.z.values[zIndex];values.push(zValue),prevValue[2]=zValue}else values.push(prevValue[2])})),values}interpolateRotations(curve){for(let i=1;i<curve.values.length;i++){const initialValue=curve.values[i-1],valuesSpan=curve.values[i]-initialValue,absoluteSpan=Math.abs(valuesSpan);if(absoluteSpan>=180){const numSubIntervals=absoluteSpan/180,step=valuesSpan/numSubIntervals;let nextValue=initialValue+step;const initialTime=curve.times[i-1],interval=(curve.times[i]-initialTime)/numSubIntervals;let nextTime=initialTime+interval;const interpolatedTimes=[],interpolatedValues=[];for(;nextTime<curve.times[i];)interpolatedTimes.push(nextTime),nextTime+=interval,interpolatedValues.push(nextValue),nextValue+=step;curve.times=inject(curve.times,i,interpolatedTimes),curve.values=inject(curve.values,i,interpolatedValues)}}}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(node){this.nodeStack.push(node),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(val,name){this.currentProp=val,this.currentPropName=name}parse(text){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const scope=this,split=text.split(/[\r\n]+/);return split.forEach((function(line,i){const matchComment=line.match(/^[\s\t]*;/),matchEmpty=line.match(/^[\s\t]*$/);if(matchComment||matchEmpty)return;const matchBeginning=line.match("^\\t{"+scope.currentIndent+"}(\\w+):(.*){",""),matchProperty=line.match("^\\t{"+scope.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),matchEnd=line.match("^\\t{"+(scope.currentIndent-1)+"}}");matchBeginning?scope.parseNodeBegin(line,matchBeginning):matchProperty?scope.parseNodeProperty(line,matchProperty,split[++i]):matchEnd?scope.popStack():line.match(/^[^\s\t}]/)&&scope.parseNodePropertyContinued(line)})),this.allNodes}parseNodeBegin(line,property){const nodeName=property[1].trim().replace(/^"/,"").replace(/"$/,""),nodeAttrs=property[2].split(",").map((function(attr){return attr.trim().replace(/^"/,"").replace(/"$/,"")})),node={name:nodeName},attrs=this.parseNodeAttr(nodeAttrs),currentNode=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(nodeName,node):nodeName in currentNode?("PoseNode"===nodeName?currentNode.PoseNode.push(node):void 0!==currentNode[nodeName].id&&(currentNode[nodeName]={},currentNode[nodeName][currentNode[nodeName].id]=currentNode[nodeName]),""!==attrs.id&&(currentNode[nodeName][attrs.id]=node)):"number"==typeof attrs.id?(currentNode[nodeName]={},currentNode[nodeName][attrs.id]=node):"Properties70"!==nodeName&&(currentNode[nodeName]="PoseNode"===nodeName?[node]:node),"number"==typeof attrs.id&&(node.id=attrs.id),""!==attrs.name&&(node.attrName=attrs.name),""!==attrs.type&&(node.attrType=attrs.type),this.pushStack(node)}parseNodeAttr(attrs){let id=attrs[0];""!==attrs[0]&&(id=parseInt(attrs[0]),isNaN(id)&&(id=attrs[0]));let name="",type="";return attrs.length>1&&(name=attrs[1].replace(/^(\w+)::/,""),type=attrs[2]),{id,name,type}}parseNodeProperty(line,property,contentLine){let propName=property[1].replace(/^"/,"").replace(/"$/,"").trim(),propValue=property[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===propName&&","===propValue&&(propValue=contentLine.replace(/"/g,"").replace(/,$/,"").trim());const currentNode=this.getCurrentNode();if("Properties70"!==currentNode.name){if("C"===propName){const connProps=propValue.split(",").slice(1),from=parseInt(connProps[0]),to=parseInt(connProps[1]);let rest=propValue.split(",").slice(3);rest=rest.map((function(elem){return elem.trim().replace(/^"/,"")})),propName="connections",propValue=[from,to],function append(a,b){for(let i=0,j=a.length,l=b.length;i<l;i++,j++)a[j]=b[i]}(propValue,rest),void 0===currentNode[propName]&&(currentNode[propName]=[])}"Node"===propName&&(currentNode.id=propValue),propName in currentNode&&Array.isArray(currentNode[propName])?currentNode[propName].push(propValue):"a"!==propName?currentNode[propName]=propValue:currentNode.a=propValue,this.setCurrentProp(currentNode,propName),"a"===propName&&","!==propValue.slice(-1)&&(currentNode.a=parseNumberArray(propValue))}else this.parseNodeSpecialProperty(line,propName,propValue)}parseNodePropertyContinued(line){const currentNode=this.getCurrentNode();currentNode.a+=line,","!==line.slice(-1)&&(currentNode.a=parseNumberArray(currentNode.a))}parseNodeSpecialProperty(line,propName,propValue){const props=propValue.split('",').map((function(prop){return prop.trim().replace(/^\"/,"").replace(/\s/,"_")})),innerPropName=props[0],innerPropType1=props[1],innerPropType2=props[2],innerPropFlag=props[3];let innerPropValue=props[4];switch(innerPropType1){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":innerPropValue=parseFloat(innerPropValue);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":innerPropValue=parseNumberArray(innerPropValue)}this.getPrevNode()[innerPropName]={type:innerPropType1,type2:innerPropType2,flag:innerPropFlag,value:innerPropValue},this.setCurrentProp(this.getPrevNode(),innerPropName)}}class BinaryParser{parse(buffer){const reader=new BinaryReader(buffer);reader.skip(23);const version=reader.getUint32();if(version<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+version);const allNodes=new FBXTree;for(;!this.endOfContent(reader);){const node=this.parseNode(reader,version);null!==node&&allNodes.add(node.name,node)}return allNodes}endOfContent(reader){return reader.size()%16==0?(reader.getOffset()+160+16&-16)>=reader.size():reader.getOffset()+160+16>=reader.size()}parseNode(reader,version){const node={},endOffset=version>=7500?reader.getUint64():reader.getUint32(),numProperties=version>=7500?reader.getUint64():reader.getUint32();version>=7500?reader.getUint64():reader.getUint32();const nameLen=reader.getUint8(),name=reader.getString(nameLen);if(0===endOffset)return null;const propertyList=[];for(let i=0;i<numProperties;i++)propertyList.push(this.parseProperty(reader));const id=propertyList.length>0?propertyList[0]:"",attrName=propertyList.length>1?propertyList[1]:"",attrType=propertyList.length>2?propertyList[2]:"";for(node.singleProperty=1===numProperties&&reader.getOffset()===endOffset;endOffset>reader.getOffset();){const subNode=this.parseNode(reader,version);null!==subNode&&this.parseSubNode(name,node,subNode)}return node.propertyList=propertyList,"number"==typeof id&&(node.id=id),""!==attrName&&(node.attrName=attrName),""!==attrType&&(node.attrType=attrType),""!==name&&(node.name=name),node}parseSubNode(name,node,subNode){if(!0===subNode.singleProperty){const value=subNode.propertyList[0];Array.isArray(value)?(node[subNode.name]=subNode,subNode.a=value):node[subNode.name]=value}else if("Connections"===name&&"C"===subNode.name){const array=[];subNode.propertyList.forEach((function(property,i){0!==i&&array.push(property)})),void 0===node.connections&&(node.connections=[]),node.connections.push(array)}else if("Properties70"===subNode.name){Object.keys(subNode).forEach((function(key){node[key]=subNode[key]}))}else if("Properties70"===name&&"P"===subNode.name){let innerPropName=subNode.propertyList[0],innerPropType1=subNode.propertyList[1];const innerPropType2=subNode.propertyList[2],innerPropFlag=subNode.propertyList[3];let innerPropValue;0===innerPropName.indexOf("Lcl ")&&(innerPropName=innerPropName.replace("Lcl ","Lcl_")),0===innerPropType1.indexOf("Lcl ")&&(innerPropType1=innerPropType1.replace("Lcl ","Lcl_")),innerPropValue="Color"===innerPropType1||"ColorRGB"===innerPropType1||"Vector"===innerPropType1||"Vector3D"===innerPropType1||0===innerPropType1.indexOf("Lcl_")?[subNode.propertyList[4],subNode.propertyList[5],subNode.propertyList[6]]:subNode.propertyList[4],node[innerPropName]={type:innerPropType1,type2:innerPropType2,flag:innerPropFlag,value:innerPropValue}}else void 0===node[subNode.name]?"number"==typeof subNode.id?(node[subNode.name]={},node[subNode.name][subNode.id]=subNode):node[subNode.name]=subNode:"PoseNode"===subNode.name?(Array.isArray(node[subNode.name])||(node[subNode.name]=[node[subNode.name]]),node[subNode.name].push(subNode)):void 0===node[subNode.name][subNode.id]&&(node[subNode.name][subNode.id]=subNode)}parseProperty(reader){const type=reader.getString(1);let length;switch(type){case"C":return reader.getBoolean();case"D":return reader.getFloat64();case"F":return reader.getFloat32();case"I":return reader.getInt32();case"L":return reader.getInt64();case"R":return length=reader.getUint32(),reader.getArrayBuffer(length);case"S":return length=reader.getUint32(),reader.getString(length);case"Y":return reader.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const arrayLength=reader.getUint32(),encoding=reader.getUint32(),compressedLength=reader.getUint32();if(0===encoding)switch(type){case"b":case"c":return reader.getBooleanArray(arrayLength);case"d":return reader.getFloat64Array(arrayLength);case"f":return reader.getFloat32Array(arrayLength);case"i":return reader.getInt32Array(arrayLength);case"l":return reader.getInt64Array(arrayLength)}const data=unzlibSync(new Uint8Array(reader.getArrayBuffer(compressedLength))),reader2=new BinaryReader(data.buffer);switch(type){case"b":case"c":return reader2.getBooleanArray(arrayLength);case"d":return reader2.getFloat64Array(arrayLength);case"f":return reader2.getFloat32Array(arrayLength);case"i":return reader2.getInt32Array(arrayLength);case"l":return reader2.getInt64Array(arrayLength)}default:throw new Error("THREE.FBXLoader: Unknown property type "+type)}}}class BinaryReader{constructor(buffer,littleEndian){this.dv=new DataView(buffer),this.offset=0,this.littleEndian=void 0===littleEndian||littleEndian}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(length){this.offset+=length}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(size){const a=[];for(let i=0;i<size;i++)a.push(this.getBoolean());return a}getUint8(){const value=this.dv.getUint8(this.offset);return this.offset+=1,value}getInt16(){const value=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,value}getInt32(){const value=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,value}getInt32Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getInt32());return a}getUint32(){const value=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,value}getInt64(){let low,high;return this.littleEndian?(low=this.getUint32(),high=this.getUint32()):(high=this.getUint32(),low=this.getUint32()),2147483648&high?(high=4294967295&~high,low=4294967295&~low,4294967295===low&&(high=high+1&4294967295),low=low+1&4294967295,-(4294967296*high+low)):4294967296*high+low}getInt64Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getInt64());return a}getUint64(){let low,high;return this.littleEndian?(low=this.getUint32(),high=this.getUint32()):(high=this.getUint32(),low=this.getUint32()),4294967296*high+low}getFloat32(){const value=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,value}getFloat32Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getFloat32());return a}getFloat64(){const value=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,value}getFloat64Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getFloat64());return a}getArrayBuffer(size){const value=this.dv.buffer.slice(this.offset,this.offset+size);return this.offset+=size,value}getString(size){let a=[];for(let i=0;i<size;i++)a[i]=this.getUint8();const nullByte=a.indexOf(0);return nullByte>=0&&(a=a.slice(0,nullByte)),decodeText(new Uint8Array(a))}}class FBXTree{add(key,val){this[key]=val}}function getFbxVersion(text){const match=text.match(/FBXVersion: (\d+)/);if(match){return parseInt(match[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(time){return time/46186158e3}const dataArray=[];function getData(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){let index;switch(infoObject.mappingType){case"ByPolygonVertex":index=polygonVertexIndex;break;case"ByPolygon":index=polygonIndex;break;case"ByVertice":index=vertexIndex;break;case"AllSame":index=infoObject.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+infoObject.mappingType)}"IndexToDirect"===infoObject.referenceType&&(index=infoObject.indices[index]);const from=index*infoObject.dataSize,to=from+infoObject.dataSize;return function slice(a,b,from,to){for(let i=from,j=0;i<to;i++,j++)a[j]=b[i];return a}(dataArray,infoObject.buffer,from,to)}const tempEuler=new three_core.O9p,tempVec=new three_core.Pq0;function generateTransform(transformData){const lTranslationM=new three_core.kn4,lPreRotationM=new three_core.kn4,lRotationM=new three_core.kn4,lPostRotationM=new three_core.kn4,lScalingM=new three_core.kn4,lScalingPivotM=new three_core.kn4,lScalingOffsetM=new three_core.kn4,lRotationOffsetM=new three_core.kn4,lRotationPivotM=new three_core.kn4,lParentGX=new three_core.kn4,lParentLX=new three_core.kn4,lGlobalT=new three_core.kn4,inheritType=transformData.inheritType?transformData.inheritType:0;if(transformData.translation&&lTranslationM.setPosition(tempVec.fromArray(transformData.translation)),transformData.preRotation){const array=transformData.preRotation.map(three_core.cj9.degToRad);array.push(transformData.eulerOrder),lPreRotationM.makeRotationFromEuler(tempEuler.fromArray(array))}if(transformData.rotation){const array=transformData.rotation.map(three_core.cj9.degToRad);array.push(transformData.eulerOrder),lRotationM.makeRotationFromEuler(tempEuler.fromArray(array))}if(transformData.postRotation){const array=transformData.postRotation.map(three_core.cj9.degToRad);array.push(transformData.eulerOrder),lPostRotationM.makeRotationFromEuler(tempEuler.fromArray(array)),lPostRotationM.invert()}transformData.scale&&lScalingM.scale(tempVec.fromArray(transformData.scale)),transformData.scalingOffset&&lScalingOffsetM.setPosition(tempVec.fromArray(transformData.scalingOffset)),transformData.scalingPivot&&lScalingPivotM.setPosition(tempVec.fromArray(transformData.scalingPivot)),transformData.rotationOffset&&lRotationOffsetM.setPosition(tempVec.fromArray(transformData.rotationOffset)),transformData.rotationPivot&&lRotationPivotM.setPosition(tempVec.fromArray(transformData.rotationPivot)),transformData.parentMatrixWorld&&(lParentLX.copy(transformData.parentMatrix),lParentGX.copy(transformData.parentMatrixWorld));const lLRM=lPreRotationM.clone().multiply(lRotationM).multiply(lPostRotationM),lParentGRM=new three_core.kn4;lParentGRM.extractRotation(lParentGX);const lParentTM=new three_core.kn4;lParentTM.copyPosition(lParentGX);const lParentGRSM=lParentTM.clone().invert().multiply(lParentGX),lParentGSM=lParentGRM.clone().invert().multiply(lParentGRSM),lLSM=lScalingM,lGlobalRS=new three_core.kn4;if(0===inheritType)lGlobalRS.copy(lParentGRM).multiply(lLRM).multiply(lParentGSM).multiply(lLSM);else if(1===inheritType)lGlobalRS.copy(lParentGRM).multiply(lParentGSM).multiply(lLRM).multiply(lLSM);else{const lParentLSM_inv=(new three_core.kn4).scale((new three_core.Pq0).setFromMatrixScale(lParentLX)).clone().invert(),lParentGSM_noLocal=lParentGSM.clone().multiply(lParentLSM_inv);lGlobalRS.copy(lParentGRM).multiply(lLRM).multiply(lParentGSM_noLocal).multiply(lLSM)}const lRotationPivotM_inv=lRotationPivotM.clone().invert(),lScalingPivotM_inv=lScalingPivotM.clone().invert();let lTransform=lTranslationM.clone().multiply(lRotationOffsetM).multiply(lRotationPivotM).multiply(lPreRotationM).multiply(lRotationM).multiply(lPostRotationM).multiply(lRotationPivotM_inv).multiply(lScalingOffsetM).multiply(lScalingPivotM).multiply(lScalingM).multiply(lScalingPivotM_inv);const lLocalTWithAllPivotAndOffsetInfo=(new three_core.kn4).copyPosition(lTransform),lGlobalTranslation=lParentGX.clone().multiply(lLocalTWithAllPivotAndOffsetInfo);return lGlobalT.copyPosition(lGlobalTranslation),lTransform=lGlobalT.clone().multiply(lGlobalRS),lTransform.premultiply(lParentGX.invert()),lTransform}function getEulerOrder(order){const enums=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(order=order||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),enums[0]):enums[order]}function parseNumberArray(value){return value.split(",").map((function(val){return parseFloat(val)}))}function convertArrayBufferToString(buffer,from,to){return void 0===from&&(from=0),void 0===to&&(to=buffer.byteLength),decodeText(new Uint8Array(buffer,from,to))}function inject(a1,index,a2){return a1.slice(0,index).concat(a2).concat(a1.slice(index))}var __defProp=Object.defineProperty,__publicField=(obj,key,value)=>(((obj,key,value)=>{key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value})(obj,"symbol"!=typeof key?key+"":key,value),value);class FontLoader extends three_core.aHM{constructor(manager){super(manager)}load(url,onLoad,onProgress,onError){const loader=new three_core.Y9S(this.manager);loader.setPath(this.path),loader.setRequestHeader(this.requestHeader),loader.setWithCredentials(this.withCredentials),loader.load(url,(response=>{if("string"!=typeof response)throw new Error("unsupported data type");const json=JSON.parse(response),font=this.parse(json);onLoad&&onLoad(font)}),onProgress,onError)}loadAsync(url,onProgress){return super.loadAsync(url,onProgress)}parse(json){return new Font(json)}}class Font{constructor(data){__publicField(this,"data"),__publicField(this,"isFont",!0),__publicField(this,"type","Font"),this.data=data}generateShapes(text,size=100,_options){const shapes=[],options={letterSpacing:0,lineHeight:1,..._options},paths=function createPaths(text,size,data,options){const chars=Array.from(text),scale=size/data.resolution,line_height=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*scale,paths=[];let offsetX=0,offsetY=0;for(let i=0;i<chars.length;i++){const char=chars[i];if("\n"===char)offsetX=0,offsetY-=line_height*options.lineHeight;else{const ret=createPath(char,scale,offsetX,offsetY,data);ret&&(offsetX+=ret.offsetX+options.letterSpacing,paths.push(ret.path))}}return paths}(text,size,this.data,options);for(let p=0,pl=paths.length;p<pl;p++)Array.prototype.push.apply(shapes,paths[p].toShapes(!1));return shapes}}function createPath(char,scale,offsetX,offsetY,data){const glyph=data.glyphs[char]||data.glyphs["?"];if(!glyph)return void console.error('THREE.Font: character "'+char+'" does not exists in font family '+data.familyName+".");const path=new three_core.Ld9;let x,y,cpx,cpy,cpx1,cpy1,cpx2,cpy2;if(glyph.o){const outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));for(let i=0,l=outline.length;i<l;){switch(outline[i++]){case"m":x=parseInt(outline[i++])*scale+offsetX,y=parseInt(outline[i++])*scale+offsetY,path.moveTo(x,y);break;case"l":x=parseInt(outline[i++])*scale+offsetX,y=parseInt(outline[i++])*scale+offsetY,path.lineTo(x,y);break;case"q":cpx=parseInt(outline[i++])*scale+offsetX,cpy=parseInt(outline[i++])*scale+offsetY,cpx1=parseInt(outline[i++])*scale+offsetX,cpy1=parseInt(outline[i++])*scale+offsetY,path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);break;case"b":cpx=parseInt(outline[i++])*scale+offsetX,cpy=parseInt(outline[i++])*scale+offsetY,cpx1=parseInt(outline[i++])*scale+offsetX,cpy1=parseInt(outline[i++])*scale+offsetY,cpx2=parseInt(outline[i++])*scale+offsetX,cpy2=parseInt(outline[i++])*scale+offsetY,path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy)}}}return{offsetX:glyph.ha*scale,path}}const _taskCache=new WeakMap;class DRACOLoader extends three_core.aHM{constructor(manager){super(manager),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(path){return this.decoderPath=path,this}setDecoderConfig(config){return this.decoderConfig=config,this}setWorkerLimit(workerLimit){return this.workerLimit=workerLimit,this}load(url,onLoad,onProgress,onError){const loader=new three_core.Y9S(this.manager);loader.setPath(this.path),loader.setResponseType("arraybuffer"),loader.setRequestHeader(this.requestHeader),loader.setWithCredentials(this.withCredentials),loader.load(url,(buffer=>{const taskConfig={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(buffer,taskConfig).then(onLoad).catch(onError)}),onProgress,onError)}decodeDracoFile(buffer,callback,attributeIDs,attributeTypes){const taskConfig={attributeIDs:attributeIDs||this.defaultAttributeIDs,attributeTypes:attributeTypes||this.defaultAttributeTypes,useUniqueIDs:!!attributeIDs};this.decodeGeometry(buffer,taskConfig).then(callback)}decodeGeometry(buffer,taskConfig){for(const attribute in taskConfig.attributeTypes){const type=taskConfig.attributeTypes[attribute];void 0!==type.BYTES_PER_ELEMENT&&(taskConfig.attributeTypes[attribute]=type.name)}const taskKey=JSON.stringify(taskConfig);if(_taskCache.has(buffer)){const cachedTask=_taskCache.get(buffer);if(cachedTask.key===taskKey)return cachedTask.promise;if(0===buffer.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let worker;const taskID=this.workerNextTaskID++,taskCost=buffer.byteLength,geometryPending=this._getWorker(taskID,taskCost).then((_worker=>(worker=_worker,new Promise(((resolve,reject)=>{worker._callbacks[taskID]={resolve,reject},worker.postMessage({type:"decode",id:taskID,taskConfig,buffer},[buffer])}))))).then((message=>this._createGeometry(message.geometry)));return geometryPending.catch((()=>!0)).then((()=>{worker&&taskID&&this._releaseTask(worker,taskID)})),_taskCache.set(buffer,{key:taskKey,promise:geometryPending}),geometryPending}_createGeometry(geometryData){const geometry=new three_core.LoY;geometryData.index&&geometry.setIndex(new three_core.THS(geometryData.index.array,1));for(let i=0;i<geometryData.attributes.length;i++){const attribute=geometryData.attributes[i],name=attribute.name,array=attribute.array,itemSize=attribute.itemSize;geometry.setAttribute(name,new three_core.THS(array,itemSize))}return geometry}_loadLibrary(url,responseType){const loader=new three_core.Y9S(this.manager);return loader.setPath(this.decoderPath),loader.setResponseType(responseType),loader.setWithCredentials(this.withCredentials),new Promise(((resolve,reject)=>{loader.load(url,resolve,void 0,reject)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const useJS="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,librariesPending=[];return useJS?librariesPending.push(this._loadLibrary("draco_decoder.js","text")):(librariesPending.push(this._loadLibrary("draco_wasm_wrapper.js","text")),librariesPending.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(librariesPending).then((libraries=>{const jsContent=libraries[0];useJS||(this.decoderConfig.wasmBinary=libraries[1]);const fn=DRACOWorker.toString(),body=["/* draco decoder */",jsContent,"","/* worker */",fn.substring(fn.indexOf("{")+1,fn.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([body]))})),this.decoderPending}_getWorker(taskID,taskCost){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const worker2=new Worker(this.workerSourceURL);worker2._callbacks={},worker2._taskCosts={},worker2._taskLoad=0,worker2.postMessage({type:"init",decoderConfig:this.decoderConfig}),worker2.onmessage=function(e){const message=e.data;switch(message.type){case"decode":worker2._callbacks[message.id].resolve(message);break;case"error":worker2._callbacks[message.id].reject(message);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+message.type+'"')}},this.workerPool.push(worker2)}else this.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));const worker=this.workerPool[this.workerPool.length-1];return worker._taskCosts[taskID]=taskCost,worker._taskLoad+=taskCost,worker}))}_releaseTask(worker,taskID){worker._taskLoad-=worker._taskCosts[taskID],delete worker._callbacks[taskID],delete worker._taskCosts[taskID]}debug(){console.log("Task load: ",this.workerPool.map((worker=>worker._taskLoad)))}dispose(){for(let i=0;i<this.workerPool.length;++i)this.workerPool[i].terminate();return this.workerPool.length=0,this}}function DRACOWorker(){let decoderConfig,decoderPending;function decodeAttribute(draco,decoder,dracoGeometry,attributeName,attributeType,attribute){const numComponents=attribute.num_components(),numValues=dracoGeometry.num_points()*numComponents,byteLength=numValues*attributeType.BYTES_PER_ELEMENT,dataType=function getDracoDataType(draco,attributeType){switch(attributeType){case Float32Array:return draco.DT_FLOAT32;case Int8Array:return draco.DT_INT8;case Int16Array:return draco.DT_INT16;case Int32Array:return draco.DT_INT32;case Uint8Array:return draco.DT_UINT8;case Uint16Array:return draco.DT_UINT16;case Uint32Array:return draco.DT_UINT32}}(draco,attributeType),ptr=draco._malloc(byteLength);decoder.GetAttributeDataArrayForAllPoints(dracoGeometry,attribute,dataType,byteLength,ptr);const array=new attributeType(draco.HEAPF32.buffer,ptr,numValues).slice();return draco._free(ptr),{name:attributeName,array,itemSize:numComponents}}onmessage=function(e){const message=e.data;switch(message.type){case"init":decoderConfig=message.decoderConfig,decoderPending=new Promise((function(resolve){decoderConfig.onModuleLoaded=function(draco){resolve({draco})},DracoDecoderModule(decoderConfig)}));break;case"decode":const buffer=message.buffer,taskConfig=message.taskConfig;decoderPending.then((module=>{const draco=module.draco,decoder=new draco.Decoder,decoderBuffer=new draco.DecoderBuffer;decoderBuffer.Init(new Int8Array(buffer),buffer.byteLength);try{const geometry=function decodeGeometry(draco,decoder,decoderBuffer,taskConfig){const attributeIDs=taskConfig.attributeIDs,attributeTypes=taskConfig.attributeTypes;let dracoGeometry,decodingStatus;const geometryType=decoder.GetEncodedGeometryType(decoderBuffer);if(geometryType===draco.TRIANGULAR_MESH)dracoGeometry=new draco.Mesh,decodingStatus=decoder.DecodeBufferToMesh(decoderBuffer,dracoGeometry);else{if(geometryType!==draco.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");dracoGeometry=new draco.PointCloud,decodingStatus=decoder.DecodeBufferToPointCloud(decoderBuffer,dracoGeometry)}if(!decodingStatus.ok()||0===dracoGeometry.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+decodingStatus.error_msg());const geometry={index:null,attributes:[]};for(const attributeName in attributeIDs){const attributeType=self[attributeTypes[attributeName]];let attribute,attributeID;if(taskConfig.useUniqueIDs)attributeID=attributeIDs[attributeName],attribute=decoder.GetAttributeByUniqueId(dracoGeometry,attributeID);else{if(attributeID=decoder.GetAttributeId(dracoGeometry,draco[attributeIDs[attributeName]]),-1===attributeID)continue;attribute=decoder.GetAttribute(dracoGeometry,attributeID)}geometry.attributes.push(decodeAttribute(draco,decoder,dracoGeometry,attributeName,attributeType,attribute))}geometryType===draco.TRIANGULAR_MESH&&(geometry.index=function decodeIndex(draco,decoder,dracoGeometry){const numFaces=dracoGeometry.num_faces(),numIndices=3*numFaces,byteLength=4*numIndices,ptr=draco._malloc(byteLength);decoder.GetTrianglesUInt32Array(dracoGeometry,byteLength,ptr);const index=new Uint32Array(draco.HEAPF32.buffer,ptr,numIndices).slice();return draco._free(ptr),{array:index,itemSize:1}}(draco,decoder,dracoGeometry));return draco.destroy(dracoGeometry),geometry}(draco,decoder,decoderBuffer,taskConfig),buffers=geometry.attributes.map((attr=>attr.array.buffer));geometry.index&&buffers.push(geometry.index.array.buffer),self.postMessage({type:"decode",id:message.id,geometry},buffers)}catch(error){console.error(error),self.postMessage({type:"error",id:message.id,error:error.message})}finally{draco.destroy(decoderBuffer),draco.destroy(decoder)}}))}}}let generated;const MeshoptDecoder=()=>{if(generated)return generated;const detector=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),wasmpack=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let instance,wasm="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(detector)&&(wasm="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");const promise=WebAssembly.instantiate(function unpack(data){const result=new Uint8Array(data.length);for(let i=0;i<data.length;++i){const ch=data.charCodeAt(i);result[i]=ch>96?ch-71:ch>64?ch-65:ch>47?ch+4:ch>46?63:62}let write=0;for(let i=0;i<data.length;++i)result[write++]=result[i]<60?wasmpack[result[i]]:64*(result[i]-60)+result[++i];return result.buffer.slice(0,write)}(wasm),{}).then((result=>{instance=result.instance,instance.exports.__wasm_call_ctors()}));function decode(fun,target,count,size,source,filter){const sbrk=instance.exports.sbrk,count4=count+3&-4,tp=sbrk(count4*size),sp=sbrk(source.length),heap=new Uint8Array(instance.exports.memory.buffer);heap.set(source,sp);const res=fun(tp,count,size,sp,source.length);if(0===res&&filter&&filter(tp,count4,size),target.set(heap.subarray(tp,tp+count*size)),sbrk(tp-sbrk(0)),0!==res)throw new Error(`Malformed buffer data: ${res}`)}const filters={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},decoders={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return generated={ready:promise,supported:!0,decodeVertexBuffer(target,count,size,source,filter){decode(instance.exports.meshopt_decodeVertexBuffer,target,count,size,source,instance.exports[filters[filter]])},decodeIndexBuffer(target,count,size,source){decode(instance.exports.meshopt_decodeIndexBuffer,target,count,size,source)},decodeIndexSequence(target,count,size,source){decode(instance.exports.meshopt_decodeIndexSequence,target,count,size,source)},decodeGltfBuffer(target,count,size,source,mode,filter){decode(instance.exports[decoders[mode]],target,count,size,source,instance.exports[filters[filter]])}},generated};class GLTFLoader extends three_core.aHM{constructor(manager){super(manager),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(parser){return new GLTFMaterialsClearcoatExtension(parser)})),this.register((function(parser){return new GLTFMaterialsDispersionExtension(parser)})),this.register((function(parser){return new GLTFTextureBasisUExtension(parser)})),this.register((function(parser){return new GLTFTextureWebPExtension(parser)})),this.register((function(parser){return new GLTFTextureAVIFExtension(parser)})),this.register((function(parser){return new GLTFMaterialsSheenExtension(parser)})),this.register((function(parser){return new GLTFMaterialsTransmissionExtension(parser)})),this.register((function(parser){return new GLTFMaterialsVolumeExtension(parser)})),this.register((function(parser){return new GLTFMaterialsIorExtension(parser)})),this.register((function(parser){return new GLTFMaterialsEmissiveStrengthExtension(parser)})),this.register((function(parser){return new GLTFMaterialsSpecularExtension(parser)})),this.register((function(parser){return new GLTFMaterialsIridescenceExtension(parser)})),this.register((function(parser){return new GLTFMaterialsAnisotropyExtension(parser)})),this.register((function(parser){return new GLTFMaterialsBumpExtension(parser)})),this.register((function(parser){return new GLTFLightsExtension(parser)})),this.register((function(parser){return new GLTFMeshoptCompression(parser)})),this.register((function(parser){return new GLTFMeshGpuInstancing(parser)}))}load(url,onLoad,onProgress,onError){const scope=this;let resourcePath;if(""!==this.resourcePath)resourcePath=this.resourcePath;else if(""!==this.path){const relativeUrl=three_core.r6x.extractUrlBase(url);resourcePath=three_core.r6x.resolveURL(relativeUrl,this.path)}else resourcePath=three_core.r6x.extractUrlBase(url);this.manager.itemStart(url);const _onError=function(e){onError?onError(e):console.error(e),scope.manager.itemError(url),scope.manager.itemEnd(url)},loader=new three_core.Y9S(this.manager);loader.setPath(this.path),loader.setResponseType("arraybuffer"),loader.setRequestHeader(this.requestHeader),loader.setWithCredentials(this.withCredentials),loader.load(url,(function(data){try{scope.parse(data,resourcePath,(function(gltf){onLoad(gltf),scope.manager.itemEnd(url)}),_onError)}catch(e){_onError(e)}}),onProgress,_onError)}setDRACOLoader(dracoLoader){return this.dracoLoader=dracoLoader,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(ktx2Loader){return this.ktx2Loader=ktx2Loader,this}setMeshoptDecoder(meshoptDecoder){return this.meshoptDecoder=meshoptDecoder,this}register(callback){return-1===this.pluginCallbacks.indexOf(callback)&&this.pluginCallbacks.push(callback),this}unregister(callback){return-1!==this.pluginCallbacks.indexOf(callback)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(callback),1),this}parse(data,path,onLoad,onError){let json;const extensions={},plugins={};if("string"==typeof data)json=JSON.parse(data);else if(data instanceof ArrayBuffer){if(decodeText(new Uint8Array(data.slice(0,4)))===BINARY_EXTENSION_HEADER_MAGIC){try{extensions[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(data)}catch(error){return void(onError&&onError(error))}json=JSON.parse(extensions[EXTENSIONS.KHR_BINARY_GLTF].content)}else json=JSON.parse(decodeText(new Uint8Array(data)))}else json=data;if(void 0===json.asset||json.asset.version[0]<2)return void(onError&&onError(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const parser=new GLTFParser(json,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});parser.fileLoader.setRequestHeader(this.requestHeader);for(let i=0;i<this.pluginCallbacks.length;i++){const plugin=this.pluginCallbacks[i](parser);plugin.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),plugins[plugin.name]=plugin,extensions[plugin.name]=!0}if(json.extensionsUsed)for(let i=0;i<json.extensionsUsed.length;++i){const extensionName=json.extensionsUsed[i],extensionsRequired=json.extensionsRequired||[];switch(extensionName){case EXTENSIONS.KHR_MATERIALS_UNLIT:extensions[extensionName]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:extensions[extensionName]=new GLTFDracoMeshCompressionExtension(json,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:extensions[extensionName]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:extensions[extensionName]=new GLTFMeshQuantizationExtension;break;default:extensionsRequired.indexOf(extensionName)>=0&&void 0===plugins[extensionName]&&console.warn('THREE.GLTFLoader: Unknown extension "'+extensionName+'".')}}parser.setExtensions(extensions),parser.setPlugins(plugins),parser.parse(onLoad,onError)}parseAsync(data,path){const scope=this;return new Promise((function(resolve,reject){scope.parse(data,path,resolve,reject)}))}}function GLTFRegistry(){let objects={};return{get:function(key){return objects[key]},add:function(key,object){objects[key]=object},remove:function(key){delete objects[key]},removeAll:function(){objects={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const parser=this.parser,nodeDefs=this.parser.json.nodes||[];for(let nodeIndex=0,nodeLength=nodeDefs.length;nodeIndex<nodeLength;nodeIndex++){const nodeDef=nodeDefs[nodeIndex];nodeDef.extensions&&nodeDef.extensions[this.name]&&void 0!==nodeDef.extensions[this.name].light&&parser._addNodeRef(this.cache,nodeDef.extensions[this.name].light)}}_loadLight(lightIndex){const parser=this.parser,cacheKey="light:"+lightIndex;let dependency=parser.cache.get(cacheKey);if(dependency)return dependency;const json=parser.json,lightDef=((json.extensions&&json.extensions[this.name]||{}).lights||[])[lightIndex];let lightNode;const color=new three_core.Q1f(16777215);void 0!==lightDef.color&&color.setRGB(lightDef.color[0],lightDef.color[1],lightDef.color[2],"srgb-linear");const range=void 0!==lightDef.range?lightDef.range:0;switch(lightDef.type){case"directional":lightNode=new three_core.ZyN(color),lightNode.target.position.set(0,0,-1),lightNode.add(lightNode.target);break;case"point":lightNode=new three_core.HiM(color),lightNode.distance=range;break;case"spot":lightNode=new three_core.nCl(color),lightNode.distance=range,lightDef.spot=lightDef.spot||{},lightDef.spot.innerConeAngle=void 0!==lightDef.spot.innerConeAngle?lightDef.spot.innerConeAngle:0,lightDef.spot.outerConeAngle=void 0!==lightDef.spot.outerConeAngle?lightDef.spot.outerConeAngle:Math.PI/4,lightNode.angle=lightDef.spot.outerConeAngle,lightNode.penumbra=1-lightDef.spot.innerConeAngle/lightDef.spot.outerConeAngle,lightNode.target.position.set(0,0,-1),lightNode.add(lightNode.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+lightDef.type)}return lightNode.position.set(0,0,0),lightNode.decay=2,assignExtrasToUserData(lightNode,lightDef),void 0!==lightDef.intensity&&(lightNode.intensity=lightDef.intensity),lightNode.name=parser.createUniqueName(lightDef.name||"light_"+lightIndex),dependency=Promise.resolve(lightNode),parser.cache.add(cacheKey,dependency),dependency}getDependency(type,index){if("light"===type)return this._loadLight(index)}createNodeAttachment(nodeIndex){const self2=this,parser=this.parser,nodeDef=parser.json.nodes[nodeIndex],lightIndex=(nodeDef.extensions&&nodeDef.extensions[this.name]||{}).light;return void 0===lightIndex?null:this._loadLight(lightIndex).then((function(light){return parser._getNodeRef(self2.cache,lightIndex,light)}))}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return three_core.V9B}extendParams(materialParams,materialDef,parser){const pending=[];materialParams.color=new three_core.Q1f(1,1,1),materialParams.opacity=1;const metallicRoughness=materialDef.pbrMetallicRoughness;if(metallicRoughness){if(Array.isArray(metallicRoughness.baseColorFactor)){const array=metallicRoughness.baseColorFactor;materialParams.color.setRGB(array[0],array[1],array[2],"srgb-linear"),materialParams.opacity=array[3]}void 0!==metallicRoughness.baseColorTexture&&pending.push(parser.assignTexture(materialParams,"map",metallicRoughness.baseColorTexture,"srgb"))}return Promise.all(pending)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(materialIndex,materialParams){const materialDef=this.parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const emissiveStrength=materialDef.extensions[this.name].emissiveStrength;return void 0!==emissiveStrength&&(materialParams.emissiveIntensity=emissiveStrength),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];if(void 0!==extension.clearcoatFactor&&(materialParams.clearcoat=extension.clearcoatFactor),void 0!==extension.clearcoatTexture&&pending.push(parser.assignTexture(materialParams,"clearcoatMap",extension.clearcoatTexture)),void 0!==extension.clearcoatRoughnessFactor&&(materialParams.clearcoatRoughness=extension.clearcoatRoughnessFactor),void 0!==extension.clearcoatRoughnessTexture&&pending.push(parser.assignTexture(materialParams,"clearcoatRoughnessMap",extension.clearcoatRoughnessTexture)),void 0!==extension.clearcoatNormalTexture&&(pending.push(parser.assignTexture(materialParams,"clearcoatNormalMap",extension.clearcoatNormalTexture)),void 0!==extension.clearcoatNormalTexture.scale)){const scale=extension.clearcoatNormalTexture.scale;materialParams.clearcoatNormalScale=new three_core.I9Y(scale,scale)}return Promise.all(pending)}}class GLTFMaterialsDispersionExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const materialDef=this.parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const extension=materialDef.extensions[this.name];return materialParams.dispersion=void 0!==extension.dispersion?extension.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];return void 0!==extension.iridescenceFactor&&(materialParams.iridescence=extension.iridescenceFactor),void 0!==extension.iridescenceTexture&&pending.push(parser.assignTexture(materialParams,"iridescenceMap",extension.iridescenceTexture)),void 0!==extension.iridescenceIor&&(materialParams.iridescenceIOR=extension.iridescenceIor),void 0===materialParams.iridescenceThicknessRange&&(materialParams.iridescenceThicknessRange=[100,400]),void 0!==extension.iridescenceThicknessMinimum&&(materialParams.iridescenceThicknessRange[0]=extension.iridescenceThicknessMinimum),void 0!==extension.iridescenceThicknessMaximum&&(materialParams.iridescenceThicknessRange[1]=extension.iridescenceThicknessMaximum),void 0!==extension.iridescenceThicknessTexture&&pending.push(parser.assignTexture(materialParams,"iridescenceThicknessMap",extension.iridescenceThicknessTexture)),Promise.all(pending)}}class GLTFMaterialsSheenExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[];materialParams.sheenColor=new three_core.Q1f(0,0,0),materialParams.sheenRoughness=0,materialParams.sheen=1;const extension=materialDef.extensions[this.name];if(void 0!==extension.sheenColorFactor){const colorFactor=extension.sheenColorFactor;materialParams.sheenColor.setRGB(colorFactor[0],colorFactor[1],colorFactor[2],"srgb-linear")}return void 0!==extension.sheenRoughnessFactor&&(materialParams.sheenRoughness=extension.sheenRoughnessFactor),void 0!==extension.sheenColorTexture&&pending.push(parser.assignTexture(materialParams,"sheenColorMap",extension.sheenColorTexture,"srgb")),void 0!==extension.sheenRoughnessTexture&&pending.push(parser.assignTexture(materialParams,"sheenRoughnessMap",extension.sheenRoughnessTexture)),Promise.all(pending)}}class GLTFMaterialsTransmissionExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];return void 0!==extension.transmissionFactor&&(materialParams.transmission=extension.transmissionFactor),void 0!==extension.transmissionTexture&&pending.push(parser.assignTexture(materialParams,"transmissionMap",extension.transmissionTexture)),Promise.all(pending)}}class GLTFMaterialsVolumeExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];materialParams.thickness=void 0!==extension.thicknessFactor?extension.thicknessFactor:0,void 0!==extension.thicknessTexture&&pending.push(parser.assignTexture(materialParams,"thicknessMap",extension.thicknessTexture)),materialParams.attenuationDistance=extension.attenuationDistance||1/0;const colorArray=extension.attenuationColor||[1,1,1];return materialParams.attenuationColor=(new three_core.Q1f).setRGB(colorArray[0],colorArray[1],colorArray[2],"srgb-linear"),Promise.all(pending)}}class GLTFMaterialsIorExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const materialDef=this.parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const extension=materialDef.extensions[this.name];return materialParams.ior=void 0!==extension.ior?extension.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];materialParams.specularIntensity=void 0!==extension.specularFactor?extension.specularFactor:1,void 0!==extension.specularTexture&&pending.push(parser.assignTexture(materialParams,"specularIntensityMap",extension.specularTexture));const colorArray=extension.specularColorFactor||[1,1,1];return materialParams.specularColor=(new three_core.Q1f).setRGB(colorArray[0],colorArray[1],colorArray[2],"srgb-linear"),void 0!==extension.specularColorTexture&&pending.push(parser.assignTexture(materialParams,"specularColorMap",extension.specularColorTexture,"srgb")),Promise.all(pending)}}class GLTFMaterialsBumpExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];return materialParams.bumpScale=void 0!==extension.bumpFactor?extension.bumpFactor:1,void 0!==extension.bumpTexture&&pending.push(parser.assignTexture(materialParams,"bumpMap",extension.bumpTexture)),Promise.all(pending)}}class GLTFMaterialsAnisotropyExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(materialIndex){const materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?three_core.uSd:null}extendMaterialParams(materialIndex,materialParams){const parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();const pending=[],extension=materialDef.extensions[this.name];return void 0!==extension.anisotropyStrength&&(materialParams.anisotropy=extension.anisotropyStrength),void 0!==extension.anisotropyRotation&&(materialParams.anisotropyRotation=extension.anisotropyRotation),void 0!==extension.anisotropyTexture&&pending.push(parser.assignTexture(materialParams,"anisotropyMap",extension.anisotropyTexture)),Promise.all(pending)}}class GLTFTextureBasisUExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(textureIndex){const parser=this.parser,json=parser.json,textureDef=json.textures[textureIndex];if(!textureDef.extensions||!textureDef.extensions[this.name])return null;const extension=textureDef.extensions[this.name],loader=parser.options.ktx2Loader;if(!loader){if(json.extensionsRequired&&json.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return parser.loadTextureImage(textureIndex,extension.source,loader)}}class GLTFTextureWebPExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(textureIndex){const name=this.name,parser=this.parser,json=parser.json,textureDef=json.textures[textureIndex];if(!textureDef.extensions||!textureDef.extensions[name])return null;const extension=textureDef.extensions[name],source=json.images[extension.source];let loader=parser.textureLoader;if(source.uri){const handler=parser.options.manager.getHandler(source.uri);null!==handler&&(loader=handler)}return this.detectSupport().then((function(isSupported){if(isSupported)return parser.loadTextureImage(textureIndex,extension.source,loader);if(json.extensionsRequired&&json.extensionsRequired.indexOf(name)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return parser.loadTexture(textureIndex)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(resolve){const image=new Image;image.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",image.onload=image.onerror=function(){resolve(1===image.height)}}))),this.isSupported}}class GLTFTextureAVIFExtension{constructor(parser){this.parser=parser,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(textureIndex){const name=this.name,parser=this.parser,json=parser.json,textureDef=json.textures[textureIndex];if(!textureDef.extensions||!textureDef.extensions[name])return null;const extension=textureDef.extensions[name],source=json.images[extension.source];let loader=parser.textureLoader;if(source.uri){const handler=parser.options.manager.getHandler(source.uri);null!==handler&&(loader=handler)}return this.detectSupport().then((function(isSupported){if(isSupported)return parser.loadTextureImage(textureIndex,extension.source,loader);if(json.extensionsRequired&&json.extensionsRequired.indexOf(name)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return parser.loadTexture(textureIndex)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(resolve){const image=new Image;image.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",image.onload=image.onerror=function(){resolve(1===image.height)}}))),this.isSupported}}class GLTFMeshoptCompression{constructor(parser){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=parser}loadBufferView(index){const json=this.parser.json,bufferView=json.bufferViews[index];if(bufferView.extensions&&bufferView.extensions[this.name]){const extensionDef=bufferView.extensions[this.name],buffer=this.parser.getDependency("buffer",extensionDef.buffer),decoder=this.parser.options.meshoptDecoder;if(!decoder||!decoder.supported){if(json.extensionsRequired&&json.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return buffer.then((function(res){const byteOffset=extensionDef.byteOffset||0,byteLength=extensionDef.byteLength||0,count=extensionDef.count,stride=extensionDef.byteStride,source=new Uint8Array(res,byteOffset,byteLength);return decoder.decodeGltfBufferAsync?decoder.decodeGltfBufferAsync(count,stride,source,extensionDef.mode,extensionDef.filter).then((function(res2){return res2.buffer})):decoder.ready.then((function(){const result=new ArrayBuffer(count*stride);return decoder.decodeGltfBuffer(new Uint8Array(result),count,stride,source,extensionDef.mode,extensionDef.filter),result}))}))}return null}}class GLTFMeshGpuInstancing{constructor(parser){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=parser}createNodeMesh(nodeIndex){const json=this.parser.json,nodeDef=json.nodes[nodeIndex];if(!nodeDef.extensions||!nodeDef.extensions[this.name]||void 0===nodeDef.mesh)return null;const meshDef=json.meshes[nodeDef.mesh];for(const primitive of meshDef.primitives)if(primitive.mode!==WEBGL_CONSTANTS.TRIANGLES&&primitive.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&primitive.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&void 0!==primitive.mode)return null;const attributesDef=nodeDef.extensions[this.name].attributes,pending=[],attributes={};for(const key in attributesDef)pending.push(this.parser.getDependency("accessor",attributesDef[key]).then((accessor=>(attributes[key]=accessor,attributes[key]))));return pending.length<1?null:(pending.push(this.parser.createNodeMesh(nodeIndex)),Promise.all(pending).then((results=>{const nodeObject=results.pop(),meshes=nodeObject.isGroup?nodeObject.children:[nodeObject],count=results[0].count,instancedMeshes=[];for(const mesh of meshes){const m=new three_core.kn4,p=new three_core.Pq0,q=new three_core.PTz,s=new three_core.Pq0(1,1,1),instancedMesh=new three_core.ZLX(mesh.geometry,mesh.material,count);for(let i=0;i<count;i++)attributes.TRANSLATION&&p.fromBufferAttribute(attributes.TRANSLATION,i),attributes.ROTATION&&q.fromBufferAttribute(attributes.ROTATION,i),attributes.SCALE&&s.fromBufferAttribute(attributes.SCALE,i),instancedMesh.setMatrixAt(i,m.compose(p,q,s));for(const attributeName in attributes)if("_COLOR_0"===attributeName){const attr=attributes[attributeName];instancedMesh.instanceColor=new three_core.uWO(attr.array,attr.itemSize,attr.normalized)}else"TRANSLATION"!==attributeName&&"ROTATION"!==attributeName&&"SCALE"!==attributeName&&mesh.geometry.setAttribute(attributeName,attributes[attributeName]);three_core.B69.prototype.copy.call(instancedMesh,mesh),this.parser.assignFinalMaterial(instancedMesh),instancedMeshes.push(instancedMesh)}return nodeObject.isGroup?(nodeObject.clear(),nodeObject.add(...instancedMeshes),nodeObject):instancedMeshes[0]})))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_CHUNK_TYPES_JSON=1313821514,BINARY_EXTENSION_CHUNK_TYPES_BIN=5130562;class GLTFBinaryExtension{constructor(data){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const headerView=new DataView(data,0,12);if(this.header={magic:decodeText(new Uint8Array(data.slice(0,4))),version:headerView.getUint32(4,!0),length:headerView.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const chunkContentsLength=this.header.length-12,chunkView=new DataView(data,12);let chunkIndex=0;for(;chunkIndex<chunkContentsLength;){const chunkLength=chunkView.getUint32(chunkIndex,!0);chunkIndex+=4;const chunkType=chunkView.getUint32(chunkIndex,!0);if(chunkIndex+=4,chunkType===BINARY_EXTENSION_CHUNK_TYPES_JSON){const contentArray=new Uint8Array(data,12+chunkIndex,chunkLength);this.content=decodeText(contentArray)}else if(chunkType===BINARY_EXTENSION_CHUNK_TYPES_BIN){const byteOffset=12+chunkIndex;this.body=data.slice(byteOffset,byteOffset+chunkLength)}chunkIndex+=chunkLength}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(json,dracoLoader){if(!dracoLoader)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=json,this.dracoLoader=dracoLoader,this.dracoLoader.preload()}decodePrimitive(primitive,parser){const json=this.json,dracoLoader=this.dracoLoader,bufferViewIndex=primitive.extensions[this.name].bufferView,gltfAttributeMap=primitive.extensions[this.name].attributes,threeAttributeMap={},attributeNormalizedMap={},attributeTypeMap={};for(const attributeName in gltfAttributeMap){const threeAttributeName=ATTRIBUTES[attributeName]||attributeName.toLowerCase();threeAttributeMap[threeAttributeName]=gltfAttributeMap[attributeName]}for(const attributeName in primitive.attributes){const threeAttributeName=ATTRIBUTES[attributeName]||attributeName.toLowerCase();if(void 0!==gltfAttributeMap[attributeName]){const accessorDef=json.accessors[primitive.attributes[attributeName]],componentType=WEBGL_COMPONENT_TYPES[accessorDef.componentType];attributeTypeMap[threeAttributeName]=componentType.name,attributeNormalizedMap[threeAttributeName]=!0===accessorDef.normalized}}return parser.getDependency("bufferView",bufferViewIndex).then((function(bufferView){return new Promise((function(resolve,reject){dracoLoader.decodeDracoFile(bufferView,(function(geometry){for(const attributeName in geometry.attributes){const attribute=geometry.attributes[attributeName],normalized=attributeNormalizedMap[attributeName];void 0!==normalized&&(attribute.normalized=normalized)}resolve(geometry)}),threeAttributeMap,attributeTypeMap,"srgb-linear",reject)}))}))}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(texture,transform){return void 0!==transform.texCoord&&transform.texCoord!==texture.channel||void 0!==transform.offset||void 0!==transform.rotation||void 0!==transform.scale?(texture=texture.clone(),void 0!==transform.texCoord&&(texture.channel=transform.texCoord),void 0!==transform.offset&&texture.offset.fromArray(transform.offset),void 0!==transform.rotation&&(texture.rotation=transform.rotation),void 0!==transform.scale&&texture.repeat.fromArray(transform.scale),texture.needsUpdate=!0,texture):texture}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends three_core.lGw{constructor(parameterPositions,sampleValues,sampleSize,resultBuffer){super(parameterPositions,sampleValues,sampleSize,resultBuffer)}copySampleValue_(index){const result=this.resultBuffer,values=this.sampleValues,valueSize=this.valueSize,offset=index*valueSize*3+valueSize;for(let i=0;i!==valueSize;i++)result[i]=values[offset+i];return result}interpolate_(i1,t0,t,t1){const result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,stride2=2*stride,stride3=3*stride,td=t1-t0,p=(t-t0)/td,pp=p*p,ppp=pp*p,offset1=i1*stride3,offset0=offset1-stride3,s2=-2*ppp+3*pp,s3=ppp-pp,s0=1-s2,s1=s3-pp+p;for(let i=0;i!==stride;i++){const p0=values[offset0+i+stride],m0=values[offset0+i+stride2]*td,p1=values[offset1+i+stride],m1=values[offset1+i]*td;result[i]=s0*p0+s1*m0+s2*p1+s3*m1}return result}}const _q=new three_core.PTz;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(i1,t0,t,t1){const result=super.interpolate_(i1,t0,t,t1);return _q.fromArray(result).normalize().toArray(result),result}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:three_core.hxR,9729:three_core.k6q,9984:three_core.pHI,9985:three_core.kRr,9986:three_core.Cfg,9987:three_core.$_I},WEBGL_WRAPPINGS={33071:three_core.ghU,33648:three_core.kTW,10497:three_core.GJx},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...version>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:three_core.PJ3,STEP:three_core.ljd},ALPHA_MODES_OPAQUE="OPAQUE",ALPHA_MODES_MASK="MASK",ALPHA_MODES_BLEND="BLEND";function createDefaultMaterial(cache){return void 0===cache.DefaultMaterial&&(cache.DefaultMaterial=new three_core._4j({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:three_core.hB5})),cache.DefaultMaterial}function addUnknownExtensionsToUserData(knownExtensions,object,objectDef){for(const name in objectDef.extensions)void 0===knownExtensions[name]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[name]=objectDef.extensions[name])}function assignExtrasToUserData(object,gltfDef){void 0!==gltfDef.extras&&("object"==typeof gltfDef.extras?Object.assign(object.userData,gltfDef.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+gltfDef.extras))}function updateMorphTargets(mesh,meshDef){if(mesh.updateMorphTargets(),void 0!==meshDef.weights)for(let i=0,il=meshDef.weights.length;i<il;i++)mesh.morphTargetInfluences[i]=meshDef.weights[i];if(meshDef.extras&&Array.isArray(meshDef.extras.targetNames)){const targetNames=meshDef.extras.targetNames;if(mesh.morphTargetInfluences.length===targetNames.length){mesh.morphTargetDictionary={};for(let i=0,il=targetNames.length;i<il;i++)mesh.morphTargetDictionary[targetNames[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(primitiveDef){let geometryKey;const dracoExtension=primitiveDef.extensions&&primitiveDef.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(geometryKey=dracoExtension?"draco:"+dracoExtension.bufferView+":"+dracoExtension.indices+":"+createAttributesKey(dracoExtension.attributes):primitiveDef.indices+":"+createAttributesKey(primitiveDef.attributes)+":"+primitiveDef.mode,void 0!==primitiveDef.targets)for(let i=0,il=primitiveDef.targets.length;i<il;i++)geometryKey+=":"+createAttributesKey(primitiveDef.targets[i]);return geometryKey}function createAttributesKey(attributes){let attributesKey="";const keys=Object.keys(attributes).sort();for(let i=0,il=keys.length;i<il;i++)attributesKey+=keys[i]+":"+attributes[keys[i]]+";";return attributesKey}function getNormalizedComponentScale(constructor){switch(constructor){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const _identityMatrix=new three_core.kn4;class GLTFParser{constructor(json={},options={}){this.json=json,this.extensions={},this.plugins={},this.options=options,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let isSafari=!1,isFirefox=!1,firefoxVersion=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(isSafari=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),isFirefox=navigator.userAgent.indexOf("Firefox")>-1,firefoxVersion=isFirefox?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||isSafari||isFirefox&&firefoxVersion<98?this.textureLoader=new three_core.Tap(this.options.manager):this.textureLoader=new three_core.Kzg(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new three_core.Y9S(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(extensions){this.extensions=extensions}setPlugins(plugins){this.plugins=plugins}parse(onLoad,onError){const parser=this,json=this.json,extensions=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(ext){return ext._markDefs&&ext._markDefs()})),Promise.all(this._invokeAll((function(ext){return ext.beforeRoot&&ext.beforeRoot()}))).then((function(){return Promise.all([parser.getDependencies("scene"),parser.getDependencies("animation"),parser.getDependencies("camera")])})).then((function(dependencies){const result={scene:dependencies[0][json.scene||0],scenes:dependencies[0],animations:dependencies[1],cameras:dependencies[2],asset:json.asset,parser,userData:{}};return addUnknownExtensionsToUserData(extensions,result,json),assignExtrasToUserData(result,json),Promise.all(parser._invokeAll((function(ext){return ext.afterRoot&&ext.afterRoot(result)}))).then((function(){for(const scene of result.scenes)scene.updateMatrixWorld();onLoad(result)}))})).catch(onError)}_markDefs(){const nodeDefs=this.json.nodes||[],skinDefs=this.json.skins||[],meshDefs=this.json.meshes||[];for(let skinIndex=0,skinLength=skinDefs.length;skinIndex<skinLength;skinIndex++){const joints=skinDefs[skinIndex].joints;for(let i=0,il=joints.length;i<il;i++)nodeDefs[joints[i]].isBone=!0}for(let nodeIndex=0,nodeLength=nodeDefs.length;nodeIndex<nodeLength;nodeIndex++){const nodeDef=nodeDefs[nodeIndex];void 0!==nodeDef.mesh&&(this._addNodeRef(this.meshCache,nodeDef.mesh),void 0!==nodeDef.skin&&(meshDefs[nodeDef.mesh].isSkinnedMesh=!0)),void 0!==nodeDef.camera&&this._addNodeRef(this.cameraCache,nodeDef.camera)}}_addNodeRef(cache,index){void 0!==index&&(void 0===cache.refs[index]&&(cache.refs[index]=cache.uses[index]=0),cache.refs[index]++)}_getNodeRef(cache,index,object){if(cache.refs[index]<=1)return object;const ref=object.clone(),updateMappings=(original,clone)=>{const mappings=this.associations.get(original);null!=mappings&&this.associations.set(clone,mappings);for(const[i,child]of original.children.entries())updateMappings(child,clone.children[i])};return updateMappings(object,ref),ref.name+="_instance_"+cache.uses[index]++,ref}_invokeOne(func){const extensions=Object.values(this.plugins);extensions.push(this);for(let i=0;i<extensions.length;i++){const result=func(extensions[i]);if(result)return result}return null}_invokeAll(func){const extensions=Object.values(this.plugins);extensions.unshift(this);const pending=[];for(let i=0;i<extensions.length;i++){const result=func(extensions[i]);result&&pending.push(result)}return pending}getDependency(type,index){const cacheKey=type+":"+index;let dependency=this.cache.get(cacheKey);if(!dependency){switch(type){case"scene":dependency=this.loadScene(index);break;case"node":dependency=this._invokeOne((function(ext){return ext.loadNode&&ext.loadNode(index)}));break;case"mesh":dependency=this._invokeOne((function(ext){return ext.loadMesh&&ext.loadMesh(index)}));break;case"accessor":dependency=this.loadAccessor(index);break;case"bufferView":dependency=this._invokeOne((function(ext){return ext.loadBufferView&&ext.loadBufferView(index)}));break;case"buffer":dependency=this.loadBuffer(index);break;case"material":dependency=this._invokeOne((function(ext){return ext.loadMaterial&&ext.loadMaterial(index)}));break;case"texture":dependency=this._invokeOne((function(ext){return ext.loadTexture&&ext.loadTexture(index)}));break;case"skin":dependency=this.loadSkin(index);break;case"animation":dependency=this._invokeOne((function(ext){return ext.loadAnimation&&ext.loadAnimation(index)}));break;case"camera":dependency=this.loadCamera(index);break;default:if(dependency=this._invokeOne((function(ext){return ext!=this&&ext.getDependency&&ext.getDependency(type,index)})),!dependency)throw new Error("Unknown type: "+type)}this.cache.add(cacheKey,dependency)}return dependency}getDependencies(type){let dependencies=this.cache.get(type);if(!dependencies){const parser=this,defs=this.json[type+("mesh"===type?"es":"s")]||[];dependencies=Promise.all(defs.map((function(def,index){return parser.getDependency(type,index)}))),this.cache.add(type,dependencies)}return dependencies}loadBuffer(bufferIndex){const bufferDef=this.json.buffers[bufferIndex],loader=this.fileLoader;if(bufferDef.type&&"arraybuffer"!==bufferDef.type)throw new Error("THREE.GLTFLoader: "+bufferDef.type+" buffer type is not supported.");if(void 0===bufferDef.uri&&0===bufferIndex)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const options=this.options;return new Promise((function(resolve,reject){loader.load(three_core.r6x.resolveURL(bufferDef.uri,options.path),resolve,void 0,(function(){reject(new Error('THREE.GLTFLoader: Failed to load buffer "'+bufferDef.uri+'".'))}))}))}loadBufferView(bufferViewIndex){const bufferViewDef=this.json.bufferViews[bufferViewIndex];return this.getDependency("buffer",bufferViewDef.buffer).then((function(buffer){const byteLength=bufferViewDef.byteLength||0,byteOffset=bufferViewDef.byteOffset||0;return buffer.slice(byteOffset,byteOffset+byteLength)}))}loadAccessor(accessorIndex){const parser=this,json=this.json,accessorDef=this.json.accessors[accessorIndex];if(void 0===accessorDef.bufferView&&void 0===accessorDef.sparse){const itemSize=WEBGL_TYPE_SIZES[accessorDef.type],TypedArray=WEBGL_COMPONENT_TYPES[accessorDef.componentType],normalized=!0===accessorDef.normalized,array=new TypedArray(accessorDef.count*itemSize);return Promise.resolve(new three_core.THS(array,itemSize,normalized))}const pendingBufferViews=[];return void 0!==accessorDef.bufferView?pendingBufferViews.push(this.getDependency("bufferView",accessorDef.bufferView)):pendingBufferViews.push(null),void 0!==accessorDef.sparse&&(pendingBufferViews.push(this.getDependency("bufferView",accessorDef.sparse.indices.bufferView)),pendingBufferViews.push(this.getDependency("bufferView",accessorDef.sparse.values.bufferView))),Promise.all(pendingBufferViews).then((function(bufferViews){const bufferView=bufferViews[0],itemSize=WEBGL_TYPE_SIZES[accessorDef.type],TypedArray=WEBGL_COMPONENT_TYPES[accessorDef.componentType],elementBytes=TypedArray.BYTES_PER_ELEMENT,itemBytes=elementBytes*itemSize,byteOffset=accessorDef.byteOffset||0,byteStride=void 0!==accessorDef.bufferView?json.bufferViews[accessorDef.bufferView].byteStride:void 0,normalized=!0===accessorDef.normalized;let array,bufferAttribute;if(byteStride&&byteStride!==itemBytes){const ibSlice=Math.floor(byteOffset/byteStride),ibCacheKey="InterleavedBuffer:"+accessorDef.bufferView+":"+accessorDef.componentType+":"+ibSlice+":"+accessorDef.count;let ib=parser.cache.get(ibCacheKey);ib||(array=new TypedArray(bufferView,ibSlice*byteStride,accessorDef.count*byteStride/elementBytes),ib=new three_core.eB$(array,byteStride/elementBytes),parser.cache.add(ibCacheKey,ib)),bufferAttribute=new three_core.eHs(ib,itemSize,byteOffset%byteStride/elementBytes,normalized)}else array=null===bufferView?new TypedArray(accessorDef.count*itemSize):new TypedArray(bufferView,byteOffset,accessorDef.count*itemSize),bufferAttribute=new three_core.THS(array,itemSize,normalized);if(void 0!==accessorDef.sparse){const itemSizeIndices=WEBGL_TYPE_SIZES.SCALAR,TypedArrayIndices=WEBGL_COMPONENT_TYPES[accessorDef.sparse.indices.componentType],byteOffsetIndices=accessorDef.sparse.indices.byteOffset||0,byteOffsetValues=accessorDef.sparse.values.byteOffset||0,sparseIndices=new TypedArrayIndices(bufferViews[1],byteOffsetIndices,accessorDef.sparse.count*itemSizeIndices),sparseValues=new TypedArray(bufferViews[2],byteOffsetValues,accessorDef.sparse.count*itemSize);null!==bufferView&&(bufferAttribute=new three_core.THS(bufferAttribute.array.slice(),bufferAttribute.itemSize,bufferAttribute.normalized));for(let i=0,il=sparseIndices.length;i<il;i++){const index=sparseIndices[i];if(bufferAttribute.setX(index,sparseValues[i*itemSize]),itemSize>=2&&bufferAttribute.setY(index,sparseValues[i*itemSize+1]),itemSize>=3&&bufferAttribute.setZ(index,sparseValues[i*itemSize+2]),itemSize>=4&&bufferAttribute.setW(index,sparseValues[i*itemSize+3]),itemSize>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return bufferAttribute}))}loadTexture(textureIndex){const json=this.json,options=this.options,sourceIndex=json.textures[textureIndex].source,sourceDef=json.images[sourceIndex];let loader=this.textureLoader;if(sourceDef.uri){const handler=options.manager.getHandler(sourceDef.uri);null!==handler&&(loader=handler)}return this.loadTextureImage(textureIndex,sourceIndex,loader)}loadTextureImage(textureIndex,sourceIndex,loader){const parser=this,json=this.json,textureDef=json.textures[textureIndex],sourceDef=json.images[sourceIndex],cacheKey=(sourceDef.uri||sourceDef.bufferView)+":"+textureDef.sampler;if(this.textureCache[cacheKey])return this.textureCache[cacheKey];const promise=this.loadImageSource(sourceIndex,loader).then((function(texture){texture.flipY=!1,texture.name=textureDef.name||sourceDef.name||"",""===texture.name&&"string"==typeof sourceDef.uri&&!1===sourceDef.uri.startsWith("data:image/")&&(texture.name=sourceDef.uri);const sampler=(json.samplers||{})[textureDef.sampler]||{};return texture.magFilter=WEBGL_FILTERS[sampler.magFilter]||three_core.k6q,texture.minFilter=WEBGL_FILTERS[sampler.minFilter]||three_core.$_I,texture.wrapS=WEBGL_WRAPPINGS[sampler.wrapS]||three_core.GJx,texture.wrapT=WEBGL_WRAPPINGS[sampler.wrapT]||three_core.GJx,parser.associations.set(texture,{textures:textureIndex}),texture})).catch((function(){return null}));return this.textureCache[cacheKey]=promise,promise}loadImageSource(sourceIndex,loader){const parser=this,json=this.json,options=this.options;if(void 0!==this.sourceCache[sourceIndex])return this.sourceCache[sourceIndex].then((texture=>texture.clone()));const sourceDef=json.images[sourceIndex],URL=self.URL||self.webkitURL;let sourceURI=sourceDef.uri||"",isObjectURL=!1;if(void 0!==sourceDef.bufferView)sourceURI=parser.getDependency("bufferView",sourceDef.bufferView).then((function(bufferView){isObjectURL=!0;const blob=new Blob([bufferView],{type:sourceDef.mimeType});return sourceURI=URL.createObjectURL(blob),sourceURI}));else if(void 0===sourceDef.uri)throw new Error("THREE.GLTFLoader: Image "+sourceIndex+" is missing URI and bufferView");const promise=Promise.resolve(sourceURI).then((function(sourceURI2){return new Promise((function(resolve,reject){let onLoad=resolve;!0===loader.isImageBitmapLoader&&(onLoad=function(imageBitmap){const texture=new three_core.gPd(imageBitmap);texture.needsUpdate=!0,resolve(texture)}),loader.load(three_core.r6x.resolveURL(sourceURI2,options.path),onLoad,void 0,reject)}))})).then((function(texture){return!0===isObjectURL&&URL.revokeObjectURL(sourceURI),assignExtrasToUserData(texture,sourceDef),texture.userData.mimeType=sourceDef.mimeType||function getImageURIMimeType(uri){return uri.search(/\.jpe?g($|\?)/i)>0||0===uri.search(/^data\:image\/jpeg/)?"image/jpeg":uri.search(/\.webp($|\?)/i)>0||0===uri.search(/^data\:image\/webp/)?"image/webp":"image/png"}(sourceDef.uri),texture})).catch((function(error){throw console.error("THREE.GLTFLoader: Couldn't load texture",sourceURI),error}));return this.sourceCache[sourceIndex]=promise,promise}assignTexture(materialParams,mapName,mapDef,colorSpace){const parser=this;return this.getDependency("texture",mapDef.index).then((function(texture){if(!texture)return null;if(void 0!==mapDef.texCoord&&mapDef.texCoord>0&&((texture=texture.clone()).channel=mapDef.texCoord),parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const transform=void 0!==mapDef.extensions?mapDef.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(transform){const gltfReference=parser.associations.get(texture);texture=parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(texture,transform),parser.associations.set(texture,gltfReference)}}return void 0!==colorSpace&&("number"==typeof colorSpace&&(colorSpace=3001===colorSpace?"srgb":"srgb-linear"),"colorSpace"in texture?texture.colorSpace=colorSpace:texture.encoding="srgb"===colorSpace?3001:3e3),materialParams[mapName]=texture,texture}))}assignFinalMaterial(mesh){const geometry=mesh.geometry;let material=mesh.material;const useDerivativeTangents=void 0===geometry.attributes.tangent,useVertexColors=void 0!==geometry.attributes.color,useFlatShading=void 0===geometry.attributes.normal;if(mesh.isPoints){const cacheKey="PointsMaterial:"+material.uuid;let pointsMaterial=this.cache.get(cacheKey);pointsMaterial||(pointsMaterial=new three_core.BH$,three_core.imn.prototype.copy.call(pointsMaterial,material),pointsMaterial.color.copy(material.color),pointsMaterial.map=material.map,pointsMaterial.sizeAttenuation=!1,this.cache.add(cacheKey,pointsMaterial)),material=pointsMaterial}else if(mesh.isLine){const cacheKey="LineBasicMaterial:"+material.uuid;let lineMaterial=this.cache.get(cacheKey);lineMaterial||(lineMaterial=new three_core.mrM,three_core.imn.prototype.copy.call(lineMaterial,material),lineMaterial.color.copy(material.color),lineMaterial.map=material.map,this.cache.add(cacheKey,lineMaterial)),material=lineMaterial}if(useDerivativeTangents||useVertexColors||useFlatShading){let cacheKey="ClonedMaterial:"+material.uuid+":";useDerivativeTangents&&(cacheKey+="derivative-tangents:"),useVertexColors&&(cacheKey+="vertex-colors:"),useFlatShading&&(cacheKey+="flat-shading:");let cachedMaterial=this.cache.get(cacheKey);cachedMaterial||(cachedMaterial=material.clone(),useVertexColors&&(cachedMaterial.vertexColors=!0),useFlatShading&&(cachedMaterial.flatShading=!0),useDerivativeTangents&&(cachedMaterial.normalScale&&(cachedMaterial.normalScale.y*=-1),cachedMaterial.clearcoatNormalScale&&(cachedMaterial.clearcoatNormalScale.y*=-1)),this.cache.add(cacheKey,cachedMaterial),this.associations.set(cachedMaterial,this.associations.get(material))),material=cachedMaterial}mesh.material=material}getMaterialType(){return three_core._4j}loadMaterial(materialIndex){const parser=this,json=this.json,extensions=this.extensions,materialDef=json.materials[materialIndex];let materialType;const materialParams={},pending=[];if((materialDef.extensions||{})[EXTENSIONS.KHR_MATERIALS_UNLIT]){const kmuExtension=extensions[EXTENSIONS.KHR_MATERIALS_UNLIT];materialType=kmuExtension.getMaterialType(),pending.push(kmuExtension.extendParams(materialParams,materialDef,parser))}else{const metallicRoughness=materialDef.pbrMetallicRoughness||{};if(materialParams.color=new three_core.Q1f(1,1,1),materialParams.opacity=1,Array.isArray(metallicRoughness.baseColorFactor)){const array=metallicRoughness.baseColorFactor;materialParams.color.setRGB(array[0],array[1],array[2],"srgb-linear"),materialParams.opacity=array[3]}void 0!==metallicRoughness.baseColorTexture&&pending.push(parser.assignTexture(materialParams,"map",metallicRoughness.baseColorTexture,"srgb")),materialParams.metalness=void 0!==metallicRoughness.metallicFactor?metallicRoughness.metallicFactor:1,materialParams.roughness=void 0!==metallicRoughness.roughnessFactor?metallicRoughness.roughnessFactor:1,void 0!==metallicRoughness.metallicRoughnessTexture&&(pending.push(parser.assignTexture(materialParams,"metalnessMap",metallicRoughness.metallicRoughnessTexture)),pending.push(parser.assignTexture(materialParams,"roughnessMap",metallicRoughness.metallicRoughnessTexture))),materialType=this._invokeOne((function(ext){return ext.getMaterialType&&ext.getMaterialType(materialIndex)})),pending.push(Promise.all(this._invokeAll((function(ext){return ext.extendMaterialParams&&ext.extendMaterialParams(materialIndex,materialParams)}))))}!0===materialDef.doubleSided&&(materialParams.side=three_core.$EB);const alphaMode=materialDef.alphaMode||ALPHA_MODES_OPAQUE;if(alphaMode===ALPHA_MODES_BLEND?(materialParams.transparent=!0,materialParams.depthWrite=!1):(materialParams.transparent=!1,alphaMode===ALPHA_MODES_MASK&&(materialParams.alphaTest=void 0!==materialDef.alphaCutoff?materialDef.alphaCutoff:.5)),void 0!==materialDef.normalTexture&&materialType!==three_core.V9B&&(pending.push(parser.assignTexture(materialParams,"normalMap",materialDef.normalTexture)),materialParams.normalScale=new three_core.I9Y(1,1),void 0!==materialDef.normalTexture.scale)){const scale=materialDef.normalTexture.scale;materialParams.normalScale.set(scale,scale)}if(void 0!==materialDef.occlusionTexture&&materialType!==three_core.V9B&&(pending.push(parser.assignTexture(materialParams,"aoMap",materialDef.occlusionTexture)),void 0!==materialDef.occlusionTexture.strength&&(materialParams.aoMapIntensity=materialDef.occlusionTexture.strength)),void 0!==materialDef.emissiveFactor&&materialType!==three_core.V9B){const emissiveFactor=materialDef.emissiveFactor;materialParams.emissive=(new three_core.Q1f).setRGB(emissiveFactor[0],emissiveFactor[1],emissiveFactor[2],"srgb-linear")}return void 0!==materialDef.emissiveTexture&&materialType!==three_core.V9B&&pending.push(parser.assignTexture(materialParams,"emissiveMap",materialDef.emissiveTexture,"srgb")),Promise.all(pending).then((function(){const material=new materialType(materialParams);return materialDef.name&&(material.name=materialDef.name),assignExtrasToUserData(material,materialDef),parser.associations.set(material,{materials:materialIndex}),materialDef.extensions&&addUnknownExtensionsToUserData(extensions,material,materialDef),material}))}createUniqueName(originalName){const sanitizedName=three_core.Nwf.sanitizeNodeName(originalName||"");return sanitizedName in this.nodeNamesUsed?sanitizedName+"_"+ ++this.nodeNamesUsed[sanitizedName]:(this.nodeNamesUsed[sanitizedName]=0,sanitizedName)}loadGeometries(primitives){const parser=this,extensions=this.extensions,cache=this.primitiveCache;function createDracoPrimitive(primitive){return extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(primitive,parser).then((function(geometry){return addPrimitiveAttributes(geometry,primitive,parser)}))}const pending=[];for(let i=0,il=primitives.length;i<il;i++){const primitive=primitives[i],cacheKey=createPrimitiveKey(primitive),cached=cache[cacheKey];if(cached)pending.push(cached.promise);else{let geometryPromise;geometryPromise=primitive.extensions&&primitive.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?createDracoPrimitive(primitive):addPrimitiveAttributes(new three_core.LoY,primitive,parser),cache[cacheKey]={primitive,promise:geometryPromise},pending.push(geometryPromise)}}return Promise.all(pending)}loadMesh(meshIndex){const parser=this,json=this.json,extensions=this.extensions,meshDef=json.meshes[meshIndex],primitives=meshDef.primitives,pending=[];for(let i=0,il=primitives.length;i<il;i++){const material=void 0===primitives[i].material?createDefaultMaterial(this.cache):this.getDependency("material",primitives[i].material);pending.push(material)}return pending.push(parser.loadGeometries(primitives)),Promise.all(pending).then((function(results){const materials=results.slice(0,results.length-1),geometries=results[results.length-1],meshes=[];for(let i=0,il=geometries.length;i<il;i++){const geometry=geometries[i],primitive=primitives[i];let mesh;const material=materials[i];if(primitive.mode===WEBGL_CONSTANTS.TRIANGLES||primitive.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||primitive.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||void 0===primitive.mode)mesh=!0===meshDef.isSkinnedMesh?new three_core.I46(geometry,material):new three_core.eaF(geometry,material),!0===mesh.isSkinnedMesh&&mesh.normalizeSkinWeights(),primitive.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?mesh.geometry=toTrianglesDrawMode(mesh.geometry,three_core.O49):primitive.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(mesh.geometry=toTrianglesDrawMode(mesh.geometry,three_core.rYR));else if(primitive.mode===WEBGL_CONSTANTS.LINES)mesh=new three_core.DXC(geometry,material);else if(primitive.mode===WEBGL_CONSTANTS.LINE_STRIP)mesh=new three_core.N1A(geometry,material);else if(primitive.mode===WEBGL_CONSTANTS.LINE_LOOP)mesh=new three_core.FCc(geometry,material);else{if(primitive.mode!==WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+primitive.mode);mesh=new three_core.ONl(geometry,material)}Object.keys(mesh.geometry.morphAttributes).length>0&&updateMorphTargets(mesh,meshDef),mesh.name=parser.createUniqueName(meshDef.name||"mesh_"+meshIndex),assignExtrasToUserData(mesh,meshDef),primitive.extensions&&addUnknownExtensionsToUserData(extensions,mesh,primitive),parser.assignFinalMaterial(mesh),meshes.push(mesh)}for(let i=0,il=meshes.length;i<il;i++)parser.associations.set(meshes[i],{meshes:meshIndex,primitives:i});if(1===meshes.length)return meshDef.extensions&&addUnknownExtensionsToUserData(extensions,meshes[0],meshDef),meshes[0];const group=new three_core.YJl;meshDef.extensions&&addUnknownExtensionsToUserData(extensions,group,meshDef),parser.associations.set(group,{meshes:meshIndex});for(let i=0,il=meshes.length;i<il;i++)group.add(meshes[i]);return group}))}loadCamera(cameraIndex){let camera;const cameraDef=this.json.cameras[cameraIndex],params=cameraDef[cameraDef.type];if(params)return"perspective"===cameraDef.type?camera=new three_core.ubm(three_core.cj9.radToDeg(params.yfov),params.aspectRatio||1,params.znear||1,params.zfar||2e6):"orthographic"===cameraDef.type&&(camera=new three_core.qUd(-params.xmag,params.xmag,params.ymag,-params.ymag,params.znear,params.zfar)),cameraDef.name&&(camera.name=this.createUniqueName(cameraDef.name)),assignExtrasToUserData(camera,cameraDef),Promise.resolve(camera);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(skinIndex){const skinDef=this.json.skins[skinIndex],pending=[];for(let i=0,il=skinDef.joints.length;i<il;i++)pending.push(this._loadNodeShallow(skinDef.joints[i]));return void 0!==skinDef.inverseBindMatrices?pending.push(this.getDependency("accessor",skinDef.inverseBindMatrices)):pending.push(null),Promise.all(pending).then((function(results){const inverseBindMatrices=results.pop(),jointNodes=results,bones=[],boneInverses=[];for(let i=0,il=jointNodes.length;i<il;i++){const jointNode=jointNodes[i];if(jointNode){bones.push(jointNode);const mat=new three_core.kn4;null!==inverseBindMatrices&&mat.fromArray(inverseBindMatrices.array,16*i),boneInverses.push(mat)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',skinDef.joints[i])}return new three_core.EAD(bones,boneInverses)}))}loadAnimation(animationIndex){const json=this.json,parser=this,animationDef=json.animations[animationIndex],animationName=animationDef.name?animationDef.name:"animation_"+animationIndex,pendingNodes=[],pendingInputAccessors=[],pendingOutputAccessors=[],pendingSamplers=[],pendingTargets=[];for(let i=0,il=animationDef.channels.length;i<il;i++){const channel=animationDef.channels[i],sampler=animationDef.samplers[channel.sampler],target=channel.target,name=target.node,input=void 0!==animationDef.parameters?animationDef.parameters[sampler.input]:sampler.input,output=void 0!==animationDef.parameters?animationDef.parameters[sampler.output]:sampler.output;void 0!==target.node&&(pendingNodes.push(this.getDependency("node",name)),pendingInputAccessors.push(this.getDependency("accessor",input)),pendingOutputAccessors.push(this.getDependency("accessor",output)),pendingSamplers.push(sampler),pendingTargets.push(target))}return Promise.all([Promise.all(pendingNodes),Promise.all(pendingInputAccessors),Promise.all(pendingOutputAccessors),Promise.all(pendingSamplers),Promise.all(pendingTargets)]).then((function(dependencies){const nodes=dependencies[0],inputAccessors=dependencies[1],outputAccessors=dependencies[2],samplers=dependencies[3],targets=dependencies[4],tracks=[];for(let i=0,il=nodes.length;i<il;i++){const node=nodes[i],inputAccessor=inputAccessors[i],outputAccessor=outputAccessors[i],sampler=samplers[i],target=targets[i];if(void 0===node)continue;node.updateMatrix&&node.updateMatrix();const createdTracks=parser._createAnimationTracks(node,inputAccessor,outputAccessor,sampler,target);if(createdTracks)for(let k=0;k<createdTracks.length;k++)tracks.push(createdTracks[k])}return new three_core.tz3(animationName,void 0,tracks)}))}createNodeMesh(nodeIndex){const json=this.json,parser=this,nodeDef=json.nodes[nodeIndex];return void 0===nodeDef.mesh?null:parser.getDependency("mesh",nodeDef.mesh).then((function(mesh){const node=parser._getNodeRef(parser.meshCache,nodeDef.mesh,mesh);return void 0!==nodeDef.weights&&node.traverse((function(o){if(o.isMesh)for(let i=0,il=nodeDef.weights.length;i<il;i++)o.morphTargetInfluences[i]=nodeDef.weights[i]})),node}))}loadNode(nodeIndex){const parser=this,nodeDef=this.json.nodes[nodeIndex],nodePending=parser._loadNodeShallow(nodeIndex),childPending=[],childrenDef=nodeDef.children||[];for(let i=0,il=childrenDef.length;i<il;i++)childPending.push(parser.getDependency("node",childrenDef[i]));const skeletonPending=void 0===nodeDef.skin?Promise.resolve(null):parser.getDependency("skin",nodeDef.skin);return Promise.all([nodePending,Promise.all(childPending),skeletonPending]).then((function(results){const node=results[0],children=results[1],skeleton=results[2];null!==skeleton&&node.traverse((function(mesh){mesh.isSkinnedMesh&&mesh.bind(skeleton,_identityMatrix)}));for(let i=0,il=children.length;i<il;i++)node.add(children[i]);return node}))}_loadNodeShallow(nodeIndex){const json=this.json,extensions=this.extensions,parser=this;if(void 0!==this.nodeCache[nodeIndex])return this.nodeCache[nodeIndex];const nodeDef=json.nodes[nodeIndex],nodeName=nodeDef.name?parser.createUniqueName(nodeDef.name):"",pending=[],meshPromise=parser._invokeOne((function(ext){return ext.createNodeMesh&&ext.createNodeMesh(nodeIndex)}));return meshPromise&&pending.push(meshPromise),void 0!==nodeDef.camera&&pending.push(parser.getDependency("camera",nodeDef.camera).then((function(camera){return parser._getNodeRef(parser.cameraCache,nodeDef.camera,camera)}))),parser._invokeAll((function(ext){return ext.createNodeAttachment&&ext.createNodeAttachment(nodeIndex)})).forEach((function(promise){pending.push(promise)})),this.nodeCache[nodeIndex]=Promise.all(pending).then((function(objects){let node;if(node=!0===nodeDef.isBone?new three_core.$Kf:objects.length>1?new three_core.YJl:1===objects.length?objects[0]:new three_core.B69,node!==objects[0])for(let i=0,il=objects.length;i<il;i++)node.add(objects[i]);if(nodeDef.name&&(node.userData.name=nodeDef.name,node.name=nodeName),assignExtrasToUserData(node,nodeDef),nodeDef.extensions&&addUnknownExtensionsToUserData(extensions,node,nodeDef),void 0!==nodeDef.matrix){const matrix=new three_core.kn4;matrix.fromArray(nodeDef.matrix),node.applyMatrix4(matrix)}else void 0!==nodeDef.translation&&node.position.fromArray(nodeDef.translation),void 0!==nodeDef.rotation&&node.quaternion.fromArray(nodeDef.rotation),void 0!==nodeDef.scale&&node.scale.fromArray(nodeDef.scale);return parser.associations.has(node)||parser.associations.set(node,{}),parser.associations.get(node).nodes=nodeIndex,node})),this.nodeCache[nodeIndex]}loadScene(sceneIndex){const extensions=this.extensions,sceneDef=this.json.scenes[sceneIndex],parser=this,scene=new three_core.YJl;sceneDef.name&&(scene.name=parser.createUniqueName(sceneDef.name)),assignExtrasToUserData(scene,sceneDef),sceneDef.extensions&&addUnknownExtensionsToUserData(extensions,scene,sceneDef);const nodeIds=sceneDef.nodes||[],pending=[];for(let i=0,il=nodeIds.length;i<il;i++)pending.push(parser.getDependency("node",nodeIds[i]));return Promise.all(pending).then((function(nodes){for(let i=0,il=nodes.length;i<il;i++)scene.add(nodes[i]);return parser.associations=(node=>{const reducedAssociations=new Map;for(const[key,value]of parser.associations)(key instanceof three_core.imn||key instanceof three_core.gPd)&&reducedAssociations.set(key,value);return node.traverse((node2=>{const mappings=parser.associations.get(node2);null!=mappings&&reducedAssociations.set(node2,mappings)})),reducedAssociations})(scene),scene}))}_createAnimationTracks(node,inputAccessor,outputAccessor,sampler,target){const tracks=[],targetName=node.name?node.name:node.uuid,targetNames=[];let TypedKeyframeTrack;switch(PATH_PROPERTIES[target.path]===PATH_PROPERTIES.weights?node.traverse((function(object){object.morphTargetInfluences&&targetNames.push(object.name?object.name:object.uuid)})):targetNames.push(targetName),PATH_PROPERTIES[target.path]){case PATH_PROPERTIES.weights:TypedKeyframeTrack=three_core.Hit;break;case PATH_PROPERTIES.rotation:TypedKeyframeTrack=three_core.MBL;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:TypedKeyframeTrack=three_core.RiT;break;default:if(1===outputAccessor.itemSize)TypedKeyframeTrack=three_core.Hit;else TypedKeyframeTrack=three_core.RiT}const interpolation=void 0!==sampler.interpolation?INTERPOLATION[sampler.interpolation]:three_core.PJ3,outputArray=this._getArrayFromAccessor(outputAccessor);for(let j=0,jl=targetNames.length;j<jl;j++){const track=new TypedKeyframeTrack(targetNames[j]+"."+PATH_PROPERTIES[target.path],inputAccessor.array,outputArray,interpolation);"CUBICSPLINE"===sampler.interpolation&&this._createCubicSplineTrackInterpolant(track),tracks.push(track)}return tracks}_getArrayFromAccessor(accessor){let outputArray=accessor.array;if(accessor.normalized){const scale=getNormalizedComponentScale(outputArray.constructor),scaled=new Float32Array(outputArray.length);for(let j=0,jl=outputArray.length;j<jl;j++)scaled[j]=outputArray[j]*scale;outputArray=scaled}return outputArray}_createCubicSplineTrackInterpolant(track){track.createInterpolant=function InterpolantFactoryMethodGLTFCubicSpline(result){return new(this instanceof three_core.MBL?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,result)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function addPrimitiveAttributes(geometry,primitiveDef,parser){const attributes=primitiveDef.attributes,pending=[];function assignAttributeAccessor(accessorIndex,attributeName){return parser.getDependency("accessor",accessorIndex).then((function(accessor){geometry.setAttribute(attributeName,accessor)}))}for(const gltfAttributeName in attributes){const threeAttributeName=ATTRIBUTES[gltfAttributeName]||gltfAttributeName.toLowerCase();threeAttributeName in geometry.attributes||pending.push(assignAttributeAccessor(attributes[gltfAttributeName],threeAttributeName))}if(void 0!==primitiveDef.indices&&!geometry.index){const accessor=parser.getDependency("accessor",primitiveDef.indices).then((function(accessor2){geometry.setIndex(accessor2)}));pending.push(accessor)}return assignExtrasToUserData(geometry,primitiveDef),function computeBounds(geometry,primitiveDef,parser){const attributes=primitiveDef.attributes,box=new three_core.NRn;if(void 0===attributes.POSITION)return;{const accessor=parser.json.accessors[attributes.POSITION],min=accessor.min,max=accessor.max;if(void 0===min||void 0===max)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(box.set(new three_core.Pq0(min[0],min[1],min[2]),new three_core.Pq0(max[0],max[1],max[2])),accessor.normalized){const boxScale=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[accessor.componentType]);box.min.multiplyScalar(boxScale),box.max.multiplyScalar(boxScale)}}const targets=primitiveDef.targets;if(void 0!==targets){const maxDisplacement=new three_core.Pq0,vector=new three_core.Pq0;for(let i=0,il=targets.length;i<il;i++){const target=targets[i];if(void 0!==target.POSITION){const accessor=parser.json.accessors[target.POSITION],min=accessor.min,max=accessor.max;if(void 0!==min&&void 0!==max){if(vector.setX(Math.max(Math.abs(min[0]),Math.abs(max[0]))),vector.setY(Math.max(Math.abs(min[1]),Math.abs(max[1]))),vector.setZ(Math.max(Math.abs(min[2]),Math.abs(max[2]))),accessor.normalized){const boxScale=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[accessor.componentType]);vector.multiplyScalar(boxScale)}maxDisplacement.max(vector)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}box.expandByVector(maxDisplacement)}geometry.boundingBox=box;const sphere=new three_core.iyt;box.getCenter(sphere.center),sphere.radius=box.min.distanceTo(box.max)/2,geometry.boundingSphere=sphere}(geometry,primitiveDef,parser),Promise.all(pending).then((function(){return void 0!==primitiveDef.targets?function addMorphTargets(geometry,targets,parser){let hasMorphPosition=!1,hasMorphNormal=!1,hasMorphColor=!1;for(let i=0,il=targets.length;i<il;i++){const target=targets[i];if(void 0!==target.POSITION&&(hasMorphPosition=!0),void 0!==target.NORMAL&&(hasMorphNormal=!0),void 0!==target.COLOR_0&&(hasMorphColor=!0),hasMorphPosition&&hasMorphNormal&&hasMorphColor)break}if(!hasMorphPosition&&!hasMorphNormal&&!hasMorphColor)return Promise.resolve(geometry);const pendingPositionAccessors=[],pendingNormalAccessors=[],pendingColorAccessors=[];for(let i=0,il=targets.length;i<il;i++){const target=targets[i];if(hasMorphPosition){const pendingAccessor=void 0!==target.POSITION?parser.getDependency("accessor",target.POSITION):geometry.attributes.position;pendingPositionAccessors.push(pendingAccessor)}if(hasMorphNormal){const pendingAccessor=void 0!==target.NORMAL?parser.getDependency("accessor",target.NORMAL):geometry.attributes.normal;pendingNormalAccessors.push(pendingAccessor)}if(hasMorphColor){const pendingAccessor=void 0!==target.COLOR_0?parser.getDependency("accessor",target.COLOR_0):geometry.attributes.color;pendingColorAccessors.push(pendingAccessor)}}return Promise.all([Promise.all(pendingPositionAccessors),Promise.all(pendingNormalAccessors),Promise.all(pendingColorAccessors)]).then((function(accessors){const morphPositions=accessors[0],morphNormals=accessors[1],morphColors=accessors[2];return hasMorphPosition&&(geometry.morphAttributes.position=morphPositions),hasMorphNormal&&(geometry.morphAttributes.normal=morphNormals),hasMorphColor&&(geometry.morphAttributes.color=morphColors),geometry.morphTargetsRelative=!0,geometry}))}(geometry,primitiveDef.targets,parser):geometry}))}const angular_three_soba_loaders_c0=["progressSpanRef"];function NgtsLoader_Conditional_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"div",2)(1,"div")(2,"div",3),core["ɵɵelement"](3,"div",4)(4,"span",5,0),core["ɵɵelementEnd"]()()()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵclassMap"](ctx_r0.containerClass()||""),core["ɵɵstyleProp"]("--ngts-loader-container-opacity",ctx_r0.active()?1:0),core["ɵɵadvance"](2),core["ɵɵclassMap"](ctx_r0.innerClass()||""),core["ɵɵadvance"](),core["ɵɵclassMap"](ctx_r0.barClass()||""),core["ɵɵstyleProp"]("--ngts-loader-bar-scale",ctx_r0.progress()/100),core["ɵɵadvance"](),core["ɵɵclassMap"](ctx_r0.dataClass()||"")}}function _injectFBX(input,{injector}={}){return(0,ngxtension_assert_injector.x)(_injectFBX,injector,(()=>(0,angular_three.hz)((()=>FBXLoader),input)))}_injectFBX.preload=input=>{angular_three.hz.preload((()=>FBXLoader),input)};let fontLoader=null;function loadFontData(_x){return _loadFontData.apply(this,arguments)}function _loadFontData(){return(_loadFontData=(0,asyncToGenerator.A)((function*(font){return"string"==typeof font?yield(yield fetch(font)).json():font}))).apply(this,arguments)}function parseFontData(fontData){return fontLoader||(fontLoader=new FontLoader),fontLoader.parse(fontData)}const cache=new Map;function injectFont(input,{injector}={}){return(0,ngxtension_assert_injector.x)(injectFont,injector,(()=>{const font=(0,core.signal)(null);return(0,core.effect)((()=>{const fontInput=input();cache.has(fontInput)?font.set(cache.get(fontInput)):loadFontData(input()).then((data=>{const parsed=parseFontData(data);cache.set(fontInput,parsed),font.set(parsed)}))})),font.asReadonly()}))}injectFont.preload=input=>{loadFontData(input()).then((data=>{const parsed=parseFontData(data);cache.set(input(),parsed)}))},injectFont.clear=input=>{input?cache.delete(input()):cache.clear()};let dracoLoader=null,decoderPath="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function _extensions(useDraco,useMeshOpt,extensions){return loader=>{extensions&&extensions(loader),useDraco&&(dracoLoader||(dracoLoader=new DRACOLoader),dracoLoader.setDecoderPath("string"==typeof useDraco?useDraco:decoderPath),loader.setDRACOLoader(dracoLoader)),useMeshOpt&&loader.setMeshoptDecoder(MeshoptDecoder())}}function _injectGLTF(path,{useDraco=!0,useMeshOpt=!0,injector,extensions,onLoad}={}){return(0,ngxtension_assert_injector.x)(_injectGLTF,injector,(()=>{const result=(0,angular_three.hz)((()=>GLTFLoader),path,{extensions:_extensions(useDraco,useMeshOpt,extensions),onLoad});return Object.defineProperty(result,"scene",{value:(0,core.computed)((()=>{const gltf=result();return gltf?gltf.scene:null}))}),result}))}_injectGLTF.preload=(path,{useDraco=!0,useMeshOpt=!0,extensions,onLoad}={})=>{angular_three.hz.preload((()=>GLTFLoader),path,_extensions(useDraco,useMeshOpt,extensions),onLoad)},_injectGLTF.setDecoderPath=path=>{decoderPath=path};function injectProgress(injector){return(0,ngxtension_assert_injector.x)(injectProgress,injector,(()=>{const cdr=(0,core.inject)(core.ChangeDetectorRef),progress=(0,core.signal)({errors:[],active:!1,progress:0,item:"",loaded:0,total:0});let saveLastTotalLoaded=0;return three_core.h_9.onStart=(item,loaded,total)=>{progress.update((prev=>({...prev,active:!0,item,loaded,total,progress:(loaded-saveLastTotalLoaded)/(total-saveLastTotalLoaded)*100}))),cdr.detectChanges()},three_core.h_9.onLoad=()=>{progress.update((prev=>({...prev,active:!1}))),cdr.detectChanges()},three_core.h_9.onError=url=>{progress.update((prev=>({...prev,errors:[...prev.errors,url]}))),cdr.detectChanges()},three_core.h_9.onProgress=(item,loaded,total)=>{loaded===total&&(saveLastTotalLoaded=total),progress.update((prev=>({...prev,item,loaded,total,progress:(loaded-saveLastTotalLoaded)/(total-saveLastTotalLoaded)*100||100}))),cdr.detectChanges()},progress.asReadonly()}))}const angular_three_soba_loaders_defaultOptions={containerClass:"",innerClass:"",barClass:"",dataClass:"",dataInterpolation:p=>`Loading ${p.toFixed(2)}%`,initialState:value=>value};class NgtsLoader{constructor(){this.progressState=injectProgress(),this.active=(0,core.computed)((()=>this.progressState().active)),this.progress=(0,core.computed)((()=>this.progressState().progress)),this.options=(0,core.input)(angular_three_soba_loaders_defaultOptions,{transform:(0,ngxtension_inject_inputs.sg)(angular_three_soba_loaders_defaultOptions)}),this.containerClass=(0,angular_three.B4)(this.options,"containerClass"),this.innerClass=(0,angular_three.B4)(this.options,"innerClass"),this.barClass=(0,angular_three.B4)(this.options,"barClass"),this.dataClass=(0,angular_three.B4)(this.options,"dataClass"),this.initialState=(0,angular_three.B4)(this.options,"initialState"),this.dataInterpolation=(0,angular_three.B4)(this.options,"dataInterpolation"),this.progressSpanRef=(0,core.viewChild)("progressSpanRef"),this.shown=(0,core.signal)(this.initialState()(this.active())),(0,core.effect)((onCleanup=>{const[active,lastShown]=[this.active(),(0,core.untracked)(this.shown)];if(lastShown!==active){const timeoutId=setTimeout((()=>{this.shown.set(active)}),300);onCleanup((()=>clearTimeout(timeoutId)))}}));let rafId,progressRef=0;(0,core.effect)((onCleanup=>{const[dataInterpolation,progress]=[this.dataInterpolation(),this.progress()],updateProgress=()=>{const progressSpan=this.progressSpanRef()?.nativeElement;progressSpan&&(progressRef+=(progress-progressRef)/2,(progressRef>.95*progress||100===progress)&&(progressRef=progress),progressSpan.innerText=dataInterpolation(progressRef),progressRef<progress&&(rafId=requestAnimationFrame(updateProgress)))};updateProgress(),onCleanup((()=>cancelAnimationFrame(rafId)))}))}static{this.ɵfac=function NgtsLoader_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsLoader)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsLoader,selectors:[["ngts-loader"]],viewQuery:function NgtsLoader_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.progressSpanRef,angular_three_soba_loaders_c0,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{options:[1,"options"]},decls:1,vars:1,consts:[["progressSpanRef",""],[1,"ngts-loader-container",3,"class","--ngts-loader-container-opacity"],[1,"ngts-loader-container"],[1,"ngts-loader-inner"],[1,"ngts-loader-bar"],[1,"ngts-loader-data"]],template:function NgtsLoader_Template(rf,ctx){1&rf&&core["ɵɵtemplate"](0,NgtsLoader_Conditional_0_Template,6,12,"div",1),2&rf&&core["ɵɵconditional"](ctx.shown()?0:-1)},styles:['.ngts-loader-container[_ngcontent-%COMP%]{--ngts-loader-container-opacity: 0;position:absolute;top:0;left:0;width:100%;height:100%;background:#171717;display:flex;align-items:center;justify-content:center;transition:opacity .3s ease;z-index:1000;opacity:var(--ngts-loader-container-opacity)}.ngts-loader-inner[_ngcontent-%COMP%]{width:100px;height:3px;background:#272727;text-align:center}.ngts-loader-bar[_ngcontent-%COMP%]{--ngts-loader-bar-scale: 0;height:3px;width:100px;background:#fff;transition:transform .2s;transform-origin:left center;transform:scaleX(var(--ngts-loader-bar-scale))}.ngts-loader-data[_ngcontent-%COMP%]{display:inline-block;position:relative;font-variant-numeric:tabular-nums;margin-top:.8em;color:#f0f0f0;font-size:.6em;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Helvetica Neue,Helvetica,Arial,Roboto,Ubuntu,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;white-space:nowrap}'],changeDetection:0})}}function _injectTexture(input,{onLoad,injector}={}){return(0,ngxtension_assert_injector.x)(_injectTexture,injector,(()=>{const store=(0,angular_three.ZQ)(),result=(0,angular_three.hz)((()=>three_core.Tap),input);return(0,core.effect)((()=>{const textures=result();if(!textures)return;const gl=store.get("gl");if("initTexture"in gl){const array=Array.isArray(textures)?textures:textures instanceof three_core.gPd?[textures]:Object.values(textures);onLoad&&onLoad(array),array.forEach(gl.initTexture.bind(gl))}})),result}))}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsLoader,[{type:core.Component,args:[{selector:"ngts-loader",template:'\n\t\t@if (shown()) {\n\t\t\t<div\n\t\t\t\tclass="ngts-loader-container"\n\t\t\t\t[class]="containerClass() || \'\'"\n\t\t\t\t[style.--ngts-loader-container-opacity]="active() ? 1 : 0"\n\t\t\t>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="ngts-loader-inner" [class]="innerClass() || \'\'">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="ngts-loader-bar"\n\t\t\t\t\t\t\t[class]="barClass() || \'\'"\n\t\t\t\t\t\t\t[style.--ngts-loader-bar-scale]="progress() / 100"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<span #progressSpanRef class="ngts-loader-data" [class]="dataClass() || \'\'"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t}\n\t',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:['.ngts-loader-container{--ngts-loader-container-opacity: 0;position:absolute;top:0;left:0;width:100%;height:100%;background:#171717;display:flex;align-items:center;justify-content:center;transition:opacity .3s ease;z-index:1000;opacity:var(--ngts-loader-container-opacity)}.ngts-loader-inner{width:100px;height:3px;background:#272727;text-align:center}.ngts-loader-bar{--ngts-loader-bar-scale: 0;height:3px;width:100px;background:#fff;transition:transform .2s;transform-origin:left center;transform:scaleX(var(--ngts-loader-bar-scale))}.ngts-loader-data{display:inline-block;position:relative;font-variant-numeric:tabular-nums;margin-top:.8em;color:#f0f0f0;font-size:.6em;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Helvetica Neue,Helvetica,Arial,Roboto,Ubuntu,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;white-space:nowrap}\n']}]}],(()=>[]),null),_injectTexture.preload=input=>{angular_three.hz.preload((()=>three_core.Tap),input)};const angular_three_soba_abstractions_c0=["group"],angular_three_soba_abstractions_c1=["inner"],angular_three_soba_abstractions_c2=["*"],angular_three_soba_abstractions_c3=["line"],angular_three_soba_abstractions_c4=a0=>[a0];function NgtsLine_ngt_primitive_0_ngt_primitive_2_Template(rf,ctx){if(1&rf){const _r1=core["ɵɵgetCurrentView"]();core["ɵɵelementStart"](0,"ngt-primitive",5),core["ɵɵlistener"]("attached",(function NgtsLine_ngt_primitive_0_ngt_primitive_2_Template_ngt_primitive_attached_0_listener($event){core["ɵɵrestoreView"](_r1);const ctx_r1=core["ɵɵnextContext"](2);return core["ɵɵresetView"](ctx_r1.onGeometryAttached($event))})),core["ɵɵelementEnd"]()}}function NgtsLine_ngt_primitive_0_ngt_primitive_3_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-primitive",6),2&rf){const ctx_r1=core["ɵɵnextContext"](2);core["ɵɵproperty"]("color",ctx_r1.color())("vertexColors",ctx_r1.vertex())("resolution",ctx_r1.resolution())("linewidth",ctx_r1.actualLineWidth())("dashed",ctx_r1.dashed())("transparent",4===ctx_r1.itemSize())("parameters",ctx_r1.parameters())}}function NgtsLine_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",2,0),core["ɵɵtemplate"](2,NgtsLine_ngt_primitive_0_ngt_primitive_2_Template,1,0,"ngt-primitive",3)(3,NgtsLine_ngt_primitive_0_ngt_primitive_3_Template,1,7,"ngt-primitive",4),core["ɵɵprojection"](4),core["ɵɵelementEnd"]()),2&rf){const ctx_r1=core["ɵɵnextContext"]();core["ɵɵproperty"]("parameters",ctx_r1.parameters()),core["ɵɵadvance"](2),core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](3,angular_three_soba_abstractions_c4,ctx_r1.lineGeometry())),core["ɵɵadvance"](),core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](5,angular_three_soba_abstractions_c4,ctx_r1.lineMaterial))}}function NgtsGradientTexture_ngt_canvas_texture_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-canvas-texture",1),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("attach",ctx_r0.attach())("colorSpace",ctx_r0.outputColorSpace())("parameters",ctx_r0.parameters())}}const angular_three_soba_abstractions_c5=["mesh"];function NgtsGrid_ngt_plane_geometry_2_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-plane-geometry")}const angular_three_soba_abstractions_c6=["helper"],angular_three_soba_abstractions_c7=["geometry"],angular_three_soba_abstractions_c8=(a0,a1)=>[a0,a1];function NgtsPrismGeometry_ngt_extrude_geometry_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-extrude-geometry",2,0),core["ɵɵprojection"](2),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("attach",ctx_r0.attach())}}function NgtsRoundedBox_ngt_extrude_geometry_2_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-extrude-geometry",null,1)}function NgtsText_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",1),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("text",ctx_r0.text())("font",ctx_r0.font())("anchorX",ctx_r0.anchorX())("anchorY",ctx_r0.anchorY())("sdfGlyphSize",ctx_r0.sdfGlyphSize())("fontSize",ctx_r0.fontSize())("parameters",ctx_r0.parameters())}}const angular_three_soba_abstractions_c9=["textGeometry"];function NgtsText3D_ngt_text_geometry_2_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-text-geometry",null,1)}const defaultOptions$b={follow:!0,lockX:!1,lockY:!1,lockZ:!1};class NgtsBillboard{constructor(){this.options=(0,core.input)(defaultOptions$b,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$b)}),this.parameters=(0,angular_three.cJ)(this.options,["follow","lockX","lockY","lockZ"]),this.groupRef=core.viewChild.required("group"),this.innerRef=core.viewChild.required("inner"),(0,angular_three.X$)({Group:three_core.YJl});const q=new three_core.PTz;(0,angular_three.bC)((({camera})=>{const[{follow,lockX,lockY,lockZ},group,inner]=[this.options(),this.groupRef().nativeElement,this.innerRef().nativeElement];if(!follow||!group)return;const prevRotation=group.rotation.clone();group.updateMatrix(),group.updateWorldMatrix(!1,!1),group.getWorldQuaternion(q),camera.getWorldQuaternion(inner.quaternion).premultiply(q.invert()),lockX&&(group.rotation.x=prevRotation.x),lockY&&(group.rotation.y=prevRotation.y),lockZ&&(group.rotation.z=prevRotation.z)}))}static{this.ɵfac=function NgtsBillboard_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsBillboard)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsBillboard,selectors:[["ngts-billboard"]],viewQuery:function NgtsBillboard_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.groupRef,angular_three_soba_abstractions_c0,5),core["ɵɵviewQuerySignal"](ctx.innerRef,angular_three_soba_abstractions_c1,5)),2&rf&&core["ɵɵqueryAdvance"](2)},inputs:{options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:5,vars:1,consts:[["group",""],["inner",""],[3,"parameters"]],template:function NgtsBillboard_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-group",2,0)(2,"ngt-group",null,1),core["ɵɵprojection"](4),core["ɵɵelementEnd"]()()),2&rf&&core["ɵɵproperty"]("parameters",ctx.parameters())},encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsBillboard,[{type:core.Component,args:[{selector:"ngts-billboard",template:'\n\t\t<ngt-group #group [parameters]="parameters()">\n\t\t\t<ngt-group #inner>\n\t\t\t\t<ng-content />\n\t\t\t</ngt-group>\n\t\t</ngt-group>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);const defaultOptions$a={lineWidth:1,segments:!1,color:16777215};class NgtsLine{onGeometryAttached({parent}){parent.computeLineDistances()}constructor(){this.points=core.input.required(),this.options=(0,core.input)(defaultOptions$a,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$a)}),this.parameters=(0,angular_three.cJ)(this.options,["color","vertexColors","lineWidth","segments","linewidth","dashed"]),this.lineRef=(0,core.viewChild)("line"),this.store=(0,angular_three.ZQ)(),this.size=this.store.select("size"),this.segments=(0,angular_three.B4)(this.options,"segments"),this.vertexColors=(0,angular_three.B4)(this.options,"vertexColors"),this.dashed=(0,angular_three.B4)(this.options,"dashed"),this.color=(0,angular_three.B4)(this.options,"color"),this.vertex=(0,core.computed)((()=>Boolean(this.vertexColors()))),this.resolution=(0,core.computed)((()=>[this.size().width,this.size().height])),this.lineWidth=(0,angular_three.B4)(this.options,"lineWidth"),this.linewidth=(0,angular_three.B4)(this.options,"linewidth"),this.line2=(0,core.computed)((()=>this.segments()?new LineSegments2:new Line2)),this.lineMaterial=new LineMaterial,this.actualLineWidth=(0,core.computed)((()=>this.linewidth()??this.lineWidth()??1)),this.itemSize=(0,core.computed)((()=>4===this.vertexColors()?.[0]?.length?4:3)),this.lineGeometry=(0,core.computed)((()=>{const geom=this.segments()?new LineSegmentsGeometry:new LineGeometry,pValues=this.points().map((p=>{const isArray=Array.isArray(p);return p instanceof three_core.Pq0||p instanceof three_core.IUQ?[p.x,p.y,p.z]:p instanceof three_core.I9Y?[p.x,p.y,0]:isArray&&3===p.length?[p[0],p[1],p[2]]:isArray&&2===p.length?[p[0],p[1],0]:p}));geom.setPositions(pValues.flat());const vertexColors=this.vertexColors();if(vertexColors){const cValues=vertexColors.map((c=>c instanceof three_core.Q1f?c.toArray():c));geom.setColors(cValues.flat(),this.itemSize())}return geom})),(0,core.effect)((()=>{const[lineMaterial,dashed]=[this.lineMaterial,this.dashed()];dashed?lineMaterial.defines.USE_DASH="":delete lineMaterial.defines.USE_DASH,(0,angular_three.Zu)(lineMaterial)})),(0,core.effect)((onCleanup=>{const[lineGeometry,lineMaterial]=[this.lineGeometry(),this.lineMaterial];onCleanup((()=>{lineGeometry.dispose(),lineMaterial.dispose()}))}))}static{this.ɵfac=function NgtsLine_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsLine)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsLine,selectors:[["ngts-line"]],viewQuery:function NgtsLine_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.lineRef,angular_three_soba_abstractions_c3,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{points:[1,"points"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:1,vars:3,consts:[["line",""],[3,"parameters",4,"args"],[3,"parameters"],["attach","geometry",3,"attached",4,"args"],["attach","material",3,"color","vertexColors","resolution","linewidth","dashed","transparent","parameters",4,"args"],["attach","geometry",3,"attached"],["attach","material",3,"color","vertexColors","resolution","linewidth","dashed","transparent","parameters"]],template:function NgtsLine_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsLine_ngt_primitive_0_Template,5,7,"ngt-primitive",1)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,angular_three_soba_abstractions_c4,ctx.line2()))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsLine,[{type:core.Component,args:[{selector:"ngts-line",template:'\n\t\t<ngt-primitive *args="[line2()]" #line [parameters]="parameters()">\n\t\t\t<ngt-primitive *args="[lineGeometry()]" attach="geometry" (attached)="onGeometryAttached($any($event))" />\n\t\t\t<ngt-primitive\n\t\t\t\t*args="[lineMaterial]"\n\t\t\t\tattach="material"\n\t\t\t\t[color]="color()"\n\t\t\t\t[vertexColors]="vertex()"\n\t\t\t\t[resolution]="resolution()"\n\t\t\t\t[linewidth]="actualLineWidth()"\n\t\t\t\t[dashed]="dashed()"\n\t\t\t\t[transparent]="itemSize() === 4"\n\t\t\t\t[parameters]="parameters()"\n\t\t\t/>\n\t\t\t<ng-content />\n\t\t</ngt-primitive>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[angular_three.nQ]}]}],(()=>[]),null);const defaultOptions$9={curveType:"centripetal",tension:.5,segments:20,closed:!1,lineWidth:1};class NgtsCatmullRomLine{constructor(){this.points=core.input.required(),this.options=(0,core.input)(defaultOptions$9,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$9)}),this.parameters=(0,angular_three.cJ)(this.options,["curveType","tension","segments","closed","vertexColors"]),this.line=core.viewChild.required(NgtsLine),this.closed=(0,angular_three.B4)(this.options,"closed"),this.curveType=(0,angular_three.B4)(this.options,"curveType"),this.tension=(0,angular_three.B4)(this.options,"tension"),this.segments=(0,angular_three.B4)(this.options,"segments"),this.vertexColors=(0,angular_three.B4)(this.options,"vertexColors"),this.curve=(0,core.computed)((()=>{const[points,closed,curveType,tension]=[this.points(),this.closed(),this.curveType(),this.tension()],mappedPoints=points.map((pt=>pt instanceof three_core.Pq0?pt:new three_core.Pq0(...pt)));return new three_core.B6O(mappedPoints,closed,curveType,tension)})),this.segmentedPoints=(0,core.computed)((()=>{const[curve,segments]=[this.curve(),this.segments()];return curve.getPoints(segments)})),this.interpolatedVertexColors=(0,core.computed)((()=>{const[vertexColors,segments]=[this.vertexColors(),this.segments()];if(!vertexColors||vertexColors.length<2)return;if(vertexColors.length===segments+1)return vertexColors;const mappedColors=vertexColors.map((color=>color instanceof three_core.Q1f?color:new three_core.Q1f(...color)));(0,core.untracked)(this.closed)&&mappedColors.push(mappedColors[0].clone());const iColors=[mappedColors[0]],divisions=segments/(mappedColors.length-1);for(let i=1;i<segments;i++){const alpha=i%divisions/divisions,colorIndex=Math.floor(i/divisions);iColors.push(mappedColors[colorIndex].clone().lerp(mappedColors[colorIndex+1],alpha))}return iColors.push(mappedColors[mappedColors.length-1]),iColors})),this.lineOptions=(0,core.computed)((()=>({...this.parameters(),vertexColors:this.interpolatedVertexColors()})))}static{this.ɵfac=function NgtsCatmullRomLine_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsCatmullRomLine)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsCatmullRomLine,selectors:[["ngts-catmull-rom-line"]],viewQuery:function NgtsCatmullRomLine_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.line,NgtsLine,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{points:[1,"points"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:2,vars:2,consts:[[3,"points","options"]],template:function NgtsCatmullRomLine_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngts-line",0),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("points",ctx.segmentedPoints())("options",ctx.lineOptions())},dependencies:[NgtsLine],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCatmullRomLine,[{type:core.Component,args:[{selector:"ngts-catmull-rom-line",template:'\n\t\t<ngts-line [points]="segmentedPoints()" [options]="lineOptions()">\n\t\t\t<ng-content />\n\t\t</ngts-line>\n\t',changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[NgtsLine]}]}],null,null);const defaultOptions$8={lineWidth:1,segments:20};class NgtsCubicBezierLine{constructor(){this.start=core.input.required(),this.end=core.input.required(),this.midA=core.input.required(),this.midB=core.input.required(),this.options=(0,core.input)(defaultOptions$8,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$8)}),this.parameters=(0,angular_three.cJ)(this.options,["segments"]),this.line=core.viewChild.required(NgtsLine),this.segments=(0,angular_three.B4)(this.options,"segments"),this.points=(0,core.computed)((()=>{const[start,end,midA,midB,segments]=[this.start(),this.end(),this.midA(),this.midB(),this.segments()],startV=start instanceof three_core.Pq0?start:new three_core.Pq0(...start),endV=end instanceof three_core.Pq0?end:new three_core.Pq0(...end),midAV=midA instanceof three_core.Pq0?midA:new three_core.Pq0(...midA),midBV=midB instanceof three_core.Pq0?midB:new three_core.Pq0(...midB);return new three_core.s0K(startV,midAV,midBV,endV).getPoints(segments)}))}static{this.ɵfac=function NgtsCubicBezierLine_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsCubicBezierLine)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsCubicBezierLine,selectors:[["ngts-cubic-bezier-line"]],viewQuery:function NgtsCubicBezierLine_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.line,NgtsLine,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{start:[1,"start"],end:[1,"end"],midA:[1,"midA"],midB:[1,"midB"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:2,vars:2,consts:[[3,"points","options"]],template:function NgtsCubicBezierLine_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngts-line",0),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("points",ctx.points())("options",ctx.parameters())},dependencies:[NgtsLine],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCubicBezierLine,[{type:core.Component,args:[{selector:"ngts-cubic-bezier-line",template:'\n\t\t<ngts-line [points]="points()" [options]="parameters()">\n\t\t\t<ng-content />\n\t\t</ngts-line>\n\t',changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[NgtsLine]}]}],null,null);const defaultOptions$7={lineWidth:1,threshold:15};class NgtsEdges{constructor(){this.options=(0,core.input)(defaultOptions$7,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$7)}),this.parameters=(0,angular_three.cJ)(this.options,["threshold","geometry"]),this.lineOptions=(0,core.computed)((()=>({...this.parameters(),raycast:()=>null}))),this.tmpPoints=[0,0,0,1,0,0],this.line=core.viewChild.required(NgtsLine),(0,core.effect)((()=>{const line=this.line().lineRef()?.nativeElement;if(!line)return;const lS=(0,angular_three.h3)(line);if(!lS)return;const parent=lS.parent();if(!parent)return;const{geometry:explicitGeometry,threshold}=this.options(),geometry=explicitGeometry??parent.geometry;if(!geometry)return;if(this.memoizedGeometry===geometry&&this.memoizedThreshold===threshold)return;this.memoizedGeometry=geometry,this.memoizedThreshold=threshold;const points=new three_core.TDQ(geometry,threshold).attributes.position.array;line.geometry.setPositions(points),(0,angular_three.Zu)(line.geometry.attributes.instanceStart),(0,angular_three.Zu)(line.geometry.attributes.instanceEnd),line.computeLineDistances()}))}static{this.ɵfac=function NgtsEdges_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsEdges)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsEdges,selectors:[["ngts-edges"]],viewQuery:function NgtsEdges_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.line,NgtsLine,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:2,vars:2,consts:[[3,"points","options"]],template:function NgtsEdges_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngts-line",0),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("points",ctx.tmpPoints)("options",ctx.lineOptions())},dependencies:[NgtsLine],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsEdges,[{type:core.Component,args:[{selector:"ngts-edges",template:'\n\t\t<ngts-line [points]="tmpPoints" [options]="lineOptions()">\n\t\t\t<ng-content />\n\t\t</ngts-line>\n\t',imports:[NgtsLine],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);const defaultOptions$6={size:1024,width:16,type:"linear",innerCircleRadius:0,outerCircleRadius:"auto"};class NgtsGradientTexture{constructor(){this.attach=(0,core.input)("map"),this.stops=core.input.required(),this.colors=core.input.required(),this.options=(0,core.input)(defaultOptions$6,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$6)}),this.parameters=(0,angular_three.cJ)(this.options,["size","width","type","innerCircleRadius","outerCircleRadius"]),this.store=(0,angular_three.ZQ)(),this.outputColorSpace=this.store.select("gl","outputColorSpace"),this.document=(0,core.inject)(common.DOCUMENT),this.canvas=(0,core.computed)((()=>{const canvas=this.document.createElement("canvas"),context=canvas.getContext("2d"),[{width,size,type,outerCircleRadius,innerCircleRadius},stops,colors]=[(0,core.untracked)(this.options),this.stops(),this.colors()];let gradient;if(canvas.width=width,canvas.height=size,"linear"===type)gradient=context.createLinearGradient(0,0,0,size);else{const canvasCenterX=canvas.width/2,canvasCenterY=canvas.height/2,radius="auto"!==outerCircleRadius?Math.abs(Number(outerCircleRadius)):Math.sqrt(canvasCenterX**2+canvasCenterY**2);gradient=context.createRadialGradient(canvasCenterX,canvasCenterY,Math.abs(innerCircleRadius),canvasCenterX,canvasCenterY,radius)}const tempColor=new three_core.Q1f;let i=stops.length;for(;i--;)gradient.addColorStop(stops[i],tempColor.set(colors[i]).getStyle());return context.save(),context.fillStyle=gradient,context.fillRect(0,0,width,size),context.restore(),canvas})),(0,angular_three.X$)({CanvasTexture:three_core.GOR})}static{this.ɵfac=function NgtsGradientTexture_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsGradientTexture)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsGradientTexture,selectors:[["ngts-gradient-texture"]],inputs:{attach:[1,"attach"],stops:[1,"stops"],colors:[1,"colors"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:1,vars:3,consts:[[3,"attach","colorSpace","parameters",4,"args"],[3,"attach","colorSpace","parameters"]],template:function NgtsGradientTexture_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsGradientTexture_ngt_canvas_texture_0_Template,2,3,"ngt-canvas-texture",0)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,angular_three_soba_abstractions_c4,ctx.canvas()))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGradientTexture,[{type:core.Component,args:[{selector:"ngts-gradient-texture",template:'\n\t\t<ngt-canvas-texture\n\t\t\t*args="[canvas()]"\n\t\t\t[attach]="attach()"\n\t\t\t[colorSpace]="outputColorSpace()"\n\t\t\t[parameters]="parameters()"\n\t\t>\n\t\t\t<ng-content />\n\t\t</ngt-canvas-texture>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[angular_three.nQ]}]}],(()=>[]),null);const defaultOptions$5={planeArgs:[],cellSize:.5,cellThickness:.5,cellColor:"black",sectionSize:1,sectionThickness:1,sectionColor:"#2080ff",infiniteGrid:!1,followCamera:!1,fadeDistance:100,fadeStrength:1,fadeFrom:1,side:three_core.hsX};class NgtsGrid{constructor(){this.options=(0,core.input)(defaultOptions$5,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$5)}),this.parameters=(0,angular_three.cJ)(this.options,["planeArgs","cellSize","cellThickness","cellColor","sectionSize","sectionThickness","sectionColor","infiniteGrid","followCamera","fadeDistance","fadeStrength","fadeFrom","side"]),this.meshRef=core.viewChild.required("mesh"),this.plane=new three_core.Zcv,this.upVector=new three_core.Pq0(0,1,0),this.zeroVector=new three_core.Pq0(0,0,0),this.planeArgs=(0,angular_three.B4)(this.options,"planeArgs"),this.side=(0,angular_three.B4)(this.options,"side"),this.uniforms=(0,core.computed)((()=>{const{cellSize,sectionSize,cellColor,sectionColor,cellThickness,sectionThickness,fadeDistance,fadeStrength,fadeFrom,infiniteGrid,followCamera}=this.options();return{cellSize,sectionSize,cellColor,sectionColor,cellThickness,sectionThickness,fadeDistance,fadeStrength,fadeFrom,infiniteGrid,followCamera}})),(0,angular_three.X$)({Mesh:three_core.eaF,PlaneGeometry:three_core.bdM,GridMaterial}),(0,angular_three.bC)((({camera})=>{const mesh=this.meshRef().nativeElement;this.plane.setFromNormalAndCoplanarPoint(this.upVector,this.zeroVector).applyMatrix4(mesh.matrixWorld);const gridMaterial=mesh.material,worldCamProjPosition=gridMaterial.uniforms.worldCamProjPosition,worldPlanePosition=gridMaterial.uniforms.worldPlanePosition;this.plane.projectPoint(camera.position,worldCamProjPosition.value),worldPlanePosition.value.set(0,0,0).applyMatrix4(mesh.matrixWorld)}))}static{this.ɵfac=function NgtsGrid_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsGrid)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsGrid,selectors:[["ngts-grid"]],viewQuery:function NgtsGrid_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.meshRef,angular_three_soba_abstractions_c5,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:6,vars:7,consts:[["mesh",""],[3,"frustumCulled","parameters"],[4,"args"],[3,"transparent","side","parameters"],["attach","extensions.derivatives",3,"rawValue"]],template:function NgtsGrid_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-mesh",1,0),core["ɵɵtemplate"](2,NgtsGrid_ngt_plane_geometry_2_Template,1,0,"ngt-plane-geometry",2),core["ɵɵelementStart"](3,"ngt-grid-material",3),core["ɵɵelement"](4,"ngt-value",4),core["ɵɵelementEnd"](),core["ɵɵprojection"](5),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("frustumCulled",!1)("parameters",ctx.parameters()),core["ɵɵadvance"](2),core["ɵɵproperty"]("args",ctx.planeArgs()),core["ɵɵadvance"](),core["ɵɵproperty"]("transparent",!0)("side",ctx.side())("parameters",ctx.uniforms()),core["ɵɵadvance"](),core["ɵɵproperty"]("rawValue",!0))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}function injectHelper(object,helperConstructor,{injector,args=()=>[]}={}){return(0,ngxtension_assert_injector.x)(injectHelper,injector,(()=>{const scene=(0,angular_three.ZQ)().select("scene"),helper=(0,core.computed)((()=>{const maybeObject3D=object();if(!maybeObject3D)return null;const object3D=(0,angular_three.qE)(maybeObject3D);if(!object3D)return null;const currentHelper=new(helperConstructor())(object3D,...args());return currentHelper.traverse((child=>child.raycast=()=>null)),currentHelper}));return(0,core.effect)((onCleanup=>{const currentHelper=helper();if(!currentHelper)return;const _scene=scene();_scene.add(currentHelper),onCleanup((()=>{_scene.remove(currentHelper),currentHelper.dispose?.()}))})),(0,angular_three.bC)((()=>{const currentHelper=helper();currentHelper&&currentHelper.update()})),helper}))}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsGrid,[{type:core.Component,args:[{selector:"ngts-grid",template:'\n\t\t<ngt-mesh #mesh [frustumCulled]="false" [parameters]="parameters()">\n\t\t\t<ngt-plane-geometry *args="planeArgs()" />\n\t\t\t<ngt-grid-material [transparent]="true" [side]="side()" [parameters]="uniforms()">\n\t\t\t\t<ngt-value attach="extensions.derivatives" [rawValue]="true" />\n\t\t\t</ngt-grid-material>\n\t\t\t<ng-content />\n\t\t</ngt-mesh>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[angular_three.nQ]}]}],(()=>[]),null);class NgtsHelper{constructor(){this.type=core.input.required(),this.options=(0,core.input)([]),this.helperRef=core.viewChild.required("helper"),this.parent=(0,core.computed)((()=>{const helper=this.helperRef().nativeElement;if(!helper)return;const localState=(0,angular_three.h3)(helper);return localState?localState.parent():void 0})),this.helper=injectHelper(this.parent,this.type,{args:this.options}),(0,angular_three.X$)({Object3D:three_core.B69})}static{this.ɵfac=function NgtsHelper_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsHelper)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsHelper,selectors:[["ngts-helper"]],viewQuery:function NgtsHelper_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.helperRef,angular_three_soba_abstractions_c6,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{type:[1,"type"],options:[1,"options"]},decls:2,vars:0,consts:[["helper",""]],template:function NgtsHelper_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-object3D",null,0)},encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsHelper,[{type:core.Component,args:[{selector:"ngts-helper",template:"\n\t\t<ngt-object3D #helper />\n\t",schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);const defaultOptions$4={height:1,bevelEnabled:!1};class NgtsPrismGeometry{constructor(){this.attach=(0,core.input)("geometry"),this.vertices=core.input.required(),this.options=(0,core.input)(defaultOptions$4,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$4)}),this.parameters=(0,core.computed)((()=>({...this.options(),depth:this.options().height}))),this.shape=(0,core.computed)((()=>{const interpolatedVertices=this.vertices().map((v=>v instanceof three_core.I9Y?v:new three_core.I9Y(...v)));return new three_core.ypk(interpolatedVertices)})),this.geometryRef=(0,core.viewChild)("geometry"),(0,angular_three.X$)({ExtrudeGeometry:three_core.QCA})}static{this.ɵfac=function NgtsPrismGeometry_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsPrismGeometry)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsPrismGeometry,selectors:[["ngts-prism-geometry"]],viewQuery:function NgtsPrismGeometry_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.geometryRef,angular_three_soba_abstractions_c7,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{attach:[1,"attach"],vertices:[1,"vertices"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:1,vars:4,consts:[["geometry",""],[3,"attach",4,"args"],[3,"attach"]],template:function NgtsPrismGeometry_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsPrismGeometry_ngt_extrude_geometry_0_Template,3,1,"ngt-extrude-geometry",1)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction2"](1,angular_three_soba_abstractions_c8,ctx.shape(),ctx.parameters()))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsPrismGeometry,[{type:core.Component,args:[{selector:"ngts-prism-geometry",template:'\n\t\t<ngt-extrude-geometry #geometry *args="[shape(), parameters()]" [attach]="attach()">\n\t\t\t<ng-content />\n\t\t</ngt-extrude-geometry>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[angular_three.nQ]}]}],(()=>[]),null);const defaultOptions$3={lineWidth:1,segments:20};class NgtsQuadraticBezierLine{constructor(){this.start=(0,core.input)([0,0,0]),this.end=(0,core.input)([0,0,0]),this.mid=(0,core.input)(),this.options=(0,core.input)(defaultOptions$3,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$3)}),this.parameters=(0,angular_three.cJ)(this.options,["segments"]),this.segments=(0,angular_three.B4)(this.options,"segments"),this.line=core.viewChild.required(NgtsLine),this.points=(0,core.computed)((()=>this.getPoints(this.start(),this.end(),this.mid(),this.segments()))),this.curve=new three_core.CV9}setPoints(start,end,mid){const points=this.getPoints(start,end,mid),geometry=this.line().lineGeometry();geometry&&geometry.setPositions(points.map((p=>p.toArray())).flat())}getPoints(start,end,mid,segments=20){return start instanceof three_core.Pq0?this.curve.v0.copy(start):this.curve.v0.set(...start),end instanceof three_core.Pq0?this.curve.v2.copy(end):this.curve.v2.set(...end),mid instanceof three_core.Pq0?this.curve.v1.copy(mid):Array.isArray(mid)?this.curve.v1.set(...mid):this.curve.v1.copy(this.curve.v0.clone().add(this.curve.v2.clone().sub(this.curve.v0)).add(new three_core.Pq0(0,this.curve.v0.y-this.curve.v2.y,0))),this.curve.getPoints(segments)}static{this.ɵfac=function NgtsQuadraticBezierLine_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsQuadraticBezierLine)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsQuadraticBezierLine,selectors:[["ngts-quadratic-bezier-line"]],viewQuery:function NgtsQuadraticBezierLine_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.line,NgtsLine,5),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{start:[1,"start"],end:[1,"end"],mid:[1,"mid"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:2,vars:2,consts:[[3,"points","options"]],template:function NgtsQuadraticBezierLine_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngts-line",0),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf&&core["ɵɵproperty"]("points",ctx.points())("options",ctx.parameters())},dependencies:[NgtsLine],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsQuadraticBezierLine,[{type:core.Component,args:[{selector:"ngts-quadratic-bezier-line",template:'\n\t\t<ngts-line [points]="points()" [options]="parameters()">\n\t\t\t<ng-content />\n\t\t</ngts-line>\n\t',changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[NgtsLine]}]}],null,null);const eps=1e-5;const defaultOptions$2={width:1,height:1,depth:1,radius:.05,smoothness:4,bevelSegments:4,creaseAngle:.4,steps:1};class NgtsRoundedBox{constructor(){this.options=(0,core.input)(defaultOptions$2,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$2)}),this.parameters=(0,angular_three.cJ)(this.options,["width","height","depth","radius","smoothness","bevelSegments","steps","creaseAngle"]),this.width=(0,angular_three.B4)(this.options,"width"),this.height=(0,angular_three.B4)(this.options,"height"),this.depth=(0,angular_three.B4)(this.options,"depth"),this.radius=(0,angular_three.B4)(this.options,"radius"),this.smoothness=(0,angular_three.B4)(this.options,"smoothness"),this.bevelSegments=(0,angular_three.B4)(this.options,"bevelSegments"),this.steps=(0,angular_three.B4)(this.options,"steps"),this.creaseAngle=(0,angular_three.B4)(this.options,"creaseAngle"),this.meshRef=core.viewChild.required("mesh"),this.geometryRef=(0,core.viewChild)("geometry"),this.shape=(0,core.computed)((()=>{const[width,height,radius]=[this.width(),this.height(),this.radius()];return function createShape(width,height,radius0){const shape=new three_core.ypk,radius=radius0-eps;return shape.absarc(eps,eps,eps,-Math.PI/2,-Math.PI,!0),shape.absarc(eps,height-2*radius,eps,Math.PI,Math.PI/2,!0),shape.absarc(width-2*radius,height-2*radius,eps,Math.PI/2,0,!0),shape.absarc(width-2*radius,eps,eps,0,-Math.PI/2,!0),shape}(width,height,radius)})),this.params=(0,core.computed)((()=>{const[depth,radius,smoothness,bevelSegments,steps]=[this.depth(),this.radius(),this.smoothness(),(0,core.untracked)(this.bevelSegments),(0,core.untracked)(this.steps)];return{depth:depth-2*radius,bevelEnabled:!0,bevelSegments:2*bevelSegments,steps,bevelSize:radius-eps,bevelThickness:radius,curveSegments:smoothness}})),(0,angular_three.X$)({ExtrudeGeometry:three_core.QCA,Mesh:three_core.eaF});const objectEvents=(0,core.inject)(angular_three.KY,{host:!0});(0,core.effect)((()=>{const mesh=this.meshRef().nativeElement;objectEvents.ngtObjectEvents.set(mesh)})),(0,core.effect)((()=>{const geometry=this.geometryRef()?.nativeElement;geometry&&(geometry.center(),function toCreasedNormals(geometry,creaseAngle=Math.PI/3){const creaseDot=Math.cos(creaseAngle),verts=[new three_core.Pq0,new three_core.Pq0,new three_core.Pq0],tempVec1=new three_core.Pq0,tempVec2=new three_core.Pq0,tempNorm=new three_core.Pq0,tempNorm2=new three_core.Pq0;function hashVertex(v){return`${~~(100.00000001000001*v.x)},${~~(100.00000001000001*v.y)},${~~(100.00000001000001*v.z)}`}const resultGeometry=geometry.index?geometry.toNonIndexed():geometry,posAttr=resultGeometry.attributes.position,vertexMap={};for(let i=0,l=posAttr.count/3;i<l;i++){const i3=3*i,a=verts[0].fromBufferAttribute(posAttr,i3+0),b=verts[1].fromBufferAttribute(posAttr,i3+1),c=verts[2].fromBufferAttribute(posAttr,i3+2);tempVec1.subVectors(c,b),tempVec2.subVectors(a,b);const normal=(new three_core.Pq0).crossVectors(tempVec1,tempVec2).normalize();for(let n=0;n<3;n++){const hash=hashVertex(verts[n]);hash in vertexMap||(vertexMap[hash]=[]),vertexMap[hash].push(normal)}}const normalArray=new Float32Array(3*posAttr.count),normAttr=new three_core.THS(normalArray,3,!1);for(let i=0,l=posAttr.count/3;i<l;i++){const i3=3*i,a=verts[0].fromBufferAttribute(posAttr,i3+0),b=verts[1].fromBufferAttribute(posAttr,i3+1),c=verts[2].fromBufferAttribute(posAttr,i3+2);tempVec1.subVectors(c,b),tempVec2.subVectors(a,b),tempNorm.crossVectors(tempVec1,tempVec2).normalize();for(let n=0;n<3;n++){const otherNormals=vertexMap[hashVertex(verts[n])];tempNorm2.set(0,0,0);for(let k=0,lk=otherNormals.length;k<lk;k++){const otherNorm=otherNormals[k];tempNorm.dot(otherNorm)>creaseDot&&tempNorm2.add(otherNorm)}tempNorm2.normalize(),normAttr.setXYZ(i3+n,tempNorm2.x,tempNorm2.y,tempNorm2.z)}}return resultGeometry.setAttribute("normal",normAttr),resultGeometry}(geometry,(0,core.untracked)(this.creaseAngle)))}))}static{this.ɵfac=function NgtsRoundedBox_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsRoundedBox)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsRoundedBox,selectors:[["ngts-rounded-box"]],viewQuery:function NgtsRoundedBox_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.meshRef,angular_three_soba_abstractions_c5,5),core["ɵɵviewQuerySignal"](ctx.geometryRef,angular_three_soba_abstractions_c7,5)),2&rf&&core["ɵɵqueryAdvance"](2)},inputs:{options:[1,"options"]},features:[core["ɵɵHostDirectivesFeature"]([{directive:angular_three.KY,outputs:["click","click","dblclick","dblclick","contextmenu","contextmenu","pointerup","pointerup","pointerdown","pointerdown","pointerover","pointerover","pointerout","pointerout","pointerenter","pointerenter","pointerleave","pointerleave","pointermove","pointermove","pointermissed","pointermissed","pointercancel","pointercancel","wheel","wheel"]}])],ngContentSelectors:angular_three_soba_abstractions_c2,decls:4,vars:5,consts:[["mesh",""],["geometry",""],[3,"parameters"],[4,"args"]],template:function NgtsRoundedBox_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-mesh",2,0),core["ɵɵtemplate"](2,NgtsRoundedBox_ngt_extrude_geometry_2_Template,2,0,"ngt-extrude-geometry",3),core["ɵɵprojection"](3),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("parameters",ctx.parameters()),core["ɵɵadvance"](2),core["ɵɵproperty"]("args",core["ɵɵpureFunction2"](2,angular_three_soba_abstractions_c8,ctx.shape(),ctx.params())))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsRoundedBox,[{type:core.Component,args:[{selector:"ngts-rounded-box",template:'\n\t\t<ngt-mesh #mesh [parameters]="parameters()">\n\t\t\t<ngt-extrude-geometry #geometry *args="[shape(), params()]" />\n\t\t\t<ng-content />\n\t\t</ngt-mesh>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[angular_three.nQ],hostDirectives:[{directive:angular_three.KY,outputs:["click","dblclick","contextmenu","pointerup","pointerdown","pointerover","pointerout","pointerenter","pointerleave","pointermove","pointermissed","pointercancel","wheel"]}]}]}],(()=>[]),null);const angular_three_soba_abstractions_defaultOptions$1={sdfGlyphSize:64,anchorX:"center",anchorY:"middle",fontSize:1};class NgtsText{constructor(){this.text=core.input.required(),this.options=(0,core.input)(angular_three_soba_abstractions_defaultOptions$1,{transform:(0,ngxtension_inject_inputs.sg)(angular_three_soba_abstractions_defaultOptions$1)}),this.parameters=(0,angular_three.cJ)(this.options,["font","fontSize","sdfGlyphSize","anchorX","anchorY","characters"]),this.synced=(0,core.output)(),this.store=(0,angular_three.ZQ)(),this.invalidate=this.store.select("invalidate"),this.characters=(0,angular_three.B4)(this.options,"characters"),this.font=(0,angular_three.B4)(this.options,"font"),this.anchorX=(0,angular_three.B4)(this.options,"anchorX"),this.anchorY=(0,angular_three.B4)(this.options,"anchorY"),this.sdfGlyphSize=(0,angular_three.B4)(this.options,"sdfGlyphSize"),this.fontSize=(0,angular_three.B4)(this.options,"fontSize"),this.troikaMesh=new Text,(0,core.inject)(core.DestroyRef).onDestroy((()=>{this.troikaMesh.dispose()})),(0,core.effect)((()=>{const[font,characters,invalidate]=[this.font(),this.characters(),this.invalidate()];font&&function preloadFont({font,characters,sdfGlyphSize},callback){getTextRenderInfo({font,sdfGlyphSize,text:Array.isArray(characters)?characters.join("\n"):""+characters},callback)}({font,characters},(()=>invalidate()))})),(0,core.effect)((()=>{const[invalidate]=[this.invalidate(),this.text(),this.options()];this.troikaMesh.sync((()=>{invalidate(),this.synced.emit(this.troikaMesh)}))}))}static{this.ɵfac=function NgtsText_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsText)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsText,selectors:[["ngts-text"]],inputs:{text:[1,"text"],options:[1,"options"]},outputs:{synced:"synced"},ngContentSelectors:angular_three_soba_abstractions_c2,decls:1,vars:3,consts:[[3,"text","font","anchorX","anchorY","sdfGlyphSize","fontSize","parameters",4,"args"],[3,"text","font","anchorX","anchorY","sdfGlyphSize","fontSize","parameters"]],template:function NgtsText_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsText_ngt_primitive_0_Template,2,7,"ngt-primitive",0)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,angular_three_soba_abstractions_c4,ctx.troikaMesh))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsText,[{type:core.Component,args:[{selector:"ngts-text",template:'\n\t\t<ngt-primitive\n\t\t\t*args="[troikaMesh]"\n\t\t\t[text]="text()"\n\t\t\t[font]="font()"\n\t\t\t[anchorX]="anchorX()"\n\t\t\t[anchorY]="anchorY()"\n\t\t\t[sdfGlyphSize]="sdfGlyphSize()"\n\t\t\t[fontSize]="fontSize()"\n\t\t\t[parameters]="parameters()"\n\t\t>\n\t\t\t<ng-content />\n\t\t</ngt-primitive>\n\t',imports:[angular_three.nQ],schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);const angular_three_soba_abstractions_defaultOptions={letterSpacing:0,lineHeight:1,size:1,height:.2,bevelThickness:.1,bevelSize:.01,bevelEnabled:!1,bevelOffset:0,bevelSegments:4,curveSegments:8};class NgtsText3D{constructor(){this.font=core.input.required(),this.text=core.input.required(),this.options=(0,core.input)(angular_three_soba_abstractions_defaultOptions,{transform:(0,ngxtension_inject_inputs.sg)(angular_three_soba_abstractions_defaultOptions)}),this.parameters=(0,angular_three.cJ)(this.options,["letterSpacing","lineHeight","size","height","bevelThickness","bevelSize","bevelEnabled","bevelOffset","bevelSegments","curveSegments","smooth"]),this.meshRef=core.viewChild.required("mesh"),this.textGeometryRef=(0,core.viewChild)("textGeometry"),this.loadedFont=injectFont(this.font),this.smooth=(0,angular_three.B4)(this.options,"smooth"),this.textOptions=(0,angular_three.B4)(this.options,["letterSpacing","lineHeight","size","height","bevelThickness","bevelSize","bevelEnabled","bevelOffset","bevelSegments","curveSegments"]),this.textArgs=(0,core.computed)((()=>{const[text,font,textOptions]=[this.text(),this.loadedFont(),this.textOptions()];return font?[text,{font,...textOptions}]:null})),(0,angular_three.X$)({Mesh:three_core.eaF,TextGeometry}),(0,core.effect)((()=>{const[mesh,textGeometry,textArgs]=[this.meshRef()?.nativeElement,this.textGeometryRef()?.nativeElement,this.textArgs()];if(!textArgs||!textGeometry||!mesh)return;const smooth=this.smooth();smooth&&(mesh.geometry=function mergeVertices(geometry,tolerance=1e-4){tolerance=Math.max(tolerance,Number.EPSILON);const hashToIndex={},indices=geometry.getIndex(),positions=geometry.getAttribute("position"),vertexCount=indices?indices.count:positions.count;let nextIndex=0;const attributeNames=Object.keys(geometry.attributes),attrArrays={},morphAttrsArrays={},newIndices=[],getters=["getX","getY","getZ","getW"];for(let i=0,l=attributeNames.length;i<l;i++){const name=attributeNames[i];attrArrays[name]=[];const morphAttr=geometry.morphAttributes[name];morphAttr&&(morphAttrsArrays[name]=new Array(morphAttr.length).fill(0).map((()=>[])))}const decimalShift=Math.log10(1/tolerance),shiftMultiplier=Math.pow(10,decimalShift);for(let i=0;i<vertexCount;i++){const index=indices?indices.getX(i):i;let hash="";for(let j=0,l=attributeNames.length;j<l;j++){const name=attributeNames[j],attribute=geometry.getAttribute(name),itemSize=attribute.itemSize;for(let k=0;k<itemSize;k++)hash+=~~(attribute[getters[k]](index)*shiftMultiplier)+","}if(hash in hashToIndex)newIndices.push(hashToIndex[hash]);else{for(let j=0,l=attributeNames.length;j<l;j++){const name=attributeNames[j],attribute=geometry.getAttribute(name),morphAttr=geometry.morphAttributes[name],itemSize=attribute.itemSize,newarray=attrArrays[name],newMorphArrays=morphAttrsArrays[name];for(let k=0;k<itemSize;k++){const getterFunc=getters[k];if(newarray.push(attribute[getterFunc](index)),morphAttr)for(let m=0,ml=morphAttr.length;m<ml;m++)newMorphArrays[m].push(morphAttr[m][getterFunc](index))}}hashToIndex[hash]=nextIndex,newIndices.push(nextIndex),nextIndex++}}const result=geometry.clone();for(let i=0,l=attributeNames.length;i<l;i++){const name=attributeNames[i],oldAttribute=geometry.getAttribute(name),buffer=new oldAttribute.array.constructor(attrArrays[name]),attribute=new three_core.THS(buffer,oldAttribute.itemSize,oldAttribute.normalized);if(result.setAttribute(name,attribute),name in morphAttrsArrays)for(let j=0;j<morphAttrsArrays[name].length;j++){const oldMorphAttribute=geometry.morphAttributes[name][j],buffer2=new oldMorphAttribute.array.constructor(morphAttrsArrays[name][j]),morphAttribute=new three_core.THS(buffer2,oldMorphAttribute.itemSize,oldMorphAttribute.normalized);result.morphAttributes[name][j]=morphAttribute}}return result.setIndex(newIndices),result}(textGeometry,smooth),mesh.geometry.computeVertexNormals())}))}static{this.ɵfac=function NgtsText3D_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsText3D)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsText3D,selectors:[["ngts-text-3d"]],viewQuery:function NgtsText3D_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.meshRef,angular_three_soba_abstractions_c5,5),core["ɵɵviewQuerySignal"](ctx.textGeometryRef,angular_three_soba_abstractions_c9,5)),2&rf&&core["ɵɵqueryAdvance"](2)},inputs:{font:[1,"font"],text:[1,"text"],options:[1,"options"]},ngContentSelectors:angular_three_soba_abstractions_c2,decls:4,vars:2,consts:[["mesh",""],["textGeometry",""],[3,"parameters"],[4,"args"]],template:function NgtsText3D_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵelementStart"](0,"ngt-mesh",2,0),core["ɵɵtemplate"](2,NgtsText3D_ngt_text_geometry_2_Template,2,0,"ngt-text-geometry",3),core["ɵɵprojection"](3),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵproperty"]("parameters",ctx.parameters()),core["ɵɵadvance"](2),core["ɵɵproperty"]("args",ctx.textArgs()))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsText3D,[{type:core.Component,args:[{selector:"ngts-text-3d",template:'\n\t\t<ngt-mesh #mesh [parameters]="parameters()">\n\t\t\t<ngt-text-geometry #textGeometry *args="textArgs()" />\n\t\t\t<ng-content />\n\t\t</ngt-mesh>\n\t',imports:[angular_three.nQ],schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null)},"./node_modules/angular-three-soba/fesm2022/angular-three-soba-controls.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H6:()=>NgtsOrbitControls});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),angular_three=__webpack_require__("./node_modules/angular-three/fesm2022/angular-three.mjs");const MOUSE_BUTTON_LEFT=1,MOUSE_BUTTON_RIGHT=2,MOUSE_BUTTON_MIDDLE=4,ACTION=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),DOLLY_DIRECTION_NONE=0,DOLLY_DIRECTION_IN=1,DOLLY_DIRECTION_OUT=-1;function isPerspectiveCamera(camera){return camera.isPerspectiveCamera}function isOrthographicCamera(camera){return camera.isOrthographicCamera}const PI_2=2*Math.PI,PI_HALF=Math.PI/2,DEG2RAD=Math.PI/180;function clamp(value,min,max){return Math.max(min,Math.min(max,value))}function approxZero(number,error=1e-5){return Math.abs(number)<error}function approxEquals(a,b,error=1e-5){return approxZero(a-b,error)}function roundToStep(value,step){return Math.round(value/step)*step}function infinityToMaxNumber(value){return isFinite(value)?value:value<0?-Number.MAX_VALUE:Number.MAX_VALUE}function maxNumberToInfinity(value){return Math.abs(value)<Number.MAX_VALUE?value:value*(1/0)}function smoothDamp(current,target,currentVelocityRef,smoothTime,maxSpeed=1/0,deltaTime){const omega=2/(smoothTime=Math.max(1e-4,smoothTime)),x=omega*deltaTime,exp=1/(1+x+.48*x*x+.235*x*x*x);let change=current-target;const originalTo=target,maxChange=maxSpeed*smoothTime;change=clamp(change,-maxChange,maxChange),target=current-change;const temp=(currentVelocityRef.value+omega*change)*deltaTime;currentVelocityRef.value=(currentVelocityRef.value-omega*temp)*exp;let output=target+(change+temp)*exp;return originalTo-current>0==output>originalTo&&(output=originalTo,currentVelocityRef.value=(output-originalTo)/deltaTime),output}function smoothDampVec3(current,target,currentVelocityRef,smoothTime,maxSpeed=1/0,deltaTime,out){const omega=2/(smoothTime=Math.max(1e-4,smoothTime)),x=omega*deltaTime,exp=1/(1+x+.48*x*x+.235*x*x*x);let targetX=target.x,targetY=target.y,targetZ=target.z,changeX=current.x-targetX,changeY=current.y-targetY,changeZ=current.z-targetZ;const originalToX=targetX,originalToY=targetY,originalToZ=targetZ,maxChange=maxSpeed*smoothTime,magnitudeSq=changeX*changeX+changeY*changeY+changeZ*changeZ;if(magnitudeSq>maxChange*maxChange){const magnitude=Math.sqrt(magnitudeSq);changeX=changeX/magnitude*maxChange,changeY=changeY/magnitude*maxChange,changeZ=changeZ/magnitude*maxChange}targetX=current.x-changeX,targetY=current.y-changeY,targetZ=current.z-changeZ;const tempX=(currentVelocityRef.x+omega*changeX)*deltaTime,tempY=(currentVelocityRef.y+omega*changeY)*deltaTime,tempZ=(currentVelocityRef.z+omega*changeZ)*deltaTime;currentVelocityRef.x=(currentVelocityRef.x-omega*tempX)*exp,currentVelocityRef.y=(currentVelocityRef.y-omega*tempY)*exp,currentVelocityRef.z=(currentVelocityRef.z-omega*tempZ)*exp,out.x=targetX+(changeX+tempX)*exp,out.y=targetY+(changeY+tempY)*exp,out.z=targetZ+(changeZ+tempZ)*exp;const origMinusCurrentX=originalToX-current.x,origMinusCurrentY=originalToY-current.y,origMinusCurrentZ=originalToZ-current.z;return origMinusCurrentX*(out.x-originalToX)+origMinusCurrentY*(out.y-originalToY)+origMinusCurrentZ*(out.z-originalToZ)>0&&(out.x=originalToX,out.y=originalToY,out.z=originalToZ,currentVelocityRef.x=(out.x-originalToX)/deltaTime,currentVelocityRef.y=(out.y-originalToY)/deltaTime,currentVelocityRef.z=(out.z-originalToZ)/deltaTime),out}function extractClientCoordFromEvent(pointers,out){out.set(0,0),pointers.forEach((pointer=>{out.x+=pointer.clientX,out.y+=pointer.clientY})),out.x/=pointers.length,out.y/=pointers.length}function notSupportedInOrthographicCamera(camera,message){return!!isOrthographicCamera(camera)&&(console.warn(`${message} is not supported in OrthographicCamera`),!0)}class EventDispatcher{constructor(){this._listeners={}}addEventListener(type,listener){const listeners=this._listeners;void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)}hasEventListener(type,listener){const listeners=this._listeners;return void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener)}removeEventListener(type,listener){const listenerArray=this._listeners[type];if(void 0!==listenerArray){const index=listenerArray.indexOf(listener);-1!==index&&listenerArray.splice(index,1)}}removeAllEventListeners(type){type?Array.isArray(this._listeners[type])&&(this._listeners[type].length=0):this._listeners={}}dispatchEvent(event){const listenerArray=this._listeners[event.type];if(void 0!==listenerArray){event.target=this;const array=listenerArray.slice(0);for(let i=0,l=array.length;i<l;i++)array[i].call(this,event)}}}var _a;const isMac=/Mac/.test(null===(_a=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===_a?void 0:_a.platform);let THREE,_ORIGIN,_AXIS_Y,_AXIS_Z,_v2,_v3A,_v3B,_v3C,_cameraDirection,_xColumn,_yColumn,_zColumn,_deltaTarget,_deltaOffset,_sphericalA,_sphericalB,_box3A,_box3B,_sphere,_quaternionA,_quaternionB,_rotationMatrix,_raycaster;class CameraControls extends EventDispatcher{static install(libs){THREE=libs.THREE,_ORIGIN=Object.freeze(new THREE.Vector3(0,0,0)),_AXIS_Y=Object.freeze(new THREE.Vector3(0,1,0)),_AXIS_Z=Object.freeze(new THREE.Vector3(0,0,1)),_v2=new THREE.Vector2,_v3A=new THREE.Vector3,_v3B=new THREE.Vector3,_v3C=new THREE.Vector3,_cameraDirection=new THREE.Vector3,_xColumn=new THREE.Vector3,_yColumn=new THREE.Vector3,_zColumn=new THREE.Vector3,_deltaTarget=new THREE.Vector3,_deltaOffset=new THREE.Vector3,_sphericalA=new THREE.Spherical,_sphericalB=new THREE.Spherical,_box3A=new THREE.Box3,_box3B=new THREE.Box3,_sphere=new THREE.Sphere,_quaternionA=new THREE.Quaternion,_quaternionB=new THREE.Quaternion,_rotationMatrix=new THREE.Matrix4,_raycaster=new THREE.Raycaster}static get ACTION(){return ACTION}constructor(camera,domElement){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ACTION.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=DOLLY_DIRECTION_NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new THREE.Vector3,this._focalOffsetVelocity=new THREE.Vector3,this._zoomVelocity={value:0},this._truckInternal=(deltaX,deltaY,dragToOffset,screenSpacePanning)=>{let truckX,pedestalY;if(isPerspectiveCamera(this._camera)){const offset=_v3A.copy(this._camera.position).sub(this._target),fov=this._camera.getEffectiveFOV()*DEG2RAD,targetDistance=offset.length()*Math.tan(.5*fov);truckX=this.truckSpeed*deltaX*targetDistance/this._elementRect.height,pedestalY=this.truckSpeed*deltaY*targetDistance/this._elementRect.height}else{if(!isOrthographicCamera(this._camera))return;{const camera=this._camera;truckX=this.truckSpeed*deltaX*(camera.right-camera.left)/camera.zoom/this._elementRect.width,pedestalY=this.truckSpeed*deltaY*(camera.top-camera.bottom)/camera.zoom/this._elementRect.height}}screenSpacePanning?(dragToOffset?this.setFocalOffset(this._focalOffsetEnd.x+truckX,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(truckX,0,!0),this.forward(-pedestalY,!0)):dragToOffset?this.setFocalOffset(this._focalOffsetEnd.x+truckX,this._focalOffsetEnd.y+pedestalY,this._focalOffsetEnd.z,!0):this.truck(truckX,pedestalY,!0)},this._rotateInternal=(deltaX,deltaY)=>{const theta=PI_2*this.azimuthRotateSpeed*deltaX/this._elementRect.height,phi=PI_2*this.polarRotateSpeed*deltaY/this._elementRect.height;this.rotate(theta,phi,!0)},this._dollyInternal=(delta,x,y)=>{const dollyScale=Math.pow(.95,-delta*this.dollySpeed),lastDistance=this._sphericalEnd.radius,distance=this._sphericalEnd.radius*dollyScale,clampedDistance=clamp(distance,this.minDistance,this.maxDistance),overflowedDistance=clampedDistance-distance;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(distance,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(overflowedDistance,!0),this._dollyToNoClamp(clampedDistance,!0)):this._dollyToNoClamp(clampedDistance,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?distance:clampedDistance)-lastDistance,this._dollyControlCoord.set(x,y)),this._lastDollyDirection=Math.sign(-delta)},this._zoomInternal=(delta,x,y)=>{const zoomScale=Math.pow(.95,delta*this.dollySpeed),lastZoom=this._zoom,zoom=this._zoom*zoomScale;this.zoomTo(zoom,!0),this.dollyToCursor&&(this._changedZoom+=zoom-lastZoom,this._dollyControlCoord.set(x,y))},void 0===THREE&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=camera,this._yAxisUpSpace=(new THREE.Quaternion).setFromUnitVectors(this._camera.up,_AXIS_Y),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ACTION.NONE,this._target=new THREE.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new THREE.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new THREE.Spherical).setFromVector3(_v3A.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this._updateNearPlaneCorners(),this._boundary=new THREE.Box3(new THREE.Vector3(-1/0,-1/0,-1/0),new THREE.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new THREE.Vector2,this.mouseButtons={left:ACTION.ROTATE,middle:ACTION.DOLLY,right:ACTION.TRUCK,wheel:isPerspectiveCamera(this._camera)?ACTION.DOLLY:isOrthographicCamera(this._camera)?ACTION.ZOOM:ACTION.NONE},this.touches={one:ACTION.TOUCH_ROTATE,two:isPerspectiveCamera(this._camera)?ACTION.TOUCH_DOLLY_TRUCK:isOrthographicCamera(this._camera)?ACTION.TOUCH_ZOOM_TRUCK:ACTION.NONE,three:ACTION.TOUCH_TRUCK};const dragStartPosition=new THREE.Vector2,lastDragPosition=new THREE.Vector2,dollyStart=new THREE.Vector2,onPointerDown=event=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const elRect=this._domElement.getBoundingClientRect(),left=event.clientX/elRect.width,top=event.clientY/elRect.height;if(left<this._interactiveArea.left||left>this._interactiveArea.right||top<this._interactiveArea.top||top>this._interactiveArea.bottom)return}const mouseButton="mouse"!==event.pointerType?null:(event.buttons&MOUSE_BUTTON_LEFT)===MOUSE_BUTTON_LEFT?MOUSE_BUTTON_LEFT:(event.buttons&MOUSE_BUTTON_MIDDLE)===MOUSE_BUTTON_MIDDLE?MOUSE_BUTTON_MIDDLE:(event.buttons&MOUSE_BUTTON_RIGHT)===MOUSE_BUTTON_RIGHT?MOUSE_BUTTON_RIGHT:null;if(null!==mouseButton){const zombiePointer=this._findPointerByMouseButton(mouseButton);zombiePointer&&this._disposePointer(zombiePointer)}if((event.buttons&MOUSE_BUTTON_LEFT)===MOUSE_BUTTON_LEFT&&this._lockedPointer)return;const pointer={pointerId:event.pointerId,clientX:event.clientX,clientY:event.clientY,deltaX:0,deltaY:0,mouseButton};this._activePointers.push(pointer),this._domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",onPointerUp),this._domElement.ownerDocument.addEventListener("pointermove",onPointerMove,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",onPointerUp),this._isDragging=!0,startDragging(event)},onPointerMove=event=>{event.cancelable&&event.preventDefault();const pointerId=event.pointerId,pointer=this._lockedPointer||this._findPointerById(pointerId);if(pointer){if(pointer.clientX=event.clientX,pointer.clientY=event.clientY,pointer.deltaX=event.movementX,pointer.deltaY=event.movementY,this._state=0,"touch"===event.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(event.buttons&MOUSE_BUTTON_LEFT)===MOUSE_BUTTON_LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(event.buttons&MOUSE_BUTTON_MIDDLE)===MOUSE_BUTTON_MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(event.buttons&MOUSE_BUTTON_RIGHT)===MOUSE_BUTTON_RIGHT&&(this._state=this._state|this.mouseButtons.right);dragging()}},onPointerUp=event=>{const pointer=this._findPointerById(event.pointerId);if(!pointer||pointer!==this._lockedPointer){if(pointer&&this._disposePointer(pointer),"touch"===event.pointerType)switch(this._activePointers.length){case 0:this._state=ACTION.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=ACTION.NONE;endDragging()}};let lastScrollTimeStamp=-1;const onMouseWheel=event=>{if(!this._domElement)return;if(!this._enabled||this.mouseButtons.wheel===ACTION.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const elRect=this._domElement.getBoundingClientRect(),left=event.clientX/elRect.width,top=event.clientY/elRect.height;if(left<this._interactiveArea.left||left>this._interactiveArea.right||top<this._interactiveArea.top||top>this._interactiveArea.bottom)return}if(event.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ACTION.ROTATE||this.mouseButtons.wheel===ACTION.TRUCK){const now=performance.now();lastScrollTimeStamp-now<1e3&&this._getClientRect(this._elementRect),lastScrollTimeStamp=now}const deltaYFactor=isMac?-1:-3,delta=1===event.deltaMode?event.deltaY/deltaYFactor:event.deltaY/(10*deltaYFactor),x=this.dollyToCursor?(event.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,y=this.dollyToCursor?(event.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ACTION.ROTATE:this._rotateInternal(event.deltaX,event.deltaY),this._isUserControllingRotate=!0;break;case ACTION.TRUCK:this._truckInternal(event.deltaX,event.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case ACTION.SCREEN_PAN:this._truckInternal(event.deltaX,event.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case ACTION.OFFSET:this._truckInternal(event.deltaX,event.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case ACTION.DOLLY:this._dollyInternal(-delta,x,y),this._isUserControllingDolly=!0;break;case ACTION.ZOOM:this._zoomInternal(-delta,x,y),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},onContextMenu=event=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===CameraControls.ACTION.NONE){const pointerId=event instanceof PointerEvent?event.pointerId:0,pointer=this._findPointerById(pointerId);return pointer&&this._disposePointer(pointer),this._domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,{passive:!1}),void this._domElement.ownerDocument.removeEventListener("pointerup",onPointerUp)}event.preventDefault()}},startDragging=event=>{if(!this._enabled)return;extractClientCoordFromEvent(this._activePointers,_v2),this._getClientRect(this._elementRect),dragStartPosition.copy(_v2),lastDragPosition.copy(_v2);if(this._activePointers.length>=2){const dx=_v2.x-this._activePointers[1].clientX,dy=_v2.y-this._activePointers[1].clientY,distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance);const x=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),y=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);lastDragPosition.set(x,y)}if(this._state=0,event)if("pointerType"in event&&"touch"===event.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(event.buttons&MOUSE_BUTTON_LEFT)!==MOUSE_BUTTON_LEFT||(this._state=this._state|this.mouseButtons.left),(event.buttons&MOUSE_BUTTON_MIDDLE)===MOUSE_BUTTON_MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(event.buttons&MOUSE_BUTTON_RIGHT)===MOUSE_BUTTON_RIGHT&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);(this._state&ACTION.ROTATE)!==ACTION.ROTATE&&(this._state&ACTION.TOUCH_ROTATE)!==ACTION.TOUCH_ROTATE&&(this._state&ACTION.TOUCH_DOLLY_ROTATE)!==ACTION.TOUCH_DOLLY_ROTATE&&(this._state&ACTION.TOUCH_ZOOM_ROTATE)!==ACTION.TOUCH_ZOOM_ROTATE||(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),(this._state&ACTION.TRUCK)!==ACTION.TRUCK&&(this._state&ACTION.SCREEN_PAN)!==ACTION.SCREEN_PAN&&(this._state&ACTION.TOUCH_TRUCK)!==ACTION.TOUCH_TRUCK&&(this._state&ACTION.TOUCH_SCREEN_PAN)!==ACTION.TOUCH_SCREEN_PAN&&(this._state&ACTION.TOUCH_DOLLY_TRUCK)!==ACTION.TOUCH_DOLLY_TRUCK&&(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)!==ACTION.TOUCH_DOLLY_SCREEN_PAN&&(this._state&ACTION.TOUCH_ZOOM_TRUCK)!==ACTION.TOUCH_ZOOM_TRUCK&&(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)!==ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),(this._state&ACTION.DOLLY)!==ACTION.DOLLY&&(this._state&ACTION.TOUCH_DOLLY)!==ACTION.TOUCH_DOLLY&&(this._state&ACTION.TOUCH_DOLLY_TRUCK)!==ACTION.TOUCH_DOLLY_TRUCK&&(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)!==ACTION.TOUCH_DOLLY_SCREEN_PAN&&(this._state&ACTION.TOUCH_DOLLY_OFFSET)!==ACTION.TOUCH_DOLLY_OFFSET&&(this._state&ACTION.TOUCH_DOLLY_ROTATE)!==ACTION.TOUCH_DOLLY_ROTATE||(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),(this._state&ACTION.ZOOM)!==ACTION.ZOOM&&(this._state&ACTION.TOUCH_ZOOM)!==ACTION.TOUCH_ZOOM&&(this._state&ACTION.TOUCH_ZOOM_TRUCK)!==ACTION.TOUCH_ZOOM_TRUCK&&(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)!==ACTION.TOUCH_ZOOM_SCREEN_PAN&&(this._state&ACTION.TOUCH_ZOOM_OFFSET)!==ACTION.TOUCH_ZOOM_OFFSET&&(this._state&ACTION.TOUCH_ZOOM_ROTATE)!==ACTION.TOUCH_ZOOM_ROTATE||(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),(this._state&ACTION.OFFSET)!==ACTION.OFFSET&&(this._state&ACTION.TOUCH_OFFSET)!==ACTION.TOUCH_OFFSET&&(this._state&ACTION.TOUCH_DOLLY_OFFSET)!==ACTION.TOUCH_DOLLY_OFFSET&&(this._state&ACTION.TOUCH_ZOOM_OFFSET)!==ACTION.TOUCH_ZOOM_OFFSET||(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},dragging=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,extractClientCoordFromEvent(this._activePointers,_v2);const lockedPointer=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,deltaX=lockedPointer?-lockedPointer.deltaX:lastDragPosition.x-_v2.x,deltaY=lockedPointer?-lockedPointer.deltaY:lastDragPosition.y-_v2.y;if(lastDragPosition.copy(_v2),(this._state&ACTION.ROTATE)!==ACTION.ROTATE&&(this._state&ACTION.TOUCH_ROTATE)!==ACTION.TOUCH_ROTATE&&(this._state&ACTION.TOUCH_DOLLY_ROTATE)!==ACTION.TOUCH_DOLLY_ROTATE&&(this._state&ACTION.TOUCH_ZOOM_ROTATE)!==ACTION.TOUCH_ZOOM_ROTATE||(this._rotateInternal(deltaX,deltaY),this._isUserControllingRotate=!0),(this._state&ACTION.DOLLY)===ACTION.DOLLY||(this._state&ACTION.ZOOM)===ACTION.ZOOM){const dollyX=this.dollyToCursor?(dragStartPosition.x-this._elementRect.x)/this._elementRect.width*2-1:0,dollyY=this.dollyToCursor?(dragStartPosition.y-this._elementRect.y)/this._elementRect.height*-2+1:0,dollyDirection=this.dollyDragInverted?-1:1;(this._state&ACTION.DOLLY)===ACTION.DOLLY?(this._dollyInternal(dollyDirection*deltaY*.125,dollyX,dollyY),this._isUserControllingDolly=!0):(this._zoomInternal(dollyDirection*deltaY*.125,dollyX,dollyY),this._isUserControllingZoom=!0)}if((this._state&ACTION.TOUCH_DOLLY)===ACTION.TOUCH_DOLLY||(this._state&ACTION.TOUCH_ZOOM)===ACTION.TOUCH_ZOOM||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_ZOOM_TRUCK)===ACTION.TOUCH_ZOOM_TRUCK||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)===ACTION.TOUCH_ZOOM_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET||(this._state&ACTION.TOUCH_ZOOM_OFFSET)===ACTION.TOUCH_ZOOM_OFFSET||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE||(this._state&ACTION.TOUCH_ZOOM_ROTATE)===ACTION.TOUCH_ZOOM_ROTATE){const dx=_v2.x-this._activePointers[1].clientX,dy=_v2.y-this._activePointers[1].clientY,distance=Math.sqrt(dx*dx+dy*dy),dollyDelta=dollyStart.y-distance;dollyStart.set(0,distance);const dollyX=this.dollyToCursor?(lastDragPosition.x-this._elementRect.x)/this._elementRect.width*2-1:0,dollyY=this.dollyToCursor?(lastDragPosition.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ACTION.TOUCH_DOLLY)===ACTION.TOUCH_DOLLY||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET?(this._dollyInternal(.125*dollyDelta,dollyX,dollyY),this._isUserControllingDolly=!0):(this._zoomInternal(.125*dollyDelta,dollyX,dollyY),this._isUserControllingZoom=!0)}(this._state&ACTION.TRUCK)!==ACTION.TRUCK&&(this._state&ACTION.TOUCH_TRUCK)!==ACTION.TOUCH_TRUCK&&(this._state&ACTION.TOUCH_DOLLY_TRUCK)!==ACTION.TOUCH_DOLLY_TRUCK&&(this._state&ACTION.TOUCH_ZOOM_TRUCK)!==ACTION.TOUCH_ZOOM_TRUCK||(this._truckInternal(deltaX,deltaY,!1,!1),this._isUserControllingTruck=!0),(this._state&ACTION.SCREEN_PAN)!==ACTION.SCREEN_PAN&&(this._state&ACTION.TOUCH_SCREEN_PAN)!==ACTION.TOUCH_SCREEN_PAN&&(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)!==ACTION.TOUCH_DOLLY_SCREEN_PAN&&(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)!==ACTION.TOUCH_ZOOM_SCREEN_PAN||(this._truckInternal(deltaX,deltaY,!1,!0),this._isUserControllingTruck=!0),(this._state&ACTION.OFFSET)!==ACTION.OFFSET&&(this._state&ACTION.TOUCH_OFFSET)!==ACTION.TOUCH_OFFSET&&(this._state&ACTION.TOUCH_DOLLY_OFFSET)!==ACTION.TOUCH_DOLLY_OFFSET&&(this._state&ACTION.TOUCH_ZOOM_OFFSET)!==ACTION.TOUCH_ZOOM_OFFSET||(this._truckInternal(deltaX,deltaY,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},endDragging=()=>{extractClientCoordFromEvent(this._activePointers,_v2),lastDragPosition.copy(_v2),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",onPointerUp),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",onPointerUp),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",onPointerLockChange),this._domElement.ownerDocument.addEventListener("pointerlockerror",onPointerLockError),this._domElement.ownerDocument.addEventListener("pointermove",onPointerMove,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",onPointerUp),startDragging())},this.unlockPointer=()=>{var _a,_b,_c;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(_a=this._domElement)||void 0===_a||_a.ownerDocument.exitPointerLock(),null===(_b=this._domElement)||void 0===_b||_b.ownerDocument.removeEventListener("pointerlockchange",onPointerLockChange),null===(_c=this._domElement)||void 0===_c||_c.ownerDocument.removeEventListener("pointerlockerror",onPointerLockError),this.cancel()};const onPointerLockChange=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},onPointerLockError=()=>{this.unlockPointer()};this._addAllEventListeners=domElement=>{this._domElement=domElement,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",onPointerDown),this._domElement.addEventListener("pointercancel",onPointerUp),this._domElement.addEventListener("wheel",onMouseWheel,{passive:!1}),this._domElement.addEventListener("contextmenu",onContextMenu)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",onPointerDown),this._domElement.removeEventListener("pointercancel",onPointerUp),this._domElement.removeEventListener("wheel",onMouseWheel,{passive:!1}),this._domElement.removeEventListener("contextmenu",onContextMenu),this._domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",onPointerUp),this._domElement.ownerDocument.removeEventListener("pointerlockchange",onPointerLockChange),this._domElement.ownerDocument.removeEventListener("pointerlockerror",onPointerLockError))},this.cancel=()=>{this._state!==ACTION.NONE&&(this._state=ACTION.NONE,this._activePointers.length=0,endDragging())},domElement&&this.connect(domElement),this.update(0)}get camera(){return this._camera}set camera(camera){this._camera=camera,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(enabled){this._enabled=enabled,this._domElement&&(enabled?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(distance){this._spherical.radius===distance&&this._sphericalEnd.radius===distance||(this._spherical.radius=distance,this._sphericalEnd.radius=distance,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(azimuthAngle){this._spherical.theta===azimuthAngle&&this._sphericalEnd.theta===azimuthAngle||(this._spherical.theta=azimuthAngle,this._sphericalEnd.theta=azimuthAngle,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(polarAngle){this._spherical.phi===polarAngle&&this._sphericalEnd.phi===polarAngle||(this._spherical.phi=polarAngle,this._sphericalEnd.phi=polarAngle,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(boundaryEnclosesCamera){this._boundaryEnclosesCamera=boundaryEnclosesCamera,this._needsUpdate=!0}set interactiveArea(interactiveArea){this._interactiveArea.width=clamp(interactiveArea.width,0,1),this._interactiveArea.height=clamp(interactiveArea.height,0,1),this._interactiveArea.x=clamp(interactiveArea.x,0,1-this._interactiveArea.width),this._interactiveArea.y=clamp(interactiveArea.y,0,1-this._interactiveArea.height)}addEventListener(type,listener){super.addEventListener(type,listener)}removeEventListener(type,listener){super.removeEventListener(type,listener)}rotate(azimuthAngle,polarAngle,enableTransition=!1){return this.rotateTo(this._sphericalEnd.theta+azimuthAngle,this._sphericalEnd.phi+polarAngle,enableTransition)}rotateAzimuthTo(azimuthAngle,enableTransition=!1){return this.rotateTo(azimuthAngle,this._sphericalEnd.phi,enableTransition)}rotatePolarTo(polarAngle,enableTransition=!1){return this.rotateTo(this._sphericalEnd.theta,polarAngle,enableTransition)}rotateTo(azimuthAngle,polarAngle,enableTransition=!1){this._isUserControllingRotate=!1;const theta=clamp(azimuthAngle,this.minAzimuthAngle,this.maxAzimuthAngle),phi=clamp(polarAngle,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=theta,this._sphericalEnd.phi=phi,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,enableTransition||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const resolveImmediately=!enableTransition||approxEquals(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&approxEquals(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}dolly(distance,enableTransition=!1){return this.dollyTo(this._sphericalEnd.radius-distance,enableTransition)}dollyTo(distance,enableTransition=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=DOLLY_DIRECTION_NONE,this._changedDolly=0,this._dollyToNoClamp(clamp(distance,this.minDistance,this.maxDistance),enableTransition)}_dollyToNoClamp(distance,enableTransition=!1){const lastRadius=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const maxDistanceByCollisionTest=this._collisionTest(),isCollided=approxEquals(maxDistanceByCollisionTest,this._spherical.radius);if(!(lastRadius>distance)&&isCollided)return Promise.resolve();this._sphericalEnd.radius=Math.min(distance,maxDistanceByCollisionTest)}else this._sphericalEnd.radius=distance;this._needsUpdate=!0,enableTransition||(this._spherical.radius=this._sphericalEnd.radius);const resolveImmediately=!enableTransition||approxEquals(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}dollyInFixed(distance,enableTransition=!1){this._targetEnd.add(this._getCameraDirection(_cameraDirection).multiplyScalar(distance)),enableTransition||this._target.copy(this._targetEnd);const resolveImmediately=!enableTransition||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}zoom(zoomStep,enableTransition=!1){return this.zoomTo(this._zoomEnd+zoomStep,enableTransition)}zoomTo(zoom,enableTransition=!1){this._isUserControllingZoom=!1,this._zoomEnd=clamp(zoom,this.minZoom,this.maxZoom),this._needsUpdate=!0,enableTransition||(this._zoom=this._zoomEnd);const resolveImmediately=!enableTransition||approxEquals(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(resolveImmediately)}pan(x,y,enableTransition=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(x,y,enableTransition)}truck(x,y,enableTransition=!1){this._camera.updateMatrix(),_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_xColumn.multiplyScalar(x),_yColumn.multiplyScalar(-y);const offset=_v3A.copy(_xColumn).add(_yColumn),to=_v3B.copy(this._targetEnd).add(offset);return this.moveTo(to.x,to.y,to.z,enableTransition)}forward(distance,enableTransition=!1){_v3A.setFromMatrixColumn(this._camera.matrix,0),_v3A.crossVectors(this._camera.up,_v3A),_v3A.multiplyScalar(distance);const to=_v3B.copy(this._targetEnd).add(_v3A);return this.moveTo(to.x,to.y,to.z,enableTransition)}elevate(height,enableTransition=!1){return _v3A.copy(this._camera.up).multiplyScalar(height),this.moveTo(this._targetEnd.x+_v3A.x,this._targetEnd.y+_v3A.y,this._targetEnd.z+_v3A.z,enableTransition)}moveTo(x,y,z,enableTransition=!1){this._isUserControllingTruck=!1;const offset=_v3A.set(x,y,z).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,offset,this.boundaryFriction),this._needsUpdate=!0,enableTransition||this._target.copy(this._targetEnd);const resolveImmediately=!enableTransition||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}lookInDirectionOf(x,y,z,enableTransition=!1){const position=_v3A.set(x,y,z).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(position.x,position.y,position.z,enableTransition)}fitToBox(box3OrObject,enableTransition,{cover=!1,paddingLeft=0,paddingRight=0,paddingBottom=0,paddingTop=0}={}){const promises=[],aabb=box3OrObject.isBox3?_box3A.copy(box3OrObject):_box3A.setFromObject(box3OrObject);aabb.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const theta=roundToStep(this._sphericalEnd.theta,PI_HALF),phi=roundToStep(this._sphericalEnd.phi,PI_HALF);promises.push(this.rotateTo(theta,phi,enableTransition));const normal=_v3A.setFromSpherical(this._sphericalEnd).normalize(),rotation=_quaternionA.setFromUnitVectors(normal,_AXIS_Z),viewFromPolar=approxEquals(Math.abs(normal.y),1);viewFromPolar&&rotation.multiply(_quaternionB.setFromAxisAngle(_AXIS_Y,theta)),rotation.multiply(this._yAxisUpSpaceInverse);const bb=_box3B.makeEmpty();_v3B.copy(aabb.min).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.min).setX(aabb.max.x).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.min).setY(aabb.max.y).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.max).setZ(aabb.min.z).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.min).setZ(aabb.max.z).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.max).setY(aabb.min.y).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.max).setX(aabb.min.x).applyQuaternion(rotation),bb.expandByPoint(_v3B),_v3B.copy(aabb.max).applyQuaternion(rotation),bb.expandByPoint(_v3B),bb.min.x-=paddingLeft,bb.min.y-=paddingBottom,bb.max.x+=paddingRight,bb.max.y+=paddingTop,rotation.setFromUnitVectors(_AXIS_Z,normal),viewFromPolar&&rotation.premultiply(_quaternionB.invert()),rotation.premultiply(this._yAxisUpSpace);const bbSize=bb.getSize(_v3A),center=bb.getCenter(_v3B).applyQuaternion(rotation);if(isPerspectiveCamera(this._camera)){const distance=this.getDistanceToFitBox(bbSize.x,bbSize.y,bbSize.z,cover);promises.push(this.moveTo(center.x,center.y,center.z,enableTransition)),promises.push(this.dollyTo(distance,enableTransition)),promises.push(this.setFocalOffset(0,0,0,enableTransition))}else if(isOrthographicCamera(this._camera)){const camera=this._camera,width=camera.right-camera.left,height=camera.top-camera.bottom,zoom=cover?Math.max(width/bbSize.x,height/bbSize.y):Math.min(width/bbSize.x,height/bbSize.y);promises.push(this.moveTo(center.x,center.y,center.z,enableTransition)),promises.push(this.zoomTo(zoom,enableTransition)),promises.push(this.setFocalOffset(0,0,0,enableTransition))}return Promise.all(promises)}fitToSphere(sphereOrMesh,enableTransition){const promises=[],boundingSphere="isObject3D"in sphereOrMesh?CameraControls.createBoundingSphere(sphereOrMesh,_sphere):_sphere.copy(sphereOrMesh);if(promises.push(this.moveTo(boundingSphere.center.x,boundingSphere.center.y,boundingSphere.center.z,enableTransition)),isPerspectiveCamera(this._camera)){const distanceToFit=this.getDistanceToFitSphere(boundingSphere.radius);promises.push(this.dollyTo(distanceToFit,enableTransition))}else if(isOrthographicCamera(this._camera)){const width=this._camera.right-this._camera.left,height=this._camera.top-this._camera.bottom,diameter=2*boundingSphere.radius,zoom=Math.min(width/diameter,height/diameter);promises.push(this.zoomTo(zoom,enableTransition))}return promises.push(this.setFocalOffset(0,0,0,enableTransition)),Promise.all(promises)}setLookAt(positionX,positionY,positionZ,targetX,targetY,targetZ,enableTransition=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=DOLLY_DIRECTION_NONE,this._changedDolly=0;const target=_v3B.set(targetX,targetY,targetZ),position=_v3A.set(positionX,positionY,positionZ);this._targetEnd.copy(target),this._sphericalEnd.setFromVector3(position.sub(target).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,enableTransition||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const resolveImmediately=!enableTransition||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold)&&approxEquals(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&approxEquals(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&approxEquals(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}lerpLookAt(positionAX,positionAY,positionAZ,targetAX,targetAY,targetAZ,positionBX,positionBY,positionBZ,targetBX,targetBY,targetBZ,t,enableTransition=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=DOLLY_DIRECTION_NONE,this._changedDolly=0;const targetA=_v3A.set(targetAX,targetAY,targetAZ),positionA=_v3B.set(positionAX,positionAY,positionAZ);_sphericalA.setFromVector3(positionA.sub(targetA).applyQuaternion(this._yAxisUpSpace));const targetB=_v3C.set(targetBX,targetBY,targetBZ),positionB=_v3B.set(positionBX,positionBY,positionBZ);_sphericalB.setFromVector3(positionB.sub(targetB).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(targetA.lerp(targetB,t));const deltaTheta=_sphericalB.theta-_sphericalA.theta,deltaPhi=_sphericalB.phi-_sphericalA.phi,deltaRadius=_sphericalB.radius-_sphericalA.radius;this._sphericalEnd.set(_sphericalA.radius+deltaRadius*t,_sphericalA.phi+deltaPhi*t,_sphericalA.theta+deltaTheta*t),this.normalizeRotations(),this._needsUpdate=!0,enableTransition||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const resolveImmediately=!enableTransition||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold)&&approxEquals(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&approxEquals(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&approxEquals(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}setPosition(positionX,positionY,positionZ,enableTransition=!1){return this.setLookAt(positionX,positionY,positionZ,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,enableTransition)}setTarget(targetX,targetY,targetZ,enableTransition=!1){const pos=this.getPosition(_v3A),promise=this.setLookAt(pos.x,pos.y,pos.z,targetX,targetY,targetZ,enableTransition);return this._sphericalEnd.phi=clamp(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),promise}setFocalOffset(x,y,z,enableTransition=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(x,y,z),this._needsUpdate=!0,enableTransition||this._focalOffset.copy(this._focalOffsetEnd);const resolveImmediately=!enableTransition||approxEquals(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&approxEquals(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&approxEquals(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(resolveImmediately)}setOrbitPoint(targetX,targetY,targetZ){this._camera.updateMatrixWorld(),_xColumn.setFromMatrixColumn(this._camera.matrixWorldInverse,0),_yColumn.setFromMatrixColumn(this._camera.matrixWorldInverse,1),_zColumn.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const position=_v3A.set(targetX,targetY,targetZ),distance=position.distanceTo(this._camera.position),cameraToPoint=position.sub(this._camera.position);_xColumn.multiplyScalar(cameraToPoint.x),_yColumn.multiplyScalar(cameraToPoint.y),_zColumn.multiplyScalar(cameraToPoint.z),_v3A.copy(_xColumn).add(_yColumn).add(_zColumn),_v3A.z=_v3A.z+distance,this.dollyTo(distance,!1),this.setFocalOffset(-_v3A.x,_v3A.y,-_v3A.z,!1),this.moveTo(targetX,targetY,targetZ,!1)}setBoundary(box3){if(!box3)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(box3),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(viewportOrX,y,width,height){null!==viewportOrX?(this._viewport=this._viewport||new THREE.Vector4,"number"==typeof viewportOrX?this._viewport.set(viewportOrX,y,width,height):this._viewport.copy(viewportOrX)):this._viewport=null}getDistanceToFitBox(width,height,depth,cover=!1){if(notSupportedInOrthographicCamera(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const boundingRectAspect=width/height,fov=this._camera.getEffectiveFOV()*DEG2RAD,aspect=this._camera.aspect;return.5*((cover?boundingRectAspect>aspect:boundingRectAspect<aspect)?height:width/aspect)/Math.tan(.5*fov)+.5*depth}getDistanceToFitSphere(radius){if(notSupportedInOrthographicCamera(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const vFOV=this._camera.getEffectiveFOV()*DEG2RAD,hFOV=2*Math.atan(Math.tan(.5*vFOV)*this._camera.aspect),fov=1<this._camera.aspect?vFOV:hFOV;return radius/Math.sin(.5*fov)}getTarget(out,receiveEndValue=!0){return(out&&out.isVector3?out:new THREE.Vector3).copy(receiveEndValue?this._targetEnd:this._target)}getPosition(out,receiveEndValue=!0){return(out&&out.isVector3?out:new THREE.Vector3).setFromSpherical(receiveEndValue?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(receiveEndValue?this._targetEnd:this._target)}getSpherical(out,receiveEndValue=!0){return(out||new THREE.Spherical).copy(receiveEndValue?this._sphericalEnd:this._spherical)}getFocalOffset(out,receiveEndValue=!0){return(out&&out.isVector3?out:new THREE.Vector3).copy(receiveEndValue?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%PI_2,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=PI_2),this._spherical.theta+=PI_2*Math.round((this._sphericalEnd.theta-this._spherical.theta)/PI_2)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(enableTransition=!1){if(!approxEquals(this._camera.up.x,this._cameraUp0.x)||!approxEquals(this._camera.up.y,this._cameraUp0.y)||!approxEquals(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const position=this.getPosition(_v3A);this.updateCameraUp(),this.setPosition(position.x,position.y,position.z)}const promises=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,enableTransition),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,enableTransition),this.zoomTo(this._zoom0,enableTransition)];return Promise.all(promises)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,_AXIS_Y),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const cameraDirection=_v3A.subVectors(this._target,this._camera.position).normalize(),side=_v3B.crossVectors(cameraDirection,this._camera.up);this._camera.up.crossVectors(side,cameraDirection).normalize(),this._camera.updateMatrixWorld();const position=this.getPosition(_v3A);this.updateCameraUp(),this.setPosition(position.x,position.y,position.z)}update(delta){const deltaTheta=this._sphericalEnd.theta-this._spherical.theta,deltaPhi=this._sphericalEnd.phi-this._spherical.phi,deltaRadius=this._sphericalEnd.radius-this._spherical.radius,deltaTarget=_deltaTarget.subVectors(this._targetEnd,this._target),deltaOffset=_deltaOffset.subVectors(this._focalOffsetEnd,this._focalOffset),deltaZoom=this._zoomEnd-this._zoom;if(approxZero(deltaTheta))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const smoothTime=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=smoothDamp(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,smoothTime,1/0,delta),this._needsUpdate=!0}if(approxZero(deltaPhi))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const smoothTime=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=smoothDamp(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,smoothTime,1/0,delta),this._needsUpdate=!0}if(approxZero(deltaRadius))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const smoothTime=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=smoothDamp(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,smoothTime,this.maxSpeed,delta),this._needsUpdate=!0}if(approxZero(deltaTarget.x)&&approxZero(deltaTarget.y)&&approxZero(deltaTarget.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const smoothTime=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;smoothDampVec3(this._target,this._targetEnd,this._targetVelocity,smoothTime,this.maxSpeed,delta,this._target),this._needsUpdate=!0}if(approxZero(deltaOffset.x)&&approxZero(deltaOffset.y)&&approxZero(deltaOffset.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const smoothTime=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;smoothDampVec3(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,smoothTime,this.maxSpeed,delta,this._focalOffset),this._needsUpdate=!0}if(approxZero(deltaZoom))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const smoothTime=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=smoothDamp(this._zoom,this._zoomEnd,this._zoomVelocity,smoothTime,1/0,delta)}if(this.dollyToCursor)if(isPerspectiveCamera(this._camera)&&0!==this._changedDolly){const dollyControlAmount=this._spherical.radius-this._lastDistance,camera=this._camera,cameraDirection=this._getCameraDirection(_cameraDirection),planeX=_v3A.copy(cameraDirection).cross(camera.up).normalize();0===planeX.lengthSq()&&(planeX.x=1);const planeY=_v3B.crossVectors(planeX,cameraDirection),worldToScreen=this._sphericalEnd.radius*Math.tan(camera.getEffectiveFOV()*DEG2RAD*.5),lerpRatio=(this._sphericalEnd.radius-dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,cursor=_v3C.copy(this._targetEnd).add(planeX.multiplyScalar(this._dollyControlCoord.x*worldToScreen*camera.aspect)).add(planeY.multiplyScalar(this._dollyControlCoord.y*worldToScreen)),newTargetEnd=_v3A.copy(this._targetEnd).lerp(cursor,lerpRatio),isMin=this._lastDollyDirection===DOLLY_DIRECTION_IN&&this._spherical.radius<=this.minDistance,isMax=this._lastDollyDirection===DOLLY_DIRECTION_OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(isMin||isMax)){this._sphericalEnd.radius-=dollyControlAmount,this._spherical.radius-=dollyControlAmount;const dollyAmount=_v3B.copy(cameraDirection).multiplyScalar(-dollyControlAmount);newTargetEnd.add(dollyAmount)}this._boundary.clampPoint(newTargetEnd,newTargetEnd);const targetEndDiff=_v3B.subVectors(newTargetEnd,this._targetEnd);this._targetEnd.copy(newTargetEnd),this._target.add(targetEndDiff),this._changedDolly-=dollyControlAmount,approxZero(this._changedDolly)&&(this._changedDolly=0)}else if(isOrthographicCamera(this._camera)&&0!==this._changedZoom){const dollyControlAmount=this._zoom-this._lastZoom,camera=this._camera,worldCursorPosition=_v3A.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera),quaternion=_v3B.set(0,0,-1).applyQuaternion(camera.quaternion),cursor=_v3C.copy(worldCursorPosition).add(quaternion.multiplyScalar(-worldCursorPosition.dot(camera.up))),lerpRatio=-(this._zoom-dollyControlAmount-this._zoom)/this._zoom,cameraDirection=this._getCameraDirection(_cameraDirection),prevPlaneConstant=this._targetEnd.dot(cameraDirection),newTargetEnd=_v3A.copy(this._targetEnd).lerp(cursor,lerpRatio),newPlaneConstant=newTargetEnd.dot(cameraDirection),pullBack=cameraDirection.multiplyScalar(newPlaneConstant-prevPlaneConstant);newTargetEnd.sub(pullBack),this._boundary.clampPoint(newTargetEnd,newTargetEnd);const targetEndDiff=_v3B.subVectors(newTargetEnd,this._targetEnd);this._targetEnd.copy(newTargetEnd),this._target.add(targetEndDiff),this._changedZoom-=dollyControlAmount,approxZero(this._changedZoom)&&(this._changedZoom=0)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const maxDistance=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,maxDistance),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);(!approxZero(this._focalOffset.x)||!approxZero(this._focalOffset.y)||!approxZero(this._focalOffset.z))&&(_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_zColumn.setFromMatrixColumn(this._camera.matrix,2),_xColumn.multiplyScalar(this._focalOffset.x),_yColumn.multiplyScalar(-this._focalOffset.y),_zColumn.multiplyScalar(this._focalOffset.z),_v3A.copy(_xColumn).add(_yColumn).add(_zColumn),this._camera.position.add(_v3A),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),_v3A.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const updated=this._needsUpdate;return updated&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):updated?(this.dispatchEvent({type:"update"}),approxZero(deltaTheta,this.restThreshold)&&approxZero(deltaPhi,this.restThreshold)&&approxZero(deltaRadius,this.restThreshold)&&approxZero(deltaTarget.x,this.restThreshold)&&approxZero(deltaTarget.y,this.restThreshold)&&approxZero(deltaTarget.z,this.restThreshold)&&approxZero(deltaOffset.x,this.restThreshold)&&approxZero(deltaOffset.y,this.restThreshold)&&approxZero(deltaOffset.z,this.restThreshold)&&approxZero(deltaZoom,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!updated&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=updated,this._needsUpdate=!1,updated}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:infinityToMaxNumber(this.maxDistance),minZoom:this.minZoom,maxZoom:infinityToMaxNumber(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:infinityToMaxNumber(this.maxPolarAngle),minAzimuthAngle:infinityToMaxNumber(this.minAzimuthAngle),maxAzimuthAngle:infinityToMaxNumber(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:_v3A.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(json,enableTransition=!1){const obj=JSON.parse(json);this.enabled=obj.enabled,this.minDistance=obj.minDistance,this.maxDistance=maxNumberToInfinity(obj.maxDistance),this.minZoom=obj.minZoom,this.maxZoom=maxNumberToInfinity(obj.maxZoom),this.minPolarAngle=obj.minPolarAngle,this.maxPolarAngle=maxNumberToInfinity(obj.maxPolarAngle),this.minAzimuthAngle=maxNumberToInfinity(obj.minAzimuthAngle),this.maxAzimuthAngle=maxNumberToInfinity(obj.maxAzimuthAngle),this.smoothTime=obj.smoothTime,this.draggingSmoothTime=obj.draggingSmoothTime,this.dollySpeed=obj.dollySpeed,this.truckSpeed=obj.truckSpeed,this.dollyToCursor=obj.dollyToCursor,this._target0.fromArray(obj.target0),this._position0.fromArray(obj.position0),this._zoom0=obj.zoom0,this._focalOffset0.fromArray(obj.focalOffset0),this.moveTo(obj.target[0],obj.target[1],obj.target[2],enableTransition),_sphericalA.setFromVector3(_v3A.fromArray(obj.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(_sphericalA.theta,_sphericalA.phi,enableTransition),this.dollyTo(_sphericalA.radius,enableTransition),this.zoomTo(obj.zoom,enableTransition),this.setFocalOffset(obj.focalOffset[0],obj.focalOffset[1],obj.focalOffset[2],enableTransition),this._needsUpdate=!0}connect(domElement){this._domElement?console.warn("camera-controls is already connected."):(domElement.setAttribute("data-camera-controls-version","2.10.0"),this._addAllEventListeners(domElement),this._getClientRect(this._elementRect))}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(out){return out.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(out){return this._getTargetDirection(out).negate()}_findPointerById(pointerId){return this._activePointers.find((activePointer=>activePointer.pointerId===pointerId))}_findPointerByMouseButton(mouseButton){return this._activePointers.find((activePointer=>activePointer.mouseButton===mouseButton))}_disposePointer(pointer){this._activePointers.splice(this._activePointers.indexOf(pointer),1)}_encloseToBoundary(position,offset,friction){const offsetLength2=offset.lengthSq();if(0===offsetLength2)return position;const newTarget=_v3B.copy(offset).add(position),deltaClampedTarget=this._boundary.clampPoint(newTarget,_v3C).sub(newTarget),deltaClampedTargetLength2=deltaClampedTarget.lengthSq();if(0===deltaClampedTargetLength2)return position.add(offset);if(deltaClampedTargetLength2===offsetLength2)return position;if(0===friction)return position.add(offset).add(deltaClampedTarget);{const offsetFactor=1+friction*deltaClampedTargetLength2/offset.dot(deltaClampedTarget);return position.add(_v3B.copy(offset).multiplyScalar(offsetFactor)).add(deltaClampedTarget.multiplyScalar(1-friction))}}_updateNearPlaneCorners(){if(isPerspectiveCamera(this._camera)){const camera=this._camera,near=camera.near,fov=camera.getEffectiveFOV()*DEG2RAD,heightHalf=Math.tan(.5*fov)*near,widthHalf=heightHalf*camera.aspect;this._nearPlaneCorners[0].set(-widthHalf,-heightHalf,0),this._nearPlaneCorners[1].set(widthHalf,-heightHalf,0),this._nearPlaneCorners[2].set(widthHalf,heightHalf,0),this._nearPlaneCorners[3].set(-widthHalf,heightHalf,0)}else if(isOrthographicCamera(this._camera)){const camera=this._camera,zoomInv=1/camera.zoom,left=camera.left*zoomInv,right=camera.right*zoomInv,top=camera.top*zoomInv,bottom=camera.bottom*zoomInv;this._nearPlaneCorners[0].set(left,top,0),this._nearPlaneCorners[1].set(right,top,0),this._nearPlaneCorners[2].set(right,bottom,0),this._nearPlaneCorners[3].set(left,bottom,0)}}_collisionTest(){let distance=1/0;if(!(this.colliderMeshes.length>=1))return distance;if(notSupportedInOrthographicCamera(this._camera,"_collisionTest"))return distance;const rayDirection=this._getTargetDirection(_cameraDirection);_rotationMatrix.lookAt(_ORIGIN,rayDirection,this._camera.up);for(let i=0;i<4;i++){const nearPlaneCorner=_v3B.copy(this._nearPlaneCorners[i]);nearPlaneCorner.applyMatrix4(_rotationMatrix);const origin=_v3C.addVectors(this._target,nearPlaneCorner);_raycaster.set(origin,rayDirection),_raycaster.far=this._spherical.radius+1;const intersects=_raycaster.intersectObjects(this.colliderMeshes);0!==intersects.length&&intersects[0].distance<distance&&(distance=intersects[0].distance)}return distance}_getClientRect(target){if(!this._domElement)return;const rect=this._domElement.getBoundingClientRect();return target.x=rect.left,target.y=rect.top,this._viewport?(target.x+=this._viewport.x,target.y+=rect.height-this._viewport.w-this._viewport.y,target.width=this._viewport.z,target.height=this._viewport.w):(target.width=rect.width,target.height=rect.height),target}_createOnRestPromise(resolveImmediately){return resolveImmediately?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((resolve=>{const onResolve=()=>{this.removeEventListener("rest",onResolve),resolve()};this.addEventListener("rest",onResolve)})))}_addAllEventListeners(_domElement){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(_){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(_){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(object3d,out=new THREE.Sphere){const boundingSphere=out,center=boundingSphere.center;_box3A.makeEmpty(),object3d.traverseVisible((object=>{object.isMesh&&_box3A.expandByObject(object)})),_box3A.getCenter(center);let maxRadiusSq=0;return object3d.traverseVisible((object=>{if(!object.isMesh)return;const mesh=object;if(!mesh.geometry)return;const geometry=mesh.geometry.clone();geometry.applyMatrix4(mesh.matrixWorld);const position=geometry.attributes.position;for(let i=0,l=position.count;i<l;i++)_v3A.fromBufferAttribute(position,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_v3A))})),boundingSphere.radius=Math.sqrt(maxRadiusSq),boundingSphere}}var ngxtension_inject_inputs=__webpack_require__("./node_modules/ngxtension/fesm2022/ngxtension-inject-inputs.mjs"),three_core=__webpack_require__("./node_modules/three/build/three.core.js"),OrbitControls=__webpack_require__("./node_modules/three-stdlib/controls/OrbitControls.js"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs");function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}new three_core.I9Y,new three_core.I9Y;function misc_19a3ec46_esm_clamp(value,min,max){return Math.max(min,Math.min(max,value))}function repeat(t,length){return misc_19a3ec46_esm_clamp(t-Math.floor(t/length)*length,0,length)}function deltaAngle(current,target){var delta=repeat(target-current,2*Math.PI);return delta>Math.PI&&(delta-=2*Math.PI),delta}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Grad=function Grad(x,y,z){var _this=this;_classCallCheck(this,Grad),_defineProperty(this,"dot2",(function(x,y){return _this.x*x+_this.y*y})),_defineProperty(this,"dot3",(function(x,y,z){return _this.x*x+_this.y*y+_this.z*z})),this.x=x,this.y=y,this.z=z},grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)],p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],perm=new Array(512),gradP=new Array(512),seed=function seed(_seed){_seed>0&&_seed<1&&(_seed*=65536),(_seed=Math.floor(_seed))<256&&(_seed|=_seed<<8);for(var i=0;i<256;i++){var v;v=1&i?p[i]^255&_seed:p[i]^_seed>>8&255,perm[i]=perm[i+256]=v,gradP[i]=gradP[i+256]=grad3[v%12]}};seed(0);Math.sqrt(3),Math.sqrt(3),Math.PI;function lcgRandom(seed){var state=function normalizeSeed(seed){if("number"==typeof seed)seed=Math.abs(seed);else if("string"==typeof seed){var string=seed;seed=0;for(var i=0;i<string.length;i++)seed=(seed+(i+1)*(string.charCodeAt(i)%96))%2147483647}return 0===seed&&(seed=311),seed}(seed);return function(){var result=48271*state%2147483647;return state=result,result/2147483647}}var Generator=function Generator(_seed){var _this=this;_classCallCheck(this,Generator),_defineProperty(this,"seed",0),_defineProperty(this,"init",(function(seed){_this.seed=seed,_this.value=lcgRandom(seed)})),_defineProperty(this,"value",lcgRandom(this.seed)),this.init(_seed)};new Generator(Math.random());var exp=function exp(t){return 1/(1+t+.48*t*t+.235*t*t*t)},sine={in:function _in(x){return 1-Math.cos(x*Math.PI/2)},out:function out(x){return Math.sin(x*Math.PI/2)},inOut:function inOut(x){return-(Math.cos(Math.PI*x)-1)/2}},cubic={in:function _in(x){return x*x*x},out:function out(x){return 1-Math.pow(1-x,3)},inOut:function inOut(x){return x<.5?4*x*x*x:1-Math.pow(-2*x+2,3)/2}},quint={in:function _in(x){return x*x*x*x*x},out:function out(x){return 1-Math.pow(1-x,5)},inOut:function inOut(x){return x<.5?16*x*x*x*x*x:1-Math.pow(-2*x+2,5)/2}},circ={in:function _in(x){return 1-Math.sqrt(1-Math.pow(x,2))},out:function out(x){return Math.sqrt(1-Math.pow(x-1,2))},inOut:function inOut(x){return x<.5?(1-Math.sqrt(1-Math.pow(2*x,2)))/2:(Math.sqrt(1-Math.pow(-2*x+2,2))+1)/2}},expo={in:function _in(x){return 0===x?0:Math.pow(2,10*x-10)},out:function out(x){return 1===x?1:1-Math.pow(2,-10*x)},inOut:function inOut(x){return 0===x?0:1===x?1:x<.5?Math.pow(2,20*x-10)/2:(2-Math.pow(2,-20*x+10))/2}};function damp(current,prop,target){var smoothTime=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,delta=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,maxSpeed=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,easing=arguments.length>6&&void 0!==arguments[6]?arguments[6]:exp,eps=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,vel="velocity_"+prop;if(void 0===current.__damp&&(current.__damp={}),void 0===current.__damp[vel]&&(current.__damp[vel]=0),Math.abs(current[prop]-target)<=eps)return current[prop]=target,!1;var omega=2/(smoothTime=Math.max(1e-4,smoothTime)),t=easing(omega*delta),change=current[prop]-target,originalTo=target,maxChange=maxSpeed*smoothTime;change=Math.min(Math.max(change,-maxChange),maxChange),target=current[prop]-change;var temp=(current.__damp[vel]+omega*change)*delta;current.__damp[vel]=(current.__damp[vel]-omega*temp)*t;var output=target+(change+temp)*t;return originalTo-current[prop]>0==output>originalTo&&(output=originalTo,current.__damp[vel]=(output-originalTo)/delta),current[prop]=output,!0}var vl3d=new three_core.Pq0,_q1=new three_core.PTz,_q2=new three_core.PTz,_m1=new three_core.kn4,_position=new three_core.Pq0;function dampAngle(current,prop,target,smoothTime,delta,maxSpeed,easing,eps){return damp(current,prop,current[prop]+deltaAngle(current[prop],target),smoothTime,delta,maxSpeed,easing,eps)}var a2,b2,v2d=new three_core.I9Y;var a3,b3,c3,v3d=new three_core.Pq0;function damp3(current,target,smoothTime,delta,maxSpeed,easing,eps){return"number"==typeof target?v3d.setScalar(target):Array.isArray(target)?v3d.set(target[0],target[1],target[2]):v3d.copy(target),a3=damp(current,"x",v3d.x,smoothTime,delta,maxSpeed,easing,eps),b3=damp(current,"y",v3d.y,smoothTime,delta,maxSpeed,easing,eps),c3=damp(current,"z",v3d.z,smoothTime,delta,maxSpeed,easing,eps),a3||b3||c3}var a4,b4,c4,d4,v4d=new three_core.IUQ;var aE,bE,cE,rot=new three_core.O9p;var aC,bC,cC,col=new three_core.Q1f;var aQ,bQ,cQ,dQ,qt=new three_core.PTz,v4result=new three_core.IUQ,v4velocity=new three_core.IUQ,v4error=new three_core.IUQ;function dampQ(current,target,smoothTime,delta,maxSpeed,easing,eps){var cur=current;Array.isArray(target)?qt.set(target[0],target[1],target[2],target[3]):qt.copy(target);var multi=current.dot(qt)>0?1:-1;return qt.x*=multi,qt.y*=multi,qt.z*=multi,qt.w*=multi,aQ=damp(current,"x",qt.x,smoothTime,delta,maxSpeed,easing,eps),bQ=damp(current,"y",qt.y,smoothTime,delta,maxSpeed,easing,eps),cQ=damp(current,"z",qt.z,smoothTime,delta,maxSpeed,easing,eps),dQ=damp(current,"w",qt.w,smoothTime,delta,maxSpeed,easing,eps),v4result.set(current.x,current.y,current.z,current.w).normalize(),v4velocity.set(cur.__damp.velocity_x,cur.__damp.velocity_y,cur.__damp.velocity_z,cur.__damp.velocity_w),v4error.copy(v4result).multiplyScalar(v4velocity.dot(v4result)/v4result.dot(v4result)),cur.__damp.velocity_x-=v4error.x,cur.__damp.velocity_y-=v4error.y,cur.__damp.velocity_z-=v4error.z,cur.__damp.velocity_w-=v4error.w,current.set(v4result.x,v4result.y,v4result.z,v4result.w),aQ||bQ||cQ||dQ}var aS,bS,cS,spherical=new three_core.YHV;var aM,bM,cM,mat=new three_core.kn4,mPos=new three_core.Pq0,mRot=new three_core.PTz,mSca=new three_core.Pq0;var easing=Object.freeze({__proto__:null,rsqw:function rsqw(t){var delta=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return a/Math.atan(1/delta)*Math.atan(Math.sin(2*Math.PI*t*f)/delta)},exp,linear:function linear(t){return t},sine,cubic,quint,circ,quart:{in:function _in(t){return t*t*t*t},out:function out(t){return 1- --t*t*t*t},inOut:function inOut(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}},expo,damp,dampLookAt:function dampLookAt(current,target,smoothTime,delta,maxSpeed,easing,eps){"number"==typeof target?vl3d.setScalar(target):Array.isArray(target)?vl3d.set(target[0],target[1],target[2]):vl3d.copy(target);var parent=current.parent;current.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(current.matrixWorld),function isCamera(v){return v&&v.isCamera}(current)||function isLight(v){return v&&v.isLight}(current)?_m1.lookAt(_position,vl3d,current.up):_m1.lookAt(vl3d,_position,current.up),dampQ(current.quaternion,_q2.setFromRotationMatrix(_m1),smoothTime,delta,maxSpeed,easing,eps),parent&&(_m1.extractRotation(parent.matrixWorld),_q1.setFromRotationMatrix(_m1),dampQ(current.quaternion,_q2.copy(current.quaternion).premultiply(_q1.invert()),smoothTime,delta,maxSpeed,easing,eps))},dampAngle,damp2:function damp2(current,target,smoothTime,delta,maxSpeed,easing,eps){return"number"==typeof target?v2d.setScalar(target):Array.isArray(target)?v2d.set(target[0],target[1]):v2d.copy(target),a2=damp(current,"x",v2d.x,smoothTime,delta,maxSpeed,easing,eps),b2=damp(current,"y",v2d.y,smoothTime,delta,maxSpeed,easing,eps),a2||b2},damp3,damp4:function damp4(current,target,smoothTime,delta,maxSpeed,easing,eps){return"number"==typeof target?v4d.setScalar(target):Array.isArray(target)?v4d.set(target[0],target[1],target[2],target[3]):v4d.copy(target),a4=damp(current,"x",v4d.x,smoothTime,delta,maxSpeed,easing,eps),b4=damp(current,"y",v4d.y,smoothTime,delta,maxSpeed,easing,eps),c4=damp(current,"z",v4d.z,smoothTime,delta,maxSpeed,easing,eps),d4=damp(current,"w",v4d.w,smoothTime,delta,maxSpeed,easing,eps),a4||b4||c4||d4},dampE:function dampE(current,target,smoothTime,delta,maxSpeed,easing,eps){return Array.isArray(target)?rot.set(target[0],target[1],target[2],target[3]):rot.copy(target),aE=dampAngle(current,"x",rot.x,smoothTime,delta,maxSpeed,easing,eps),bE=dampAngle(current,"y",rot.y,smoothTime,delta,maxSpeed,easing,eps),cE=dampAngle(current,"z",rot.z,smoothTime,delta,maxSpeed,easing,eps),aE||bE||cE},dampC:function dampC(current,target,smoothTime,delta,maxSpeed,easing,eps){return target instanceof three_core.Q1f?col.copy(target):Array.isArray(target)?col.setRGB(target[0],target[1],target[2]):col.set(target),aC=damp(current,"r",col.r,smoothTime,delta,maxSpeed,easing,eps),bC=damp(current,"g",col.g,smoothTime,delta,maxSpeed,easing,eps),cC=damp(current,"b",col.b,smoothTime,delta,maxSpeed,easing,eps),aC||bC||cC},dampQ,dampS:function dampS(current,target,smoothTime,delta,maxSpeed,easing,eps){return Array.isArray(target)?spherical.set(target[0],target[1],target[2]):spherical.copy(target),aS=damp(current,"radius",spherical.radius,smoothTime,delta,maxSpeed,easing,eps),bS=dampAngle(current,"phi",spherical.phi,smoothTime,delta,maxSpeed,easing,eps),cS=dampAngle(current,"theta",spherical.theta,smoothTime,delta,maxSpeed,easing,eps),aS||bS||cS},dampM:function dampM(current,target,smoothTime,delta,maxSpeed,easing,eps){var cur=current;return void 0===cur.__damp&&(cur.__damp={position:new three_core.Pq0,rotation:new three_core.PTz,scale:new three_core.Pq0},current.decompose(cur.__damp.position,cur.__damp.rotation,cur.__damp.scale)),Array.isArray(target)?mat.set.apply(mat,_toConsumableArray(target)):mat.copy(target),mat.decompose(mPos,mRot,mSca),aM=damp3(cur.__damp.position,mPos,smoothTime,delta,maxSpeed,easing,eps),bM=dampQ(cur.__damp.rotation,mRot,smoothTime,delta,maxSpeed,easing,eps),cM=damp3(cur.__damp.scale,mSca,smoothTime,delta,maxSpeed,easing,eps),current.compose(cur.__damp.position,cur.__damp.rotation,cur.__damp.scale),aM||bM||cM}});function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}three_core.LoY;const _c0=["*"],_c1=a0=>[a0];function NgtsCameraControls_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",1),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("parameters",ctx_r0.parameters())}}function NgtsOrbitControls_ngt_primitive_0_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"ngt-primitive",1),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("parameters",ctx_r0.parameters())("enableDamping",ctx_r0.enableDamping())}}const defaultOptions$2={makeDefault:!1,events:!1,regress:!1};class NgtsCameraControls{constructor(){this.options=(0,core.input)(defaultOptions$2,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$2)}),this.parameters=(0,angular_three.cJ)(this.options,["makeDefault","camera","regress","domElement"]),this.changed=(0,core.output)(),this.started=(0,core.output)(),this.ended=(0,core.output)(),this.store=(0,angular_three.ZQ)(),this.invalidate=this.store.select("invalidate"),this.performanceRegress=this.store.select("performance","regress"),this.defaultCamera=this.store.select("camera"),this.glDomElement=this.store.select("gl","domElement"),this.eventsElement=this.store.select("events","connected"),this.camera=(0,angular_three.B4)(this.options,"camera"),this.regress=(0,angular_three.B4)(this.options,"regress"),this.domElement=(0,angular_three.B4)(this.options,"domElement"),this.makeDefault=(0,angular_three.B4)(this.options,"makeDefault"),this.controls=(0,core.computed)((()=>{const[camera,defaultCamera]=[this.camera(),this.defaultCamera()];return new CameraControls(camera||defaultCamera)})),CameraControls.install({THREE:{Box3:three_core.NRn,MathUtils:{clamp:three_core.cj9.clamp},Matrix4:three_core.kn4,Quaternion:three_core.PTz,Raycaster:three_core.tBo,Sphere:three_core.iyt,Spherical:three_core.YHV,Vector2:three_core.I9Y,Vector3:three_core.Pq0,Vector4:three_core.IUQ}}),(0,core.effect)((onCleanup=>{if(!this.makeDefault())return;const controls=this.controls(),oldControls=this.store.snapshot.controls;this.store.update({controls}),onCleanup((()=>{this.store.update({controls:oldControls})}))})),(0,angular_three.bC)((({delta})=>{const controls=this.controls();controls?.enabled&&controls.update(delta)}),{priority:-1}),(0,core.effect)((onCleanup=>{const[domElement,eventsElement,glDomElement,controls]=[this.domElement(),this.eventsElement(),this.glDomElement(),this.controls()];controls.connect(domElement||eventsElement||glDomElement),onCleanup((()=>controls.disconnect()))})),(0,core.effect)((onCleanup=>{const controls=this.controls();if(!controls)return;const[regress,performanceRegress,invalidate]=[this.regress(),this.performanceRegress(),this.invalidate()],callback=e=>{invalidate(),regress&&performanceRegress(),this.changed.emit(e)},startCallback=this.started.emit.bind(this.started),endCallback=this.ended.emit.bind(this.ended);controls.addEventListener("update",callback),controls.addEventListener("controlstart",startCallback),controls.addEventListener("controlend",endCallback),controls.addEventListener("control",callback),controls.addEventListener("transitionstart",callback),controls.addEventListener("wake",callback),onCleanup((()=>{controls.removeEventListener("update",callback),controls.removeEventListener("controlstart",startCallback),controls.removeEventListener("controlend",endCallback),controls.removeEventListener("control",callback),controls.removeEventListener("transitionstart",callback),controls.removeEventListener("wake",callback)}))}))}static{this.ɵfac=function NgtsCameraControls_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsCameraControls)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsCameraControls,selectors:[["ngts-camera-controls"]],inputs:{options:[1,"options"]},outputs:{changed:"changed",started:"started",ended:"ended"},ngContentSelectors:_c0,decls:1,vars:3,consts:[[3,"parameters",4,"args"],[3,"parameters"]],template:function NgtsCameraControls_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsCameraControls_ngt_primitive_0_Template,2,1,"ngt-primitive",0)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,_c1,ctx.controls()))},dependencies:[angular_three.nQ],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsCameraControls,[{type:core.Component,args:[{selector:"ngts-camera-controls",template:'\n\t\t<ngt-primitive *args="[controls()]" [parameters]="parameters()">\n\t\t\t<ng-content />\n\t\t</ngt-primitive>\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA],imports:[angular_three.nQ],changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);const defaultOptions$1={enableDamping:!0,regress:!1,makeDefault:!1,keyEvents:!1};class NgtsOrbitControls{constructor(){this.options=(0,core.input)(defaultOptions$1,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions$1)}),this.parameters=(0,angular_three.cJ)(this.options,["makeDefault","camera","regress","domElement","keyEvents","enableDamping"]),this.changed=(0,core.output)(),this.started=(0,core.output)(),this.ended=(0,core.output)(),this.store=(0,angular_three.ZQ)(),this.invalidate=this.store.select("invalidate"),this.performanceRegress=this.store.select("performance","regress"),this.defaultCamera=this.store.select("camera"),this.glDomElement=this.store.select("gl","domElement"),this.camera=(0,angular_three.B4)(this.options,"camera"),this.regress=(0,angular_three.B4)(this.options,"regress"),this.keyEvents=(0,angular_three.B4)(this.options,"keyEvents"),this.domElement=(0,angular_three.B4)(this.options,"domElement"),this.makeDefault=(0,angular_three.B4)(this.options,"makeDefault"),this.controls=(0,core.computed)((()=>{const[camera,defaultCamera]=[this.camera(),this.defaultCamera()],controlsCamera=camera||defaultCamera;return new OrbitControls.N(controlsCamera)})),this.enableDamping=(0,angular_three.B4)(this.options,"enableDamping"),(0,angular_three.bC)((()=>{const controls=this.controls();controls?.enabled&&controls.update()}),{priority:-1}),(0,core.effect)((onCleanup=>{if(!this.makeDefault())return;const controls=this.controls();if(!controls)return;const oldControls=this.store.get("controls");this.store.update({controls}),onCleanup((()=>{this.store.update({controls:oldControls})}))})),(0,core.effect)((onCleanup=>{const[keyEvents,domElement,controls]=[this.keyEvents(),this.domElement()||this.store.get("events","connected")||this.glDomElement(),this.controls(),this.invalidate(),this.regress()];controls&&(keyEvents?controls.connect(!0===keyEvents?domElement:keyEvents):controls.connect(domElement),onCleanup((()=>{controls.dispose()})))})),(0,core.effect)((onCleanup=>{const controls=this.controls();if(!controls)return;const[invalidate,performanceRegress,regress]=[this.invalidate(),this.performanceRegress(),this.regress()],changeCallback=e=>{invalidate(),regress&&performanceRegress(),this.changed.emit(e)},startCallback=this.started.emit.bind(this.started),endCallback=this.ended.emit.bind(this.ended);controls.addEventListener("change",changeCallback),controls.addEventListener("start",startCallback),controls.addEventListener("end",endCallback),onCleanup((()=>{controls.removeEventListener("change",changeCallback),controls.removeEventListener("start",startCallback),controls.removeEventListener("end",endCallback)}))}))}static{this.ɵfac=function NgtsOrbitControls_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsOrbitControls)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsOrbitControls,selectors:[["ngts-orbit-controls"]],inputs:{options:[1,"options"]},outputs:{changed:"changed",started:"started",ended:"ended"},ngContentSelectors:_c0,decls:1,vars:3,consts:[[3,"parameters","enableDamping",4,"args"],[3,"parameters","enableDamping"]],template:function NgtsOrbitControls_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵtemplate"](0,NgtsOrbitControls_ngt_primitive_0_Template,2,2,"ngt-primitive",0)),2&rf&&core["ɵɵproperty"]("args",core["ɵɵpureFunction1"](1,_c1,ctx.controls()))},dependencies:[angular_three.nQ],encapsulation:2})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsOrbitControls,[{type:core.Component,args:[{selector:"ngts-orbit-controls",template:'\n\t\t<ngt-primitive *args="[controls()]" [parameters]="parameters()" [enableDamping]="enableDamping()">\n\t\t\t<ng-content />\n\t\t</ngt-primitive>\n\t',imports:[angular_three.nQ],schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],(()=>[]),null);const defaultOptions={eps:1e-5,horizontal:!1,infinite:!1,pages:1,distance:1,damping:.25,maxSpeed:1/0,prepend:!1,enabled:!0,style:{}};class NgtsScrollControls{constructor(){this.progress=(0,core.model)(0),this.options=(0,core.input)(defaultOptions,{transform:(0,ngxtension_inject_inputs.sg)(defaultOptions)}),this.document=(0,core.inject)(common.DOCUMENT),this.store=(0,angular_three.ZQ)(),this.gl=this.store.select("gl"),this.events=this.store.select("events"),this.invalidate=this.store.select("invalidate"),this.size=this.store.select("size"),this.domElement=(0,angular_three.B4)(this.gl,"domElement"),this.target=(0,angular_three.B4)(this.domElement,"parentNode"),this._el=this.document.createElement("div"),this._fill=this.document.createElement("div"),this._fixed=this.document.createElement("div"),this.style=(0,angular_three.B4)(this.options,"style"),this.prepend=(0,angular_three.B4)(this.options,"prepend"),this.enabled=(0,angular_three.B4)(this.options,"enabled"),this.infinite=(0,angular_three.B4)(this.options,"infinite"),this.maxSpeed=(0,angular_three.B4)(this.options,"maxSpeed"),this.eps=(0,angular_three.B4)(this.options,"eps"),this.horizontal=(0,angular_three.B4)(this.options,"horizontal"),this.pages=(0,angular_three.B4)(this.options,"pages"),this.distance=(0,angular_three.B4)(this.options,"distance"),this.damping=(0,angular_three.B4)(this.options,"damping"),this.scroll=0,this.offset=0,this.delta=0,(0,core.effect)((onCleanup=>{const target=this.target();if(!target)return;const parent=target,[pages,distance,horizontal,el,fill,fixed,style,prepend,domElement,events]=[this.pages(),this.distance(),this.horizontal(),this.el,this.fill,this.fixed,(0,core.untracked)(this.style),(0,core.untracked)(this.prepend),(0,core.untracked)(this.domElement),(0,core.untracked)(this.events)];el.style.position="absolute",el.style.width="100%",el.style.height="100%",el.style[horizontal?"overflowX":"overflowY"]="auto",el.style[horizontal?"overflowY":"overflowX"]="hidden",el.style.top="0px",el.style.left="0px";for(const key in style)el.style[key]=style[key];fixed.style.position="sticky",fixed.style.top="0px",fixed.style.left="0px",fixed.style.width="100%",fixed.style.height="100%",fixed.style.overflow="hidden",el.appendChild(fixed),fill.style.height=horizontal?"100%":pages*distance*100+"%",fill.style.width=horizontal?pages*distance*100+"%":"100%",fill.style.pointerEvents="none",el.appendChild(fill),prepend?parent.prepend(el):parent.appendChild(el),el[horizontal?"scrollLeft":"scrollTop"]=1;const oldTarget=events.connected||domElement;requestAnimationFrame((()=>events.connect?.(el)));const oldCompute=events.compute?.bind(events);this.store.snapshot.setEvents({compute(event,store){const state=store.snapshot,{left,top}=parent.getBoundingClientRect(),offsetX=event.clientX-left,offsetY=event.clientY-top;state.pointer.set(offsetX/state.size.width*2-1,-offsetY/state.size.height*2+1),state.raycaster.setFromCamera(state.pointer,state.camera)}}),onCleanup((()=>{parent.removeChild(el),this.store.snapshot.setEvents({compute:oldCompute}),events.connect?.(oldTarget)}))})),(0,core.effect)((onCleanup=>{const[el,events]=[this.el,this.events()];if(!events.connected||events.connected!==el)return;const[size,infinite,invalidate,horizontal,enabled]=[this.size(),this.infinite(),this.invalidate(),this.horizontal(),this.enabled()],containerLength=size[horizontal?"width":"height"],scrollLength=el[horizontal?"scrollWidth":"scrollHeight"],scrollThreshold=scrollLength-containerLength;let current=0,disableScroll=!0,firstRun=!0;const onScroll=()=>{if(enabled&&!firstRun){if(invalidate(),current=el[horizontal?"scrollLeft":"scrollTop"],this.scroll=current/scrollThreshold,infinite){if(!disableScroll)if(current>=scrollThreshold){const damp=1-this.offset;el[horizontal?"scrollLeft":"scrollTop"]=1,this.scroll=this.offset=-damp,disableScroll=!0}else if(current<=0){const damp=1+this.offset;el[horizontal?"scrollLeft":"scrollTop"]=scrollLength,this.scroll=this.offset=damp,disableScroll=!0}disableScroll&&setTimeout((()=>disableScroll=!1),40)}this.progress.set(this.scroll)}};el.addEventListener("scroll",onScroll,{passive:!0}),requestAnimationFrame((()=>firstRun=!1));const onWheel=e=>el[horizontal?"scrollLeft":"scrollTop"]+=e.deltaY/2;horizontal&&el.addEventListener("wheel",onWheel,{passive:!0}),onCleanup((()=>{el.removeEventListener("scroll",onScroll),horizontal&&el.removeEventListener("wheel",onWheel)}))}));let last=0;(0,angular_three.bC)((({delta})=>{last=this.offset,easing.damp(this,"offset",this.scroll,this.damping(),delta,this.maxSpeed(),void 0,this.eps()),easing.damp(this,"delta",Math.abs(last-this.offset),this.damping(),delta,this.maxSpeed(),void 0,this.eps()),this.delta>this.eps()&&this.invalidate()()}))}get el(){return this._el}get fill(){return this._fill}get fixed(){return this._fixed}range(from,distance,margin=0){const start=from-margin,end=start+distance+2*margin;return this.offset<start?0:this.offset>end?1:(this.offset-start)/(end-start)}curve(from,distance,margin=0){return Math.sin(this.range(from,distance,margin)*Math.PI)}visible(from,distance,margin=0){const start=from-margin,end=start+distance+2*margin;return this.offset>=start&&this.offset<=end}static{this.ɵfac=function NgtsScrollControls_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsScrollControls)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtsScrollControls,selectors:[["ngts-scroll-controls"]],inputs:{progress:[1,"progress"],options:[1,"options"]},outputs:{progress:"progressChange"},ngContentSelectors:_c0,decls:1,vars:0,template:function NgtsScrollControls_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](),core["ɵɵprojection"](0))},encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsScrollControls,[{type:core.Component,args:[{selector:"ngts-scroll-controls",template:"\n\t\t<ng-content />\n\t",changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);class NgtsScrollCanvas{constructor(){this.host=(0,core.inject)(core.ElementRef),this.scrollControls=(0,core.inject)(NgtsScrollControls),this.store=(0,angular_three.ZQ)(),this.viewport=this.store.select("viewport"),(0,angular_three.bC)((()=>{const group=this.host.nativeElement;group.position.x=this.scrollControls.horizontal()?-this.viewport().width*(this.scrollControls.pages()-1)*this.scrollControls.offset:0,group.position.y=this.scrollControls.horizontal()?0:this.viewport().height*(this.scrollControls.pages()-1)*this.scrollControls.offset}))}static{this.ɵfac=function NgtsScrollCanvas_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsScrollCanvas)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtsScrollCanvas,selectors:[["ngt-group","ngtsScrollCanvas",""]]})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsScrollCanvas,[{type:core.Directive,args:[{selector:"ngt-group[ngtsScrollCanvas]"}]}],(()=>[]),null);class NgtsScrollHtml extends angular_three.tF{constructor(){super(),this.scrollControls=(0,core.inject)(NgtsScrollControls),this.size=this.store.select("size"),(0,angular_three.bC)((()=>{this.scrollControls.delta>this.scrollControls.eps()&&(this.host.nativeElement.style.transform=`translate3d(${this.scrollControls.horizontal()?-this.size().width*(this.scrollControls.pages()-1)*this.scrollControls.offset:0}px,${this.scrollControls.horizontal()?0:this.size().height*(this.scrollControls.pages()-1)*-this.scrollControls.offset}px,0)`)}))}static{this.ɵfac=function NgtsScrollHtml_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtsScrollHtml)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtsScrollHtml,selectors:[["div","ngtsScrollHTML",""]],hostAttrs:[2,"position","absolute","top","0","left","0","will-change","transform"],features:[core["ɵɵProvidersFeature"]([(0,angular_three.zW)([NgtsScrollControls],(scrollControls=>scrollControls.fixed))]),core["ɵɵInheritDefinitionFeature"]]})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtsScrollHtml,[{type:core.Directive,args:[{selector:"div[ngtsScrollHTML]",host:{style:"position: absolute; top: 0; left: 0; will-change: transform;"},providers:[(0,angular_three.zW)([NgtsScrollControls],(scrollControls=>scrollControls.fixed))]}]}],(()=>[]),null)},"./node_modules/angular-three/fesm2022/angular-three.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{nQ:()=>NgtArgs,og:()=>NgtCanvas,tF:()=>NgtHTML,KY:()=>NgtObjectEvents,tz:()=>addAfterEffect,f7:()=>addEffect,FT:()=>applyProps,Zu:()=>checkNeedsUpdate,Ug:()=>checkUpdate,X$:()=>extend,h3:()=>getLocalState,bC:()=>injectBeforeRender,hz:()=>injectLoader,ZQ:()=>injectStore,is:()=>is,cJ:()=>omit,B4:()=>pick,zW:()=>provideHTMLDomElement,qE:()=>resolveRef});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),ngxtension_assert_injector=__webpack_require__("./node_modules/ngxtension/fesm2022/ngxtension-assert-injector.mjs");function createInjectFn(token){return function({injector,...injectOptions}={}){return injector=(0,ngxtension_assert_injector.x)(this,injector),(0,core.runInInjectionContext)(injector,(()=>(0,core.inject)(token,injectOptions)))}}function createProvideFn(token,factory,opts={}){const{deps=[],multi=!1,extraProviders=[],isFunctionValue:isFunctionValueFromOpts=!1}=opts;return(value,isFunctionValue=isFunctionValueFromOpts)=>{let provider;if(void 0!==value){provider={provide:token,useFactory:"function"==typeof value?isFunctionValue?()=>value:value:()=>value,multi}}else provider={provide:token,useFactory:factory,deps,multi};return[extraProviders,provider]}}function createInjectionToken(factory,options){const tokenName=factory.name||factory.toString(),opts=options??{isRoot:!0};if(opts.isRoot??=!0,opts.multi&&(opts.isRoot=!1),opts.isRoot){if(opts.token)throw new Error("createInjectionToken is creating a root InjectionToken but an external token is passed in.\n");const token=new core.InjectionToken(`Token for ${tokenName}`,{factory:()=>opts.deps&&Array.isArray(opts.deps)?factory(...opts.deps.map((dep=>(dep=Array.isArray(dep)?dep.at(-1):dep,(0,core.inject)(dep))))):factory()}),injectFn=createInjectFn(token);return[injectFn,createProvideFn(token,factory,opts),token,()=>({provide:core.ENVIRONMENT_INITIALIZER,useValue:()=>injectFn(),multi:!0})]}const token=opts.token||new core.InjectionToken(`Token for ${tokenName}`);return[createInjectFn(token),createProvideFn(token,factory,opts),token,()=>[]]}var ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),pipe=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/pipe.js"),debounceTime=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),fromEvent=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),share=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/share.js");const defaultResizeOptions={box:"content-box",scroll:!1,offsetSize:!1,debounce:{scroll:50,resize:0},emitInZone:!0,emitInitialResult:!1},[injectResizeOptions,provideResizeOptions,NGX_RESIZE_OPTIONS]=createInjectionToken((()=>defaultResizeOptions));class NgxResize{constructor(){this.ngxResizeOptions={},this.ngxResize=new core.EventEmitter,this.host=(0,core.inject)(core.ElementRef),this.zone=(0,core.inject)(core.NgZone),this.document=(0,core.inject)(common.DOCUMENT),this.resizeOptions=injectResizeOptions(),this.destroyRef=(0,core.inject)(core.DestroyRef)}ngOnInit(){createResizeStream({...this.resizeOptions,...this.ngxResizeOptions},this.host.nativeElement,this.document,this.zone).pipe((0,rxjs_interop.pQ)(this.destroyRef)).subscribe(this.ngxResize)}static{this.ɵfac=function NgxResize_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgxResize)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgxResize,selectors:[["","ngxResize",""]],inputs:{ngxResizeOptions:"ngxResizeOptions"},outputs:{ngxResize:"ngxResize"}})}}function createResizeStream({debounce,scroll,offsetSize,box,emitInZone,emitInitialResult},nativeElement,document,zone){const window=document.defaultView,screen=window?.screen,isSupport=!!window?.ResizeObserver;let observer,lastBounds,lastEntries=[];const torndown$=new ReplaySubject.m,scrollContainers=findScrollContainers(nativeElement,window,document.body),scrollDebounce=debounce?"number"==typeof debounce?debounce:debounce.scroll:null,resizeDebounce=debounce?"number"==typeof debounce?debounce:debounce.resize:null,debounceAndTorndown=debounce=>(0,pipe.F)((0,debounceTime.B)(debounce??0),(0,takeUntil.Q)(torndown$));return new Observable.c((subscriber=>{if(isSupport)return zone.runOutsideAngular((()=>{if(emitInitialResult){const[result]=calculateResult(nativeElement,window,offsetSize,[]);emitInZone?zone.run((()=>{subscriber.next(result)})):subscriber.next(result)}const callback=entries=>{lastEntries=entries;const[result,size]=calculateResult(nativeElement,window,offsetSize,entries);emitInZone?zone.run((()=>{subscriber.next(result)})):subscriber.next(result),areBoundsEqual(lastBounds||{},size)||(lastBounds=size)},boundCallback=()=>{callback(lastEntries)};observer=new ResizeObserver(callback),observer.observe(nativeElement,{box}),scroll&&(scrollContainers&&scrollContainers.forEach((scrollContainer=>{(0,fromEvent.R)(scrollContainer,"scroll",{capture:!0,passive:!0}).pipe(debounceAndTorndown(scrollDebounce)).subscribe(boundCallback)})),(0,fromEvent.R)(window,"scroll",{capture:!0,passive:!0}).pipe(debounceAndTorndown(scrollDebounce)).subscribe(boundCallback)),(0,fromEvent.R)(window,"resize").pipe(debounceAndTorndown(resizeDebounce)).subscribe(boundCallback),screen&&"orientation"in screen&&"addEventListener"in screen.orientation?(0,fromEvent.R)(screen.orientation,"change").pipe(debounceAndTorndown(scrollDebounce)).subscribe(boundCallback):window&&"orientationchange"in window&&(0,fromEvent.R)(window,"orientationchange").pipe(debounceAndTorndown(scrollDebounce)).subscribe(boundCallback)})),()=>{observer&&(observer.unobserve(nativeElement),observer.disconnect()),torndown$.next(),torndown$.complete()};subscriber.error("[ngx-resize] your browser does not support ResizeObserver. Please consider using a polyfill")})).pipe((0,debounceTime.B)(scrollDebounce??0),(0,share.u)({connector:()=>new ReplaySubject.m(1)}))}function calculateResult(nativeElement,window,offsetSize,entries){const{left,top,width,height,bottom,right,x,y}=nativeElement.getBoundingClientRect(),size={left,top,width,height,bottom,right,x,y};return nativeElement instanceof HTMLElement&&offsetSize&&(size.height=nativeElement.offsetHeight,size.width=nativeElement.offsetWidth),Object.freeze(size),[{entries,dpr:window.devicePixelRatio,...size},size]}function findScrollContainers(element,window,documentBody){const result=[];if(!element||!window||element===documentBody)return result;const{overflow,overflowX,overflowY}=window.getComputedStyle(element);return[overflow,overflowX,overflowY].some((prop=>"auto"===prop||"scroll"===prop))&&result.push(element),[...result,...findScrollContainers(element.parentElement,window,documentBody)]}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgxResize,[{type:core.Directive,args:[{selector:"[ngxResize]",standalone:!0}]}],null,{ngxResizeOptions:[{type:core.Input}],ngxResize:[{type:core.Output}]});const keys=["x","y","top","bottom","left","right","width","height"],areBoundsEqual=(a,b)=>keys.every((key=>a[key]===b[key]));var three_core=__webpack_require__("./node_modules/three/build/three.core.js"),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),isObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isObservable.js"),from=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/from.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),BehaviorSubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),EmptyError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/EmptyError.js"),concat=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/concat.js"),innerFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js");function defer(observableFactory){return new Observable.c((function(subscriber){(0,innerFrom.Tg)(observableFactory()).subscribe(subscriber)}))}var isFunction=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isFunction.js");function throwError_throwError(errorOrErrorFactory,scheduler){var errorFactory=(0,isFunction.T)(errorOrErrorFactory)?errorOrErrorFactory:function(){return errorOrErrorFactory},init=function(subscriber){return subscriber.error(errorFactory())};return new Observable.c(scheduler?function(subscriber){return scheduler.schedule(init,0,subscriber)}:init)}var empty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js"),ConnectableObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/ConnectableObservable.js"),Subscription=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),startWith=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/startWith.js"),mergeMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),lift=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),OperatorSubscriber=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js");function defaultIfEmpty(defaultValue){return(0,lift.N)((function(source,subscriber){var hasValue=!1;source.subscribe((0,OperatorSubscriber._)(subscriber,(function(value){hasValue=!0,subscriber.next(value)}),(function(){hasValue||subscriber.next(defaultValue),subscriber.complete()})))}))}function throwIfEmpty(errorFactory){return void 0===errorFactory&&(errorFactory=defaultErrorFactory),(0,lift.N)((function(source,subscriber){var hasValue=!1;source.subscribe((0,OperatorSubscriber._)(subscriber,(function(value){hasValue=!0,subscriber.next(value)}),(function(){return hasValue?subscriber.complete():subscriber.error(errorFactory())})))}))}function defaultErrorFactory(){return new EmptyError.G}var identity=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js");function first(predicate,defaultValue){var hasDefaultValue=arguments.length>=2;return function(source){return source.pipe(predicate?(0,filter.p)((function(v,i){return predicate(v,i,source)})):identity.D,(0,take.s)(1),hasDefaultValue?defaultIfEmpty(defaultValue):throwIfEmpty((function(){return new EmptyError.G})))}}var concatMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/concatMap.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js");function scan(accumulator,seed){return(0,lift.N)(function scanInternals(accumulator,seed,hasSeed,emitOnNext,emitBeforeComplete){return function(source,subscriber){var hasState=hasSeed,state=seed,index=0;source.subscribe((0,OperatorSubscriber._)(subscriber,(function(value){var i=index++;state=hasState?accumulator(state,value,i):(hasState=!0,value),emitOnNext&&subscriber.next(state)}),emitBeforeComplete&&function(){hasState&&subscriber.next(state),subscriber.complete()}))}}(accumulator,seed,arguments.length>=2,!0))}var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");function takeLast(count){return count<=0?function(){return empty.w}:(0,lift.N)((function(source,subscriber){var buffer=[];source.subscribe((0,OperatorSubscriber._)(subscriber,(function(value){buffer.push(value),count<buffer.length&&buffer.shift()}),(function(){var e_1,_a;try{for(var buffer_1=(0,tslib_es6.Ju)(buffer),buffer_1_1=buffer_1.next();!buffer_1_1.done;buffer_1_1=buffer_1.next()){var value=buffer_1_1.value;subscriber.next(value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{buffer_1_1&&!buffer_1_1.done&&(_a=buffer_1.return)&&_a.call(buffer_1)}finally{if(e_1)throw e_1.error}}subscriber.complete()}),void 0,(function(){buffer=null})))}))}var finalize=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/finalize.js"),refCount=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/refCount.js"),mergeAll=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js"),platform_browser=__webpack_require__("./node_modules/@angular/platform-browser/fesm2022/platform-browser.mjs");const PRIMARY_OUTLET="primary",RouteTitleKey=Symbol("RouteTitle");class ParamsAsMap{params;constructor(params){this.params=params||{}}has(name){return Object.prototype.hasOwnProperty.call(this.params,name)}get(name){if(this.has(name)){const v=this.params[name];return Array.isArray(v)?v[0]:v}return null}getAll(name){if(this.has(name)){const v=this.params[name];return Array.isArray(v)?v:[v]}return[]}get keys(){return Object.keys(this.params)}}function convertToParamMap(params){return new ParamsAsMap(params)}function defaultUrlMatcher(segments,segmentGroup,route){const parts=route.path.split("/");if(parts.length>segments.length)return null;if("full"===route.pathMatch&&(segmentGroup.hasChildren()||parts.length<segments.length))return null;const posParams={};for(let index=0;index<parts.length;index++){const part=parts[index],segment=segments[index];if(":"===part[0])posParams[part.substring(1)]=segment;else if(part!==segment.path)return null}return{consumed:segments.slice(0,parts.length),posParams}}function shallowEqual(a,b){const k1=a?getDataKeys(a):void 0,k2=b?getDataKeys(b):void 0;if(!k1||!k2||k1.length!=k2.length)return!1;let key;for(let i=0;i<k1.length;i++)if(key=k1[i],!equalArraysOrString(a[key],b[key]))return!1;return!0}function getDataKeys(obj){return[...Object.keys(obj),...Object.getOwnPropertySymbols(obj)]}function equalArraysOrString(a,b){if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;const aSorted=[...a].sort(),bSorted=[...b].sort();return aSorted.every(((val,index)=>bSorted[index]===val))}return a===b}function router_last(a){return a.length>0?a[a.length-1]:null}function wrapIntoObservable(value){return(0,isObservable.A)(value)?value:(0,core["ɵisPromise"])(value)?(0,from.H)(Promise.resolve(value)):(0,of.of)(value)}const pathCompareMap={exact:function equalSegmentGroups(container,containee,matrixParams){if(!equalPath(container.segments,containee.segments))return!1;if(!matrixParamsMatch(container.segments,containee.segments,matrixParams))return!1;if(container.numberOfChildren!==containee.numberOfChildren)return!1;for(const c in containee.children){if(!container.children[c])return!1;if(!equalSegmentGroups(container.children[c],containee.children[c],matrixParams))return!1}return!0},subset:containsSegmentGroup},paramCompareMap={exact:function equalParams(container,containee){return shallowEqual(container,containee)},subset:function containsParams(container,containee){return Object.keys(containee).length<=Object.keys(container).length&&Object.keys(containee).every((key=>equalArraysOrString(container[key],containee[key])))},ignored:()=>!0};function containsTree(container,containee,options){return pathCompareMap[options.paths](container.root,containee.root,options.matrixParams)&&paramCompareMap[options.queryParams](container.queryParams,containee.queryParams)&&!("exact"===options.fragment&&container.fragment!==containee.fragment)}function containsSegmentGroup(container,containee,matrixParams){return containsSegmentGroupHelper(container,containee,containee.segments,matrixParams)}function containsSegmentGroupHelper(container,containee,containeePaths,matrixParams){if(container.segments.length>containeePaths.length){const current=container.segments.slice(0,containeePaths.length);return!!equalPath(current,containeePaths)&&(!containee.hasChildren()&&!!matrixParamsMatch(current,containeePaths,matrixParams))}if(container.segments.length===containeePaths.length){if(!equalPath(container.segments,containeePaths))return!1;if(!matrixParamsMatch(container.segments,containeePaths,matrixParams))return!1;for(const c in containee.children){if(!container.children[c])return!1;if(!containsSegmentGroup(container.children[c],containee.children[c],matrixParams))return!1}return!0}{const current=containeePaths.slice(0,container.segments.length),next=containeePaths.slice(container.segments.length);return!!equalPath(container.segments,current)&&(!!matrixParamsMatch(container.segments,current,matrixParams)&&(!!container.children.primary&&containsSegmentGroupHelper(container.children.primary,containee,next,matrixParams)))}}function matrixParamsMatch(containerPaths,containeePaths,options){return containeePaths.every(((containeeSegment,i)=>paramCompareMap[options](containerPaths[i].parameters,containeeSegment.parameters)))}class UrlTree{root;queryParams;fragment;_queryParamMap;constructor(root=new UrlSegmentGroup([],{}),queryParams={},fragment=null){if(this.root=root,this.queryParams=queryParams,this.fragment=fragment,("undefined"==typeof ngDevMode||ngDevMode)&&root.segments.length>0)throw new core["ɵRuntimeError"](4015,"The root `UrlSegmentGroup` should not contain `segments`. Instead, these segments belong in the `children` so they can be associated with a named outlet.")}get queryParamMap(){return this._queryParamMap??=convertToParamMap(this.queryParams),this._queryParamMap}toString(){return DEFAULT_SERIALIZER.serialize(this)}}class UrlSegmentGroup{segments;children;parent=null;constructor(segments,children){this.segments=segments,this.children=children,Object.values(children).forEach((v=>v.parent=this))}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return serializePaths(this)}}class UrlSegment{path;parameters;_parameterMap;constructor(path,parameters){this.path=path,this.parameters=parameters}get parameterMap(){return this._parameterMap??=convertToParamMap(this.parameters),this._parameterMap}toString(){return serializePath(this)}}function equalPath(as,bs){return as.length===bs.length&&as.every(((a,i)=>a.path===bs[i].path))}class UrlSerializer{static ɵfac=function UrlSerializer_Factory(__ngFactoryType__){return new(__ngFactoryType__||UrlSerializer)};static ɵprov=core["ɵɵdefineInjectable"]({token:UrlSerializer,factory:()=>new DefaultUrlSerializer,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](UrlSerializer,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>new DefaultUrlSerializer}]}],null,null);class DefaultUrlSerializer{parse(url){const p=new UrlParser(url);return new UrlTree(p.parseRootSegment(),p.parseQueryParams(),p.parseFragment())}serialize(tree){return`${`/${serializeSegment(tree.root,!0)}`}${function serializeQueryParams(params){const strParams=Object.entries(params).map((([name,value])=>Array.isArray(value)?value.map((v=>`${encodeUriQuery(name)}=${encodeUriQuery(v)}`)).join("&"):`${encodeUriQuery(name)}=${encodeUriQuery(value)}`)).filter((s=>s));return strParams.length?`?${strParams.join("&")}`:""}(tree.queryParams)}${"string"==typeof tree.fragment?`#${function encodeUriFragment(s){return encodeURI(s)}(tree.fragment)}`:""}`}}const DEFAULT_SERIALIZER=new DefaultUrlSerializer;function serializePaths(segment){return segment.segments.map((p=>serializePath(p))).join("/")}function serializeSegment(segment,root){if(!segment.hasChildren())return serializePaths(segment);if(root){const primary=segment.children.primary?serializeSegment(segment.children.primary,!1):"",children=[];return Object.entries(segment.children).forEach((([k,v])=>{"primary"!==k&&children.push(`${k}:${serializeSegment(v,!1)}`)})),children.length>0?`${primary}(${children.join("//")})`:primary}{const children=function mapChildrenIntoArray(segment,fn){let res=[];return Object.entries(segment.children).forEach((([childOutlet,child])=>{"primary"===childOutlet&&(res=res.concat(fn(child,childOutlet)))})),Object.entries(segment.children).forEach((([childOutlet,child])=>{"primary"!==childOutlet&&(res=res.concat(fn(child,childOutlet)))})),res}(segment,((v,k)=>"primary"===k?[serializeSegment(segment.children.primary,!1)]:[`${k}:${serializeSegment(v,!1)}`]));return 1===Object.keys(segment.children).length&&null!=segment.children.primary?`${serializePaths(segment)}/${children[0]}`:`${serializePaths(segment)}/(${children.join("//")})`}}function encodeUriString(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function encodeUriQuery(s){return encodeUriString(s).replace(/%3B/gi,";")}function encodeUriSegment(s){return encodeUriString(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function decode(s){return decodeURIComponent(s)}function decodeQuery(s){return decode(s.replace(/\+/g,"%20"))}function serializePath(path){return`${encodeUriSegment(path.path)}${function serializeMatrixParams(params){return Object.entries(params).map((([key,value])=>`;${encodeUriSegment(key)}=${encodeUriSegment(value)}`)).join("")}(path.parameters)}`}const SEGMENT_RE=/^[^\/()?;#]+/;function matchSegments(str){const match=str.match(SEGMENT_RE);return match?match[0]:""}const MATRIX_PARAM_SEGMENT_RE=/^[^\/()?;=#]+/;const QUERY_PARAM_RE=/^[^=?&#]+/;const QUERY_PARAM_VALUE_RE=/^[^&#]+/;class UrlParser{url;remaining;constructor(url){this.url=url,this.remaining=url}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new UrlSegmentGroup([],{}):new UrlSegmentGroup([],this.parseChildren())}parseQueryParams(){const params={};if(this.consumeOptional("?"))do{this.parseQueryParam(params)}while(this.consumeOptional("&"));return params}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const segments=[];for(this.peekStartsWith("(")||segments.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),segments.push(this.parseSegment());let children={};this.peekStartsWith("/(")&&(this.capture("/"),children=this.parseParens(!0));let res={};return this.peekStartsWith("(")&&(res=this.parseParens(!1)),(segments.length>0||Object.keys(children).length>0)&&(res.primary=new UrlSegmentGroup(segments,children)),res}parseSegment(){const path=matchSegments(this.remaining);if(""===path&&this.peekStartsWith(";"))throw new core["ɵRuntimeError"](4009,("undefined"==typeof ngDevMode||ngDevMode)&&`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(path),new UrlSegment(decode(path),this.parseMatrixParams())}parseMatrixParams(){const params={};for(;this.consumeOptional(";");)this.parseParam(params);return params}parseParam(params){const key=function matchMatrixKeySegments(str){const match=str.match(MATRIX_PARAM_SEGMENT_RE);return match?match[0]:""}(this.remaining);if(!key)return;this.capture(key);let value="";if(this.consumeOptional("=")){const valueMatch=matchSegments(this.remaining);valueMatch&&(value=valueMatch,this.capture(value))}params[decode(key)]=decode(value)}parseQueryParam(params){const key=function matchQueryParams(str){const match=str.match(QUERY_PARAM_RE);return match?match[0]:""}(this.remaining);if(!key)return;this.capture(key);let value="";if(this.consumeOptional("=")){const valueMatch=function matchUrlQueryParamValue(str){const match=str.match(QUERY_PARAM_VALUE_RE);return match?match[0]:""}(this.remaining);valueMatch&&(value=valueMatch,this.capture(value))}const decodedKey=decodeQuery(key),decodedVal=decodeQuery(value);if(params.hasOwnProperty(decodedKey)){let currentVal=params[decodedKey];Array.isArray(currentVal)||(currentVal=[currentVal],params[decodedKey]=currentVal),currentVal.push(decodedVal)}else params[decodedKey]=decodedVal}parseParens(allowPrimary){const segments={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const path=matchSegments(this.remaining),next=this.remaining[path.length];if("/"!==next&&")"!==next&&";"!==next)throw new core["ɵRuntimeError"](4010,("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot parse url '${this.url}'`);let outletName;path.indexOf(":")>-1?(outletName=path.slice(0,path.indexOf(":")),this.capture(outletName),this.capture(":")):allowPrimary&&(outletName="primary");const children=this.parseChildren();segments[outletName]=1===Object.keys(children).length?children.primary:new UrlSegmentGroup([],children),this.consumeOptional("//")}return segments}peekStartsWith(str){return this.remaining.startsWith(str)}consumeOptional(str){return!!this.peekStartsWith(str)&&(this.remaining=this.remaining.substring(str.length),!0)}capture(str){if(!this.consumeOptional(str))throw new core["ɵRuntimeError"](4011,("undefined"==typeof ngDevMode||ngDevMode)&&`Expected "${str}".`)}}function createRoot(rootCandidate){return rootCandidate.segments.length>0?new UrlSegmentGroup([],{[PRIMARY_OUTLET]:rootCandidate}):rootCandidate}function squashSegmentGroup(segmentGroup){const newChildren={};for(const[childOutlet,child]of Object.entries(segmentGroup.children)){const childCandidate=squashSegmentGroup(child);if("primary"===childOutlet&&0===childCandidate.segments.length&&childCandidate.hasChildren())for(const[grandChildOutlet,grandChild]of Object.entries(childCandidate.children))newChildren[grandChildOutlet]=grandChild;else(childCandidate.segments.length>0||childCandidate.hasChildren())&&(newChildren[childOutlet]=childCandidate)}return function mergeTrivialChildren(s){if(1===s.numberOfChildren&&s.children.primary){const c=s.children.primary;return new UrlSegmentGroup(s.segments.concat(c.segments),c.children)}return s}(new UrlSegmentGroup(segmentGroup.segments,newChildren))}function isUrlTree(v){return v instanceof UrlTree}function createSegmentGroupFromRoute(route){let targetGroup;const rootCandidate=function createSegmentGroupFromRouteRecursive(currentRoute){const childOutlets={};for(const childSnapshot of currentRoute.children){const root=createSegmentGroupFromRouteRecursive(childSnapshot);childOutlets[childSnapshot.outlet]=root}const segmentGroup=new UrlSegmentGroup(currentRoute.url,childOutlets);return currentRoute===route&&(targetGroup=segmentGroup),segmentGroup}(route.root),rootSegmentGroup=createRoot(rootCandidate);return targetGroup??rootSegmentGroup}function createUrlTreeFromSegmentGroup(relativeTo,commands,queryParams,fragment){let root=relativeTo;for(;root.parent;)root=root.parent;if(0===commands.length)return tree(root,root,root,queryParams,fragment);const nav=function computeNavigation(commands){if("string"==typeof commands[0]&&1===commands.length&&"/"===commands[0])return new Navigation(!0,0,commands);let numberOfDoubleDots=0,isAbsolute=!1;const res=commands.reduce(((res,cmd,cmdIdx)=>{if("object"==typeof cmd&&null!=cmd){if(cmd.outlets){const outlets={};return Object.entries(cmd.outlets).forEach((([name,commands])=>{outlets[name]="string"==typeof commands?commands.split("/"):commands})),[...res,{outlets}]}if(cmd.segmentPath)return[...res,cmd.segmentPath]}return"string"!=typeof cmd?[...res,cmd]:0===cmdIdx?(cmd.split("/").forEach(((urlPart,partIndex)=>{0==partIndex&&"."===urlPart||(0==partIndex&&""===urlPart?isAbsolute=!0:".."===urlPart?numberOfDoubleDots++:""!=urlPart&&res.push(urlPart))})),res):[...res,cmd]}),[]);return new Navigation(isAbsolute,numberOfDoubleDots,res)}(commands);if(nav.toRoot())return tree(root,root,new UrlSegmentGroup([],{}),queryParams,fragment);const position=function findStartingPositionForTargetGroup(nav,root,target){if(nav.isAbsolute)return new Position(root,!0,0);if(!target)return new Position(root,!1,NaN);if(null===target.parent)return new Position(target,!0,0);const modifier=isMatrixParams(nav.commands[0])?0:1,index=target.segments.length-1+modifier;return function createPositionApplyingDoubleDots(group,index,numberOfDoubleDots){let g=group,ci=index,dd=numberOfDoubleDots;for(;dd>ci;){if(dd-=ci,g=g.parent,!g)throw new core["ɵRuntimeError"](4005,("undefined"==typeof ngDevMode||ngDevMode)&&"Invalid number of '../'");ci=g.segments.length}return new Position(g,!1,ci-dd)}(target,index,nav.numberOfDoubleDots)}(nav,root,relativeTo),newSegmentGroup=position.processChildren?updateSegmentGroupChildren(position.segmentGroup,position.index,nav.commands):updateSegmentGroup(position.segmentGroup,position.index,nav.commands);return tree(root,position.segmentGroup,newSegmentGroup,queryParams,fragment)}function isMatrixParams(command){return"object"==typeof command&&null!=command&&!command.outlets&&!command.segmentPath}function isCommandWithOutlets(command){return"object"==typeof command&&null!=command&&command.outlets}function tree(oldRoot,oldSegmentGroup,newSegmentGroup,queryParams,fragment){let rootCandidate,qp={};queryParams&&Object.entries(queryParams).forEach((([name,value])=>{qp[name]=Array.isArray(value)?value.map((v=>`${v}`)):`${value}`})),rootCandidate=oldRoot===oldSegmentGroup?newSegmentGroup:replaceSegment(oldRoot,oldSegmentGroup,newSegmentGroup);const newRoot=createRoot(squashSegmentGroup(rootCandidate));return new UrlTree(newRoot,qp,fragment)}function replaceSegment(current,oldSegment,newSegment){const children={};return Object.entries(current.children).forEach((([outletName,c])=>{children[outletName]=c===oldSegment?newSegment:replaceSegment(c,oldSegment,newSegment)})),new UrlSegmentGroup(current.segments,children)}class Navigation{isAbsolute;numberOfDoubleDots;commands;constructor(isAbsolute,numberOfDoubleDots,commands){if(this.isAbsolute=isAbsolute,this.numberOfDoubleDots=numberOfDoubleDots,this.commands=commands,isAbsolute&&commands.length>0&&isMatrixParams(commands[0]))throw new core["ɵRuntimeError"](4003,("undefined"==typeof ngDevMode||ngDevMode)&&"Root segment cannot have matrix parameters");const cmdWithOutlet=commands.find(isCommandWithOutlets);if(cmdWithOutlet&&cmdWithOutlet!==router_last(commands))throw new core["ɵRuntimeError"](4004,("undefined"==typeof ngDevMode||ngDevMode)&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Position{segmentGroup;processChildren;index;constructor(segmentGroup,processChildren,index){this.segmentGroup=segmentGroup,this.processChildren=processChildren,this.index=index}}function updateSegmentGroup(segmentGroup,startIndex,commands){if(segmentGroup??=new UrlSegmentGroup([],{}),0===segmentGroup.segments.length&&segmentGroup.hasChildren())return updateSegmentGroupChildren(segmentGroup,startIndex,commands);const m=function prefixedWith(segmentGroup,startIndex,commands){let currentCommandIndex=0,currentPathIndex=startIndex;const noMatch={match:!1,pathIndex:0,commandIndex:0};for(;currentPathIndex<segmentGroup.segments.length;){if(currentCommandIndex>=commands.length)return noMatch;const path=segmentGroup.segments[currentPathIndex],command=commands[currentCommandIndex];if(isCommandWithOutlets(command))break;const curr=`${command}`,next=currentCommandIndex<commands.length-1?commands[currentCommandIndex+1]:null;if(currentPathIndex>0&&void 0===curr)break;if(curr&&next&&"object"==typeof next&&void 0===next.outlets){if(!compare(curr,next,path))return noMatch;currentCommandIndex+=2}else{if(!compare(curr,{},path))return noMatch;currentCommandIndex++}currentPathIndex++}return{match:!0,pathIndex:currentPathIndex,commandIndex:currentCommandIndex}}(segmentGroup,startIndex,commands),slicedCommands=commands.slice(m.commandIndex);if(m.match&&m.pathIndex<segmentGroup.segments.length){const g=new UrlSegmentGroup(segmentGroup.segments.slice(0,m.pathIndex),{});return g.children.primary=new UrlSegmentGroup(segmentGroup.segments.slice(m.pathIndex),segmentGroup.children),updateSegmentGroupChildren(g,0,slicedCommands)}return m.match&&0===slicedCommands.length?new UrlSegmentGroup(segmentGroup.segments,{}):m.match&&!segmentGroup.hasChildren()?createNewSegmentGroup(segmentGroup,startIndex,commands):m.match?updateSegmentGroupChildren(segmentGroup,0,slicedCommands):createNewSegmentGroup(segmentGroup,startIndex,commands)}function updateSegmentGroupChildren(segmentGroup,startIndex,commands){if(0===commands.length)return new UrlSegmentGroup(segmentGroup.segments,{});{const outlets=function getOutlets(commands){return isCommandWithOutlets(commands[0])?commands[0].outlets:{[PRIMARY_OUTLET]:commands}}(commands),children={};if(Object.keys(outlets).some((o=>"primary"!==o))&&segmentGroup.children.primary&&1===segmentGroup.numberOfChildren&&0===segmentGroup.children.primary.segments.length){const childrenOfEmptyChild=updateSegmentGroupChildren(segmentGroup.children.primary,startIndex,commands);return new UrlSegmentGroup(segmentGroup.segments,childrenOfEmptyChild.children)}return Object.entries(outlets).forEach((([outlet,commands])=>{"string"==typeof commands&&(commands=[commands]),null!==commands&&(children[outlet]=updateSegmentGroup(segmentGroup.children[outlet],startIndex,commands))})),Object.entries(segmentGroup.children).forEach((([childOutlet,child])=>{void 0===outlets[childOutlet]&&(children[childOutlet]=child)})),new UrlSegmentGroup(segmentGroup.segments,children)}}function createNewSegmentGroup(segmentGroup,startIndex,commands){const paths=segmentGroup.segments.slice(0,startIndex);let i=0;for(;i<commands.length;){const command=commands[i];if(isCommandWithOutlets(command)){const children=createNewSegmentChildren(command.outlets);return new UrlSegmentGroup(paths,children)}if(0===i&&isMatrixParams(commands[0])){const p=segmentGroup.segments[startIndex];paths.push(new UrlSegment(p.path,stringify(commands[0]))),i++;continue}const curr=isCommandWithOutlets(command)?command.outlets.primary:`${command}`,next=i<commands.length-1?commands[i+1]:null;curr&&next&&isMatrixParams(next)?(paths.push(new UrlSegment(curr,stringify(next))),i+=2):(paths.push(new UrlSegment(curr,{})),i++)}return new UrlSegmentGroup(paths,{})}function createNewSegmentChildren(outlets){const children={};return Object.entries(outlets).forEach((([outlet,commands])=>{"string"==typeof commands&&(commands=[commands]),null!==commands&&(children[outlet]=createNewSegmentGroup(new UrlSegmentGroup([],{}),0,commands))})),children}function stringify(params){const res={};return Object.entries(params).forEach((([k,v])=>res[k]=`${v}`)),res}function compare(path,params,segment){return path==segment.path&&shallowEqual(params,segment.parameters)}var EventType,NavigationCancellationCode,NavigationSkippedCode;!function(EventType){EventType[EventType.NavigationStart=0]="NavigationStart",EventType[EventType.NavigationEnd=1]="NavigationEnd",EventType[EventType.NavigationCancel=2]="NavigationCancel",EventType[EventType.NavigationError=3]="NavigationError",EventType[EventType.RoutesRecognized=4]="RoutesRecognized",EventType[EventType.ResolveStart=5]="ResolveStart",EventType[EventType.ResolveEnd=6]="ResolveEnd",EventType[EventType.GuardsCheckStart=7]="GuardsCheckStart",EventType[EventType.GuardsCheckEnd=8]="GuardsCheckEnd",EventType[EventType.RouteConfigLoadStart=9]="RouteConfigLoadStart",EventType[EventType.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",EventType[EventType.ChildActivationStart=11]="ChildActivationStart",EventType[EventType.ChildActivationEnd=12]="ChildActivationEnd",EventType[EventType.ActivationStart=13]="ActivationStart",EventType[EventType.ActivationEnd=14]="ActivationEnd",EventType[EventType.Scroll=15]="Scroll",EventType[EventType.NavigationSkipped=16]="NavigationSkipped"}(EventType||(EventType={}));class RouterEvent{id;url;constructor(id,url){this.id=id,this.url=url}}class NavigationStart extends RouterEvent{type=EventType.NavigationStart;navigationTrigger;restoredState;constructor(id,url,navigationTrigger="imperative",restoredState=null){super(id,url),this.navigationTrigger=navigationTrigger,this.restoredState=restoredState}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class NavigationEnd extends RouterEvent{urlAfterRedirects;type=EventType.NavigationEnd;constructor(id,url,urlAfterRedirects){super(id,url),this.urlAfterRedirects=urlAfterRedirects}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}!function(NavigationCancellationCode){NavigationCancellationCode[NavigationCancellationCode.Redirect=0]="Redirect",NavigationCancellationCode[NavigationCancellationCode.SupersededByNewNavigation=1]="SupersededByNewNavigation",NavigationCancellationCode[NavigationCancellationCode.NoDataFromResolver=2]="NoDataFromResolver",NavigationCancellationCode[NavigationCancellationCode.GuardRejected=3]="GuardRejected"}(NavigationCancellationCode||(NavigationCancellationCode={})),function(NavigationSkippedCode){NavigationSkippedCode[NavigationSkippedCode.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",NavigationSkippedCode[NavigationSkippedCode.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy"}(NavigationSkippedCode||(NavigationSkippedCode={}));class NavigationCancel extends RouterEvent{reason;code;type=EventType.NavigationCancel;constructor(id,url,reason,code){super(id,url),this.reason=reason,this.code=code}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class NavigationSkipped extends RouterEvent{reason;code;type=EventType.NavigationSkipped;constructor(id,url,reason,code){super(id,url),this.reason=reason,this.code=code}}class NavigationError extends RouterEvent{error;target;type=EventType.NavigationError;constructor(id,url,error,target){super(id,url),this.error=error,this.target=target}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class RoutesRecognized extends RouterEvent{urlAfterRedirects;state;type=EventType.RoutesRecognized;constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GuardsCheckStart extends RouterEvent{urlAfterRedirects;state;type=EventType.GuardsCheckStart;constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GuardsCheckEnd extends RouterEvent{urlAfterRedirects;state;shouldActivate;type=EventType.GuardsCheckEnd;constructor(id,url,urlAfterRedirects,state,shouldActivate){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state,this.shouldActivate=shouldActivate}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ResolveStart extends RouterEvent{urlAfterRedirects;state;type=EventType.ResolveStart;constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ResolveEnd extends RouterEvent{urlAfterRedirects;state;type=EventType.ResolveEnd;constructor(id,url,urlAfterRedirects,state){super(id,url),this.urlAfterRedirects=urlAfterRedirects,this.state=state}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class RouteConfigLoadStart{route;type=EventType.RouteConfigLoadStart;constructor(route){this.route=route}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class RouteConfigLoadEnd{route;type=EventType.RouteConfigLoadEnd;constructor(route){this.route=route}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class ChildActivationStart{snapshot;type=EventType.ChildActivationStart;constructor(snapshot){this.snapshot=snapshot}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ChildActivationEnd{snapshot;type=EventType.ChildActivationEnd;constructor(snapshot){this.snapshot=snapshot}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ActivationStart{snapshot;type=EventType.ActivationStart;constructor(snapshot){this.snapshot=snapshot}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ActivationEnd{snapshot;type=EventType.ActivationEnd;constructor(snapshot){this.snapshot=snapshot}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Scroll{routerEvent;position;anchor;type=EventType.Scroll;constructor(routerEvent,position,anchor){this.routerEvent=routerEvent,this.position=position,this.anchor=anchor}toString(){const pos=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${pos}')`}}class BeforeActivateRoutes{}class RedirectRequest{url;navigationBehaviorOptions;constructor(url,navigationBehaviorOptions){this.url=url,this.navigationBehaviorOptions=navigationBehaviorOptions}}function validateConfig(config,parentPath="",requireStandaloneComponents=!1){for(let i=0;i<config.length;i++){const route=config[i];validateNode(route,getFullPath(parentPath,route),requireStandaloneComponents)}}function assertStandalone(fullPath,component){if(component&&(0,core["ɵisNgModule"])(component))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}'. You are using 'loadComponent' with a module, but it must be used with standalone components. Use 'loadChildren' instead.`);if(component&&!(0,core.isStandalone)(component))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}'. The component must be standalone.`)}function validateNode(route,fullPath,requireStandaloneComponents){if("undefined"==typeof ngDevMode||ngDevMode){if(!route)throw new core["ɵRuntimeError"](4014,`\n      Invalid configuration of route '${fullPath}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(route))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': Array cannot be specified`);if(!route.redirectTo&&!route.component&&!route.loadComponent&&!route.children&&!route.loadChildren&&route.outlet&&"primary"!==route.outlet)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': a componentless route without children or loadChildren cannot have a named outlet set`);if(route.redirectTo&&route.children)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and children cannot be used together`);if(route.redirectTo&&route.loadChildren)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and loadChildren cannot be used together`);if(route.children&&route.loadChildren)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': children and loadChildren cannot be used together`);if(route.redirectTo&&(route.component||route.loadComponent))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and component/loadComponent cannot be used together`);if(route.component&&route.loadComponent)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': component and loadComponent cannot be used together`);if(route.redirectTo&&route.canActivate)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': redirectTo and canActivate cannot be used together. Redirects happen before activation so canActivate will never be executed.`);if(route.path&&route.matcher)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': path and matcher cannot be used together`);if(!(void 0!==route.redirectTo||route.component||route.loadComponent||route.children||route.loadChildren))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}'. One of the following must be provided: component, loadComponent, redirectTo, children or loadChildren`);if(void 0===route.path&&void 0===route.matcher)throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': routes must have either a path or a matcher specified`);if("string"==typeof route.path&&"/"===route.path.charAt(0))throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '${fullPath}': path cannot start with a slash`);if(""===route.path&&void 0!==route.redirectTo&&void 0===route.pathMatch){const exp="The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.";throw new core["ɵRuntimeError"](4014,`Invalid configuration of route '{path: "${fullPath}", redirectTo: "${route.redirectTo}"}': please provide 'pathMatch'. ${exp}`)}requireStandaloneComponents&&assertStandalone(fullPath,route.component)}route.children&&validateConfig(route.children,fullPath,requireStandaloneComponents)}function getFullPath(parentPath,currentRoute){return currentRoute?parentPath||currentRoute.path?parentPath&&!currentRoute.path?`${parentPath}/`:!parentPath&&currentRoute.path?currentRoute.path:`${parentPath}/${currentRoute.path}`:"":parentPath}function getOutlet(route){return route.outlet||"primary"}function getClosestRouteInjector(snapshot){if(!snapshot)return null;if(snapshot.routeConfig?._injector)return snapshot.routeConfig._injector;for(let s=snapshot.parent;s;s=s.parent){const route=s.routeConfig;if(route?._loadedInjector)return route._loadedInjector;if(route?._injector)return route._injector}return null}class OutletContext{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return getClosestRouteInjector(this.route?.snapshot)??this.rootInjector}constructor(rootInjector){this.rootInjector=rootInjector,this.children=new ChildrenOutletContexts(this.rootInjector)}}class ChildrenOutletContexts{rootInjector;contexts=new Map;constructor(rootInjector){this.rootInjector=rootInjector}onChildOutletCreated(childName,outlet){const context=this.getOrCreateContext(childName);context.outlet=outlet,this.contexts.set(childName,context)}onChildOutletDestroyed(childName){const context=this.getContext(childName);context&&(context.outlet=null,context.attachRef=null)}onOutletDeactivated(){const contexts=this.contexts;return this.contexts=new Map,contexts}onOutletReAttached(contexts){this.contexts=contexts}getOrCreateContext(childName){let context=this.getContext(childName);return context||(context=new OutletContext(this.rootInjector),this.contexts.set(childName,context)),context}getContext(childName){return this.contexts.get(childName)||null}static ɵfac=function ChildrenOutletContexts_Factory(__ngFactoryType__){return new(__ngFactoryType__||ChildrenOutletContexts)(core["ɵɵinject"](core.EnvironmentInjector))};static ɵprov=core["ɵɵdefineInjectable"]({token:ChildrenOutletContexts,factory:ChildrenOutletContexts.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](ChildrenOutletContexts,[{type:core.Injectable,args:[{providedIn:"root"}]}],(()=>[{type:core.EnvironmentInjector}]),null);class Tree{_root;constructor(root){this._root=root}get root(){return this._root.value}parent(t){const p=this.pathFromRoot(t);return p.length>1?p[p.length-2]:null}children(t){const n=findNode(t,this._root);return n?n.children.map((t=>t.value)):[]}firstChild(t){const n=findNode(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const p=findPath(t,this._root);if(p.length<2)return[];return p[p.length-2].children.map((c=>c.value)).filter((cc=>cc!==t))}pathFromRoot(t){return findPath(t,this._root).map((s=>s.value))}}function findNode(value,node){if(value===node.value)return node;for(const child of node.children){const node=findNode(value,child);if(node)return node}return null}function findPath(value,node){if(value===node.value)return[node];for(const child of node.children){const path=findPath(value,child);if(path.length)return path.unshift(node),path}return[]}class TreeNode{value;children;constructor(value,children){this.value=value,this.children=children}toString(){return`TreeNode(${this.value})`}}function nodeChildrenAsMap(node){const map={};return node&&node.children.forEach((child=>map[child.value.outlet]=child)),map}class RouterState extends Tree{snapshot;constructor(root,snapshot){super(root),this.snapshot=snapshot,setRouterState(this,root)}toString(){return this.snapshot.toString()}}function createEmptyState(rootComponent){const snapshot=function createEmptyStateSnapshot(rootComponent){const emptyParams={},emptyData={},emptyQueryParams={},fragment="",activated=new ActivatedRouteSnapshot([],emptyParams,emptyQueryParams,fragment,emptyData,"primary",rootComponent,null,{});return new RouterStateSnapshot("",new TreeNode(activated,[]))}(rootComponent),emptyUrl=new BehaviorSubject.t([new UrlSegment("",{})]),emptyParams=new BehaviorSubject.t({}),emptyData=new BehaviorSubject.t({}),emptyQueryParams=new BehaviorSubject.t({}),fragment=new BehaviorSubject.t(""),activated=new ActivatedRoute(emptyUrl,emptyParams,emptyQueryParams,fragment,emptyData,"primary",rootComponent,snapshot.root);return activated.snapshot=snapshot.root,new RouterState(new TreeNode(activated,[]),snapshot)}class ActivatedRoute{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(urlSubject,paramsSubject,queryParamsSubject,fragmentSubject,dataSubject,outlet,component,futureSnapshot){this.urlSubject=urlSubject,this.paramsSubject=paramsSubject,this.queryParamsSubject=queryParamsSubject,this.fragmentSubject=fragmentSubject,this.dataSubject=dataSubject,this.outlet=outlet,this.component=component,this._futureSnapshot=futureSnapshot,this.title=this.dataSubject?.pipe((0,map.T)((d=>d[RouteTitleKey])))??(0,of.of)(void 0),this.url=urlSubject,this.params=paramsSubject,this.queryParams=queryParamsSubject,this.fragment=fragmentSubject,this.data=dataSubject}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe((0,map.T)((p=>convertToParamMap(p)))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe((0,map.T)((p=>convertToParamMap(p)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function getInherited(route,parent,paramsInheritanceStrategy="emptyOnly"){let inherited;const{routeConfig}=route;return inherited=null===parent||"always"!==paramsInheritanceStrategy&&""!==routeConfig?.path&&(parent.component||parent.routeConfig?.loadComponent)?{params:{...route.params},data:{...route.data},resolve:{...route.data,...route._resolvedData??{}}}:{params:{...parent.params,...route.params},data:{...parent.data,...route.data},resolve:{...route.data,...parent.data,...routeConfig?.data,...route._resolvedData}},routeConfig&&hasStaticTitle(routeConfig)&&(inherited.resolve[RouteTitleKey]=routeConfig.title),inherited}class ActivatedRouteSnapshot{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[RouteTitleKey]}constructor(url,params,queryParams,fragment,data,outlet,component,routeConfig,resolve){this.url=url,this.params=params,this.queryParams=queryParams,this.fragment=fragment,this.data=data,this.outlet=outlet,this.component=component,this.routeConfig=routeConfig,this._resolve=resolve}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=convertToParamMap(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=convertToParamMap(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map((segment=>segment.toString())).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class RouterStateSnapshot extends Tree{url;constructor(url,root){super(root),this.url=url,setRouterState(this,root)}toString(){return serializeNode(this._root)}}function setRouterState(state,node){node.value._routerState=state,node.children.forEach((c=>setRouterState(state,c)))}function serializeNode(node){const c=node.children.length>0?` { ${node.children.map(serializeNode).join(", ")} } `:"";return`${node.value}${c}`}function advanceActivatedRoute(route){if(route.snapshot){const currentSnapshot=route.snapshot,nextSnapshot=route._futureSnapshot;route.snapshot=nextSnapshot,shallowEqual(currentSnapshot.queryParams,nextSnapshot.queryParams)||route.queryParamsSubject.next(nextSnapshot.queryParams),currentSnapshot.fragment!==nextSnapshot.fragment&&route.fragmentSubject.next(nextSnapshot.fragment),shallowEqual(currentSnapshot.params,nextSnapshot.params)||route.paramsSubject.next(nextSnapshot.params),function shallowEqualArrays(a,b){if(a.length!==b.length)return!1;for(let i=0;i<a.length;++i)if(!shallowEqual(a[i],b[i]))return!1;return!0}(currentSnapshot.url,nextSnapshot.url)||route.urlSubject.next(nextSnapshot.url),shallowEqual(currentSnapshot.data,nextSnapshot.data)||route.dataSubject.next(nextSnapshot.data)}else route.snapshot=route._futureSnapshot,route.dataSubject.next(route._futureSnapshot.data)}function equalParamsAndUrlSegments(a,b){const equalUrlParams=shallowEqual(a.params,b.params)&&function equalSegments(as,bs){return equalPath(as,bs)&&as.every(((a,i)=>shallowEqual(a.parameters,bs[i].parameters)))}(a.url,b.url),parentsMismatch=!a.parent!=!b.parent;return equalUrlParams&&!parentsMismatch&&(!a.parent||equalParamsAndUrlSegments(a.parent,b.parent))}function hasStaticTitle(config){return"string"==typeof config.title||null===config.title}const ROUTER_OUTLET_DATA=new core.InjectionToken(ngDevMode?"RouterOutlet data":"");class RouterOutlet{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name="primary";activateEvents=new core.EventEmitter;deactivateEvents=new core.EventEmitter;attachEvents=new core.EventEmitter;detachEvents=new core.EventEmitter;routerOutletData=(0,core.input)(void 0);parentContexts=(0,core.inject)(ChildrenOutletContexts);location=(0,core.inject)(core.ViewContainerRef);changeDetector=(0,core.inject)(core.ChangeDetectorRef);inputBinder=(0,core.inject)(INPUT_BINDER,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(changes){if(changes.name){const{firstChange,previousValue}=changes.name;if(firstChange)return;this.isTrackedInParentContexts(previousValue)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(previousValue)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(outletName){return this.parentContexts.getContext(outletName)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const context=this.parentContexts.getContext(this.name);context?.route&&(context.attachRef?this.attach(context.attachRef,context.route):this.activateWith(context.route,context.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new core["ɵRuntimeError"](4012,("undefined"==typeof ngDevMode||ngDevMode)&&"Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new core["ɵRuntimeError"](4012,("undefined"==typeof ngDevMode||ngDevMode)&&"Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new core["ɵRuntimeError"](4012,("undefined"==typeof ngDevMode||ngDevMode)&&"Outlet is not activated");this.location.detach();const cmp=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(cmp.instance),cmp}attach(ref,activatedRoute){this.activated=ref,this._activatedRoute=activatedRoute,this.location.insert(ref.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(ref.instance)}deactivate(){if(this.activated){const c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(activatedRoute,environmentInjector){if(this.isActivated)throw new core["ɵRuntimeError"](4013,("undefined"==typeof ngDevMode||ngDevMode)&&"Cannot activate an already activated outlet");this._activatedRoute=activatedRoute;const location=this.location,component=activatedRoute.snapshot.component,childContexts=this.parentContexts.getOrCreateContext(this.name).children,injector=new OutletInjector(activatedRoute,childContexts,location.injector,this.routerOutletData);this.activated=location.createComponent(component,{index:location.length,injector,environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static ɵfac=function RouterOutlet_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouterOutlet)};static ɵdir=core["ɵɵdefineDirective"]({type:RouterOutlet,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[core["ɵɵNgOnChangesFeature"]]})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterOutlet,[{type:core.Directive,args:[{selector:"router-outlet",exportAs:"outlet"}]}],null,{name:[{type:core.Input}],activateEvents:[{type:core.Output,args:["activate"]}],deactivateEvents:[{type:core.Output,args:["deactivate"]}],attachEvents:[{type:core.Output,args:["attach"]}],detachEvents:[{type:core.Output,args:["detach"]}]});class OutletInjector{route;childContexts;parent;outletData;__ngOutletInjector(parentInjector){return new OutletInjector(this.route,this.childContexts,parentInjector,this.outletData)}constructor(route,childContexts,parent,outletData){this.route=route,this.childContexts=childContexts,this.parent=parent,this.outletData=outletData}get(token,notFoundValue){return token===ActivatedRoute?this.route:token===ChildrenOutletContexts?this.childContexts:token===ROUTER_OUTLET_DATA?this.outletData:this.parent.get(token,notFoundValue)}}const INPUT_BINDER=new core.InjectionToken("");class RoutedComponentInputBinder{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(outlet){this.unsubscribeFromRouteData(outlet),this.subscribeToRouteData(outlet)}unsubscribeFromRouteData(outlet){this.outletDataSubscriptions.get(outlet)?.unsubscribe(),this.outletDataSubscriptions.delete(outlet)}subscribeToRouteData(outlet){const{activatedRoute}=outlet,dataSubscription=(0,combineLatest.z)([activatedRoute.queryParams,activatedRoute.params,activatedRoute.data]).pipe((0,switchMap.n)((([queryParams,params,data],index)=>(data={...queryParams,...params,...data},0===index?(0,of.of)(data):Promise.resolve(data))))).subscribe((data=>{if(!outlet.isActivated||!outlet.activatedComponentRef||outlet.activatedRoute!==activatedRoute||null===activatedRoute.component)return void this.unsubscribeFromRouteData(outlet);const mirror=(0,core.reflectComponentType)(activatedRoute.component);if(mirror)for(const{templateName}of mirror.inputs)outlet.activatedComponentRef.setInput(templateName,data[templateName]);else this.unsubscribeFromRouteData(outlet)}));this.outletDataSubscriptions.set(outlet,dataSubscription)}static ɵfac=function RoutedComponentInputBinder_Factory(__ngFactoryType__){return new(__ngFactoryType__||RoutedComponentInputBinder)};static ɵprov=core["ɵɵdefineInjectable"]({token:RoutedComponentInputBinder,factory:RoutedComponentInputBinder.ɵfac})}function createNode(routeReuseStrategy,curr,prevState){if(prevState&&routeReuseStrategy.shouldReuseRoute(curr.value,prevState.value.snapshot)){const value=prevState.value;value._futureSnapshot=curr.value;const children=function createOrReuseChildren(routeReuseStrategy,curr,prevState){return curr.children.map((child=>{for(const p of prevState.children)if(routeReuseStrategy.shouldReuseRoute(child.value,p.value.snapshot))return createNode(routeReuseStrategy,child,p);return createNode(routeReuseStrategy,child)}))}(routeReuseStrategy,curr,prevState);return new TreeNode(value,children)}{if(routeReuseStrategy.shouldAttach(curr.value)){const detachedRouteHandle=routeReuseStrategy.retrieve(curr.value);if(null!==detachedRouteHandle){const tree=detachedRouteHandle.route;return tree.value._futureSnapshot=curr.value,tree.children=curr.children.map((c=>createNode(routeReuseStrategy,c))),tree}}const value=function createActivatedRoute(c){return new ActivatedRoute(new BehaviorSubject.t(c.url),new BehaviorSubject.t(c.params),new BehaviorSubject.t(c.queryParams),new BehaviorSubject.t(c.fragment),new BehaviorSubject.t(c.data),c.outlet,c.component,c)}(curr.value),children=curr.children.map((c=>createNode(routeReuseStrategy,c)));return new TreeNode(value,children)}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RoutedComponentInputBinder,[{type:core.Injectable}],null,null);class RedirectCommand{redirectTo;navigationBehaviorOptions;constructor(redirectTo,navigationBehaviorOptions){this.redirectTo=redirectTo,this.navigationBehaviorOptions=navigationBehaviorOptions}}function redirectingNavigationError(urlSerializer,redirect){const{redirectTo,navigationBehaviorOptions}=isUrlTree(redirect)?{redirectTo:redirect,navigationBehaviorOptions:void 0}:redirect,error=navigationCancelingError(ngDevMode&&`Redirecting to "${urlSerializer.serialize(redirectTo)}"`,NavigationCancellationCode.Redirect);return error.url=redirectTo,error.navigationBehaviorOptions=navigationBehaviorOptions,error}function navigationCancelingError(message,code){const error=new Error(`NavigationCancelingError: ${message||""}`);return error.ngNavigationCancelingError=!0,error.cancellationCode=code,error}function isNavigationCancelingError(error){return!!error&&error.ngNavigationCancelingError}let warnedAboutUnsupportedInputBinding=!1;class ActivateRoutes{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(routeReuseStrategy,futureState,currState,forwardEvent,inputBindingEnabled){this.routeReuseStrategy=routeReuseStrategy,this.futureState=futureState,this.currState=currState,this.forwardEvent=forwardEvent,this.inputBindingEnabled=inputBindingEnabled}activate(parentContexts){const futureRoot=this.futureState._root,currRoot=this.currState?this.currState._root:null;this.deactivateChildRoutes(futureRoot,currRoot,parentContexts),advanceActivatedRoute(this.futureState.root),this.activateChildRoutes(futureRoot,currRoot,parentContexts)}deactivateChildRoutes(futureNode,currNode,contexts){const children=nodeChildrenAsMap(currNode);futureNode.children.forEach((futureChild=>{const childOutletName=futureChild.value.outlet;this.deactivateRoutes(futureChild,children[childOutletName],contexts),delete children[childOutletName]})),Object.values(children).forEach((v=>{this.deactivateRouteAndItsChildren(v,contexts)}))}deactivateRoutes(futureNode,currNode,parentContext){const future=futureNode.value,curr=currNode?currNode.value:null;if(future===curr)if(future.component){const context=parentContext.getContext(future.outlet);context&&this.deactivateChildRoutes(futureNode,currNode,context.children)}else this.deactivateChildRoutes(futureNode,currNode,parentContext);else curr&&this.deactivateRouteAndItsChildren(currNode,parentContext)}deactivateRouteAndItsChildren(route,parentContexts){route.value.component&&this.routeReuseStrategy.shouldDetach(route.value.snapshot)?this.detachAndStoreRouteSubtree(route,parentContexts):this.deactivateRouteAndOutlet(route,parentContexts)}detachAndStoreRouteSubtree(route,parentContexts){const context=parentContexts.getContext(route.value.outlet),contexts=context&&route.value.component?context.children:parentContexts,children=nodeChildrenAsMap(route);for(const treeNode of Object.values(children))this.deactivateRouteAndItsChildren(treeNode,contexts);if(context&&context.outlet){const componentRef=context.outlet.detach(),contexts=context.children.onOutletDeactivated();this.routeReuseStrategy.store(route.value.snapshot,{componentRef,route,contexts})}}deactivateRouteAndOutlet(route,parentContexts){const context=parentContexts.getContext(route.value.outlet),contexts=context&&route.value.component?context.children:parentContexts,children=nodeChildrenAsMap(route);for(const treeNode of Object.values(children))this.deactivateRouteAndItsChildren(treeNode,contexts);context&&(context.outlet&&(context.outlet.deactivate(),context.children.onOutletDeactivated()),context.attachRef=null,context.route=null)}activateChildRoutes(futureNode,currNode,contexts){const children=nodeChildrenAsMap(currNode);futureNode.children.forEach((c=>{this.activateRoutes(c,children[c.value.outlet],contexts),this.forwardEvent(new ActivationEnd(c.value.snapshot))})),futureNode.children.length&&this.forwardEvent(new ChildActivationEnd(futureNode.value.snapshot))}activateRoutes(futureNode,currNode,parentContexts){const future=futureNode.value,curr=currNode?currNode.value:null;if(advanceActivatedRoute(future),future===curr)if(future.component){const context=parentContexts.getOrCreateContext(future.outlet);this.activateChildRoutes(futureNode,currNode,context.children)}else this.activateChildRoutes(futureNode,currNode,parentContexts);else if(future.component){const context=parentContexts.getOrCreateContext(future.outlet);if(this.routeReuseStrategy.shouldAttach(future.snapshot)){const stored=this.routeReuseStrategy.retrieve(future.snapshot);this.routeReuseStrategy.store(future.snapshot,null),context.children.onOutletReAttached(stored.contexts),context.attachRef=stored.componentRef,context.route=stored.route.value,context.outlet&&context.outlet.attach(stored.componentRef,stored.route.value),advanceActivatedRoute(stored.route.value),this.activateChildRoutes(futureNode,null,context.children)}else context.attachRef=null,context.route=future,context.outlet&&context.outlet.activateWith(future,context.injector),this.activateChildRoutes(futureNode,null,context.children)}else this.activateChildRoutes(futureNode,null,parentContexts);if("undefined"==typeof ngDevMode||ngDevMode){const outlet=parentContexts.getOrCreateContext(future.outlet).outlet;outlet&&this.inputBindingEnabled&&!outlet.supportsBindingToComponentInputs&&!warnedAboutUnsupportedInputBinding&&(console.warn("'withComponentInputBinding' feature is enabled but this application is using an outlet that may not support binding to component inputs."),warnedAboutUnsupportedInputBinding=!0)}}}class CanActivate{path;route;constructor(path){this.path=path,this.route=this.path[this.path.length-1]}}class CanDeactivate{component;route;constructor(component,route){this.component=component,this.route=route}}function getAllRouteGuards(future,curr,parentContexts){const futureRoot=future._root;return getChildRouteGuards(futureRoot,curr?curr._root:null,parentContexts,[futureRoot.value])}function getTokenOrFunctionIdentity(tokenOrFunction,injector){const NOT_FOUND=Symbol(),result=injector.get(tokenOrFunction,NOT_FOUND);return result===NOT_FOUND?"function"!=typeof tokenOrFunction||(0,core["ɵisInjectable"])(tokenOrFunction)?injector.get(tokenOrFunction):tokenOrFunction:result}function getChildRouteGuards(futureNode,currNode,contexts,futurePath,checks={canDeactivateChecks:[],canActivateChecks:[]}){const prevChildren=nodeChildrenAsMap(currNode);return futureNode.children.forEach((c=>{!function getRouteGuards(futureNode,currNode,parentContexts,futurePath,checks={canDeactivateChecks:[],canActivateChecks:[]}){const future=futureNode.value,curr=currNode?currNode.value:null,context=parentContexts?parentContexts.getContext(futureNode.value.outlet):null;if(curr&&future.routeConfig===curr.routeConfig){const shouldRun=function shouldRunGuardsAndResolvers(curr,future,mode){if("function"==typeof mode)return mode(curr,future);switch(mode){case"pathParamsChange":return!equalPath(curr.url,future.url);case"pathParamsOrQueryParamsChange":return!equalPath(curr.url,future.url)||!shallowEqual(curr.queryParams,future.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!equalParamsAndUrlSegments(curr,future)||!shallowEqual(curr.queryParams,future.queryParams);default:return!equalParamsAndUrlSegments(curr,future)}}(curr,future,future.routeConfig.runGuardsAndResolvers);shouldRun?checks.canActivateChecks.push(new CanActivate(futurePath)):(future.data=curr.data,future._resolvedData=curr._resolvedData),future.component?getChildRouteGuards(futureNode,currNode,context?context.children:null,futurePath,checks):getChildRouteGuards(futureNode,currNode,parentContexts,futurePath,checks),shouldRun&&context&&context.outlet&&context.outlet.isActivated&&checks.canDeactivateChecks.push(new CanDeactivate(context.outlet.component,curr))}else curr&&deactivateRouteAndItsChildren(currNode,context,checks),checks.canActivateChecks.push(new CanActivate(futurePath)),future.component?getChildRouteGuards(futureNode,null,context?context.children:null,futurePath,checks):getChildRouteGuards(futureNode,null,parentContexts,futurePath,checks);return checks}(c,prevChildren[c.value.outlet],contexts,futurePath.concat([c.value]),checks),delete prevChildren[c.value.outlet]})),Object.entries(prevChildren).forEach((([k,v])=>deactivateRouteAndItsChildren(v,contexts.getContext(k),checks))),checks}function deactivateRouteAndItsChildren(route,context,checks){const children=nodeChildrenAsMap(route),r=route.value;Object.entries(children).forEach((([childName,node])=>{r.component?deactivateRouteAndItsChildren(node,context?context.children.getContext(childName):null,checks):deactivateRouteAndItsChildren(node,context,checks)})),r.component&&context&&context.outlet&&context.outlet.isActivated?checks.canDeactivateChecks.push(new CanDeactivate(context.outlet.component,r)):checks.canDeactivateChecks.push(new CanDeactivate(null,r))}function router_isFunction(v){return"function"==typeof v}function isEmptyError(e){return e instanceof EmptyError.G||"EmptyError"===e?.name}const INITIAL_VALUE=Symbol("INITIAL_VALUE");function prioritizedGuardValue(){return(0,switchMap.n)((obs=>(0,combineLatest.z)(obs.map((o=>o.pipe((0,take.s)(1),(0,startWith.Z)(INITIAL_VALUE))))).pipe((0,map.T)((results=>{for(const result of results)if(!0!==result){if(result===INITIAL_VALUE)return INITIAL_VALUE;if(!1===result||(isUrlTree(val=result)||val instanceof RedirectCommand))return result}var val;return!0})),(0,filter.p)((item=>item!==INITIAL_VALUE)),(0,take.s)(1))))}function checkGuards(injector,forwardEvent){return(0,mergeMap.Z)((t=>{const{targetSnapshot,currentSnapshot,guards:{canActivateChecks,canDeactivateChecks}}=t;return 0===canDeactivateChecks.length&&0===canActivateChecks.length?(0,of.of)({...t,guardsResult:!0}):function runCanDeactivateChecks(checks,futureRSS,currRSS,injector){return(0,from.H)(checks).pipe((0,mergeMap.Z)((check=>function runCanDeactivate(component,currARS,currRSS,futureRSS,injector){const canDeactivate=currARS&&currARS.routeConfig?currARS.routeConfig.canDeactivate:null;if(!canDeactivate||0===canDeactivate.length)return(0,of.of)(!0);const canDeactivateObservables=canDeactivate.map((c=>{const closestInjector=getClosestRouteInjector(currARS)??injector,guard=getTokenOrFunctionIdentity(c,closestInjector);return wrapIntoObservable(function isCanDeactivate(guard){return guard&&router_isFunction(guard.canDeactivate)}(guard)?guard.canDeactivate(component,currARS,currRSS,futureRSS):(0,core.runInInjectionContext)(closestInjector,(()=>guard(component,currARS,currRSS,futureRSS)))).pipe(first())}));return(0,of.of)(canDeactivateObservables).pipe(prioritizedGuardValue())}(check.component,check.route,currRSS,futureRSS,injector))),first((result=>!0!==result),!0))}(canDeactivateChecks,targetSnapshot,currentSnapshot,injector).pipe((0,mergeMap.Z)((canDeactivate=>canDeactivate&&function isBoolean(v){return"boolean"==typeof v}(canDeactivate)?function runCanActivateChecks(futureSnapshot,checks,injector,forwardEvent){return(0,from.H)(checks).pipe((0,concatMap.H)((check=>(0,concat.x)(function fireChildActivationStart(snapshot,forwardEvent){null!==snapshot&&forwardEvent&&forwardEvent(new ChildActivationStart(snapshot));return(0,of.of)(!0)}(check.route.parent,forwardEvent),function fireActivationStart(snapshot,forwardEvent){null!==snapshot&&forwardEvent&&forwardEvent(new ActivationStart(snapshot));return(0,of.of)(!0)}(check.route,forwardEvent),function runCanActivateChild(futureRSS,path,injector){const futureARS=path[path.length-1],canActivateChildGuardsMapped=path.slice(0,path.length-1).reverse().map((p=>function getCanActivateChild(p){const canActivateChild=p.routeConfig?p.routeConfig.canActivateChild:null;return canActivateChild&&0!==canActivateChild.length?{node:p,guards:canActivateChild}:null}(p))).filter((_=>null!==_)).map((d=>defer((()=>{const guardsMapped=d.guards.map((canActivateChild=>{const closestInjector=getClosestRouteInjector(d.node)??injector,guard=getTokenOrFunctionIdentity(canActivateChild,closestInjector);return wrapIntoObservable(function isCanActivateChild(guard){return guard&&router_isFunction(guard.canActivateChild)}(guard)?guard.canActivateChild(futureARS,futureRSS):(0,core.runInInjectionContext)(closestInjector,(()=>guard(futureARS,futureRSS)))).pipe(first())}));return(0,of.of)(guardsMapped).pipe(prioritizedGuardValue())}))));return(0,of.of)(canActivateChildGuardsMapped).pipe(prioritizedGuardValue())}(futureSnapshot,check.path,injector),function runCanActivate(futureRSS,futureARS,injector){const canActivate=futureARS.routeConfig?futureARS.routeConfig.canActivate:null;if(!canActivate||0===canActivate.length)return(0,of.of)(!0);const canActivateObservables=canActivate.map((canActivate=>defer((()=>{const closestInjector=getClosestRouteInjector(futureARS)??injector,guard=getTokenOrFunctionIdentity(canActivate,closestInjector);return wrapIntoObservable(function isCanActivate(guard){return guard&&router_isFunction(guard.canActivate)}(guard)?guard.canActivate(futureARS,futureRSS):(0,core.runInInjectionContext)(closestInjector,(()=>guard(futureARS,futureRSS)))).pipe(first())}))));return(0,of.of)(canActivateObservables).pipe(prioritizedGuardValue())}(futureSnapshot,check.route,injector)))),first((result=>!0!==result),!0))}(targetSnapshot,canActivateChecks,injector,forwardEvent):(0,of.of)(canDeactivate))),(0,map.T)((guardsResult=>({...t,guardsResult}))))}))}function runCanLoadGuards(injector,route,segments,urlSerializer){const canLoad=route.canLoad;if(void 0===canLoad||0===canLoad.length)return(0,of.of)(!0);const canLoadObservables=canLoad.map((injectionToken=>{const guard=getTokenOrFunctionIdentity(injectionToken,injector);return wrapIntoObservable(function isCanLoad(guard){return guard&&router_isFunction(guard.canLoad)}(guard)?guard.canLoad(route,segments):(0,core.runInInjectionContext)(injector,(()=>guard(route,segments))))}));return(0,of.of)(canLoadObservables).pipe(prioritizedGuardValue(),redirectIfUrlTree(urlSerializer))}function redirectIfUrlTree(urlSerializer){return(0,pipe.F)((0,tap.M)((result=>{if("boolean"!=typeof result)throw redirectingNavigationError(urlSerializer,result)})),(0,map.T)((result=>!0===result)))}function runCanMatchGuards(injector,route,segments,urlSerializer){const canMatch=route.canMatch;if(!canMatch||0===canMatch.length)return(0,of.of)(!0);const canMatchObservables=canMatch.map((injectionToken=>{const guard=getTokenOrFunctionIdentity(injectionToken,injector);return wrapIntoObservable(function isCanMatch(guard){return guard&&router_isFunction(guard.canMatch)}(guard)?guard.canMatch(route,segments):(0,core.runInInjectionContext)(injector,(()=>guard(route,segments))))}));return(0,of.of)(canMatchObservables).pipe(prioritizedGuardValue(),redirectIfUrlTree(urlSerializer))}class NoMatch{segmentGroup;constructor(segmentGroup){this.segmentGroup=segmentGroup||null}}class AbsoluteRedirect extends Error{urlTree;constructor(urlTree){super(),this.urlTree=urlTree}}function noMatch$1(segmentGroup){return throwError_throwError(new NoMatch(segmentGroup))}class ApplyRedirects{urlSerializer;urlTree;constructor(urlSerializer,urlTree){this.urlSerializer=urlSerializer,this.urlTree=urlTree}lineralizeSegments(route,urlTree){let res=[],c=urlTree.root;for(;;){if(res=res.concat(c.segments),0===c.numberOfChildren)return(0,of.of)(res);if(c.numberOfChildren>1||!c.children.primary)return redirectTo=`${route.redirectTo}`,throwError_throwError(new core["ɵRuntimeError"](4e3,("undefined"==typeof ngDevMode||ngDevMode)&&`Only absolute redirects can have named outlets. redirectTo: '${redirectTo}'`));c=c.children.primary}var redirectTo}applyRedirectCommands(segments,redirectTo,posParams,currentSnapshot,injector){if("string"!=typeof redirectTo){const redirectToFn=redirectTo,{queryParams,fragment,routeConfig,url,outlet,params,data,title}=currentSnapshot,newRedirect=(0,core.runInInjectionContext)(injector,(()=>redirectToFn({params,data,queryParams,fragment,routeConfig,url,outlet,title})));if(newRedirect instanceof UrlTree)throw new AbsoluteRedirect(newRedirect);redirectTo=newRedirect}const newTree=this.applyRedirectCreateUrlTree(redirectTo,this.urlSerializer.parse(redirectTo),segments,posParams);if("/"===redirectTo[0])throw new AbsoluteRedirect(newTree);return newTree}applyRedirectCreateUrlTree(redirectTo,urlTree,segments,posParams){const newRoot=this.createSegmentGroup(redirectTo,urlTree.root,segments,posParams);return new UrlTree(newRoot,this.createQueryParams(urlTree.queryParams,this.urlTree.queryParams),urlTree.fragment)}createQueryParams(redirectToParams,actualParams){const res={};return Object.entries(redirectToParams).forEach((([k,v])=>{if("string"==typeof v&&":"===v[0]){const sourceName=v.substring(1);res[k]=actualParams[sourceName]}else res[k]=v})),res}createSegmentGroup(redirectTo,group,segments,posParams){const updatedSegments=this.createSegments(redirectTo,group.segments,segments,posParams);let children={};return Object.entries(group.children).forEach((([name,child])=>{children[name]=this.createSegmentGroup(redirectTo,child,segments,posParams)})),new UrlSegmentGroup(updatedSegments,children)}createSegments(redirectTo,redirectToSegments,actualSegments,posParams){return redirectToSegments.map((s=>":"===s.path[0]?this.findPosParam(redirectTo,s,posParams):this.findOrReturn(s,actualSegments)))}findPosParam(redirectTo,redirectToUrlSegment,posParams){const pos=posParams[redirectToUrlSegment.path.substring(1)];if(!pos)throw new core["ɵRuntimeError"](4001,("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot redirect to '${redirectTo}'. Cannot find '${redirectToUrlSegment.path}'.`);return pos}findOrReturn(redirectToUrlSegment,actualSegments){let idx=0;for(const s of actualSegments){if(s.path===redirectToUrlSegment.path)return actualSegments.splice(idx),s;idx++}return redirectToUrlSegment}}const noMatch={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function matchWithChecks(segmentGroup,route,segments,injector,urlSerializer){const result=match(segmentGroup,route,segments);return result.matched?(injector=function getOrCreateRouteInjectorIfNeeded(route,currentInjector){return route.providers&&!route._injector&&(route._injector=(0,core.createEnvironmentInjector)(route.providers,currentInjector,`Route: ${route.path}`)),route._injector??currentInjector}(route,injector),runCanMatchGuards(injector,route,segments,urlSerializer).pipe((0,map.T)((v=>!0===v?result:{...noMatch})))):(0,of.of)(result)}function match(segmentGroup,route,segments){if("**"===route.path)return function createWildcardMatchResult(segments){return{matched:!0,parameters:segments.length>0?router_last(segments).parameters:{},consumedSegments:segments,remainingSegments:[],positionalParamSegments:{}}}(segments);if(""===route.path)return"full"===route.pathMatch&&(segmentGroup.hasChildren()||segments.length>0)?{...noMatch}:{matched:!0,consumedSegments:[],remainingSegments:segments,parameters:{},positionalParamSegments:{}};const res=(route.matcher||defaultUrlMatcher)(segments,segmentGroup,route);if(!res)return{...noMatch};const posParams={};Object.entries(res.posParams??{}).forEach((([k,v])=>{posParams[k]=v.path}));const parameters=res.consumed.length>0?{...posParams,...res.consumed[res.consumed.length-1].parameters}:posParams;return{matched:!0,consumedSegments:res.consumed,remainingSegments:segments.slice(res.consumed.length),parameters,positionalParamSegments:res.posParams??{}}}function split(segmentGroup,consumedSegments,slicedSegments,config){if(slicedSegments.length>0&&function containsEmptyPathMatchesWithNamedOutlets(segmentGroup,slicedSegments,routes){return routes.some((r=>emptyPathMatch(segmentGroup,slicedSegments,r)&&"primary"!==getOutlet(r)))}(segmentGroup,slicedSegments,config)){return{segmentGroup:new UrlSegmentGroup(consumedSegments,function createChildrenForEmptyPaths(routes,primarySegment){const res={};res.primary=primarySegment;for(const r of routes)if(""===r.path&&"primary"!==getOutlet(r)){const s=new UrlSegmentGroup([],{});res[getOutlet(r)]=s}return res}(config,new UrlSegmentGroup(slicedSegments,segmentGroup.children))),slicedSegments:[]}}if(0===slicedSegments.length&&function containsEmptyPathMatches(segmentGroup,slicedSegments,routes){return routes.some((r=>emptyPathMatch(segmentGroup,slicedSegments,r)))}(segmentGroup,slicedSegments,config)){const s=new UrlSegmentGroup(segmentGroup.segments,function addEmptyPathsToChildrenIfNeeded(segmentGroup,slicedSegments,routes,children){const res={};for(const r of routes)if(emptyPathMatch(segmentGroup,slicedSegments,r)&&!children[getOutlet(r)]){const s=new UrlSegmentGroup([],{});res[getOutlet(r)]=s}return{...children,...res}}(segmentGroup,slicedSegments,config,segmentGroup.children));return{segmentGroup:s,slicedSegments}}return{segmentGroup:new UrlSegmentGroup(segmentGroup.segments,segmentGroup.children),slicedSegments}}function emptyPathMatch(segmentGroup,slicedSegments,r){return(!(segmentGroup.hasChildren()||slicedSegments.length>0)||"full"!==r.pathMatch)&&""===r.path}class NoLeftoversInUrl{}class Recognizer{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(injector,configLoader,rootComponentType,config,urlTree,paramsInheritanceStrategy,urlSerializer){this.injector=injector,this.configLoader=configLoader,this.rootComponentType=rootComponentType,this.config=config,this.urlTree=urlTree,this.paramsInheritanceStrategy=paramsInheritanceStrategy,this.urlSerializer=urlSerializer,this.applyRedirects=new ApplyRedirects(this.urlSerializer,this.urlTree)}noMatchError(e){return new core["ɵRuntimeError"](4002,"undefined"==typeof ngDevMode||ngDevMode?`Cannot match any routes. URL Segment: '${e.segmentGroup}'`:`'${e.segmentGroup}'`)}recognize(){const rootSegmentGroup=split(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(rootSegmentGroup).pipe((0,map.T)((({children,rootSnapshot})=>{const rootNode=new TreeNode(rootSnapshot,children),routeState=new RouterStateSnapshot("",rootNode),tree=function createUrlTreeFromSnapshot(relativeTo,commands,queryParams=null,fragment=null){return createUrlTreeFromSegmentGroup(createSegmentGroupFromRoute(relativeTo),commands,queryParams,fragment)}(rootSnapshot,[],this.urlTree.queryParams,this.urlTree.fragment);return tree.queryParams=this.urlTree.queryParams,routeState.url=this.urlSerializer.serialize(tree),{state:routeState,tree}})))}match(rootSegmentGroup){const rootSnapshot=new ActivatedRouteSnapshot([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),"primary",this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,rootSegmentGroup,"primary",rootSnapshot).pipe((0,map.T)((children=>({children,rootSnapshot}))),(0,catchError.W)((e=>{if(e instanceof AbsoluteRedirect)return this.urlTree=e.urlTree,this.match(e.urlTree.root);if(e instanceof NoMatch)throw this.noMatchError(e);throw e})))}processSegmentGroup(injector,config,segmentGroup,outlet,parentRoute){return 0===segmentGroup.segments.length&&segmentGroup.hasChildren()?this.processChildren(injector,config,segmentGroup,parentRoute):this.processSegment(injector,config,segmentGroup,segmentGroup.segments,outlet,!0,parentRoute).pipe((0,map.T)((child=>child instanceof TreeNode?[child]:[])))}processChildren(injector,config,segmentGroup,parentRoute){const childOutlets=[];for(const child of Object.keys(segmentGroup.children))"primary"===child?childOutlets.unshift(child):childOutlets.push(child);return(0,from.H)(childOutlets).pipe((0,concatMap.H)((childOutlet=>{const child=segmentGroup.children[childOutlet],sortedConfig=function sortByMatchingOutlets(routes,outletName){const sortedConfig=routes.filter((r=>getOutlet(r)===outletName));return sortedConfig.push(...routes.filter((r=>getOutlet(r)!==outletName))),sortedConfig}(config,childOutlet);return this.processSegmentGroup(injector,sortedConfig,child,childOutlet,parentRoute)})),scan(((children,outletChildren)=>(children.push(...outletChildren),children))),defaultIfEmpty(null),function last(predicate,defaultValue){var hasDefaultValue=arguments.length>=2;return function(source){return source.pipe(predicate?(0,filter.p)((function(v,i){return predicate(v,i,source)})):identity.D,takeLast(1),hasDefaultValue?defaultIfEmpty(defaultValue):throwIfEmpty((function(){return new EmptyError.G})))}}(),(0,mergeMap.Z)((children=>{if(null===children)return noMatch$1(segmentGroup);const mergedChildren=mergeEmptyPathMatches(children);return("undefined"==typeof ngDevMode||ngDevMode)&&function checkOutletNameUniqueness(nodes){const names={};nodes.forEach((n=>{const routeWithSameOutletName=names[n.value.outlet];if(routeWithSameOutletName){const p=routeWithSameOutletName.url.map((s=>s.toString())).join("/"),c=n.value.url.map((s=>s.toString())).join("/");throw new core["ɵRuntimeError"](4006,("undefined"==typeof ngDevMode||ngDevMode)&&`Two segments cannot have the same outlet name: '${p}' and '${c}'.`)}names[n.value.outlet]=n.value}))}(mergedChildren),function sortActivatedRouteSnapshots(nodes){nodes.sort(((a,b)=>"primary"===a.value.outlet?-1:"primary"===b.value.outlet?1:a.value.outlet.localeCompare(b.value.outlet)))}(mergedChildren),(0,of.of)(mergedChildren)})))}processSegment(injector,routes,segmentGroup,segments,outlet,allowRedirects,parentRoute){return(0,from.H)(routes).pipe((0,concatMap.H)((r=>this.processSegmentAgainstRoute(r._injector??injector,routes,r,segmentGroup,segments,outlet,allowRedirects,parentRoute).pipe((0,catchError.W)((e=>{if(e instanceof NoMatch)return(0,of.of)(null);throw e}))))),first((x=>!!x)),(0,catchError.W)((e=>{if(isEmptyError(e))return function noLeftoversInUrl(segmentGroup,segments,outlet){return 0===segments.length&&!segmentGroup.children[outlet]}(segmentGroup,segments,outlet)?(0,of.of)(new NoLeftoversInUrl):noMatch$1(segmentGroup);throw e})))}processSegmentAgainstRoute(injector,routes,route,rawSegment,segments,outlet,allowRedirects,parentRoute){return getOutlet(route)===outlet||"primary"!==outlet&&emptyPathMatch(rawSegment,segments,route)?void 0===route.redirectTo?this.matchSegmentAgainstRoute(injector,rawSegment,route,segments,outlet,parentRoute):this.allowRedirects&&allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(injector,rawSegment,routes,route,segments,outlet,parentRoute):noMatch$1(rawSegment):noMatch$1(rawSegment)}expandSegmentAgainstRouteUsingRedirect(injector,segmentGroup,routes,route,segments,outlet,parentRoute){const{matched,parameters,consumedSegments,positionalParamSegments,remainingSegments}=match(segmentGroup,route,segments);if(!matched)return noMatch$1(segmentGroup);if("string"==typeof route.redirectTo&&"/"===route.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31)){if(ngDevMode)throw new core["ɵRuntimeError"](4016,`Detected possible infinite redirect when redirecting from '${this.urlTree}' to '${route.redirectTo}'.\nThis is currently a dev mode only error but will become a call stack size exceeded error in production in a future major version.`);this.allowRedirects=!1}const currentSnapshot=new ActivatedRouteSnapshot(segments,parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,getData(route),getOutlet(route),route.component??route._loadedComponent??null,route,getResolve(route)),inherited=getInherited(currentSnapshot,parentRoute,this.paramsInheritanceStrategy);currentSnapshot.params=Object.freeze(inherited.params),currentSnapshot.data=Object.freeze(inherited.data);const newTree=this.applyRedirects.applyRedirectCommands(consumedSegments,route.redirectTo,positionalParamSegments,currentSnapshot,injector);return this.applyRedirects.lineralizeSegments(route,newTree).pipe((0,mergeMap.Z)((newSegments=>this.processSegment(injector,routes,segmentGroup,newSegments.concat(remainingSegments),outlet,!1,parentRoute))))}matchSegmentAgainstRoute(injector,rawSegment,route,segments,outlet,parentRoute){const matchResult=matchWithChecks(rawSegment,route,segments,injector,this.urlSerializer);return"**"===route.path&&(rawSegment.children={}),matchResult.pipe((0,switchMap.n)((result=>result.matched?(injector=route._injector??injector,this.getChildConfig(injector,route,segments).pipe((0,switchMap.n)((({routes:childConfig})=>{const childInjector=route._loadedInjector??injector,{parameters,consumedSegments,remainingSegments}=result,snapshot=new ActivatedRouteSnapshot(consumedSegments,parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,getData(route),getOutlet(route),route.component??route._loadedComponent??null,route,getResolve(route)),inherited=getInherited(snapshot,parentRoute,this.paramsInheritanceStrategy);snapshot.params=Object.freeze(inherited.params),snapshot.data=Object.freeze(inherited.data);const{segmentGroup,slicedSegments}=split(rawSegment,consumedSegments,remainingSegments,childConfig);if(0===slicedSegments.length&&segmentGroup.hasChildren())return this.processChildren(childInjector,childConfig,segmentGroup,snapshot).pipe((0,map.T)((children=>new TreeNode(snapshot,children))));if(0===childConfig.length&&0===slicedSegments.length)return(0,of.of)(new TreeNode(snapshot,[]));const matchedOnOutlet=getOutlet(route)===outlet;return this.processSegment(childInjector,childConfig,segmentGroup,slicedSegments,matchedOnOutlet?"primary":outlet,!0,snapshot).pipe((0,map.T)((child=>new TreeNode(snapshot,child instanceof TreeNode?[child]:[]))))})))):noMatch$1(rawSegment))))}getChildConfig(injector,route,segments){return route.children?(0,of.of)({routes:route.children,injector}):route.loadChildren?void 0!==route._loadedRoutes?(0,of.of)({routes:route._loadedRoutes,injector:route._loadedInjector}):runCanLoadGuards(injector,route,segments,this.urlSerializer).pipe((0,mergeMap.Z)((shouldLoadResult=>shouldLoadResult?this.configLoader.loadChildren(injector,route).pipe((0,tap.M)((cfg=>{route._loadedRoutes=cfg.routes,route._loadedInjector=cfg.injector}))):function canLoadFails(route){return throwError_throwError(navigationCancelingError(("undefined"==typeof ngDevMode||ngDevMode)&&`Cannot load children because the guard of the route "path: '${route.path}'" returned false`,NavigationCancellationCode.GuardRejected))}(route)))):(0,of.of)({routes:[],injector})}}function hasEmptyPathConfig(node){const config=node.value.routeConfig;return config&&""===config.path}function mergeEmptyPathMatches(nodes){const result=[],mergedNodes=new Set;for(const node of nodes){if(!hasEmptyPathConfig(node)){result.push(node);continue}const duplicateEmptyPathNode=result.find((resultNode=>node.value.routeConfig===resultNode.value.routeConfig));void 0!==duplicateEmptyPathNode?(duplicateEmptyPathNode.children.push(...node.children),mergedNodes.add(duplicateEmptyPathNode)):result.push(node)}for(const mergedNode of mergedNodes){const mergedChildren=mergeEmptyPathMatches(mergedNode.children);result.push(new TreeNode(mergedNode.value,mergedChildren))}return result.filter((n=>!mergedNodes.has(n)))}function getData(route){return route.data||{}}function getResolve(route){return route.resolve||{}}function recognize(injector,configLoader,rootComponentType,config,serializer,paramsInheritanceStrategy){return(0,mergeMap.Z)((t=>function recognize$1(injector,configLoader,rootComponentType,config,urlTree,urlSerializer,paramsInheritanceStrategy="emptyOnly"){return new Recognizer(injector,configLoader,rootComponentType,config,urlTree,paramsInheritanceStrategy,urlSerializer).recognize()}(injector,configLoader,rootComponentType,config,t.extractedUrl,serializer,paramsInheritanceStrategy).pipe((0,map.T)((({state:targetSnapshot,tree:urlAfterRedirects})=>({...t,targetSnapshot,urlAfterRedirects}))))))}function resolveData(paramsInheritanceStrategy,injector){return(0,mergeMap.Z)((t=>{const{targetSnapshot,guards:{canActivateChecks}}=t;if(!canActivateChecks.length)return(0,of.of)(t);const routesWithResolversToRun=new Set(canActivateChecks.map((check=>check.route))),routesNeedingDataUpdates=new Set;for(const route of routesWithResolversToRun)if(!routesNeedingDataUpdates.has(route))for(const newRoute of flattenRouteTree(route))routesNeedingDataUpdates.add(newRoute);let routesProcessed=0;return(0,from.H)(routesNeedingDataUpdates).pipe((0,concatMap.H)((route=>routesWithResolversToRun.has(route)?function runResolve(futureARS,futureRSS,paramsInheritanceStrategy,injector){const config=futureARS.routeConfig,resolve=futureARS._resolve;void 0===config?.title||hasStaticTitle(config)||(resolve[RouteTitleKey]=config.title);return function resolveNode(resolve,futureARS,futureRSS,injector){const keys=getDataKeys(resolve);if(0===keys.length)return(0,of.of)({});const data={};return(0,from.H)(keys).pipe((0,mergeMap.Z)((key=>function getResolver(injectionToken,futureARS,futureRSS,injector){const closestInjector=getClosestRouteInjector(futureARS)??injector,resolver=getTokenOrFunctionIdentity(injectionToken,closestInjector),resolverValue=resolver.resolve?resolver.resolve(futureARS,futureRSS):(0,core.runInInjectionContext)(closestInjector,(()=>resolver(futureARS,futureRSS)));return wrapIntoObservable(resolverValue)}(resolve[key],futureARS,futureRSS,injector).pipe(first(),(0,tap.M)((value=>{if(value instanceof RedirectCommand)throw redirectingNavigationError(new DefaultUrlSerializer,value);data[key]=value}))))),takeLast(1),function mapTo(value){return(0,map.T)((function(){return value}))}(data),(0,catchError.W)((e=>isEmptyError(e)?empty.w:throwError_throwError(e))))}(resolve,futureARS,futureRSS,injector).pipe((0,map.T)((resolvedData=>(futureARS._resolvedData=resolvedData,futureARS.data=getInherited(futureARS,futureARS.parent,paramsInheritanceStrategy).resolve,null))))}(route,targetSnapshot,paramsInheritanceStrategy,injector):(route.data=getInherited(route,route.parent,paramsInheritanceStrategy).resolve,(0,of.of)(void 0)))),(0,tap.M)((()=>routesProcessed++)),takeLast(1),(0,mergeMap.Z)((_=>routesProcessed===routesNeedingDataUpdates.size?(0,of.of)(t):empty.w)))}))}function flattenRouteTree(route){const descendants=route.children.map((child=>flattenRouteTree(child))).flat();return[route,...descendants]}function switchTap(next){return(0,switchMap.n)((v=>{const nextResult=next(v);return nextResult?(0,from.H)(nextResult).pipe((0,map.T)((()=>v))):(0,of.of)(v)}))}class TitleStrategy{buildTitle(snapshot){let pageTitle,route=snapshot.root;for(;void 0!==route;)pageTitle=this.getResolvedTitleForRoute(route)??pageTitle,route=route.children.find((child=>"primary"===child.outlet));return pageTitle}getResolvedTitleForRoute(snapshot){return snapshot.data[RouteTitleKey]}static ɵfac=function TitleStrategy_Factory(__ngFactoryType__){return new(__ngFactoryType__||TitleStrategy)};static ɵprov=core["ɵɵdefineInjectable"]({token:TitleStrategy,factory:()=>(0,core.inject)(DefaultTitleStrategy),providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](TitleStrategy,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(DefaultTitleStrategy)}]}],null,null);class DefaultTitleStrategy extends TitleStrategy{title;constructor(title){super(),this.title=title}updateTitle(snapshot){const title=this.buildTitle(snapshot);void 0!==title&&this.title.setTitle(title)}static ɵfac=function DefaultTitleStrategy_Factory(__ngFactoryType__){return new(__ngFactoryType__||DefaultTitleStrategy)(core["ɵɵinject"](platform_browser.Title))};static ɵprov=core["ɵɵdefineInjectable"]({token:DefaultTitleStrategy,factory:DefaultTitleStrategy.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](DefaultTitleStrategy,[{type:core.Injectable,args:[{providedIn:"root"}]}],(()=>[{type:platform_browser.Title}]),null);const ROUTER_CONFIGURATION=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"router config":"",{providedIn:"root",factory:()=>({})});class ɵEmptyOutletComponent{static ɵfac=function ɵEmptyOutletComponent_Factory(__ngFactoryType__){return new(__ngFactoryType__||ɵEmptyOutletComponent)};static ɵcmp=core["ɵɵdefineComponent"]({type:ɵEmptyOutletComponent,selectors:[["ng-component"]],decls:1,vars:0,template:function _EmptyOutletComponent_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"router-outlet")},dependencies:[RouterOutlet],encapsulation:2})}function standardizeConfig(r){const children=r.children&&r.children.map(standardizeConfig),c=children?{...r,children}:{...r};return c.component||c.loadComponent||!children&&!c.loadChildren||!c.outlet||"primary"===c.outlet||(c.component=ɵEmptyOutletComponent),c}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](ɵEmptyOutletComponent,[{type:core.Component,args:[{template:"<router-outlet></router-outlet>",imports:[RouterOutlet]}]}],null,null);const ROUTES=new core.InjectionToken(ngDevMode?"ROUTES":"");class RouterConfigLoader{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=(0,core.inject)(core.Compiler);loadComponent(route){if(this.componentLoaders.get(route))return this.componentLoaders.get(route);if(route._loadedComponent)return(0,of.of)(route._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(route);const loadRunner=wrapIntoObservable(route.loadComponent()).pipe((0,map.T)(maybeUnwrapDefaultExport),(0,tap.M)((component=>{this.onLoadEndListener&&this.onLoadEndListener(route),("undefined"==typeof ngDevMode||ngDevMode)&&assertStandalone(route.path??"",component),route._loadedComponent=component})),(0,finalize.j)((()=>{this.componentLoaders.delete(route)}))),loader=new ConnectableObservable.G(loadRunner,(()=>new Subject.B)).pipe((0,refCount.B)());return this.componentLoaders.set(route,loader),loader}loadChildren(parentInjector,route){if(this.childrenLoaders.get(route))return this.childrenLoaders.get(route);if(route._loadedRoutes)return(0,of.of)({routes:route._loadedRoutes,injector:route._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(route);const moduleFactoryOrRoutes$=function loadChildren(route,compiler,parentInjector,onLoadEndListener){return wrapIntoObservable(route.loadChildren()).pipe((0,map.T)(maybeUnwrapDefaultExport),(0,mergeMap.Z)((t=>t instanceof core.NgModuleFactory||Array.isArray(t)?(0,of.of)(t):(0,from.H)(compiler.compileModuleAsync(t)))),(0,map.T)((factoryOrRoutes=>{let injector,rawRoutes;onLoadEndListener&&onLoadEndListener(route);let requireStandaloneComponents=!1;Array.isArray(factoryOrRoutes)?(rawRoutes=factoryOrRoutes,requireStandaloneComponents=!0):(injector=factoryOrRoutes.create(parentInjector).injector,rawRoutes=injector.get(ROUTES,[],{optional:!0,self:!0}).flat());const routes=rawRoutes.map(standardizeConfig);return("undefined"==typeof ngDevMode||ngDevMode)&&validateConfig(routes,route.path,requireStandaloneComponents),{routes,injector}})))}(route,this.compiler,parentInjector,this.onLoadEndListener),loadRunner=moduleFactoryOrRoutes$.pipe((0,finalize.j)((()=>{this.childrenLoaders.delete(route)}))),loader=new ConnectableObservable.G(loadRunner,(()=>new Subject.B)).pipe((0,refCount.B)());return this.childrenLoaders.set(route,loader),loader}static ɵfac=function RouterConfigLoader_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouterConfigLoader)};static ɵprov=core["ɵɵdefineInjectable"]({token:RouterConfigLoader,factory:RouterConfigLoader.ɵfac,providedIn:"root"})}function maybeUnwrapDefaultExport(input){return function isWrappedDefaultExport(value){return value&&"object"==typeof value&&"default"in value}(input)?input.default:input}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterConfigLoader,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class UrlHandlingStrategy{static ɵfac=function UrlHandlingStrategy_Factory(__ngFactoryType__){return new(__ngFactoryType__||UrlHandlingStrategy)};static ɵprov=core["ɵɵdefineInjectable"]({token:UrlHandlingStrategy,factory:()=>(0,core.inject)(DefaultUrlHandlingStrategy),providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](UrlHandlingStrategy,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(DefaultUrlHandlingStrategy)}]}],null,null);class DefaultUrlHandlingStrategy{shouldProcessUrl(url){return!0}extract(url){return url}merge(newUrlPart,wholeUrl){return newUrlPart}static ɵfac=function DefaultUrlHandlingStrategy_Factory(__ngFactoryType__){return new(__ngFactoryType__||DefaultUrlHandlingStrategy)};static ɵprov=core["ɵɵdefineInjectable"]({token:DefaultUrlHandlingStrategy,factory:DefaultUrlHandlingStrategy.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](DefaultUrlHandlingStrategy,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);const CREATE_VIEW_TRANSITION=new core.InjectionToken(ngDevMode?"view transition helper":""),VIEW_TRANSITION_OPTIONS=new core.InjectionToken(ngDevMode?"view transition options":"");function createViewTransition(injector,from,to){const transitionOptions=injector.get(VIEW_TRANSITION_OPTIONS),document=injector.get(common.DOCUMENT);return injector.get(core.NgZone).runOutsideAngular((()=>{if(!document.startViewTransition||transitionOptions.skipNextTransition)return transitionOptions.skipNextTransition=!1,new Promise((resolve=>setTimeout(resolve)));let resolveViewTransitionStarted;const viewTransitionStarted=new Promise((resolve=>{resolveViewTransitionStarted=resolve})),transition=document.startViewTransition((()=>(resolveViewTransitionStarted(),function createRenderPromise(injector){return new Promise((resolve=>{(0,core.afterNextRender)({read:()=>setTimeout(resolve)},{injector})}))}(injector)))),{onViewTransitionCreated}=transitionOptions;return onViewTransitionCreated&&(0,core.runInInjectionContext)(injector,(()=>onViewTransitionCreated({transition,from,to}))),viewTransitionStarted}))}const NAVIGATION_ERROR_HANDLER=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"navigation error handler":"");class NavigationTransitions{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Subject.B;transitionAbortSubject=new Subject.B;configLoader=(0,core.inject)(RouterConfigLoader);environmentInjector=(0,core.inject)(core.EnvironmentInjector);urlSerializer=(0,core.inject)(UrlSerializer);rootContexts=(0,core.inject)(ChildrenOutletContexts);location=(0,core.inject)(common.Location);inputBindingEnabled=null!==(0,core.inject)(INPUT_BINDER,{optional:!0});titleStrategy=(0,core.inject)(TitleStrategy);options=(0,core.inject)(ROUTER_CONFIGURATION,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=(0,core.inject)(UrlHandlingStrategy);createViewTransition=(0,core.inject)(CREATE_VIEW_TRANSITION,{optional:!0});navigationErrorHandler=(0,core.inject)(NAVIGATION_ERROR_HANDLER,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>(0,of.of)(void 0);rootComponentType=null;constructor(){this.configLoader.onLoadEndListener=r=>this.events.next(new RouteConfigLoadEnd(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new RouteConfigLoadStart(r))}complete(){this.transitions?.complete()}handleNavigationRequest(request){const id=++this.navigationId;this.transitions?.next({...this.transitions.value,...request,id})}setupNavigations(router,initialUrlTree,initialRouterState){return this.transitions=new BehaviorSubject.t({id:0,currentUrlTree:initialUrlTree,currentRawUrl:initialUrlTree,extractedUrl:this.urlHandlingStrategy.extract(initialUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(initialUrlTree),rawUrl:initialUrlTree,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:initialRouterState.snapshot,targetSnapshot:null,currentRouterState:initialRouterState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,filter.p)((t=>0!==t.id)),(0,map.T)((t=>({...t,extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl)}))),(0,switchMap.n)((overallTransitionState=>{let completed=!1,errored=!1;return(0,of.of)(overallTransitionState).pipe((0,switchMap.n)((t=>{if(this.navigationId>overallTransitionState.id){const cancellationReason="undefined"==typeof ngDevMode||ngDevMode?`Navigation ID ${overallTransitionState.id} is not equal to the current navigation id ${this.navigationId}`:"";return this.cancelNavigationTransition(overallTransitionState,cancellationReason,NavigationCancellationCode.SupersededByNewNavigation),empty.w}this.currentTransition=overallTransitionState,this.currentNavigation={id:t.id,initialUrl:t.rawUrl,extractedUrl:t.extractedUrl,targetBrowserUrl:"string"==typeof t.extras.browserUrl?this.urlSerializer.parse(t.extras.browserUrl):t.extras.browserUrl,trigger:t.source,extras:t.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const urlTransition=!router.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),onSameUrlNavigation=t.extras.onSameUrlNavigation??router.onSameUrlNavigation;if(!urlTransition&&"reload"!==onSameUrlNavigation){const reason="undefined"==typeof ngDevMode||ngDevMode?`Navigation to ${t.rawUrl} was ignored because it is the same as the current Router URL.`:"";return this.events.next(new NavigationSkipped(t.id,this.urlSerializer.serialize(t.rawUrl),reason,NavigationSkippedCode.IgnoredSameUrlNavigation)),t.resolve(!1),empty.w}if(this.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return(0,of.of)(t).pipe((0,switchMap.n)((t=>{const transition=this.transitions?.getValue();return this.events.next(new NavigationStart(t.id,this.urlSerializer.serialize(t.extractedUrl),t.source,t.restoredState)),transition!==this.transitions?.getValue()?empty.w:Promise.resolve(t)})),recognize(this.environmentInjector,this.configLoader,this.rootComponentType,router.config,this.urlSerializer,this.paramsInheritanceStrategy),(0,tap.M)((t=>{overallTransitionState.targetSnapshot=t.targetSnapshot,overallTransitionState.urlAfterRedirects=t.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:t.urlAfterRedirects};const routesRecognized=new RoutesRecognized(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(routesRecognized)})));if(urlTransition&&this.urlHandlingStrategy.shouldProcessUrl(t.currentRawUrl)){const{id,extractedUrl,source,restoredState,extras}=t,navStart=new NavigationStart(id,this.urlSerializer.serialize(extractedUrl),source,restoredState);this.events.next(navStart);const targetSnapshot=createEmptyState(this.rootComponentType).snapshot;return this.currentTransition=overallTransitionState={...t,targetSnapshot,urlAfterRedirects:extractedUrl,extras:{...extras,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=extractedUrl,(0,of.of)(overallTransitionState)}{const reason="undefined"==typeof ngDevMode||ngDevMode?`Navigation was ignored because the UrlHandlingStrategy indicated neither the current URL ${t.currentRawUrl} nor target URL ${t.rawUrl} should be processed.`:"";return this.events.next(new NavigationSkipped(t.id,this.urlSerializer.serialize(t.extractedUrl),reason,NavigationSkippedCode.IgnoredByUrlHandlingStrategy)),t.resolve(!1),empty.w}})),(0,tap.M)((t=>{const guardsStart=new GuardsCheckStart(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(guardsStart)})),(0,map.T)((t=>(this.currentTransition=overallTransitionState={...t,guards:getAllRouteGuards(t.targetSnapshot,t.currentSnapshot,this.rootContexts)},overallTransitionState))),checkGuards(this.environmentInjector,(evt=>this.events.next(evt))),(0,tap.M)((t=>{if(overallTransitionState.guardsResult=t.guardsResult,t.guardsResult&&"boolean"!=typeof t.guardsResult)throw redirectingNavigationError(this.urlSerializer,t.guardsResult);const guardsEnd=new GuardsCheckEnd(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);this.events.next(guardsEnd)})),(0,filter.p)((t=>!!t.guardsResult||(this.cancelNavigationTransition(t,"",NavigationCancellationCode.GuardRejected),!1))),switchTap((t=>{if(t.guards.canActivateChecks.length)return(0,of.of)(t).pipe((0,tap.M)((t=>{const resolveStart=new ResolveStart(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(resolveStart)})),(0,switchMap.n)((t=>{let dataResolved=!1;return(0,of.of)(t).pipe(resolveData(this.paramsInheritanceStrategy,this.environmentInjector),(0,tap.M)({next:()=>dataResolved=!0,complete:()=>{dataResolved||this.cancelNavigationTransition(t,"undefined"==typeof ngDevMode||ngDevMode?"At least one route resolver didn't emit any value.":"",NavigationCancellationCode.NoDataFromResolver)}}))})),(0,tap.M)((t=>{const resolveEnd=new ResolveEnd(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects),t.targetSnapshot);this.events.next(resolveEnd)})))})),switchTap((t=>{const loadComponents=route=>{const loaders=[];route.routeConfig?.loadComponent&&!route.routeConfig._loadedComponent&&loaders.push(this.configLoader.loadComponent(route.routeConfig).pipe((0,tap.M)((loadedComponent=>{route.component=loadedComponent})),(0,map.T)((()=>{}))));for(const child of route.children)loaders.push(...loadComponents(child));return loaders};return(0,combineLatest.z)(loadComponents(t.targetSnapshot.root)).pipe(defaultIfEmpty(null),(0,take.s)(1))})),switchTap((()=>this.afterPreactivation())),(0,switchMap.n)((()=>{const{currentSnapshot,targetSnapshot}=overallTransitionState,viewTransitionStarted=this.createViewTransition?.(this.environmentInjector,currentSnapshot.root,targetSnapshot.root);return viewTransitionStarted?(0,from.H)(viewTransitionStarted).pipe((0,map.T)((()=>overallTransitionState))):(0,of.of)(overallTransitionState)})),(0,map.T)((t=>{const targetRouterState=function createRouterState(routeReuseStrategy,curr,prevState){const root=createNode(routeReuseStrategy,curr._root,prevState?prevState._root:void 0);return new RouterState(root,curr)}(router.routeReuseStrategy,t.targetSnapshot,t.currentRouterState);return this.currentTransition=overallTransitionState={...t,targetRouterState},this.currentNavigation.targetRouterState=targetRouterState,overallTransitionState})),(0,tap.M)((()=>{this.events.next(new BeforeActivateRoutes)})),(rootContexts=this.rootContexts,routeReuseStrategy=router.routeReuseStrategy,forwardEvent=evt=>this.events.next(evt),inputBindingEnabled=this.inputBindingEnabled,(0,map.T)((t=>(new ActivateRoutes(routeReuseStrategy,t.targetRouterState,t.currentRouterState,forwardEvent,inputBindingEnabled).activate(rootContexts),t)))),(0,take.s)(1),(0,tap.M)({next:t=>{completed=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new NavigationEnd(t.id,this.urlSerializer.serialize(t.extractedUrl),this.urlSerializer.serialize(t.urlAfterRedirects))),this.titleStrategy?.updateTitle(t.targetRouterState.snapshot),t.resolve(!0)},complete:()=>{completed=!0}}),(0,takeUntil.Q)(this.transitionAbortSubject.pipe((0,tap.M)((err=>{throw err})))),(0,finalize.j)((()=>{if(!completed&&!errored){const cancelationReason="undefined"==typeof ngDevMode||ngDevMode?`Navigation ID ${overallTransitionState.id} is not equal to the current navigation id ${this.navigationId}`:"";this.cancelNavigationTransition(overallTransitionState,cancelationReason,NavigationCancellationCode.SupersededByNewNavigation)}this.currentTransition?.id===overallTransitionState.id&&(this.currentNavigation=null,this.currentTransition=null)})),(0,catchError.W)((e=>{if(errored=!0,isNavigationCancelingError(e))this.events.next(new NavigationCancel(overallTransitionState.id,this.urlSerializer.serialize(overallTransitionState.extractedUrl),e.message,e.cancellationCode)),!function isRedirectingNavigationCancelingError(error){return isNavigationCancelingError(error)&&isUrlTree(error.url)}(e)?overallTransitionState.resolve(!1):this.events.next(new RedirectRequest(e.url,e.navigationBehaviorOptions));else{const navigationError=new NavigationError(overallTransitionState.id,this.urlSerializer.serialize(overallTransitionState.extractedUrl),e,overallTransitionState.targetSnapshot??void 0);try{const navigationErrorHandlerResult=(0,core.runInInjectionContext)(this.environmentInjector,(()=>this.navigationErrorHandler?.(navigationError)));if(!(navigationErrorHandlerResult instanceof RedirectCommand))throw this.events.next(navigationError),e;{const{message,cancellationCode}=redirectingNavigationError(this.urlSerializer,navigationErrorHandlerResult);this.events.next(new NavigationCancel(overallTransitionState.id,this.urlSerializer.serialize(overallTransitionState.extractedUrl),message,cancellationCode)),this.events.next(new RedirectRequest(navigationErrorHandlerResult.redirectTo,navigationErrorHandlerResult.navigationBehaviorOptions))}}catch(ee){this.options.resolveNavigationPromiseOnError?overallTransitionState.resolve(!1):overallTransitionState.reject(ee)}}return empty.w})));var rootContexts,routeReuseStrategy,forwardEvent,inputBindingEnabled})))}cancelNavigationTransition(t,reason,code){const navCancel=new NavigationCancel(t.id,this.urlSerializer.serialize(t.extractedUrl),reason,code);this.events.next(navCancel),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const currentBrowserUrl=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),targetBrowserUrl=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return currentBrowserUrl.toString()!==targetBrowserUrl?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static ɵfac=function NavigationTransitions_Factory(__ngFactoryType__){return new(__ngFactoryType__||NavigationTransitions)};static ɵprov=core["ɵɵdefineInjectable"]({token:NavigationTransitions,factory:NavigationTransitions.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NavigationTransitions,[{type:core.Injectable,args:[{providedIn:"root"}]}],(()=>[]),null);class RouteReuseStrategy{static ɵfac=function RouteReuseStrategy_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouteReuseStrategy)};static ɵprov=core["ɵɵdefineInjectable"]({token:RouteReuseStrategy,factory:()=>(0,core.inject)(DefaultRouteReuseStrategy),providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouteReuseStrategy,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(DefaultRouteReuseStrategy)}]}],null,null);class BaseRouteReuseStrategy{shouldDetach(route){return!1}store(route,detachedTree){}shouldAttach(route){return!1}retrieve(route){return null}shouldReuseRoute(future,curr){return future.routeConfig===curr.routeConfig}}class DefaultRouteReuseStrategy extends BaseRouteReuseStrategy{static ɵfac=(()=>{let ɵDefaultRouteReuseStrategy_BaseFactory;return function DefaultRouteReuseStrategy_Factory(__ngFactoryType__){return(ɵDefaultRouteReuseStrategy_BaseFactory||(ɵDefaultRouteReuseStrategy_BaseFactory=core["ɵɵgetInheritedFactory"](DefaultRouteReuseStrategy)))(__ngFactoryType__||DefaultRouteReuseStrategy)}})();static ɵprov=core["ɵɵdefineInjectable"]({token:DefaultRouteReuseStrategy,factory:DefaultRouteReuseStrategy.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](DefaultRouteReuseStrategy,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class StateManager{static ɵfac=function StateManager_Factory(__ngFactoryType__){return new(__ngFactoryType__||StateManager)};static ɵprov=core["ɵɵdefineInjectable"]({token:StateManager,factory:()=>(0,core.inject)(HistoryStateManager),providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](StateManager,[{type:core.Injectable,args:[{providedIn:"root",useFactory:()=>(0,core.inject)(HistoryStateManager)}]}],null,null);class HistoryStateManager extends StateManager{location=(0,core.inject)(common.Location);urlSerializer=(0,core.inject)(UrlSerializer);options=(0,core.inject)(ROUTER_CONFIGURATION,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=(0,core.inject)(UrlHandlingStrategy);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new UrlTree;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.ɵrouterPageId??this.currentPageId}routerState=createEmptyState(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(listener){return this.location.subscribe((event=>{"popstate"===event.type&&listener(event.url,event.state)}))}handleRouterEvent(e,currentTransition){if(e instanceof NavigationStart)this.stateMemento=this.createStateMemento();else if(e instanceof NavigationSkipped)this.rawUrlTree=currentTransition.initialUrl;else if(e instanceof RoutesRecognized){if("eager"===this.urlUpdateStrategy&&!currentTransition.extras.skipLocationChange){const rawUrl=this.urlHandlingStrategy.merge(currentTransition.finalUrl,currentTransition.initialUrl);this.setBrowserUrl(currentTransition.targetBrowserUrl??rawUrl,currentTransition)}}else e instanceof BeforeActivateRoutes?(this.currentUrlTree=currentTransition.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(currentTransition.finalUrl,currentTransition.initialUrl),this.routerState=currentTransition.targetRouterState,"deferred"!==this.urlUpdateStrategy||currentTransition.extras.skipLocationChange||this.setBrowserUrl(currentTransition.targetBrowserUrl??this.rawUrlTree,currentTransition)):e instanceof NavigationCancel&&(e.code===NavigationCancellationCode.GuardRejected||e.code===NavigationCancellationCode.NoDataFromResolver)?this.restoreHistory(currentTransition):e instanceof NavigationError?this.restoreHistory(currentTransition,!0):e instanceof NavigationEnd&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(url,transition){const path=url instanceof UrlTree?this.urlSerializer.serialize(url):url;if(this.location.isCurrentPathEqualTo(path)||transition.extras.replaceUrl){const currentBrowserPageId=this.browserPageId,state={...transition.extras.state,...this.generateNgRouterState(transition.id,currentBrowserPageId)};this.location.replaceState(path,"",state)}else{const state={...transition.extras.state,...this.generateNgRouterState(transition.id,this.browserPageId+1)};this.location.go(path,"",state)}}restoreHistory(navigation,restoringFromCaughtError=!1){if("computed"===this.canceledNavigationResolution){const currentBrowserPageId=this.browserPageId,targetPagePosition=this.currentPageId-currentBrowserPageId;0!==targetPagePosition?this.location.historyGo(targetPagePosition):this.currentUrlTree===navigation.finalUrl&&0===targetPagePosition&&(this.resetState(navigation),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(restoringFromCaughtError&&this.resetState(navigation),this.resetUrlToCurrentUrlTree())}resetState(navigation){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,navigation.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(navigationId,routerPageId){return"computed"===this.canceledNavigationResolution?{navigationId,ɵrouterPageId:routerPageId}:{navigationId}}static ɵfac=(()=>{let ɵHistoryStateManager_BaseFactory;return function HistoryStateManager_Factory(__ngFactoryType__){return(ɵHistoryStateManager_BaseFactory||(ɵHistoryStateManager_BaseFactory=core["ɵɵgetInheritedFactory"](HistoryStateManager)))(__ngFactoryType__||HistoryStateManager)}})();static ɵprov=core["ɵɵdefineInjectable"]({token:HistoryStateManager,factory:HistoryStateManager.ɵfac,providedIn:"root"})}var NavigationResult;function afterNextNavigation(router,action){router.events.pipe((0,filter.p)((e=>e instanceof NavigationEnd||e instanceof NavigationCancel||e instanceof NavigationError||e instanceof NavigationSkipped)),(0,map.T)((e=>{if(e instanceof NavigationEnd||e instanceof NavigationSkipped)return NavigationResult.COMPLETE;return e instanceof NavigationCancel&&(e.code===NavigationCancellationCode.Redirect||e.code===NavigationCancellationCode.SupersededByNewNavigation)?NavigationResult.REDIRECTING:NavigationResult.FAILED})),(0,filter.p)((result=>result!==NavigationResult.REDIRECTING)),(0,take.s)(1)).subscribe((()=>{action()}))}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](HistoryStateManager,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null),function(NavigationResult){NavigationResult[NavigationResult.COMPLETE=0]="COMPLETE",NavigationResult[NavigationResult.FAILED=1]="FAILED",NavigationResult[NavigationResult.REDIRECTING=2]="REDIRECTING"}(NavigationResult||(NavigationResult={}));const exactMatchOptions={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},subsetMatchOptions={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};class Router{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=(0,core.inject)(core["ɵConsole"]);stateManager=(0,core.inject)(StateManager);options=(0,core.inject)(ROUTER_CONFIGURATION,{optional:!0})||{};pendingTasks=(0,core.inject)(core["ɵPendingTasksInternal"]);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=(0,core.inject)(NavigationTransitions);urlSerializer=(0,core.inject)(UrlSerializer);location=(0,core.inject)(common.Location);urlHandlingStrategy=(0,core.inject)(UrlHandlingStrategy);_events=new Subject.B;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=(0,core.inject)(RouteReuseStrategy);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=(0,core.inject)(ROUTES,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!(0,core.inject)(INPUT_BINDER,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(ngDevMode?`Unhandled Navigation Error: ${e}`:e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Subscription.yU;subscribeToNavigationEvents(){const subscription=this.navigationTransitions.events.subscribe((e=>{try{const currentTransition=this.navigationTransitions.currentTransition,currentNavigation=this.navigationTransitions.currentNavigation;if(null!==currentTransition&&null!==currentNavigation)if(this.stateManager.handleRouterEvent(e,currentNavigation),e instanceof NavigationCancel&&e.code!==NavigationCancellationCode.Redirect&&e.code!==NavigationCancellationCode.SupersededByNewNavigation)this.navigated=!0;else if(e instanceof NavigationEnd)this.navigated=!0;else if(e instanceof RedirectRequest){const opts=e.navigationBehaviorOptions,mergedTree=this.urlHandlingStrategy.merge(e.url,currentTransition.currentRawUrl),extras={browserUrl:currentTransition.extras.browserUrl,info:currentTransition.extras.info,skipLocationChange:currentTransition.extras.skipLocationChange,replaceUrl:currentTransition.extras.replaceUrl||"eager"===this.urlUpdateStrategy||(source=currentTransition.source,"imperative"!==source),...opts};this.scheduleNavigation(mergedTree,"imperative",null,extras,{resolve:currentTransition.resolve,reject:currentTransition.reject,promise:currentTransition.promise})}(function isPublicRouterEvent(e){return!(e instanceof BeforeActivateRoutes||e instanceof RedirectRequest)})(e)&&this._events.next(e)}catch(e){this.navigationTransitions.transitionAbortSubject.next(e)}var source}));this.eventsSubscription.add(subscription)}resetRootComponentType(rootComponentType){this.routerState.root.component=rootComponentType,this.navigationTransitions.rootComponentType=rootComponentType}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),"imperative",this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener(((url,state)=>{setTimeout((()=>{this.navigateToSyncWithBrowser(url,"popstate",state)}),0)}))}navigateToSyncWithBrowser(url,source,state){const extras={replaceUrl:!0},restoredState=state?.navigationId?state:null;if(state){const stateCopy={...state};delete stateCopy.navigationId,delete stateCopy.ɵrouterPageId,0!==Object.keys(stateCopy).length&&(extras.state=stateCopy)}const urlTree=this.parseUrl(url);this.scheduleNavigation(urlTree,source,restoredState,extras)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(config){("undefined"==typeof ngDevMode||ngDevMode)&&validateConfig(config),this.config=config.map(standardizeConfig),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(commands,navigationExtras={}){const{relativeTo,queryParams,fragment,queryParamsHandling,preserveFragment}=navigationExtras,f=preserveFragment?this.currentUrlTree.fragment:fragment;let relativeToUrlSegmentGroup,q=null;switch(queryParamsHandling??this.options.defaultQueryParamsHandling){case"merge":q={...this.currentUrlTree.queryParams,...queryParams};break;case"preserve":q=this.currentUrlTree.queryParams;break;default:q=queryParams||null}null!==q&&(q=this.removeEmptyProps(q));try{relativeToUrlSegmentGroup=createSegmentGroupFromRoute(relativeTo?relativeTo.snapshot:this.routerState.snapshot.root)}catch(e){"string"==typeof commands[0]&&"/"===commands[0][0]||(commands=[]),relativeToUrlSegmentGroup=this.currentUrlTree.root}return createUrlTreeFromSegmentGroup(relativeToUrlSegmentGroup,commands,q,f??null)}navigateByUrl(url,extras={skipLocationChange:!1}){const urlTree=isUrlTree(url)?url:this.parseUrl(url),mergedTree=this.urlHandlingStrategy.merge(urlTree,this.rawUrlTree);return this.scheduleNavigation(mergedTree,"imperative",null,extras)}navigate(commands,extras={skipLocationChange:!1}){return function validateCommands(commands){for(let i=0;i<commands.length;i++){const cmd=commands[i];if(null==cmd)throw new core["ɵRuntimeError"](4008,("undefined"==typeof ngDevMode||ngDevMode)&&`The requested path contains ${cmd} segment at index ${i}`)}}(commands),this.navigateByUrl(this.createUrlTree(commands,extras),extras)}serializeUrl(url){return this.urlSerializer.serialize(url)}parseUrl(url){try{return this.urlSerializer.parse(url)}catch{return this.urlSerializer.parse("/")}}isActive(url,matchOptions){let options;if(options=!0===matchOptions?{...exactMatchOptions}:!1===matchOptions?{...subsetMatchOptions}:matchOptions,isUrlTree(url))return containsTree(this.currentUrlTree,url,options);const urlTree=this.parseUrl(url);return containsTree(this.currentUrlTree,urlTree,options)}removeEmptyProps(params){return Object.entries(params).reduce(((result,[key,value])=>(null!=value&&(result[key]=value),result)),{})}scheduleNavigation(rawUrl,source,restoredState,extras,priorPromise){if(this.disposed)return Promise.resolve(!1);let resolve,reject,promise;priorPromise?(resolve=priorPromise.resolve,reject=priorPromise.reject,promise=priorPromise.promise):promise=new Promise(((res,rej)=>{resolve=res,reject=rej}));const taskId=this.pendingTasks.add();return afterNextNavigation(this,(()=>{queueMicrotask((()=>this.pendingTasks.remove(taskId)))})),this.navigationTransitions.handleNavigationRequest({source,restoredState,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl,extras,resolve,reject,promise,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),promise.catch((e=>Promise.reject(e)))}static ɵfac=function Router_Factory(__ngFactoryType__){return new(__ngFactoryType__||Router)};static ɵprov=core["ɵɵdefineInjectable"]({token:Router,factory:Router.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](Router,[{type:core.Injectable,args:[{providedIn:"root"}]}],(()=>[]),null);class RouterLink{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Subject.B;constructor(router,route,tabIndexAttribute,renderer,el,locationStrategy){this.router=router,this.route=route,this.tabIndexAttribute=tabIndexAttribute,this.renderer=renderer,this.el=el,this.locationStrategy=locationStrategy;const tagName=el.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===tagName||"area"===tagName,this.isAnchorElement?this.subscription=router.events.subscribe((s=>{s instanceof NavigationEnd&&this.updateHref()})):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(newTabIndex){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",newTabIndex)}ngOnChanges(changes){if(ngDevMode&&isUrlTree(this.routerLinkInput)&&(void 0!==this.fragment||this.queryParams||this.queryParamsHandling||this.preserveFragment||this.relativeTo))throw new core["ɵRuntimeError"](4016,"Cannot configure queryParams or fragment when using a UrlTree as the routerLink input value.");this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(commandsOrUrlTree){null==commandsOrUrlTree?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(isUrlTree(commandsOrUrlTree)?this.routerLinkInput=commandsOrUrlTree:this.routerLinkInput=Array.isArray(commandsOrUrlTree)?commandsOrUrlTree:[commandsOrUrlTree],this.setTabIndexIfNotOnNativeEl("0"))}onClick(button,ctrlKey,shiftKey,altKey,metaKey){const urlTree=this.urlTree;if(null===urlTree)return!0;if(this.isAnchorElement){if(0!==button||ctrlKey||shiftKey||altKey||metaKey)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0}const extras={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(urlTree,extras),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const urlTree=this.urlTree;this.href=null!==urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(urlTree)):null;const sanitizedValue=null===this.href?null:(0,core["ɵɵsanitizeUrlOrResourceUrl"])(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",sanitizedValue)}applyAttributeValue(attrName,attrValue){const renderer=this.renderer,nativeElement=this.el.nativeElement;null!==attrValue?renderer.setAttribute(nativeElement,attrName,attrValue):renderer.removeAttribute(nativeElement,attrName)}get urlTree(){return null===this.routerLinkInput?null:isUrlTree(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static ɵfac=function RouterLink_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouterLink)(core["ɵɵdirectiveInject"](Router),core["ɵɵdirectiveInject"](ActivatedRoute),core["ɵɵinjectAttribute"]("tabindex"),core["ɵɵdirectiveInject"](core.Renderer2),core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](common.LocationStrategy))};static ɵdir=core["ɵɵdefineDirective"]({type:RouterLink,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function RouterLink_HostBindings(rf,ctx){1&rf&&core["ɵɵlistener"]("click",(function RouterLink_click_HostBindingHandler($event){return ctx.onClick($event.button,$event.ctrlKey,$event.shiftKey,$event.altKey,$event.metaKey)})),2&rf&&core["ɵɵattribute"]("target",ctx.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",core.booleanAttribute],skipLocationChange:[2,"skipLocationChange","skipLocationChange",core.booleanAttribute],replaceUrl:[2,"replaceUrl","replaceUrl",core.booleanAttribute],routerLink:"routerLink"},features:[core["ɵɵInputTransformsFeature"],core["ɵɵNgOnChangesFeature"]]})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterLink,[{type:core.Directive,args:[{selector:"[routerLink]"}]}],(()=>[{type:Router},{type:ActivatedRoute},{type:void 0,decorators:[{type:core.Attribute,args:["tabindex"]}]},{type:core.Renderer2},{type:core.ElementRef},{type:common.LocationStrategy}]),{target:[{type:core.HostBinding,args:["attr.target"]},{type:core.Input}],queryParams:[{type:core.Input}],fragment:[{type:core.Input}],queryParamsHandling:[{type:core.Input}],state:[{type:core.Input}],info:[{type:core.Input}],relativeTo:[{type:core.Input}],preserveFragment:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],skipLocationChange:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],replaceUrl:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],routerLink:[{type:core.Input}],onClick:[{type:core.HostListener,args:["click",["$event.button","$event.ctrlKey","$event.shiftKey","$event.altKey","$event.metaKey"]]}]});class RouterLinkActive{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new core.EventEmitter;constructor(router,element,renderer,cdr,link){this.router=router,this.element=element,this.renderer=renderer,this.cdr=cdr,this.link=link,this.routerEventsSubscription=router.events.subscribe((s=>{s instanceof NavigationEnd&&this.update()}))}ngAfterContentInit(){(0,of.of)(this.links.changes,(0,of.of)(null)).pipe((0,mergeAll.U)()).subscribe((_=>{this.update(),this.subscribeToEachLinkOnChanges()}))}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const allLinkChanges=[...this.links.toArray(),this.link].filter((link=>!!link)).map((link=>link.onChanges));this.linkInputChangesSubscription=(0,from.H)(allLinkChanges).pipe((0,mergeAll.U)()).subscribe((link=>{this._isActive!==this.isLinkActive(this.router)(link)&&this.update()}))}set routerLinkActive(data){const classes=Array.isArray(data)?data:data.split(" ");this.classes=classes.filter((c=>!!c))}ngOnChanges(changes){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){this.links&&this.router.navigated&&queueMicrotask((()=>{const hasActiveLinks=this.hasActiveLinks();this.classes.forEach((c=>{hasActiveLinks?this.renderer.addClass(this.element.nativeElement,c):this.renderer.removeClass(this.element.nativeElement,c)})),hasActiveLinks&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==hasActiveLinks&&(this._isActive=hasActiveLinks,this.cdr.markForCheck(),this.isActiveChange.emit(hasActiveLinks))}))}isLinkActive(router){const options=function isActiveMatchOptions(options){return!!options.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return link=>{const urlTree=link.urlTree;return!!urlTree&&router.isActive(urlTree,options)}}hasActiveLinks(){const isActiveCheckFn=this.isLinkActive(this.router);return this.link&&isActiveCheckFn(this.link)||this.links.some(isActiveCheckFn)}static ɵfac=function RouterLinkActive_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouterLinkActive)(core["ɵɵdirectiveInject"](Router),core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.Renderer2),core["ɵɵdirectiveInject"](core.ChangeDetectorRef),core["ɵɵdirectiveInject"](RouterLink,8))};static ɵdir=core["ɵɵdefineDirective"]({type:RouterLinkActive,selectors:[["","routerLinkActive",""]],contentQueries:function RouterLinkActive_ContentQueries(rf,ctx,dirIndex){if(1&rf&&core["ɵɵcontentQuery"](dirIndex,RouterLink,5),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.links=_t)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[core["ɵɵNgOnChangesFeature"]]})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterLinkActive,[{type:core.Directive,args:[{selector:"[routerLinkActive]",exportAs:"routerLinkActive"}]}],(()=>[{type:Router},{type:core.ElementRef},{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:RouterLink,decorators:[{type:core.Optional}]}]),{links:[{type:core.ContentChildren,args:[RouterLink,{descendants:!0}]}],routerLinkActiveOptions:[{type:core.Input}],ariaCurrentWhenActive:[{type:core.Input}],isActiveChange:[{type:core.Output}],routerLinkActive:[{type:core.Input}]});class PreloadingStrategy{}class PreloadAllModules{preload(route,fn){return fn().pipe((0,catchError.W)((()=>(0,of.of)(null))))}static ɵfac=function PreloadAllModules_Factory(__ngFactoryType__){return new(__ngFactoryType__||PreloadAllModules)};static ɵprov=core["ɵɵdefineInjectable"]({token:PreloadAllModules,factory:PreloadAllModules.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](PreloadAllModules,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class NoPreloading{preload(route,fn){return(0,of.of)(null)}static ɵfac=function NoPreloading_Factory(__ngFactoryType__){return new(__ngFactoryType__||NoPreloading)};static ɵprov=core["ɵɵdefineInjectable"]({token:NoPreloading,factory:NoPreloading.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NoPreloading,[{type:core.Injectable,args:[{providedIn:"root"}]}],null,null);class RouterPreloader{router;injector;preloadingStrategy;loader;subscription;constructor(router,compiler,injector,preloadingStrategy,loader){this.router=router,this.injector=injector,this.preloadingStrategy=preloadingStrategy,this.loader=loader}setUpPreloading(){this.subscription=this.router.events.pipe((0,filter.p)((e=>e instanceof NavigationEnd)),(0,concatMap.H)((()=>this.preload()))).subscribe((()=>{}))}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(injector,routes){const res=[];for(const route of routes){route.providers&&!route._injector&&(route._injector=(0,core.createEnvironmentInjector)(route.providers,injector,`Route: ${route.path}`));const injectorForCurrentRoute=route._injector??injector,injectorForChildren=route._loadedInjector??injectorForCurrentRoute;(route.loadChildren&&!route._loadedRoutes&&void 0===route.canLoad||route.loadComponent&&!route._loadedComponent)&&res.push(this.preloadConfig(injectorForCurrentRoute,route)),(route.children||route._loadedRoutes)&&res.push(this.processRoutes(injectorForChildren,route.children??route._loadedRoutes))}return(0,from.H)(res).pipe((0,mergeAll.U)())}preloadConfig(injector,route){return this.preloadingStrategy.preload(route,(()=>{let loadedChildren$;loadedChildren$=route.loadChildren&&void 0===route.canLoad?this.loader.loadChildren(injector,route):(0,of.of)(null);const recursiveLoadChildren$=loadedChildren$.pipe((0,mergeMap.Z)((config=>null===config?(0,of.of)(void 0):(route._loadedRoutes=config.routes,route._loadedInjector=config.injector,this.processRoutes(config.injector??injector,config.routes)))));if(route.loadComponent&&!route._loadedComponent){const loadComponent$=this.loader.loadComponent(route);return(0,from.H)([recursiveLoadChildren$,loadComponent$]).pipe((0,mergeAll.U)())}return recursiveLoadChildren$}))}static ɵfac=function RouterPreloader_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouterPreloader)(core["ɵɵinject"](Router),core["ɵɵinject"](core.Compiler),core["ɵɵinject"](core.EnvironmentInjector),core["ɵɵinject"](PreloadingStrategy),core["ɵɵinject"](RouterConfigLoader))};static ɵprov=core["ɵɵdefineInjectable"]({token:RouterPreloader,factory:RouterPreloader.ɵfac,providedIn:"root"})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterPreloader,[{type:core.Injectable,args:[{providedIn:"root"}]}],(()=>[{type:Router},{type:core.Compiler},{type:core.EnvironmentInjector},{type:PreloadingStrategy},{type:RouterConfigLoader}]),null);const ROUTER_SCROLLER=new core.InjectionToken("");class RouterScroller{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(urlSerializer,transitions,viewportScroller,zone,options={}){this.urlSerializer=urlSerializer,this.transitions=transitions,this.viewportScroller=viewportScroller,this.zone=zone,this.options=options,options.scrollPositionRestoration||="disabled",options.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe((e=>{e instanceof NavigationStart?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof NavigationEnd?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof NavigationSkipped&&e.code===NavigationSkippedCode.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))}))}consumeScrollEvents(){return this.transitions.events.subscribe((e=>{e instanceof Scroll&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))}))}scheduleScrollEvent(routerEvent,anchor){this.zone.runOutsideAngular((()=>{setTimeout((()=>{this.zone.run((()=>{this.transitions.events.next(new Scroll(routerEvent,"popstate"===this.lastSource?this.store[this.restoredId]:null,anchor))}))}),0)}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static ɵfac=function RouterScroller_Factory(__ngFactoryType__){core["ɵɵinvalidFactory"]()};static ɵprov=core["ɵɵdefineInjectable"]({token:RouterScroller,factory:RouterScroller.ɵfac})}function rootRoute(router){return router.routerState.root}function routerFeature(kind,providers){return{ɵkind:kind,ɵproviders:providers}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterScroller,[{type:core.Injectable}],(()=>[{type:UrlSerializer},{type:NavigationTransitions},{type:common.ViewportScroller},{type:core.NgZone},{type:void 0}]),null);const ROUTER_IS_PROVIDED=new core.InjectionToken("",{providedIn:"root",factory:()=>!1});core.ENVIRONMENT_INITIALIZER;function getBootstrapListener(){const injector=(0,core.inject)(core.Injector);return bootstrappedComponentRef=>{const ref=injector.get(core.ApplicationRef);if(bootstrappedComponentRef!==ref.components[0])return;const router=injector.get(Router),bootstrapDone=injector.get(BOOTSTRAP_DONE);1===injector.get(INITIAL_NAVIGATION)&&router.initialNavigation(),injector.get(ROUTER_PRELOADER,null,core.InjectFlags.Optional)?.setUpPreloading(),injector.get(ROUTER_SCROLLER,null,core.InjectFlags.Optional)?.init(),router.resetRootComponentType(ref.componentTypes[0]),bootstrapDone.closed||(bootstrapDone.next(),bootstrapDone.complete(),bootstrapDone.unsubscribe())}}const BOOTSTRAP_DONE=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"bootstrap done indicator":"",{factory:()=>new Subject.B}),INITIAL_NAVIGATION=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"initial navigation":"",{providedIn:"root",factory:()=>1});function withDebugTracing(){let providers=[];return providers="undefined"==typeof ngDevMode||ngDevMode?[{provide:core.ENVIRONMENT_INITIALIZER,multi:!0,useFactory:()=>{const router=(0,core.inject)(Router);return()=>router.events.subscribe((e=>{console.group?.(`Router Event: ${e.constructor.name}`),console.log(function stringifyEvent(routerEvent){switch(routerEvent.type){case EventType.ActivationEnd:return`ActivationEnd(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case EventType.ActivationStart:return`ActivationStart(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case EventType.ChildActivationEnd:return`ChildActivationEnd(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case EventType.ChildActivationStart:return`ChildActivationStart(path: '${routerEvent.snapshot.routeConfig?.path||""}')`;case EventType.GuardsCheckEnd:return`GuardsCheckEnd(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state}, shouldActivate: ${routerEvent.shouldActivate})`;case EventType.GuardsCheckStart:return`GuardsCheckStart(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case EventType.NavigationCancel:return`NavigationCancel(id: ${routerEvent.id}, url: '${routerEvent.url}')`;case EventType.NavigationSkipped:return`NavigationSkipped(id: ${routerEvent.id}, url: '${routerEvent.url}')`;case EventType.NavigationEnd:return`NavigationEnd(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}')`;case EventType.NavigationError:return`NavigationError(id: ${routerEvent.id}, url: '${routerEvent.url}', error: ${routerEvent.error})`;case EventType.NavigationStart:return`NavigationStart(id: ${routerEvent.id}, url: '${routerEvent.url}')`;case EventType.ResolveEnd:return`ResolveEnd(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case EventType.ResolveStart:return`ResolveStart(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case EventType.RouteConfigLoadEnd:return`RouteConfigLoadEnd(path: ${routerEvent.route.path})`;case EventType.RouteConfigLoadStart:return`RouteConfigLoadStart(path: ${routerEvent.route.path})`;case EventType.RoutesRecognized:return`RoutesRecognized(id: ${routerEvent.id}, url: '${routerEvent.url}', urlAfterRedirects: '${routerEvent.urlAfterRedirects}', state: ${routerEvent.state})`;case EventType.Scroll:const pos=routerEvent.position?`${routerEvent.position[0]}, ${routerEvent.position[1]}`:null;return`Scroll(anchor: '${routerEvent.anchor}', position: '${pos}')`}}(e)),console.log(e),console.groupEnd?.()}))}}]:[],routerFeature(1,providers)}const ROUTER_PRELOADER=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"router preloader":"");const ROUTER_DIRECTIVES=[RouterOutlet,RouterLink,RouterLinkActive,ɵEmptyOutletComponent],ROUTER_FORROOT_GUARD=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),ROUTER_PROVIDERS=[common.Location,{provide:UrlSerializer,useClass:DefaultUrlSerializer},Router,ChildrenOutletContexts,{provide:ActivatedRoute,useFactory:rootRoute,deps:[Router]},RouterConfigLoader,"undefined"==typeof ngDevMode||ngDevMode?{provide:ROUTER_IS_PROVIDED,useValue:!0}:[]];class RouterModule{constructor(guard){}static forRoot(routes,config){return{ngModule:RouterModule,providers:[ROUTER_PROVIDERS,("undefined"==typeof ngDevMode||ngDevMode)&&config?.enableTracing?withDebugTracing().ɵproviders:[],{provide:ROUTES,multi:!0,useValue:routes},{provide:ROUTER_FORROOT_GUARD,useFactory:provideForRootGuard,deps:[[Router,new core.Optional,new core.SkipSelf]]},config?.errorHandler?{provide:NAVIGATION_ERROR_HANDLER,useValue:config.errorHandler}:[],{provide:ROUTER_CONFIGURATION,useValue:config||{}},config?.useHash?{provide:common.LocationStrategy,useClass:common.HashLocationStrategy}:{provide:common.LocationStrategy,useClass:common.PathLocationStrategy},{provide:ROUTER_SCROLLER,useFactory:()=>{const viewportScroller=(0,core.inject)(common.ViewportScroller),zone=(0,core.inject)(core.NgZone),config=(0,core.inject)(ROUTER_CONFIGURATION),transitions=(0,core.inject)(NavigationTransitions),urlSerializer=(0,core.inject)(UrlSerializer);return config.scrollOffset&&viewportScroller.setOffset(config.scrollOffset),new RouterScroller(urlSerializer,transitions,viewportScroller,zone,config)}},config?.preloadingStrategy?(preloadingStrategy=config.preloadingStrategy,routerFeature(0,[{provide:ROUTER_PRELOADER,useExisting:RouterPreloader},{provide:PreloadingStrategy,useExisting:preloadingStrategy}])).ɵproviders:[],config?.initialNavigation?provideInitialNavigation(config):[],config?.bindToComponentInputs?routerFeature(8,[RoutedComponentInputBinder,{provide:INPUT_BINDER,useExisting:RoutedComponentInputBinder}]).ɵproviders:[],config?.enableViewTransitions?routerFeature(9,[{provide:CREATE_VIEW_TRANSITION,useValue:createViewTransition},{provide:VIEW_TRANSITION_OPTIONS,useValue:{skipNextTransition:!!options?.skipInitialTransition,...options}}]).ɵproviders:[],[{provide:ROUTER_INITIALIZER,useFactory:getBootstrapListener},{provide:core.APP_BOOTSTRAP_LISTENER,multi:!0,useExisting:ROUTER_INITIALIZER}]]};var options,preloadingStrategy}static forChild(routes){return{ngModule:RouterModule,providers:[{provide:ROUTES,multi:!0,useValue:routes}]}}static ɵfac=function RouterModule_Factory(__ngFactoryType__){return new(__ngFactoryType__||RouterModule)(core["ɵɵinject"](ROUTER_FORROOT_GUARD,8))};static ɵmod=core["ɵɵdefineNgModule"]({type:RouterModule,imports:[RouterOutlet,RouterLink,RouterLinkActive,ɵEmptyOutletComponent],exports:[RouterOutlet,RouterLink,RouterLinkActive,ɵEmptyOutletComponent]});static ɵinj=core["ɵɵdefineInjector"]({})}function provideForRootGuard(router){if(("undefined"==typeof ngDevMode||ngDevMode)&&router)throw new core["ɵRuntimeError"](4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function provideInitialNavigation(config){return["disabled"===config.initialNavigation?routerFeature(3,[{provide:core.APP_INITIALIZER,multi:!0,useFactory:()=>{const router=(0,core.inject)(Router);return()=>{router.setUpLocationChangeListener()}}},{provide:INITIAL_NAVIGATION,useValue:2}]).ɵproviders:[],"enabledBlocking"===config.initialNavigation?routerFeature(2,[{provide:INITIAL_NAVIGATION,useValue:0},{provide:core.APP_INITIALIZER,multi:!0,deps:[core.Injector],useFactory:injector=>{const locationInitialized=injector.get(common.LOCATION_INITIALIZED,Promise.resolve());return()=>locationInitialized.then((()=>new Promise((resolve=>{const router=injector.get(Router),bootstrapDone=injector.get(BOOTSTRAP_DONE);afterNextNavigation(router,(()=>{resolve(!0)})),injector.get(NavigationTransitions).afterPreactivation=()=>(resolve(!0),bootstrapDone.closed?(0,of.of)(void 0):bootstrapDone),router.initialNavigation()}))))}}]).ɵproviders:[]]}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](RouterModule,[{type:core.NgModule,args:[{imports:ROUTER_DIRECTIVES,exports:ROUTER_DIRECTIVES}]}],(()=>[{type:void 0,decorators:[{type:core.Optional},{type:core.Inject,args:[ROUTER_FORROOT_GUARD]}]}]),null);const ROUTER_INITIALIZER=new core.InjectionToken("undefined"==typeof ngDevMode||ngDevMode?"Router Initializer":"");new core.Version("19.0.5");(0,core["ɵpublishExternalGlobalUtil"])("ɵgetLoadedRoutes",(function getLoadedRoutes(route){return route._loadedRoutes}));const _c0=["glCanvas"],_c1=["anchor"];function NgtPortal_Conditional_2_Template(rf,ctx){if(1&rf&&core["ɵɵelement"](0,"ngt-portal-before-render",1),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("renderPriority",ctx_r0.autoRenderPriority())("parentScene",ctx_r0.parentScene())("parentCamera",ctx_r0.parentCamera())}}function updater(_source){return state=>{const updater=function reducer(state){return previous=>{const partial="function"==typeof state?state(previous):state;return Object.keys(partial).forEach((key=>{const typedKey=key;void 0===partial[typedKey]&&null!=previous[typedKey]&&(partial[typedKey]=previous[typedKey])})),partial}}(state);(0,core.untracked)((()=>{_source.update((previous=>({...previous,...updater(previous)})))}))}}function getter(_source){return(...keys)=>{const root=(0,core.untracked)(_source);return 0===keys.length?root:keys.reduce(((value,key)=>value[key]),root)}}function selector(_state,computedCache){return(...keysAndOptions)=>{if(0===keysAndOptions.length)return _state;if(1===keysAndOptions.length&&"object"==typeof keysAndOptions[0]){const cachedKey="__ngt_signal_store_computed__".concat(JSON.stringify(keysAndOptions[0]));return computedCache.has(cachedKey)||computedCache.set(cachedKey,(0,core.computed)(_state,keysAndOptions)),computedCache.get(cachedKey)}const[keys,options]=function parseStoreOptions(keysAndOptions){if("object"==typeof keysAndOptions.at(-1))return[keysAndOptions.slice(0,-1),keysAndOptions.at(-1)];return[keysAndOptions,{equal:Object.is}]}(keysAndOptions),cachedKeys=keys.join("-").concat(JSON.stringify(options));return computedCache.has(cachedKeys)||computedCache.set(cachedKeys,(0,core.computed)((()=>keys.reduce(((value,key)=>value[key]),_state())),options)),computedCache.get(cachedKeys)}}function signalStore(initialState={},options){let source,update,get,select,state;const computedCache=new Map;options||(options={equal:Object.is}),"function"==typeof initialState?(source=(0,core.signal)({},options),state=source.asReadonly(),get=getter(source),update=updater(source),select=selector(state,computedCache),source.set(initialState({update,get,select}))):(source=(0,core.signal)(initialState,options),state=source.asReadonly(),get=getter(source),update=updater(source),select=selector(state,computedCache));const store={select,get,update,state};return Object.defineProperty(store,"snapshot",{get:core.untracked.bind({},state),configurable:!1,enumerable:!1}),store}const is={obj:a=>a===Object(a)&&!Array.isArray(a)&&"function"!=typeof a,material:a=>!!a&&a.isMaterial,geometry:a=>!!a&&a.isBufferGeometry,orthographicCamera:a=>!!a&&a.isOrthographicCamera,perspectiveCamera:a=>!!a&&a.isPerspectiveCamera,camera:a=>!!a&&a.isCamera,renderer:a=>!!a&&"object"==typeof a&&"render"in a&&"function"==typeof a.render,scene:a=>!!a&&a.isScene,ref:a=>a instanceof core.ElementRef,instance:a=>!!a&&!!a.__ngt__,object3D:a=>!!a&&a.isObject3D,colorSpaceExist:object=>"colorSpace"in object||"outputColorSpace"in object,equ(a,b,{arrays="shallow",objects="reference",strict=!0}={}){if(typeof a!=typeof b||!!a!=!!b)return!1;if("string"==typeof a||"number"==typeof a)return a===b;const isObj=is.obj(a);if(isObj&&"reference"===objects)return a===b;const isArr=Array.isArray(a);if(isArr&&"reference"===arrays)return a===b;if((isArr||isObj)&&a===b)return!0;let i;for(i in a)if(!(i in b))return!1;for(i in strict?b:a)if(a[i]!==b[i])return!1;if(void 0===i){if(isArr&&0===a.length&&0===b.length)return!0;if(isObj&&0===Object.keys(a).length&&0===Object.keys(b).length)return!0;if(a!==b)return!1}return!0}};function checkNeedsUpdate(value){null!==value&&is.obj(value)&&"needsUpdate"in value&&(value.needsUpdate=!0,"uniformsNeedUpdate"in value&&(value.uniformsNeedUpdate=!0))}function checkUpdate(value){is.camera(value)&&((is.perspectiveCamera(value)||is.orthographicCamera(value))&&value.updateProjectionMatrix(),value.updateMatrixWorld()),value&&value.isCubeTexture||checkNeedsUpdate(value)}function updateCamera(camera,size){camera.manual||(is.orthographicCamera(camera)?(camera.left=size.width/-2,camera.right=size.width/2,camera.top=size.height/2,camera.bottom=size.height/-2):camera.aspect=size.width/size.height,camera.updateProjectionMatrix(),camera.updateMatrixWorld())}function getLocalState(obj){if(obj)return obj.__ngt__}function invalidateInstance(instance){let store=getLocalState(instance)?.store;if(store){for(;store.snapshot.previousRoot;)store=store.snapshot.previousRoot;0===store.snapshot.internal.frames&&store.snapshot.invalidate()}checkUpdate(instance)}function prepare(object,localState){const instance=object;if(localState?.primitive||!instance.__ngt__){const{instanceStore=signalStore({parent:null,objects:[],nonObjects:[],geometryStamp:Date.now()}),...rest}=localState||{},nonObjects=instanceStore.select("nonObjects"),geometryStamp=instanceStore.select("geometryStamp"),nonObjectsChanged=(0,core.computed)((()=>{const[_nonObjects]=[nonObjects(),geometryStamp()];return _nonObjects}));instance.__ngt__={previousAttach:null,store:null,memoized:{},eventCount:0,handlers:{},instanceStore,parent:instanceStore.select("parent"),objects:instanceStore.select("objects"),nonObjects:nonObjectsChanged,add(object,type){const current=instance.__ngt__.instanceStore.snapshot[type],foundIndex=current.findIndex((node=>object===node||!!object.uuid&&!!node.uuid&&object.uuid===node.uuid));foundIndex>-1?(current.splice(foundIndex,1,object),instance.__ngt__.instanceStore.update({[type]:current})):instance.__ngt__.instanceStore.update((prev=>({[type]:[...prev[type],object]}))),notifyAncestors(instance.__ngt__.instanceStore.snapshot.parent,type)},remove(object,type){instance.__ngt__.instanceStore.update((prev=>({[type]:prev[type].filter((node=>node!==object))}))),notifyAncestors(instance.__ngt__.instanceStore.snapshot.parent,type)},setParent(parent){instance.__ngt__.instanceStore.update({parent})},updateGeometryStamp(){instance.__ngt__.instanceStore.update({geometryStamp:Date.now()})},...rest}}return instance}function notifyAncestors(instance,type){if(!instance)return;const localState=getLocalState(instance);if(!localState)return;const{parent}=localState.instanceStore.snapshot;localState.instanceStore.update({[type]:(localState.instanceStore.snapshot[type]||[]).slice()}),notifyAncestors(parent,type)}const idCache={};function makeId(event){if(event)return(event.eventObject||event.object).uuid+"/"+event.index+event.instanceId;const newId=three_core.cj9.generateUUID();return idCache[newId]?makeId():(idCache[newId]=!0,newId)}function makeDpr(dpr,window){const target=void 0!==window?window.devicePixelRatio??2:1;return Array.isArray(dpr)?Math.min(Math.max(dpr[0],target),dpr[1]):dpr}function releaseInternalPointerCapture(capturedMap,obj,captures,pointerId){const captureData=captures.get(obj);captureData&&(captures.delete(obj),0===captures.size&&(capturedMap.delete(pointerId),captureData.target.releasePointerCapture(pointerId)))}function createEvents(store){function filterPointerEvents(objects){return objects.filter((obj=>["move","over","enter","out","leave"].some((name=>{const eventName=`pointer${name}`;return getLocalState(obj)?.handlers?.[eventName]}))))}function cancelPointer(intersections){const internal=store.get("internal");for(const hoveredObj of internal.hovered.values())if(!intersections.length||!intersections.find((hit=>hit.object===hoveredObj.object&&hit.index===hoveredObj.index&&hit.instanceId===hoveredObj.instanceId))){const instance=getLocalState(hoveredObj.eventObject),handlers=instance?.handlers;if(internal.hovered.delete(makeId(hoveredObj)),instance?.eventCount){const data={...hoveredObj,intersections};handlers?.pointerout?.(data),handlers?.pointerleave?.(data)}}}function pointerMissed(event,objects){for(let i=0;i<objects.length;i++){const instance=getLocalState(objects[i]);instance?.handlers.pointermissed?.(event)}}return{handlePointer:function handlePointer(name){switch(name){case"pointerleave":case"pointercancel":return()=>cancelPointer([]);case"lostpointercapture":return event=>{const{internal}=store.snapshot;"pointerId"in event&&internal.capturedMap.has(event.pointerId)&&requestAnimationFrame((()=>{internal.capturedMap.has(event.pointerId)&&(internal.capturedMap.delete(event.pointerId),cancelPointer([]))}))}}return function handleEvent(event){const pointerMissed$=store.pointerMissed$,internal=store.get("internal");internal.lastEvent.nativeElement=event;const isPointerMove="pointermove"===name,isClickEvent="click"===name||"contextmenu"===name||"dblclick"===name,hits=function intersect(event,filter){const state=store.get(),duplicates=new Set,intersections=[],eventsObjects=filter?filter(state.internal.interaction):state.internal.interaction;for(let i=0;i<eventsObjects.length;i++){const objectRootState=getLocalState(eventsObjects[i])?.store.snapshot;objectRootState&&(objectRootState.raycaster.camera=void 0)}state.previousRoot||state.events.compute?.(event,store,null);let hits=eventsObjects.flatMap((function handleRaycast(obj){const objStore=getLocalState(obj)?.store,objState=objStore?.snapshot;return objState&&objState.events.enabled&&null!==objState.raycaster.camera?(void 0===objState.raycaster.camera&&(objState.events.compute?.(event,objStore,objState.previousRoot),void 0===objState.raycaster.camera&&(objState.raycaster.camera=null)),objState.raycaster.camera?objState.raycaster.intersectObject(obj,!0):[]):[]})).sort(((a,b)=>{const aState=getLocalState(a.object)?.store.snapshot,bState=getLocalState(b.object)?.store.snapshot;return aState&&bState&&bState.events.priority-aState.events.priority||a.distance-b.distance})).filter((item=>{const id=makeId(item);return!duplicates.has(id)&&(duplicates.add(id),!0)}));state.events.filter&&(hits=state.events.filter(hits,store));for(const hit of hits){let eventObject=hit.object;for(;eventObject;)getLocalState(eventObject)?.eventCount&&intersections.push({...hit,eventObject}),eventObject=eventObject.parent}if("pointerId"in event&&state.internal.capturedMap.has(event.pointerId))for(const captureData of state.internal.capturedMap.get(event.pointerId).values())duplicates.has(makeId(captureData.intersection))||intersections.push(captureData.intersection);return intersections}(event,isPointerMove?filterPointerEvents:void 0),delta=isClickEvent?function calculateDistance(event){const internal=store.get("internal"),dx=event.offsetX-internal.initialClick[0],dy=event.offsetY-internal.initialClick[1];return Math.round(Math.sqrt(dx*dx+dy*dy))}(event):0;"pointerdown"===name&&(internal.initialClick=[event.offsetX,event.offsetY],internal.initialHits=hits.map((hit=>hit.eventObject))),isClickEvent&&!hits.length&&delta<=2&&(pointerMissed(event,internal.interaction),pointerMissed$.next(event)),isPointerMove&&cancelPointer(hits),function handleIntersects(intersections,event,delta,callback){const rootState=store.snapshot;if(intersections.length){const localState={stopped:!1};for(const hit of intersections){const{raycaster,pointer,camera,internal}=getLocalState(hit.object)?.store.snapshot||rootState,unprojectedPoint=new three_core.Pq0(pointer.x,pointer.y,0).unproject(camera),hasPointerCapture=id=>internal.capturedMap.get(id)?.has(hit.eventObject)??!1,setPointerCapture=id=>{const captureData={intersection:hit,target:event.target};internal.capturedMap.has(id)?internal.capturedMap.get(id).set(hit.eventObject,captureData):internal.capturedMap.set(id,new Map([[hit.eventObject,captureData]])),event.target.setPointerCapture(id)},releasePointerCapture=id=>{const captures=internal.capturedMap.get(id);captures&&releaseInternalPointerCapture(internal.capturedMap,hit.eventObject,captures,id)},extractEventProps={};for(const prop in event){const property=event[prop];"function"!=typeof property&&(extractEventProps[prop]=property)}const raycastEvent={...hit,...extractEventProps,pointer,intersections,stopped:localState.stopped,delta,unprojectedPoint,ray:raycaster.ray,camera,stopPropagation(){const capturesForPointer="pointerId"in event&&internal.capturedMap.get(event.pointerId);(!capturesForPointer||capturesForPointer.has(hit.eventObject))&&(raycastEvent.stopped=localState.stopped=!0,internal.hovered.size&&Array.from(internal.hovered.values()).find((i=>i.eventObject===hit.eventObject)))&&cancelPointer([...intersections.slice(0,intersections.indexOf(hit)),hit])},target:{hasPointerCapture,setPointerCapture,releasePointerCapture},currentTarget:{hasPointerCapture,setPointerCapture,releasePointerCapture},nativeEvent:event};if(callback(raycastEvent),localState.stopped)break}}return intersections}(hits,event,delta,(function onIntersect(data){const eventObject=data.eventObject,instance=getLocalState(eventObject),handlers=instance?.handlers;if(instance?.eventCount)if(isPointerMove){if(handlers?.pointerover||handlers?.pointerenter||handlers?.pointerout||handlers?.pointerleave){const id=makeId(data),hoveredItem=internal.hovered.get(id);hoveredItem?hoveredItem.stopped&&data.stopPropagation():(internal.hovered.set(id,data),handlers.pointerover?.(data),handlers.pointerenter?.(data))}handlers?.pointermove?.(data)}else{const handler=handlers?.[name];handler?isClickEvent&&!internal.initialHits.includes(eventObject)||(pointerMissed(event,internal.interaction.filter((object=>!internal.initialHits.includes(object)))),handler(data)):isClickEvent&&internal.initialHits.includes(eventObject)&&pointerMissed(event,internal.interaction.filter((object=>!internal.initialHits.includes(object))))}}))}}}}const DOM_EVENTS={click:!1,contextmenu:!1,dblclick:!1,wheel:!1,pointerdown:!0,pointerup:!0,pointerleave:!0,pointermove:!0,pointercancel:!0,lostpointercapture:!0};function createPointerEvents(store){const{handlePointer}=createEvents(store);return{priority:1,enabled:!0,compute:(event,root)=>{const state=root.get();state.pointer.set(event.offsetX/state.size.width*2-1,-event.offsetY/state.size.height*2+1),state.raycaster.setFromCamera(state.pointer,state.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce(((handlers,supportedEventName)=>(handlers[supportedEventName]=handlePointer(supportedEventName),handlers)),{}),update:()=>{const{events,internal}=store.get();internal.lastEvent?.nativeElement&&events.handlers&&events.handlers.pointermove(internal.lastEvent.nativeElement)},connect:target=>{const state=store.get();state.events.disconnect?.(),state.setEvents({connected:target}),Object.entries(state.events.handlers??{}).forEach((([eventName,eventHandler])=>{const passive=DOM_EVENTS[eventName];target.addEventListener(eventName,eventHandler,{passive})}))},disconnect:()=>{const{events,setEvents}=store.get();events.connected&&(Object.entries(events.handlers??{}).forEach((([eventName,eventHandler])=>{events.connected instanceof HTMLElement&&events.connected.removeEventListener(eventName,eventHandler)})),setEvents({connected:void 0}))}}}const HTML="__ngt_renderer_is_html",DOM_PARENT="__ngt_dom_parent__",SPECIAL_DOM_TAG_NGT_PORTAL="ngt-portal",SPECIAL_DOM_TAG_NGT_PRIMITIVE="ngt-primitive",SPECIAL_DOM_TAG_NGT_VALUE="ngt-value",SPECIAL_PROPERTIES_RENDER_PRIORITY="priority",SPECIAL_PROPERTIES_ATTACH="attach",SPECIAL_PROPERTIES_RAW_VALUE="rawValue",SPECIAL_PROPERTIES_PARAMETERS="parameters",SPECIAL_EVENTS_BEFORE_RENDER="beforeRender",SPECIAL_EVENTS_UPDATED="updated",SPECIAL_EVENTS_ATTACHED="attached",THREE_NATIVE_EVENTS=["added","removed","childadded","childremoved","disposed"];class NgtArgs{constructor(){this.args=core.input.required(),this.vcr=(0,core.inject)(core.ViewContainerRef),this.template=(0,core.inject)(core.TemplateRef),this.injected=!1,this.injectedArgs=null;const commentNode=this.vcr.element.nativeElement;commentNode.__ngt_renderer_add_comment__&&(commentNode.__ngt_renderer_add_comment__("args"),delete commentNode.__ngt_renderer_add_comment__),(0,core.effect)((()=>{const value=this.args();null==value||!Array.isArray(value)||1===value.length&&null===value[0]||is.equ(value,this.injectedArgs)||(this.injected=!1,this.injectedArgs=value,this.createView())})),(0,core.inject)(core.DestroyRef).onDestroy((()=>{this.view?.destroy()}))}get value(){return this.validate()?(this.injected=!0,this.injectedArgs):null}validate(){return!this.injected&&!!this.injectedArgs?.length}createView(){this.view&&!this.view.destroyed&&this.view.destroy(),this.view=this.vcr.createEmbeddedView(this.template),this.view.detectChanges()}static{this.ɵfac=function NgtArgs_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtArgs)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtArgs,selectors:[["ng-template","args",""]],inputs:{args:[1,"args"]}})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtArgs,[{type:core.Directive,args:[{selector:"ng-template[args]"}]}],(()=>[]),null);const roots=new Map;function createSubs(callback,subs){const sub={callback};return subs.add(sub),()=>{subs.delete(sub)}}const globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set,addEffect=callback=>createSubs(callback,globalEffects),addAfterEffect=callback=>createSubs(callback,globalAfterEffects);function run(effects,timestamp){if(effects.size)for(const{callback}of effects.values())callback(timestamp)}function flushGlobalEffects(type,timestamp){switch(type){case"before":return run(globalEffects,timestamp);case"after":return run(globalAfterEffects,timestamp);case"tail":return run(globalTailEffects,timestamp)}}function render(timestamp,store,frame){const state=store.snapshot;let delta=state.clock.getDelta();"never"===state.frameloop&&"number"==typeof timestamp&&(delta=timestamp-state.clock.elapsedTime,state.clock.oldTime=state.clock.elapsedTime,state.clock.elapsedTime=timestamp);const subscribers=state.internal.subscribers;for(let i=0;i<subscribers.length;i++){const subscription=subscribers[i];subscription.callback({...subscription.store.snapshot,delta,frame})}return!state.internal.priority&&state.gl.render&&state.gl.render(state.scene,state.camera),state.internal.frames=Math.max(0,state.internal.frames-1),"always"===state.frameloop?1:state.internal.frames}const[injectLoop]=createInjectionToken((()=>function createLoop(roots){let repeat,frame,running=!1,beforeRenderInProgress=!1;function loop(timestamp){frame=requestAnimationFrame(loop),running=!0,repeat=0,flushGlobalEffects("before",timestamp),beforeRenderInProgress=!0;for(const root of roots.values()){const state=root.snapshot;state.internal.active&&("always"===state.frameloop||state.internal.frames>0)&&!state.gl.xr?.isPresenting&&(repeat+=render(timestamp,root))}if(beforeRenderInProgress=!1,flushGlobalEffects("after",timestamp),0===repeat)return flushGlobalEffects("tail",timestamp),running=!1,cancelAnimationFrame(frame)}return{loop,invalidate:function invalidate(store,frames=1){const state=store?.snapshot;if(!state)return roots.forEach((root=>invalidate(root,frames)));!state.gl.xr?.isPresenting&&state.internal.active&&"never"!==state.frameloop&&(state.internal.frames=frames>1?Math.min(60,state.internal.frames+frames):beforeRenderInProgress?2:1,running||(running=!0,requestAnimationFrame(loop)))},advance:function advance(timestamp,runGlobalEffects=!0,store,frame){if(runGlobalEffects&&flushGlobalEffects("before",timestamp),store)render(timestamp,store,frame);else for(const root of roots.values())render(timestamp,root);runGlobalEffects&&flushGlobalEffects("after",timestamp)}}}(roots)));function storeFactory(previousStore){const loop=injectLoop(),window=(0,core.inject)(common.DOCUMENT).defaultView||void 0,pointerMissed$=new Subject.B,store=signalStore((({get,update})=>{const{invalidate,advance}=loop,position=new three_core.Pq0,defaultTarget=new three_core.Pq0,tempTarget=new three_core.Pq0;function getCurrentViewport(camera=get("camera"),target=defaultTarget,size=get("size")){const{width,height,top,left}=size,aspect=width/height;target.isVector3?tempTarget.copy(target):tempTarget.set(...target);const distance=camera.getWorldPosition(position).distanceTo(tempTarget);if(is.orthographicCamera(camera))return{width:width/camera.zoom,height:height/camera.zoom,top,left,factor:1,distance,aspect};const fov=camera.fov*Math.PI/180,h=2*Math.tan(fov/2)*distance,w=h*(width/height);return{width:w,height:h,top,left,factor:width/w,distance,aspect}}let performanceTimeout;const setPerformanceCurrent=current=>update((state=>({performance:{...state.performance,current}}))),pointer=new three_core.I9Y;return{pointerMissed$:pointerMissed$.asObservable(),events:{priority:1,enabled:!0,connected:!1},invalidate:(frames=1)=>invalidate(store,frames),advance:(timestamp,runGlobalEffects)=>advance(timestamp,runGlobalEffects,store),legacy:!1,linear:!1,flat:!1,controls:null,clock:new three_core.zD7,pointer,frameloop:"always",performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const state=get();performanceTimeout&&clearTimeout(performanceTimeout),state.performance.current!==state.performance.min&&setPerformanceCurrent(state.performance.min),performanceTimeout=setTimeout((()=>{setPerformanceCurrent(get("performance","max"))}),state.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:window?.devicePixelRatio||1,dpr:window?.devicePixelRatio||1,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport},setEvents:events=>update((state=>({...state,events:{...state.events,...events}}))),setSize:(width,height,top,left)=>{const camera=get("camera"),size={width,height,top:top||0,left:left||0};update((state=>({size,viewport:{...state.viewport,...getCurrentViewport(camera,defaultTarget,size)}})))},setDpr:dpr=>update((state=>{const resolved=makeDpr(dpr,window);return{viewport:{...state.viewport,dpr:resolved,initialDpr:state.viewport.initialDpr||resolved}}})),setFrameloop:(frameloop="always")=>{const clock=get("clock");clock.stop(),clock.elapsedTime=0,"never"!==frameloop&&(clock.start(),clock.elapsedTime=0),update((()=>({frameloop})))},previousRoot:previousStore,internal:{active:!1,priority:0,frames:0,lastEvent:new core.ElementRef(null),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(callback,priority=0,_store=store)=>{const internal=get("internal");return internal.priority=internal.priority+(priority>0?1:0),internal.subscribers.push({callback,priority,store:_store}),internal.subscribers=internal.subscribers.sort(((a,b)=>(a.priority||0)-(b.priority||0))),()=>{const internal=get("internal");internal?.subscribers&&(internal.priority=internal.priority-(priority>0?1:0),internal.subscribers=internal.subscribers.filter((s=>s.callback!==callback)))}}}}}));Object.defineProperty(store,"pointerMissed$",{get:()=>pointerMissed$});let{size:oldSize,viewport:{dpr:oldDpr},camera:oldCamera}=store.snapshot;return(0,core.effect)((()=>{const{camera:newCamera,size:newSize,viewport:{dpr:newDpr},gl}=store.state();if(newSize!==oldSize||newDpr!==oldDpr){oldSize=newSize,oldDpr=newDpr,updateCamera(newCamera,newSize),gl.setPixelRatio(newDpr);const updateStyle="undefined"!=typeof HTMLCanvasElement&&gl.domElement instanceof HTMLCanvasElement;gl.setSize(newSize.width,newSize.height,updateStyle)}newCamera!==oldCamera&&(oldCamera=newCamera,updateCamera(newCamera,newSize),store.update((state=>({viewport:{...state.viewport,...state.viewport.getCurrentViewport(newCamera)}}))))})),store}const NGT_STORE=new core.InjectionToken("NgtStore Token");function provideStore(store){return store?{provide:NGT_STORE,useFactory:store}:{provide:NGT_STORE,useFactory:storeFactory}}function injectStore(options){return(0,core.inject)(NGT_STORE,options)}class NgtParent{constructor(){this.parent=core.input.required(),this.vcr=(0,core.inject)(core.ViewContainerRef),this.template=(0,core.inject)(core.TemplateRef),this.store=injectStore(),this.scene=this.store.select("scene"),this.injected=!1,this.injectedParent=null,this._parent=(0,core.computed)((()=>{const parent=this.parent(),rawParent="function"==typeof parent?parent():parent;if(!rawParent)return null;const scene=this.scene();return"string"==typeof rawParent?scene.getObjectByName(rawParent):"nativeElement"in rawParent?rawParent.nativeElement:rawParent}));const commentNode=this.vcr.element.nativeElement;commentNode.__ngt_renderer_add_comment__&&(commentNode.__ngt_renderer_add_comment__("parent"),delete commentNode.__ngt_renderer_add_comment__),(0,core.effect)((()=>{const parent=this._parent();parent&&(this.injected=!1,this.injectedParent=parent,this.createView())})),(0,core.inject)(core.DestroyRef).onDestroy((()=>{this.view?.destroy()}))}get value(){return this.validate()?(this.injected=!0,this.injectedParent):null}validate(){return!this.injected&&!!this.injectedParent}createView(){this.view&&!this.view.destroyed&&this.view.destroy();const comment=this.vcr.element.nativeElement;comment.__ngt_renderer_set_parent_comment__&&comment.__ngt_renderer_set_parent_comment__(this.injectedParent),this.view=this.vcr.createEmbeddedView(this.template),this.view.detectChanges()}static{this.ɵfac=function NgtParent_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtParent)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtParent,selectors:[["ng-template","parent",""]],inputs:{parent:[1,"parent"]}})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtParent,[{type:core.Directive,args:[{selector:"ng-template[parent]"}]}],(()=>[]),null);const NGT_APPLY_PROPS="__ngt_apply_props__";function applyProps(instance,props){if(!Object.keys(props).length)return instance;const localState=getLocalState(instance),rootState=localState?.store?.snapshot??instance[NGT_APPLY_PROPS]?.snapshot??{},changes=function diffProps(instance,props){const propsEntries=Object.entries(props),changes=[];for(const[propKey,propValue]of propsEntries){let key=propKey;is.colorSpaceExist(instance)&&("encoding"===propKey?key="colorSpace":"outputEncoding"===propKey&&(key="outputColorSpace")),is.equ(propValue,instance[key])||changes.push([propKey,propValue])}return changes}(instance,props);for(let i=0;i<changes.length;i++){let[key,value]=changes[i];if(is.colorSpaceExist(instance)){const sRGBEncoding=3001,SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear";"encoding"===key?(key="colorSpace",value=value===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace):"outputEncoding"===key&&(key="outputColorSpace",value=value===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace)}const currentInstance=instance,targetProp=currentInstance[key];if(targetProp&&targetProp.set&&(targetProp.copy||targetProp instanceof three_core.zgK)){const isColor=targetProp.isColor;if(Array.isArray(value))targetProp.fromArray?targetProp.fromArray(value):targetProp.set(...value);else if(targetProp.copy&&value&&value.constructor&&targetProp.constructor.name===value.constructor.name)targetProp.copy(value),three_core.ppV||rootState.linear||!isColor||targetProp.convertSRGBToLinear();else if(void 0!==value){const isColor=targetProp.isColor;!isColor&&targetProp.setScalar?targetProp.setScalar(value):targetProp instanceof three_core.zgK&&value instanceof three_core.zgK?targetProp.mask=value.mask:targetProp.set(value),three_core.ppV||rootState?.linear||!isColor||targetProp.convertSRGBToLinear()}}else if(currentInstance[key]=value,currentInstance[key]?.isTexture&&currentInstance[key].format===three_core.GWd&&currentInstance[key].type===three_core.OUM){const texture=currentInstance[key];rootState?.gl&&(is.colorSpaceExist(texture)&&is.colorSpaceExist(rootState.gl)?texture.colorSpace=rootState.gl.outputColorSpace:texture.encoding=rootState.gl.outputEncoding)}checkUpdate(currentInstance[key]),checkUpdate(targetProp),invalidateInstance(instance)}const instanceHandlersCount=localState?.eventCount,parent=localState?.instanceStore?.get("parent");if(parent&&rootState.internal&&instance.raycast&&instanceHandlersCount!==localState?.eventCount){const index=rootState.internal.interaction.indexOf(instance);index>-1&&rootState.internal.interaction.splice(index,1),localState?.eventCount&&rootState.internal.interaction.push(instance)}return parent&&localState?.onUpdate&&changes.length&&localState.onUpdate(instance),instance[NGT_APPLY_PROPS]&&delete instance[NGT_APPLY_PROPS],instance}const catalogue={};function extend(objects){Object.assign(catalogue,objects)}const[injectCatalogue]=createInjectionToken((()=>catalogue));function angular_three_createNode(type,node,document){const state=[type,null,[],!1,void 0,void 0,void 0,void 0],rendererNode=Object.assign(node,{__ngt_renderer__:state});if(rendererNode.ownerDocument||(rendererNode.ownerDocument=document),"three"!==state[0]&&(state[7]=()=>(state[6]||(state[6]=new core.DebugNode(rendererNode)),state[6])),!("getAttribute"in rendererNode)||"function"!=typeof rendererNode.getAttribute){const nodeGetAttribute=name=>rendererNode[name];nodeGetAttribute.__ngt_renderer__=!0,Object.defineProperty(rendererNode,"getAttribute",{value:nodeGetAttribute,configurable:!0})}return rendererNode}function getClosestParentWithInstance(node){let parent=node.__ngt_renderer__[1];if(parent&&"portal"===parent.__ngt_renderer__[0]&&"three"===parent.__ngt_renderer__[5]?.__ngt_renderer__[0])return parent.__ngt_renderer__[5];for(;parent&&"three"!==parent.__ngt_renderer__[0];)parent=parent.__ngt_renderer__[5]?parent.__ngt_renderer__[5]:parent.__ngt_renderer__[1];return parent}function setParent(node,parent){node.__ngt_renderer__[1]||(node.__ngt_renderer__[1]=parent)}function addChild(node,child){node.__ngt_renderer__[2].includes(child)||node.__ngt_renderer__[2].push(child)}function attach(object,value,paths=[],useApplyProps=!1){const[base,...remaining]=paths;base&&(0===remaining.length?useApplyProps?applyProps(object,{[base]:value}):object[base]=value:(!function assignEmpty(obj,base,shouldAssignStoreForApplyProps=!1){(!Object.hasOwn(obj,base)&&Reflect&&Reflect.has&&!Reflect.has(obj,base)||void 0===obj[base])&&(obj[base]={});if(shouldAssignStoreForApplyProps){if(getLocalState(obj[base]))return;const parentLocalState=getLocalState(obj);if(!parentLocalState)return;Object.assign(obj[base],{[NGT_APPLY_PROPS]:parentLocalState.store})}}(object,base,useApplyProps),attach(object[base],value,remaining,useApplyProps)))}function attachThreeChild(parent,child){const pLS=getLocalState(parent),cLS=getLocalState(child);if(!pLS||!cLS)throw new Error("[NGT] THREE instances need to be prepared with local state.");let added=!1;if(!cLS.store||cLS.store!==pLS.store||cLS.store===pLS.store.get("previousRoot")){cLS.store=pLS.store;const grandchildren=[...cLS.objects?(0,core.untracked)(cLS.objects):[],...cLS.nonObjects?(0,core.untracked)(cLS.nonObjects):[]];for(const grandchild of grandchildren){const grandChildLS=getLocalState(grandchild);grandChildLS&&(grandChildLS.store=cLS.store)}}if(cLS.attach){const attachProp=cLS.attach;if("function"==typeof attachProp){let attachCleanUp;if(cLS.isRaw){if(cLS.instanceStore.get("parent")!==parent&&cLS.setParent(parent),void 0===child.__ngt_renderer__[4])return;attachCleanUp=attachProp(parent,child.__ngt_renderer__[4],cLS.store)}else attachCleanUp=attachProp(parent,child,cLS.store);attachCleanUp&&(cLS.previousAttach=attachCleanUp)}else{if("none"===attachProp[0])return void invalidateInstance(child);if("material"===attachProp[0]&&attachProp[1]&&"number"==typeof Number(attachProp[1])&&is.material(child)&&!Array.isArray(parent.material)&&(parent.material=[]),cLS.isRaw){if(cLS.instanceStore.get("parent")!==parent&&cLS.setParent(parent),void 0===child.__ngt_renderer__[4])return;attach(parent,child.__ngt_renderer__[4],attachProp,!0)}else attach(parent,child,attachProp);cLS.previousAttach=attachProp.reduce(((value,property)=>value[property]),parent)}}else is.object3D(parent)&&is.object3D(child)&&(parent.add(child),added=!0);pLS.add&&pLS.add(child,added?"objects":"nonObjects"),cLS.parent&&(0,core.untracked)(cLS.parent)!==parent&&cLS.setParent(parent),cLS.onAttach&&cLS.onAttach({parent,node:child}),invalidateInstance(child),invalidateInstance(parent)}function removeThreeChild(child,parent,dispose){const pLS=getLocalState(parent),cLS=getLocalState(child);if(cLS?.setParent(null),pLS?.remove?.(child,"objects"),pLS?.remove?.(child,"nonObjects"),parent)if(cLS?.attach)!function detach(parent,child,attachProp){const childLocalState=getLocalState(child);childLocalState&&(Array.isArray(attachProp)?attach(parent,childLocalState.previousAttach,attachProp,childLocalState.isRaw):childLocalState.previousAttach?.())}(parent,child,cLS.attach);else if(is.object3D(parent)&&is.object3D(child)){parent.remove(child);const store=cLS?.store||pLS?.store;store&&function removeInteractivity(store,object){const{internal}=store.snapshot;internal.interaction=internal.interaction.filter((o=>o!==object)),internal.initialHits=internal.initialHits.filter((o=>o!==object)),internal.hovered.forEach(((value,key)=>{value.eventObject!==object&&value.object!==object||internal.hovered.delete(key)})),internal.capturedMap.forEach(((captures,pointerId)=>{releaseInternalPointerCapture(internal.capturedMap,object,captures,pointerId)}))}(store,child)}const isPrimitive=cLS?.primitive;isPrimitive||(removeThreeRecursive(cLS?.instanceStore.get("objects")||[],child,!!dispose),removeThreeRecursive(child.children,child,!!dispose)),isPrimitive||!child.dispose||is.scene(child)||queueMicrotask((()=>child.dispose())),parent&&invalidateInstance(parent)}function removeThreeRecursive(array,parent,dispose){array&&[...array].forEach((child=>removeThreeChild(child,parent,dispose)))}class NgtRendererFactory{constructor(){this.delegateRendererFactory=(0,core.inject)(core.RendererFactory2,{skipSelf:!0}),this.document=(0,core.inject)(common.DOCUMENT),this.catalogue=injectCatalogue(),this.rootStore=injectStore(),this.portalCommentsNodes=[],this.rendererMap=new Map,this.routedSet=new Set}createRenderer(hostElement,type){const delegateRenderer=this.delegateRendererFactory.createRenderer(hostElement,type);if(!type)return delegateRenderer;if(type.type[HTML])return this.rendererMap.set(type.id,delegateRenderer),delegateRenderer;type.type.__ngt_renderer_is_routed_scene__&&this.routedSet.add(type.id);const isNonRoot=type.type.__ngt_renderer_is_non_root__;let renderer=this.rendererMap.get(type.id);return renderer||this.rendererMap.set(type.id,renderer=new NgtRenderer(delegateRenderer,this.rootStore,this.document,this.portalCommentsNodes,this.catalogue,!hostElement&&!isNonRoot&&(0===this.routedSet.size||this.routedSet.has(type.id)))),renderer}static{this.ɵfac=function NgtRendererFactory_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtRendererFactory)}}static{this.ɵprov=core["ɵɵdefineInjectable"]({token:NgtRendererFactory,factory:NgtRendererFactory.ɵfac})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRendererFactory,[{type:core.Injectable}],null,null);class NgtRenderer{constructor(delegate,rootStore,document,portalCommentsNodes,catalogue,isRoot=!0){this.delegate=delegate,this.rootStore=rootStore,this.document=document,this.portalCommentsNodes=portalCommentsNodes,this.catalogue=catalogue,this.isRoot=isRoot,this.argsCommentNodes=[],this.parentCommentNodes=[],this.createText=this.delegate.createText.bind(this.delegate),this.destroy=this.delegate.destroy.bind(this.delegate),this.destroyNode=null,this.selectRootElement=this.delegate.selectRootElement.bind(this.delegate),this.nextSibling=this.delegate.nextSibling.bind(this.delegate),this.addClass=this.delegate.addClass.bind(this.delegate),this.removeClass=this.delegate.removeClass.bind(this.delegate),this.setStyle=this.delegate.setStyle.bind(this.delegate),this.removeStyle=this.delegate.removeStyle.bind(this.delegate),this.setValue=this.delegate.setValue.bind(this.delegate)}createElement(name,namespace){const element=this.delegate.createElement(name,namespace);if(namespace)return angular_three_createNode("dom",element,this.document);if(this.isRoot){this.isRoot=!1;const node=angular_three_createNode("three",this.rootStore.snapshot.scene,this.document);return node.__ngt_renderer__[7]=()=>(node.__ngt_renderer__[6]||(node.__ngt_renderer__[6]=new core.DebugNode(element)),node.__ngt_renderer__[6]),node}if(name===SPECIAL_DOM_TAG_NGT_PORTAL)return angular_three_createNode("portal",element,this.document);if(name===SPECIAL_DOM_TAG_NGT_VALUE)return angular_three_createNode("three",prepare({__ngt_renderer__:{rawValue:void 0}},{store:this.rootStore,isRaw:!0}),this.document);const[injectedArgs,injectedParent]=[this.getNgtDirective(NgtArgs,this.argsCommentNodes)?.value||[],this.getNgtDirective(NgtParent,this.parentCommentNodes)?.value];if(name===SPECIAL_DOM_TAG_NGT_PRIMITIVE){if(!injectedArgs[0])throw new Error("[NGT] ngt-primitive without args is invalid");const object=injectedArgs[0];let localState=getLocalState(object);localState||(prepare(object,{store:this.rootStore,primitive:!0}),localState=getLocalState(object));const primitiveNode=angular_three_createNode("three",object,this.document);return injectedParent&&(primitiveNode.__ngt_renderer__[1]=injectedParent),primitiveNode}const threeName=function kebabToPascal(str){if(!str)return str;let pascalStr="",capitalizeNext=!0;for(let i=0;i<str.length;i++){const char=str[i];"-"!==char?(pascalStr+=capitalizeNext?char.toUpperCase():char,capitalizeNext=!1):capitalizeNext=!0}return pascalStr}(name.startsWith("ngt-")?name.slice(4):name),threeTarget=this.catalogue[threeName];if(threeTarget){const instance=prepare(new threeTarget(...injectedArgs),{store:this.rootStore}),node=angular_three_createNode("three",instance,this.document),localState=getLocalState(instance);return is.geometry(instance)?localState.attach=["geometry"]:is.material(instance)&&(localState.attach=["material"]),injectedParent&&(node.__ngt_renderer__[1]=injectedParent),node}return angular_three_createNode("dom",element,this.document)}createComment(value){const comment=this.delegate.createComment(value),commentNode=angular_three_createNode("comment",comment,this.document);return comment.__ngt_renderer_add_comment__=node=>{"args"===node?this.argsCommentNodes.push(comment):"parent"===node?(this.parentCommentNodes.push(comment),comment.__ngt_renderer_set_parent_comment__=ngtParent=>{commentNode.__ngt_renderer__[1]=ngtParent}):"object"==typeof node&&this.portalCommentsNodes.push(node)},commentNode}appendChild(parent,newChild){const pRS=parent.__ngt_renderer__,cRS=newChild.__ngt_renderer__;if("dom"===pRS[0]&&(newChild instanceof Text||"dom"===cRS[0])){if(addChild(parent,newChild),newChild[DOM_PARENT]&&newChild[DOM_PARENT]instanceof HTMLElement)return void this.delegate.appendChild(newChild[DOM_PARENT],newChild);if(this.delegate.appendChild(parent,newChild),cRS&&(setParent(newChild,parent),this.shouldFindGrandparentInstance(pRS,cRS,newChild))){const closestGrandparentInstance=getClosestParentWithInstance(parent);closestGrandparentInstance&&this.appendChild(closestGrandparentInstance,newChild)}}else if("comment"!==cRS?.[0]){if(setParent(newChild,parent),addChild(parent,newChild),"portal"===cRS?.[0])return cRS[5]||this.processPortalContainer(newChild),void(cRS[5]&&this.appendChild(parent,cRS[5]));if("portal"===pRS[0])return pRS[5]||this.processPortalContainer(parent),void(pRS[5]&&this.appendChild(pRS[5],newChild));if("three"!==pRS[0]||"three"!==cRS?.[0]){if("three"===pRS[0])for(const renderChild of cRS?.[2]||[])this.appendChild(parent,renderChild);if(this.shouldFindGrandparentInstance(pRS,cRS,newChild)){const closestGrandparentInstance=getClosestParentWithInstance(parent);closestGrandparentInstance&&this.appendChild(closestGrandparentInstance,newChild)}else;}else{const cLS=getLocalState(newChild);if(cLS?.instanceStore?.get("parent"))return;if(parent===newChild)return;attachThreeChild(parent,newChild)}}else setParent(newChild,parent)}insertBefore(parent,newChild){null!=parent&&parent.__ngt_renderer__&&parent!==newChild&&this.appendChild(parent,newChild)}removeChild(parent,oldChild,isHostElement,calledByNgt=!1){if(!calledByNgt&&null==parent)return parent=this.parentNode(oldChild),this.removeChild(parent,oldChild,isHostElement,!0);null==parent&&(parent=(0,core.untracked)((()=>getLocalState(oldChild)?.parent?.()))||oldChild.__ngt_renderer__?.[1]);const cRS=oldChild.__ngt_renderer__;if(null==parent){if(cRS){if(is.scene(oldChild)&&"__ngt_root_scene__"===oldChild.name)return;"three"===cRS[0]&&removeThreeChild(oldChild,void 0,!0),this.destroyInternal(oldChild,void 0)}return}const pRS=parent.__ngt_renderer__;if((!cRS||!pRS)&&parent instanceof Element&&(oldChild instanceof Element||oldChild instanceof Text||oldChild instanceof Comment))return this.delegate.removeChild(parent,oldChild),void this.destroyInternal(oldChild,parent);if("dom"===cRS[0]&&(!pRS||"dom"===pRS[0]))return this.delegate.removeChild(parent,oldChild),void this.destroyInternal(oldChild,parent);if("three"===pRS[0]&&"three"===cRS[0])return removeThreeChild(oldChild,parent,!0),void this.destroyInternal(oldChild,parent);if("portal"===pRS[0]&&"three"===pRS[5]?.__ngt_renderer__[0])return void this.removeChild(pRS[5],oldChild,isHostElement);if("three"===pRS[0])return void this.destroyInternal(oldChild,parent);const closestGrandparentInstance=getClosestParentWithInstance(parent);closestGrandparentInstance&&this.removeChild(closestGrandparentInstance,oldChild,isHostElement),this.destroyInternal(oldChild,closestGrandparentInstance)}parentNode(node){const rS=node.__ngt_renderer__;return rS?.[1]?rS[1]:this.delegate.parentNode(node)}setAttributeInternal(el,name,value,_namespace){const rS=el.__ngt_renderer__;if(rS[3])return!1;if("three"===rS[0]){if(name===SPECIAL_PROPERTIES_RENDER_PRIORITY){let priority=Number(value);isNaN(priority)&&(priority=0,console.warn('[NGT] "priority" is an invalid number, default to 0'));const localState=getLocalState(el);localState&&(localState.priority=priority)}else if(name===SPECIAL_PROPERTIES_ATTACH){const paths=value.split(".");if(paths.length){const localState=getLocalState(el);localState&&(localState.attach=paths)}}else{let maybeCoerced=value;""===maybeCoerced||"true"===maybeCoerced||"false"===maybeCoerced?maybeCoerced="true"===maybeCoerced||""===maybeCoerced:isNaN(Number(maybeCoerced))||(maybeCoerced=Number(maybeCoerced)),name===SPECIAL_PROPERTIES_RAW_VALUE?rS[4]=maybeCoerced:applyProps(el,{[name]:maybeCoerced})}return!1}return!0}setAttribute(el,name,value,namespace){this.setAttributeInternal(el,name,value,namespace)&&this.delegate.setAttribute(el,name,value)}removeAttribute(el,name,namespace){this.setAttributeInternal(el,name,void 0,namespace)&&this.delegate.removeAttribute(el,name,namespace)}setProperty(el,name,value){const rS=el.__ngt_renderer__;if(!rS||rS[3])return;const localState=getLocalState(el);if("three"===rS[0]){if(name===SPECIAL_PROPERTIES_PARAMETERS)return"raycast"in value&&null===value.raycast&&(value.raycast=()=>null),applyProps(el,value),void("geometry"in value&&value.geometry.isBufferGeometry&&localState?.updateGeometryStamp());const parent=localState?.instanceStore.get("parent")||rS[1];return localState?.isRaw&&name===SPECIAL_PROPERTIES_RAW_VALUE?(rS[4]=value,void(parent&&attachThreeChild(parent,el))):name===SPECIAL_PROPERTIES_ATTACH?(localState&&(localState.attach=Array.isArray(value)?value.map((v=>v.toString())):"function"==typeof value?value:"string"==typeof value?value.split("."):[value]),void(parent&&attachThreeChild(parent,el))):("raycast"===name&&null===value&&(value=()=>null),applyProps(el,{[name]:value}),void("geometry"===name&&value.isBufferGeometry&&localState?.updateGeometryStamp()))}return this.delegate.setProperty(el,name,value)}listen(target,eventName,callback){const rS=target.__ngt_renderer__;if(!rS||function isDOM(node){return!node.__ngt_renderer__||node instanceof Element||node instanceof Document||node instanceof Window}(target))return this.delegate.listen(target,eventName,callback);if("three"===rS[0]){const instance=target,localState=getLocalState(instance);return function processThreeEvent(instance,priority,eventName,callback){const lS=getLocalState(instance);if(!lS)return console.warn("[NGT] instance has not been prepared yet."),()=>{};if(eventName===SPECIAL_EVENTS_BEFORE_RENDER)return lS.store.get("internal").subscribe((state=>callback({state,object:instance})),priority||lS.priority||0);if(eventName===SPECIAL_EVENTS_ATTACHED)return lS.onAttach=callback,lS.parent&&(0,core.untracked)(lS.parent)&&lS.onAttach({parent:(0,core.untracked)(lS.parent),node:instance}),()=>{lS.onAttach=void 0};if(eventName===SPECIAL_EVENTS_UPDATED)return lS.onUpdate=callback,()=>{lS.onUpdate=void 0};if(THREE_NATIVE_EVENTS.includes(eventName)&&instance instanceof three_core.Qev)return"disposed"===eventName&&(eventName="dispose"),!instance.parent||"added"!==eventName&&"removed"!==eventName||callback({type:eventName,target:instance}),instance.addEventListener(eventName,callback),()=>instance.removeEventListener(eventName,callback);lS.handlers||(lS.handlers={});const previousHandler=lS.handlers[eventName];if(Object.assign(lS.handlers,{[eventName]:event=>{previousHandler&&previousHandler(event),callback(event)}}),lS.eventCount+=1,1===lS.eventCount&&instance.raycast){let root=lS.store;for(;root.get("previousRoot");)root=root.get("previousRoot");(root.get("internal","interaction")||[]).push(instance)}return()=>{const lS=getLocalState(instance);if(lS){lS.eventCount-=1;const interactions=lS.store.get("internal","interaction")||[],index=interactions.findIndex((obj=>obj.uuid===instance.uuid));index>=0&&interactions.splice(index,1)}}}(instance,localState?.priority??0,eventName,callback)}if(target===this.rootStore.snapshot.scene){let[domTarget,event]=eventName.split(":");null==event&&(event=domTarget,domTarget="");const eventTarget="window"===domTarget?target.ownerDocument.defaultView:target.ownerDocument;return this.delegate.listen(eventTarget,event,callback)}return()=>{}}destroyInternal(node,parent){const rS=node.__ngt_renderer__;if(rS&&!rS[3]){if("three"===rS[0]){const localState=getLocalState(node);localState?.instanceStore&&(localState.instanceStore.get("objects").forEach((obj=>this.destroyInternal(obj,parent))),localState.instanceStore.get("nonObjects").forEach((obj=>this.destroyInternal(obj,parent)))),localState?.onUpdate&&delete localState.onUpdate,localState?.onAttach&&delete localState.onAttach,delete localState.objects,delete localState.nonObjects,delete localState.parent,delete localState.add,delete localState.remove,delete localState.store,delete localState.handlers,localState?.primitive||delete node.__ngt__}"comment"===rS[0]&&(rS[6]=null,rS[7]=null,delete node.__ngt_renderer_add_comment__,this.removeCommentNode(node,this.argsCommentNodes)),"portal"===rS[0]&&(rS[6]=null,rS[7]=null,this.removeCommentNode(node,this.portalCommentsNodes)),rS[1]=null;for(const renderChild of rS[2]||[]){if("three"===renderChild.__ngt_renderer__?.[0]&&parent){if("three"===parent.__ngt_renderer__?.[0]){removeThreeChild(renderChild,parent,!0);continue}const closestInstance=getClosestParentWithInstance(parent);closestInstance&&removeThreeChild(renderChild,closestInstance,!0)}this.destroyInternal(renderChild,parent)}rS[2]=[],rS[3]=!0,"getAttribute"in node&&"function"==typeof node.getAttribute&&Reflect.get(node.getAttribute,"__ngt_renderer__")&&delete node.getAttribute,parent&&function removeChild(node,child){const index=node.__ngt_renderer__?.[2].findIndex((c=>child===c));index>=0&&node.__ngt_renderer__[2].splice(index,1)}(parent,node)}}removeCommentNode(node,nodes){const index=nodes.findIndex((comment=>comment===node));index>-1&&nodes.splice(index,1)}processPortalContainer(portal){const injector=portal.__ngt_renderer__[7]?.()?.injector;if(!injector)return;const portalStore=injector.get(NGT_STORE,null);if(!portalStore)return;const portalContainer=portalStore.get("scene");if(!portalContainer)return;const localState=getLocalState(portalContainer);localState&&(localState.store=portalStore),portal.__ngt_renderer__[5]=angular_three_createNode("three",portalContainer,this.document)}shouldFindGrandparentInstance(pRS,cRS,child){const pType=pRS[0],cType=cRS[0],cLS=getLocalState(child),isParentStillDOM="dom"===pType;return"three"===cType&&!cLS?.instanceStore?.get("parent")||isParentStillDOM&&"dom"===cType||isParentStillDOM}getNgtDirective(directive,commentNodes){let directiveInstance;const destroyed=[];let i=commentNodes.length-1;for(;i>=0;){const comment=commentNodes[i];if(comment.__ngt_renderer__[3]){destroyed.push(i),i--;continue}const injector=comment.__ngt_renderer__[7]?.()?.injector;if(!injector){i--;continue}const instance=injector.get(directive,null);if(instance&&"object"==typeof instance&&"validate"in instance&&"function"==typeof instance.validate&&instance.validate()){directiveInstance=instance;break}i--}return destroyed.forEach((index=>{commentNodes.splice(index,1)})),directiveInstance}get data(){return this.delegate.data}}function provideNgtRenderer(store){const providers=[NgtRendererFactory,{provide:core.RendererFactory2,useExisting:NgtRendererFactory},provideStore((()=>store))];return(0,core.makeEnvironmentProviders)(providers)}const shallowLoose={objects:"shallow",strict:!1};function injectCanvasRootInitializer(injector){return(0,ngxtension_assert_injector.x)(injectCanvasRootInitializer,injector,(()=>{const injectedStore=injectStore(),loop=injectLoop();return canvas=>{const exist=roots.has(canvas);let store=roots.get(canvas);if(store&&console.warn("[NGT] Same canvas root is being created twice"),store||=injectedStore,!store)throw new Error("[NGT] No store initialized");exist||roots.set(canvas,store);let lastCamera,isConfigured=!1;return{isConfigured,destroy:(timeout=500)=>{const root=roots.get(canvas);root&&(root.update((state=>({internal:{...state.internal,active:!1}}))),setTimeout((()=>{try{const state=root.get();state.events.disconnect?.(),state.gl?.renderLists?.dispose?.(),state.gl?.forceContextLoss?.(),state.gl?.xr&&state.xr.disconnect(),function dispose(obj){obj.dispose&&"Scene"!==obj.type&&obj.dispose();for(const p in obj)p.dispose?.(),delete obj[p]}(state),roots.delete(canvas)}catch(e){console.error("[NGT] Unexpected error while destroying Canvas Root",e)}}),timeout))},configure:inputs=>{const{shadows=!1,linear=!1,flat=!1,legacy=!1,orthographic=!1,frameloop="always",dpr=[1,2],gl:glOptions,size:sizeOptions,camera:cameraOptions,raycaster:raycasterOptions,scene:sceneOptions,events,lookAt,performance}=inputs,state=store.snapshot,stateToUpdate={};let gl=state.gl;state.gl||(stateToUpdate.gl=gl=function makeRendererInstance(glOptions,canvas){const customRenderer="function"==typeof glOptions?glOptions(canvas):glOptions;return is.renderer(customRenderer)?customRenderer:new three_module.WebGLRenderer({powerPreference:"high-performance",canvas,antialias:!0,alpha:!0,...glOptions})}(glOptions,canvas));let raycaster=state.raycaster;raycaster||(stateToUpdate.raycaster=raycaster=new three_core.tBo);const{params,...options}=raycasterOptions||{};if(is.equ(options,raycaster,shallowLoose)||applyProps(raycaster,options),is.equ(params,raycaster.params,shallowLoose)||applyProps(raycaster,{params:{...raycaster.params,...params||{}}}),!state.camera||state.camera===lastCamera&&!is.equ(lastCamera,cameraOptions,shallowLoose)){lastCamera=cameraOptions;const isCamera=is.camera(cameraOptions);let camera=isCamera?cameraOptions:function makeCameraInstance(isOrthographic,size){return isOrthographic?new three_core.qUd(0,0,0,0,.1,1e3):new three_core.ubm(75,size.width/size.height,.1,1e3)}(orthographic,sizeOptions??state.size);isCamera||(camera.position.z=5,cameraOptions&&(applyProps(camera,cameraOptions),("aspect"in cameraOptions||"left"in cameraOptions||"right"in cameraOptions||"top"in cameraOptions||"bottom"in cameraOptions)&&(Object.assign(camera,{manual:!0}),camera?.updateProjectionMatrix())),state.camera||cameraOptions?.rotation||cameraOptions?.quaternion||(Array.isArray(lookAt)?camera.lookAt(lookAt[0],lookAt[1],lookAt[2]):lookAt?.isVector3?camera.lookAt(lookAt):camera.lookAt(0,0,0)),camera.updateProjectionMatrix?.()),is.instance(camera)||(camera=prepare(camera,{store})),stateToUpdate.camera=camera,raycaster.camera=camera}if(!state.scene){let scene;is.scene(sceneOptions)?scene=sceneOptions:(scene=new three_core.Z58,sceneOptions&&applyProps(scene,sceneOptions)),applyProps(scene,{name:"__ngt_root_scene__",setAttribute:(name,value)=>{canvas instanceof HTMLCanvasElement&&(canvas.parentElement?canvas.parentElement.setAttribute(name,value):canvas.setAttribute(name,value))}}),stateToUpdate.scene=prepare(scene,{store})}if(!state.xr){const handleXRFrame=(timestamp,frame)=>{"never"!==store.snapshot.frameloop&&loop.advance(timestamp,!0,store,frame)},handleSessionChange=()=>{const state=store.snapshot;state.gl.xr.enabled=state.gl.xr.isPresenting,state.gl.xr.setAnimationLoop(state.gl.xr.isPresenting?handleXRFrame:null),state.gl.xr.isPresenting||loop.invalidate(store)},xr={connect:()=>{gl.xr.addEventListener("sessionstart",handleSessionChange),gl.xr.addEventListener("sessionend",handleSessionChange)},disconnect:()=>{gl.xr.removeEventListener("sessionstart",handleSessionChange),gl.xr.removeEventListener("sessionend",handleSessionChange)}};gl.xr&&"function"==typeof gl.xr.addEventListener&&xr.connect(),stateToUpdate.xr=xr}if(gl.shadowMap){const oldEnabled=gl.shadowMap.enabled,oldType=gl.shadowMap.type;if(gl.shadowMap.enabled=!!shadows,"boolean"==typeof shadows)gl.shadowMap.type=three_core.Wk7;else if("string"==typeof shadows){const types={basic:three_core.bTm,percentage:three_core.QP0,soft:three_core.Wk7,variance:three_core.RyA};gl.shadowMap.type=types[shadows]??three_core.Wk7}else is.obj(shadows)&&Object.assign(gl.shadowMap,shadows);oldEnabled===gl.shadowMap.enabled&&oldType===gl.shadowMap.type||checkNeedsUpdate(gl.shadowMap)}if(three_core.ppV){const colorManagement=three_core.ppV;"enabled"in colorManagement?colorManagement.enabled=!legacy:"legacyMode"in colorManagement&&(colorManagement.legacyMode=legacy)}if(!isConfigured){applyProps(gl,{outputEncoding:linear?3e3:3001,toneMapping:flat?three_core.y_p:three_core.FV})}state.legacy!==legacy&&(stateToUpdate.legacy=legacy),state.linear!==linear&&(stateToUpdate.linear=linear),state.flat!==flat&&(stateToUpdate.flat=flat),gl.setClearAlpha&&gl.setClearAlpha(0),gl.setPixelRatio(makeDpr(state.viewport.dpr)),gl.setSize(sizeOptions?.width??state.size.width,sizeOptions?.height??state.size.height),!is.obj(glOptions)||"function"==typeof glOptions||is.renderer(glOptions)||is.equ(glOptions,gl,shallowLoose)||applyProps(gl,glOptions),events&&!state.events.handlers&&(stateToUpdate.events=events(store)),performance&&!is.equ(performance,state.performance,shallowLoose)&&(stateToUpdate.performance={...state.performance,...performance}),Object.keys(stateToUpdate).length&&store.update(stateToUpdate);const size=function computeInitialSize(canvas,defaultSize){if(defaultSize)return defaultSize;if("undefined"!=typeof HTMLCanvasElement&&canvas instanceof HTMLCanvasElement&&canvas.parentElement)return canvas.parentElement.getBoundingClientRect();if("undefined"!=typeof OffscreenCanvas&&canvas instanceof OffscreenCanvas)return{width:canvas.width,height:canvas.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}(canvas,sizeOptions);is.equ(size,state.size,shallowLoose)||state.setSize(size.width,size.height,size.top,size.left),dpr&&state.viewport.dpr!==makeDpr(dpr)&&state.setDpr(dpr),state.frameloop!==frameloop&&state.setFrameloop(frameloop),isConfigured=!0}}}}))}var _a;class NgtOutletEnvironmentInjector extends core.EnvironmentInjector{constructor(routeEnvInjector,ngtEnvInjector){super(),this.routeEnvInjector=routeEnvInjector,this.ngtEnvInjector=ngtEnvInjector}get(token,notFoundValue,flags=core.InjectFlags.Default){const options={};return"object"==typeof flags?Object.assign(options,flags):Object.assign(options,{optional:!!(flags&core.InjectFlags.Optional),host:!!(flags&core.InjectFlags.Host),self:!!(flags&core.InjectFlags.Self),skipSelf:!!(flags&core.InjectFlags.SkipSelf)}),token===core.RendererFactory2?this.ngtEnvInjector.get(token,notFoundValue,options):this.routeEnvInjector.get(token,notFoundValue,options)}runInContext(fn){try{return(0,core.runInInjectionContext)(this.routeEnvInjector,fn)}catch{}return(0,core.runInInjectionContext)(this.ngtEnvInjector,fn)}destroy(){this.routeEnvInjector.destroy()}}class NgtRouterOutlet extends RouterOutlet{constructor(){super(...arguments),this.environmentInjector=(0,core.inject)(core.EnvironmentInjector)}activateWith(activatedRoute,environmentInjector){const activateWithEnvInjector=this.environmentInjector===environmentInjector?environmentInjector:(0,core.createEnvironmentInjector)([],new NgtOutletEnvironmentInjector(environmentInjector,this.environmentInjector));return super.activateWith(activatedRoute,activateWithEnvInjector)}static{this.ɵfac=(()=>{let ɵNgtRouterOutlet_BaseFactory;return function NgtRouterOutlet_Factory(__ngFactoryType__){return(ɵNgtRouterOutlet_BaseFactory||(ɵNgtRouterOutlet_BaseFactory=core["ɵɵgetInheritedFactory"](NgtRouterOutlet)))(__ngFactoryType__||NgtRouterOutlet)}})()}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtRouterOutlet,selectors:[["ngt-router-outlet"]],features:[core["ɵɵInheritDefinitionFeature"]]})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRouterOutlet,[{type:core.Directive,args:[{selector:"ngt-router-outlet"}]}],null,null);class NgtRoutedScene{static{0}static{this.__ngt_renderer_is_routed_scene__=!0}constructor(router,cdr){(0,core.effect)((onCleanup=>{const sub=router.events.pipe((0,filter.p)((event=>event instanceof ActivationEnd))).subscribe(cdr.detectChanges.bind(cdr));onCleanup((()=>sub.unsubscribe()))}))}static{this.ɵfac=function NgtRoutedScene_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtRoutedScene)(core["ɵɵdirectiveInject"](Router),core["ɵɵdirectiveInject"](core.ChangeDetectorRef))}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtRoutedScene,selectors:[["ngt-routed-scene"]],decls:1,vars:0,template:function NgtRoutedScene_Template(rf,ctx){1&rf&&core["ɵɵelement"](0,"ngt-router-outlet")},dependencies:[NgtRouterOutlet],encapsulation:2})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtRoutedScene,[{type:core.Component,args:[{selector:"ngt-routed-scene",template:"\n\t\t<ngt-router-outlet />\n\t",imports:[NgtRouterOutlet]}]}],(()=>[{type:Router},{type:core.ChangeDetectorRef}]),null);class NgtCanvas{constructor(){this.store=injectStore(),this.initRoot=injectCanvasRootInitializer(),this.host=(0,core.inject)(core.ElementRef),this.zone=(0,core.inject)(core.NgZone),this.environmentInjector=(0,core.inject)(core.EnvironmentInjector),this.injector=(0,core.inject)(core.Injector),this.sceneGraph=core.input.required({transform:value=>"routed"===value?NgtRoutedScene:value}),this.gl=(0,core.input)(),this.size=(0,core.input)(),this.shadows=(0,core.input)(!1,{transform:value=>""===value?(0,core.booleanAttribute)(value):value}),this.legacy=(0,core.input)(!1,{transform:core.booleanAttribute}),this.linear=(0,core.input)(!1,{transform:core.booleanAttribute}),this.flat=(0,core.input)(!1,{transform:core.booleanAttribute}),this.orthographic=(0,core.input)(!1,{transform:core.booleanAttribute}),this.frameloop=(0,core.input)("always"),this.performance=(0,core.input)(),this.dpr=(0,core.input)([1,2]),this.raycaster=(0,core.input)(),this.scene=(0,core.input)(),this.camera=(0,core.input)(),this.events=(0,core.input)(createPointerEvents),this.eventSource=(0,core.input)(),this.eventPrefix=(0,core.input)("offset"),this.lookAt=(0,core.input)(),this.created=(0,core.output)(),this.rendered=(0,core.output)(),this.pointerMissed=(0,rxjs_interop.p)(this.store.get("pointerMissed$")),this.glCanvas=core.viewChild.required("glCanvas"),this.glCanvasViewContainerRef=core.viewChild.required("glCanvas",{read:core.ViewContainerRef}),this.hbPointerEvents=(0,core.computed)((()=>this.eventSource()?"none":"auto")),this.resizeResult=(0,core.signal)({},{equal:Object.is}),this.configurator=(0,core.signal)(null),(0,core.afterNextRender)((()=>{const canvasElement=this.glCanvas().nativeElement;this.zone.runOutsideAngular((()=>{this.configurator.set(this.initRoot(canvasElement))})),(0,core.effect)((()=>{const resizeResult=this.resizeResult();if(!resizeResult.width||resizeResult.width<=0||!resizeResult.height||resizeResult.height<=0)return;const configurator=this.configurator();if(!configurator)return;const canvasOptions={gl:this.gl(),shadows:this.shadows(),legacy:this.legacy(),linear:this.linear(),flat:this.flat(),orthographic:this.orthographic(),frameloop:this.frameloop(),performance:this.performance(),dpr:this.dpr(),raycaster:this.raycaster(),scene:this.scene(),camera:this.camera(),events:this.events(),eventSource:this.eventSource(),eventPrefix:this.eventPrefix(),lookAt:this.lookAt(),size:resizeResult};this.zone.runOutsideAngular((()=>{configurator.configure(canvasOptions),this.glRef?this.glRef.changeDetectorRef.detectChanges():this.noZoneRender()}))}),{injector:this.injector})})),(0,core.inject)(core.DestroyRef).onDestroy((()=>{this.glRef?.destroy(),this.glEnvironmentInjector?.destroy(),this.configurator()?.destroy()}))}noZoneRender(){this.glEnvironmentInjector?.destroy(),this.glRef?.destroy(),this.store.update((state=>({internal:{...state.internal,active:!0}})));const[state,eventSource,eventPrefix]=[this.store.snapshot,(0,core.untracked)(this.eventSource),(0,core.untracked)(this.eventPrefix)];state.events.connect?.(eventSource?is.ref(eventSource)?eventSource.nativeElement:eventSource:this.host.nativeElement),eventPrefix&&state.setEvents({compute:(event,store)=>{const{pointer,raycaster,camera,size}=store.snapshot,x=event[eventPrefix+"X"],y=event[eventPrefix+"Y"];pointer.set(x/size.width*2-1,-y/size.height*2+1),raycaster.setFromCamera(pointer,camera)}}),this.created.emit(this.store.snapshot),this.store.get("events","connected")||this.store.get("events").connect?.((0,core.untracked)(this.glCanvas).nativeElement),this.glEnvironmentInjector=(0,core.createEnvironmentInjector)([provideNgtRenderer(this.store)],this.environmentInjector),this.glRef=(0,core.untracked)(this.glCanvasViewContainerRef).createComponent((0,core.untracked)(this.sceneGraph),{environmentInjector:this.glEnvironmentInjector,injector:this.injector}),this.glRef.changeDetectorRef.detectChanges(),this.rendered.emit(this.glRef)}static{this.ɵfac=function NgtCanvas_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtCanvas)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtCanvas,selectors:[["ngt-canvas"]],viewQuery:function NgtCanvas_Query(rf,ctx){1&rf&&(core["ɵɵviewQuerySignal"](ctx.glCanvas,_c0,5),core["ɵɵviewQuerySignal"](ctx.glCanvasViewContainerRef,_c0,5,core.ViewContainerRef)),2&rf&&core["ɵɵqueryAdvance"](2)},hostAttrs:[2,"display","block","position","relative","width","100%","height","100%","overflow","hidden"],hostVars:2,hostBindings:function NgtCanvas_HostBindings(rf,ctx){2&rf&&core["ɵɵstyleProp"]("pointer-events",ctx.hbPointerEvents())},inputs:{sceneGraph:[1,"sceneGraph"],gl:[1,"gl"],size:[1,"size"],shadows:[1,"shadows"],legacy:[1,"legacy"],linear:[1,"linear"],flat:[1,"flat"],orthographic:[1,"orthographic"],frameloop:[1,"frameloop"],performance:[1,"performance"],dpr:[1,"dpr"],raycaster:[1,"raycaster"],scene:[1,"scene"],camera:[1,"camera"],events:[1,"events"],eventSource:[1,"eventSource"],eventPrefix:[1,"eventPrefix"],lookAt:[1,"lookAt"]},outputs:{created:"created",rendered:"rendered",pointerMissed:"pointerMissed"},features:[core["ɵɵProvidersFeature"]([provideResizeOptions({emitInZone:!1,emitInitialResult:!0,debounce:{scroll:50,resize:0}}),provideStore()])],decls:3,vars:0,consts:[["glCanvas",""],[2,"height","100%","width","100%",3,"ngxResize"],[2,"display","block"]],template:function NgtCanvas_Template(rf,ctx){if(1&rf){const _r1=core["ɵɵgetCurrentView"]();core["ɵɵelementStart"](0,"div",1),core["ɵɵlistener"]("ngxResize",(function NgtCanvas_Template_div_ngxResize_0_listener($event){return core["ɵɵrestoreView"](_r1),core["ɵɵresetView"](ctx.resizeResult.set($event))})),core["ɵɵelement"](1,"canvas",2,0),core["ɵɵelementEnd"]()}},dependencies:[NgxResize],encapsulation:2,changeDetection:0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtCanvas,[{type:core.Component,args:[{selector:"ngt-canvas",template:'\n\t\t<div (ngxResize)="resizeResult.set($event)" style="height: 100%; width: 100%;">\n\t\t\t<canvas #glCanvas style="display: block;"></canvas>\n\t\t</div>\n\t',imports:[NgxResize],providers:[provideResizeOptions({emitInZone:!1,emitInitialResult:!0,debounce:{scroll:50,resize:0}}),provideStore()],host:{style:"display: block;position: relative;width: 100%;height: 100%;overflow: hidden;","[style.pointerEvents]":"hbPointerEvents()"},changeDetection:core.ChangeDetectionStrategy.OnPush}]}],(()=>[]),null);class NgtSelection{constructor(){this.enabled=(0,core.input)(!0,{alias:"ngtSelection",transform:core.booleanAttribute}),this.source=(0,core.signal)([]),this.selected=this.source.asReadonly()}update(...args){this.enabled()&&this.source.update(...args)}static{this.ɵfac=function NgtSelection_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtSelection)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtSelection,selectors:[["","ngtSelection",""]],inputs:{enabled:[1,"ngtSelection","enabled"]}})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtSelection,[{type:core.Directive,args:[{selector:"[ngtSelection]"}]}],null,null);class NgtSelect{constructor(){this.enabled=(0,core.input)(!1,{transform:core.booleanAttribute,alias:"ngtSelect"});const elementRef=(0,core.inject)(core.ElementRef),selection=(0,core.inject)(NgtSelection);(0,core.effect)((onCleanup=>{if(!selection.enabled())return;if(!this.enabled())return;const host=elementRef.nativeElement;if(!host)return;const localState=getLocalState(host);if(!localState)return;if("Mesh"===host.type)return selection.update((prev=>[...prev,host])),void onCleanup((()=>selection.update((prev=>prev.filter((el=>el!==host))))));const[collection]=[(0,core.untracked)(selection.selected),localState.objects()];let changed=!1;const current=[];host.traverse((child=>{"Mesh"===child.type&&current.push(child),-1===collection.indexOf(child)&&(changed=!0)})),changed&&(selection.update((prev=>[...prev,...current])),onCleanup((()=>{selection.update((prev=>prev.filter((el=>!current.includes(el)))))})))}))}static{this.ɵfac=function NgtSelect_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtSelect)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtSelect,selectors:[["ngt-group","ngtSelect",""],["ngt-mesh","ngtSelect",""]],inputs:{enabled:[1,"ngtSelect","enabled"]}})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtSelect,[{type:core.Directive,args:[{selector:"ngt-group[ngtSelect], ngt-mesh[ngtSelect]"}]}],(()=>[]),null);const NGT_HTML_DOM_ELEMENT=new core.InjectionToken("NGT_HTML_DOM_ELEMENT");function provideHTMLDomElement(...args){return 0===args.length?{provide:NGT_HTML_DOM_ELEMENT,useFactory:()=>"gl"}:1===args.length?{provide:NGT_HTML_DOM_ELEMENT,useFactory:args[0]}:{provide:NGT_HTML_DOM_ELEMENT,useFactory:args.pop(),deps:args}}class NgtHTML{static{_a=HTML}static{this[_a]=!0}constructor(){this.store=injectStore(),this.destroyRef=(0,core.inject)(core.DestroyRef),this.host=(0,core.inject)(core.ElementRef),this.domElement=(0,core.inject)(NGT_HTML_DOM_ELEMENT,{self:!0,optional:!0}),"gl"===this.domElement?Object.assign(this.host.nativeElement,{[DOM_PARENT]:this.store.snapshot.gl.domElement.parentElement}):this.domElement&&Object.assign(this.host.nativeElement,{[DOM_PARENT]:this.domElement}),this.destroyRef.onDestroy((()=>{this.host.nativeElement[DOM_PARENT]=null,delete this.host.nativeElement[DOM_PARENT]}))}static{this.ɵfac=function NgtHTML_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtHTML)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtHTML})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtHTML,[{type:core.Directive}],(()=>[]),null);const cached=new Map,memoizedLoaders=new WeakMap;function load(loaderConstructorFactory,inputs,{extensions,onLoad,onProgress}={}){return()=>{const urls=function normalizeInputs(input){let urls=[];return urls=Array.isArray(input)?input:"string"==typeof input?[input]:Object.values(input),urls.map((url=>url.includes("undefined")||url.includes("null")||!url?"":url))}(inputs());let loader=memoizedLoaders.get(loaderConstructorFactory(urls));return loader||(loader=new(loaderConstructorFactory(urls)),memoizedLoaders.set(loaderConstructorFactory(urls),loader)),extensions&&extensions(loader),urls.map((url=>""===url?Promise.resolve(null):(cached.has(url)||cached.set(url,new Promise(((resolve,reject)=>{loader.load(url,(data=>{"scene"in data&&Object.assign(data,function makeObjectGraph(object){const data={nodes:{},materials:{}};return object&&object.traverse((child=>{child.name&&(data.nodes[child.name]=child),"material"in child&&!data.materials[child.material.name]&&(data.materials[child.material.name]=child.material)})),data}(data.scene)),onLoad&&onLoad(data),resolve(data)}),onProgress,(error=>reject(new Error(`[NGT] Could not load ${url}: ${error?.message}`))))}))),cached.get(url))))}}function _injectLoader(loaderConstructorFactory,inputs,{extensions,onProgress,onLoad,injector}={}){return(0,ngxtension_assert_injector.x)(_injectLoader,injector,(()=>{const response=(0,core.signal)(null),cachedResultPromisesEffect=load(loaderConstructorFactory,inputs,{extensions,onProgress,onLoad});return(0,core.effect)((()=>{const originalUrls=inputs(),cachedResultPromises=cachedResultPromisesEffect();Promise.all(cachedResultPromises).then((results=>{response.update((()=>{if(Array.isArray(originalUrls))return results;if("string"==typeof originalUrls)return results[0];const keys=Object.keys(originalUrls);return keys.reduce(((result,key)=>(result[key]=results[keys.indexOf(key)],result)),{})}))}))})),response.asReadonly()}))}_injectLoader.preload=(loaderConstructorFactory,inputs,extensions,onLoad)=>{const effects=load(loaderConstructorFactory,inputs,{extensions,onLoad})();effects&&Promise.all(effects)},_injectLoader.destroy=()=>{cached.clear()},_injectLoader.clear=urls=>{(Array.isArray(urls)?urls:[urls]).forEach((url=>{cached.delete(url)}))};const injectLoader=_injectLoader,RGBA_REGEX=/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*(\d*\.?\d+)?\)/;class NgtHexify{constructor(){this.document=(0,core.inject)(common.DOCUMENT,{optional:!0}),this.cache={}}transform(value){if(null==value)return 0;if(value.startsWith("#"))return this.cache[value]||(this.cache[value]=this.hexStringToNumber(value)),this.cache[value];if(this.ctx||(this.ctx=this.document?.createElement("canvas").getContext("2d")),!this.ctx)return console.warn("[NGT] hexify: canvas context is not available"),0;this.ctx.fillStyle=value;const computedValue=this.ctx.fillStyle;if(computedValue.startsWith("#"))return this.cache[computedValue]||(this.cache[computedValue]=this.hexStringToNumber(computedValue)),this.cache[computedValue];if(!computedValue.startsWith("rgba"))return console.warn(`[NGT] hexify: invalid color format. Expected rgba or hex, receive: ${computedValue}`),0;const match=computedValue.match(RGBA_REGEX);if(!match)return console.warn(`[NGT] hexify: invalid color format. Expected rgba or hex, receive: ${computedValue}`),0;const r=parseInt(match[1],10),g=parseInt(match[2],10),b=parseInt(match[3],10),a=match[4]?parseFloat(match[4]):1,cacheKey=`${r}:${g}:${b}:${a}`;if(!this.cache[cacheKey]){const hex=`#${this.componentToHex(r)}${this.componentToHex(g)}${this.componentToHex(b)}${this.componentToHex(Math.round(255*a))}`;this.cache[cacheKey]=this.hexStringToNumber(hex)}return this.cache[cacheKey]}hexStringToNumber(hexString){return parseInt(hexString.replace("#",""),16)}componentToHex(component){const hex=component.toString(16);return 1===hex.length?"0"+hex:hex}static{this.ɵfac=function NgtHexify_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtHexify)}}static{this.ɵpipe=core["ɵɵdefinePipe"]({name:"hexify",type:NgtHexify,pure:!0})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtHexify,[{type:core.Pipe,args:[{name:"hexify",pure:!0}]}],null,null);class NgtPortalBeforeRender{constructor(){this.portalStore=injectStore(),this.renderPriority=(0,core.input)(1),this.parentScene=core.input.required(),this.parentCamera=core.input.required(),(0,core.effect)((onCleanup=>{const[renderPriority,{internal}]=[this.renderPriority(),this.portalStore.state()];let oldClean;const cleanup=internal.subscribe((({gl,scene,camera})=>{const[parentScene,parentCamera]=[(0,core.untracked)(this.parentScene),(0,core.untracked)(this.parentCamera)];oldClean=gl.autoClear,1===renderPriority&&(gl.autoClear=!0,gl.render(parentScene,parentCamera)),gl.autoClear=!1,gl.clearDepth(),gl.render(scene,camera),gl.autoClear=oldClean}),renderPriority,this.portalStore);onCleanup((()=>cleanup()))}))}onPointerOver(){}static{this.ɵfac=function NgtPortalBeforeRender_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtPortalBeforeRender)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtPortalBeforeRender,selectors:[["ngt-portal-before-render"]],inputs:{renderPriority:[1,"renderPriority"],parentScene:[1,"parentScene"],parentCamera:[1,"parentCamera"]},decls:1,vars:0,consts:[["attach","none",3,"pointerover"]],template:function NgtPortalBeforeRender_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"ngt-group",0),core["ɵɵlistener"]("pointerover",(function NgtPortalBeforeRender_Template_ngt_group_pointerover_0_listener(){return ctx.onPointerOver()})),core["ɵɵelementEnd"]())},encapsulation:2})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPortalBeforeRender,[{type:core.Component,args:[{selector:"ngt-portal-before-render",template:'\n\t\t\x3c!-- Without an element that receives pointer events state.pointer will always be 0/0 --\x3e\n\t\t<ngt-group (pointerover)="onPointerOver()" attach="none" />\n\t',schemas:[core.CUSTOM_ELEMENTS_SCHEMA]}]}],(()=>[]),null);class NgtPortalContent{constructor(){const{element:comment}=(0,core.inject)(core.ViewContainerRef),{element:parentComment}=(0,core.inject)(core.ViewContainerRef,{skipSelf:!0}),commentNode=comment.nativeElement;commentNode.__ngt_renderer_add_comment__&&(commentNode.__ngt_renderer_add_comment__(parentComment.nativeElement),delete commentNode.__ngt_renderer_add_comment__)}static ngTemplateContextGuard(_,ctx){return!0}static{this.ɵfac=function NgtPortalContent_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtPortalContent)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtPortalContent,selectors:[["ng-template","portalContent",""]]})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPortalContent,[{type:core.Directive,args:[{selector:"ng-template[portalContent]"}]}],(()=>[]),null);const privateKeys=["setSize","setFrameloop","setDpr","events","setEvents","invalidate","advance","size","viewport"];class NgtPortal{constructor(){this.container=core.input.required(),this.state=(0,core.input)({}),this.autoRender=(0,core.input)(!1),this.autoRenderPriority=(0,core.input)(1),this.portalContent=core.contentChild.required(NgtPortalContent,{read:core.TemplateRef}),this.portalAnchor=core.viewChild.required("anchor",{read:core.ViewContainerRef}),this.injector=(0,core.inject)(core.Injector),this.portalStore=injectStore({self:!0}),this.parentStore=injectStore({skipSelf:!0}),this.parentScene=this.parentStore.select("scene"),this.parentCamera=this.parentStore.select("camera"),this.raycaster=new three_core.tBo,this.pointer=new three_core.I9Y,this.portalRendered=(0,core.signal)(!1),this.shouldAutoRender=(0,core.computed)((()=>this.portalRendered()&&this.autoRender()));const parentState=this.parentStore.select();(0,core.afterNextRender)((()=>{const previousState=this.parentStore.snapshot,{events={},size={},...rest}=this.state();let container=this.container();is.instance(container)||(container=prepare(container,{store:this.portalStore}));const localState=getLocalState(container);localState&&!localState.store&&(localState.store=this.portalStore),this.portalStore.update({...previousState,scene:container,raycaster:this.raycaster,pointer:this.pointer,events:{...previousState.events,...events},size:{...previousState.size,...size},previousRoot:this.parentStore,...rest,setEvents:events=>this.portalStore.update((state=>({...state,events:{...state.events,...events}})))}),(0,core.effect)((()=>{const state=this.state(),_parentState=parentState();this.portalStore.update((prev=>this.inject(_parentState,prev,state,(0,core.untracked)(this.container)))),this.portalView?this.portalView.detectChanges():(this.portalView=(0,core.untracked)(this.portalAnchor).createEmbeddedView((0,core.untracked)(this.portalContent),{container:(0,core.untracked)(this.container),injector:this.injector},{injector:this.injector}),this.portalView.detectChanges(),this.portalRendered.set(!0))}),{injector:this.injector})})),(0,core.inject)(core.DestroyRef).onDestroy((()=>{this.portalView?.destroy()}))}inject(parentState,portalState,injectedState,container){const{events={},size,...rest}=injectedState,intersect={...parentState};let viewport;if(Object.keys(parentState).forEach((key=>{(privateKeys.includes(key)||parentState[key]!==portalState[key]&&portalState[key])&&delete intersect[key]})),portalState&&size){const camera=portalState.camera;viewport=parentState.viewport.getCurrentViewport(camera,new three_core.Pq0,size),camera!==parentState.camera&&updateCamera(camera,size)}return{...intersect,scene:container,raycaster:this.raycaster,pointer:this.pointer,events:{...parentState.events,...portalState.events||{},...events||{}},size:{...parentState.size,...size||{}},viewport:{...parentState.viewport,...viewport||{}},...rest}}static{this.ɵfac=function NgtPortal_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtPortal)}}static{this.ɵcmp=core["ɵɵdefineComponent"]({type:NgtPortal,selectors:[["ngt-portal"]],contentQueries:function NgtPortal_ContentQueries(rf,ctx,dirIndex){1&rf&&core["ɵɵcontentQuerySignal"](dirIndex,ctx.portalContent,NgtPortalContent,5,core.TemplateRef),2&rf&&core["ɵɵqueryAdvance"]()},viewQuery:function NgtPortal_Query(rf,ctx){1&rf&&core["ɵɵviewQuerySignal"](ctx.portalAnchor,_c1,5,core.ViewContainerRef),2&rf&&core["ɵɵqueryAdvance"]()},inputs:{container:[1,"container"],state:[1,"state"],autoRender:[1,"autoRender"],autoRenderPriority:[1,"autoRenderPriority"]},features:[core["ɵɵProvidersFeature"]([provideStore((()=>signalStore({})))])],decls:3,vars:1,consts:[["anchor",""],[3,"renderPriority","parentScene","parentCamera"]],template:function NgtPortal_Template(rf,ctx){1&rf&&(core["ɵɵelementContainer"](0,null,0),core["ɵɵtemplate"](2,NgtPortal_Conditional_2_Template,1,3,"ngt-portal-before-render",1)),2&rf&&(core["ɵɵadvance"](2),core["ɵɵconditional"](ctx.shouldAutoRender()?2:-1))},dependencies:[NgtPortalBeforeRender],encapsulation:2,changeDetection:0})}}function injectBeforeRender(cb,{priority=0,injector}={}){return(0,ngxtension_assert_injector.x)(injectBeforeRender,injector,(()=>{const store=injectStore(),sub=store.get("internal").subscribe(cb,priority,store);return(0,core.inject)(core.DestroyRef).onDestroy((()=>{sub()})),sub}))}function resolveRef(ref){return is.ref(ref)?ref.nativeElement:ref}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtPortal,[{type:core.Component,args:[{selector:"ngt-portal",template:'\n\t\t<ng-container #anchor />\n\n\t\t@if (shouldAutoRender()) {\n\t\t\t<ngt-portal-before-render\n\t\t\t\t[renderPriority]="autoRenderPriority()"\n\t\t\t\t[parentScene]="parentScene()"\n\t\t\t\t[parentCamera]="parentCamera()"\n\t\t\t/>\n\t\t}\n\t',imports:[NgtPortalBeforeRender],schemas:[core.CUSTOM_ELEMENTS_SCHEMA],changeDetection:core.ChangeDetectionStrategy.OnPush,providers:[provideStore((()=>signalStore({})))]}]}],(()=>[]),null);class NgtObjectEvents{constructor(){this.click=(0,core.output)(),this.dblclick=(0,core.output)(),this.contextmenu=(0,core.output)(),this.pointerup=(0,core.output)(),this.pointerdown=(0,core.output)(),this.pointerover=(0,core.output)(),this.pointerout=(0,core.output)(),this.pointerenter=(0,core.output)(),this.pointerleave=(0,core.output)(),this.pointermove=(0,core.output)(),this.pointermissed=(0,core.output)(),this.pointercancel=(0,core.output)(),this.wheel=(0,core.output)(),this.ngtObjectEvents=(0,core.model)(),injectObjectEvents(this.ngtObjectEvents,{click:this.emitEvent("click"),dblclick:this.emitEvent("dblclick"),contextmenu:this.emitEvent("contextmenu"),pointerup:this.emitEvent("pointerup"),pointerdown:this.emitEvent("pointerdown"),pointerover:this.emitEvent("pointerover"),pointerout:this.emitEvent("pointerout"),pointerenter:this.emitEvent("pointerenter"),pointerleave:this.emitEvent("pointerleave"),pointermove:this.emitEvent("pointermove"),pointermissed:this.emitEvent("pointermissed"),pointercancel:this.emitEvent("pointercancel"),wheel:this.emitEvent("wheel")})}emitEvent(eventName){return this[eventName].emit.bind(this[eventName])}static{this.ɵfac=function NgtObjectEvents_Factory(__ngFactoryType__){return new(__ngFactoryType__||NgtObjectEvents)}}static{this.ɵdir=core["ɵɵdefineDirective"]({type:NgtObjectEvents,selectors:[["","ngtObjectEvents",""]],inputs:{ngtObjectEvents:[1,"ngtObjectEvents"]},outputs:{click:"click",dblclick:"dblclick",contextmenu:"contextmenu",pointerup:"pointerup",pointerdown:"pointerdown",pointerover:"pointerover",pointerout:"pointerout",pointerenter:"pointerenter",pointerleave:"pointerleave",pointermove:"pointermove",pointermissed:"pointermissed",pointercancel:"pointercancel",wheel:"wheel",ngtObjectEvents:"ngtObjectEventsChange"}})}}function injectObjectEvents(target,events,{injector}={}){return(0,ngxtension_assert_injector.x)(injectObjectEvents,injector,(()=>{const renderer=(0,core.inject)(core.Renderer2),cleanUps=[];return(0,core.effect)((onCleanup=>{const targetRef=resolveRef(target());targetRef&&(Object.entries(events).forEach((([eventName,eventHandler])=>{cleanUps.push(renderer.listen(targetRef,eventName,eventHandler))})),onCleanup((()=>{cleanUps.forEach((cleanUp=>cleanUp()))})))})),(0,core.inject)(core.DestroyRef).onDestroy((()=>{cleanUps.forEach((cleanUp=>cleanUp()))})),cleanUps}))}function omit(objFn,keysToOmit){return(0,core.computed)((()=>{const obj=objFn(),result={};for(const key of Object.keys(obj))keysToOmit.includes(key)||Object.assign(result,{[key]:obj[key]});return result}),{equal:(a,b)=>is.equ(a,b,{objects:"shallow",arrays:"shallow"})})}function pick(objFn,keyOrKeys){return Array.isArray(keyOrKeys)?(0,core.computed)((()=>{const obj=objFn(),result={};for(const key of keyOrKeys)key in obj&&Object.assign(result,{[key]:obj[key]});return result})):(0,core.computed)((()=>objFn()[keyOrKeys]))}function createVectorComputed(vectorCtor){return(inputOrOptions,keyOrKeepUndefined,keepUndefined)=>{if(void 0===keyOrKeepUndefined||"boolean"==typeof keyOrKeepUndefined){keepUndefined=!!keyOrKeepUndefined;const input=inputOrOptions;return(0,core.computed)((()=>{const value=input();if(!keepUndefined||null!=value)return"number"==typeof value?(new vectorCtor).setScalar(value):value?new vectorCtor(...value):new vectorCtor}),{equal:(a,b)=>!!a&&!!b&&a.equals(b)})}const options=inputOrOptions,key=keyOrKeepUndefined;return(0,core.computed)((()=>{const value=options()[key];if(!keepUndefined||null!=value)return"number"==typeof value?(new vectorCtor).setScalar(value):value?new vectorCtor(...value):new vectorCtor}),{equal:(a,b)=>!!a&&!!b&&a.equals(b)})}}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgtObjectEvents,[{type:core.Directive,args:[{selector:"[ngtObjectEvents]"}]}],(()=>[]),null);createVectorComputed(three_core.I9Y),createVectorComputed(three_core.Pq0),createVectorComputed(three_core.IUQ)},"./node_modules/ngxtension/fesm2022/ngxtension-assert-injector.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>assertInjector});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");function assertInjector(fn,injector,runner){!injector&&(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.assertInInjectionContext)(fn);const assertedInjector=injector??(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.inject)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Injector);return runner?(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.runInInjectionContext)(assertedInjector,runner):assertedInjector}},"./node_modules/ngxtension/fesm2022/ngxtension-inject-inputs.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function mergeInputs(defaultValue={}){return value=>""===value?defaultValue:{...defaultValue,...value}}__webpack_require__.d(__webpack_exports__,{sg:()=>mergeInputs})},"./node_modules/rxjs/dist/esm5/internal/observable/ConnectableObservable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>ConnectableObservable});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_Observable__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),_Subscription__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js"),_operators_refCount__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/refCount.js"),_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_util_lift__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),ConnectableObservable=function(_super){function ConnectableObservable(source,subjectFactory){var _this=_super.call(this)||this;return _this.source=source,_this.subjectFactory=subjectFactory,_this._subject=null,_this._refCount=0,_this._connection=null,(0,_util_lift__WEBPACK_IMPORTED_MODULE_1__.S)(source)&&(_this.lift=source.lift),_this}return(0,tslib__WEBPACK_IMPORTED_MODULE_0__.C6)(ConnectableObservable,_super),ConnectableObservable.prototype._subscribe=function(subscriber){return this.getSubject().subscribe(subscriber)},ConnectableObservable.prototype.getSubject=function(){var subject=this._subject;return subject&&!subject.isStopped||(this._subject=this.subjectFactory()),this._subject},ConnectableObservable.prototype._teardown=function(){this._refCount=0;var _connection=this._connection;this._subject=this._connection=null,null==_connection||_connection.unsubscribe()},ConnectableObservable.prototype.connect=function(){var _this=this,connection=this._connection;if(!connection){connection=this._connection=new _Subscription__WEBPACK_IMPORTED_MODULE_2__.yU;var subject_1=this.getSubject();connection.add(this.source.subscribe((0,_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_3__._)(subject_1,void 0,(function(){_this._teardown(),subject_1.complete()}),(function(err){_this._teardown(),subject_1.error(err)}),(function(){return _this._teardown()})))),connection.closed&&(this._connection=null,connection=_Subscription__WEBPACK_IMPORTED_MODULE_2__.yU.EMPTY)}return connection},ConnectableObservable.prototype.refCount=function(){return(0,_operators_refCount__WEBPACK_IMPORTED_MODULE_4__.B)()(this)},ConnectableObservable}(_Observable__WEBPACK_IMPORTED_MODULE_5__.c)},"./node_modules/rxjs/dist/esm5/internal/observable/concat.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>concat});var mergeAll=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js");var util_args=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/args.js"),from=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/from.js");function concat(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function concatAll(){return(0,mergeAll.U)(1)}()((0,from.H)(args,(0,util_args.lI)(args)))}},"./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>fromEvent});var tslib__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_observable_innerFrom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js"),_Observable__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),_operators_mergeMap__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),_util_isArrayLike__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isArrayLike.js"),_util_isFunction__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isFunction.js"),_util_mapOneOrManyArgs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/mapOneOrManyArgs.js"),nodeEventEmitterMethods=["addListener","removeListener"],eventTargetMethods=["addEventListener","removeEventListener"],jqueryMethods=["on","off"];function fromEvent(target,eventName,options,resultSelector){if((0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(options)&&(resultSelector=options,options=void 0),resultSelector)return fromEvent(target,eventName,options).pipe((0,_util_mapOneOrManyArgs__WEBPACK_IMPORTED_MODULE_1__.I)(resultSelector));var _a=(0,tslib__WEBPACK_IMPORTED_MODULE_2__.zs)(function isEventTarget(target){return(0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(target.addEventListener)&&(0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(target.removeEventListener)}(target)?eventTargetMethods.map((function(methodName){return function(handler){return target[methodName](eventName,handler,options)}})):function isNodeStyleEventEmitter(target){return(0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(target.addListener)&&(0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(target.removeListener)}(target)?nodeEventEmitterMethods.map(toCommonHandlerRegistry(target,eventName)):function isJQueryStyleEventEmitter(target){return(0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(target.on)&&(0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__.T)(target.off)}(target)?jqueryMethods.map(toCommonHandlerRegistry(target,eventName)):[],2),add=_a[0],remove=_a[1];if(!add&&(0,_util_isArrayLike__WEBPACK_IMPORTED_MODULE_3__.X)(target))return(0,_operators_mergeMap__WEBPACK_IMPORTED_MODULE_4__.Z)((function(subTarget){return fromEvent(subTarget,eventName,options)}))((0,_observable_innerFrom__WEBPACK_IMPORTED_MODULE_5__.Tg)(target));if(!add)throw new TypeError("Invalid event target");return new _Observable__WEBPACK_IMPORTED_MODULE_6__.c((function(subscriber){var handler=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return subscriber.next(1<args.length?args:args[0])};return add(handler),function(){return remove(handler)}}))}function toCommonHandlerRegistry(target,eventName){return function(methodName){return function(handler){return target[methodName](eventName,handler)}}}},"./node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>debounceTime});var _scheduler_async__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/async.js"),_util_lift__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js");function debounceTime(dueTime,scheduler){return void 0===scheduler&&(scheduler=_scheduler_async__WEBPACK_IMPORTED_MODULE_0__.E),(0,_util_lift__WEBPACK_IMPORTED_MODULE_1__.N)((function(source,subscriber){var activeTask=null,lastValue=null,lastTime=null,emit=function(){if(activeTask){activeTask.unsubscribe(),activeTask=null;var value=lastValue;lastValue=null,subscriber.next(value)}};function emitWhenIdle(){var targetTime=lastTime+dueTime,now=scheduler.now();if(now<targetTime)return activeTask=this.schedule(void 0,targetTime-now),void subscriber.add(activeTask);emit()}source.subscribe((0,_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__._)(subscriber,(function(value){lastValue=value,lastTime=scheduler.now(),activeTask||(activeTask=scheduler.schedule(emitWhenIdle,dueTime),subscriber.add(activeTask))}),(function(){emit(),subscriber.complete()}),void 0,(function(){lastValue=activeTask=null})))}))}},"./node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>mergeAll});var _mergeMap__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),_util_identity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js");function mergeAll(concurrent){return void 0===concurrent&&(concurrent=1/0),(0,_mergeMap__WEBPACK_IMPORTED_MODULE_0__.Z)(_util_identity__WEBPACK_IMPORTED_MODULE_1__.D,concurrent)}},"./node_modules/rxjs/dist/esm5/internal/operators/refCount.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>refCount});var _util_lift__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js");function refCount(){return(0,_util_lift__WEBPACK_IMPORTED_MODULE_0__.N)((function(source,subscriber){var connection=null;source._refCount++;var refCounter=(0,_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_1__._)(subscriber,void 0,void 0,void 0,(function(){if(!source||source._refCount<=0||0<--source._refCount)connection=null;else{var sharedConnection=source._connection,conn=connection;connection=null,!sharedConnection||conn&&sharedConnection!==conn||sharedConnection.unsubscribe(),subscriber.unsubscribe()}}));source.subscribe(refCounter),refCounter.closed||(connection=source.connect())}))}},"./node_modules/rxjs/dist/esm5/internal/operators/startWith.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>startWith});var _observable_concat__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/concat.js"),_util_args__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/args.js"),_util_lift__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js");function startWith(){for(var values=[],_i=0;_i<arguments.length;_i++)values[_i]=arguments[_i];var scheduler=(0,_util_args__WEBPACK_IMPORTED_MODULE_0__.lI)(values);return(0,_util_lift__WEBPACK_IMPORTED_MODULE_1__.N)((function(source,subscriber){(scheduler?(0,_observable_concat__WEBPACK_IMPORTED_MODULE_2__.x)(values,source,scheduler):(0,_observable_concat__WEBPACK_IMPORTED_MODULE_2__.x)(values,source)).subscribe(subscriber)}))}},"./node_modules/rxjs/dist/esm5/internal/util/EmptyError.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>EmptyError});var EmptyError=(0,__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/createErrorClass.js").L)((function(_super){return function EmptyErrorImpl(){_super(this),this.name="EmptyError",this.message="no elements in sequence"}}))},"./node_modules/rxjs/dist/esm5/internal/util/isObservable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>isObservable});var _Observable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),_isFunction__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isFunction.js");function isObservable(obj){return!!obj&&(obj instanceof _Observable__WEBPACK_IMPORTED_MODULE_0__.c||(0,_isFunction__WEBPACK_IMPORTED_MODULE_1__.T)(obj.lift)&&(0,_isFunction__WEBPACK_IMPORTED_MODULE_1__.T)(obj.subscribe))}}}]);